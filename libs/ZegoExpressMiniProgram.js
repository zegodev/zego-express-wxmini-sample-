!function(t,i){if("object"==typeof exports&&"object"==typeof module)module.exports=i();else if("function"==typeof define&&define.amd)define([],i);else{var n=i();for(var e in n)("object"==typeof exports?exports:t)[e]=n[e]}}("undefined"!=typeof self?self:this,(function(){return(()=>{var __webpack_modules__={537:t=>{"use strict";t.exports=function(t,i){var n=new Array(arguments.length-1),e=0,s=2,r=!0;for(;s<arguments.length;)n[e++]=arguments[s++];return new Promise((function(s,o){n[e]=function(t){if(r)if(r=!1,t)o(t);else{for(var i=new Array(arguments.length-1),n=0;n<i.length;)i[n++]=arguments[n];s.apply(null,i)}};try{t.apply(i||null,n)}catch(t){r&&(r=!1,o(t))}}))}},419:(t,i)=>{"use strict";var n=i;n.length=function(t){var i=t.length;if(!i)return 0;for(var n=0;--i%4>1&&"="===t.charAt(i);)++n;return Math.ceil(3*t.length)/4-n};for(var e=new Array(64),s=new Array(123),r=0;r<64;)s[e[r]=r<26?r+65:r<52?r+71:r<62?r-4:r-59|43]=r++;n.encode=function(t,i,n){for(var s,r=null,o=[],u=0,h=0;i<n;){var a=t[i++];switch(h){case 0:o[u++]=e[a>>2],s=(3&a)<<4,h=1;break;case 1:o[u++]=e[s|a>>4],s=(15&a)<<2,h=2;break;case 2:o[u++]=e[s|a>>6],o[u++]=e[63&a],h=0}u>8191&&((r||(r=[])).push(String.fromCharCode.apply(String,o)),u=0)}return h&&(o[u++]=e[s],o[u++]=61,1===h&&(o[u++]=61)),r?(u&&r.push(String.fromCharCode.apply(String,o.slice(0,u))),r.join("")):String.fromCharCode.apply(String,o.slice(0,u))};var o="invalid encoding";n.decode=function(t,i,n){for(var e,r=n,u=0,h=0;h<t.length;){var a=t.charCodeAt(h++);if(61===a&&u>1)break;if(void 0===(a=s[a]))throw Error(o);switch(u){case 0:e=a,u=1;break;case 1:i[n++]=e<<2|(48&a)>>4,e=a,u=2;break;case 2:i[n++]=(15&e)<<4|(60&a)>>2,e=a,u=3;break;case 3:i[n++]=(3&e)<<6|a,u=0}}if(1===u)throw Error(o);return n-r},n.test=function(t){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(t)}},211:t=>{"use strict";function i(){this._listeners={}}t.exports=i,i.prototype.on=function(t,i,n){return(this._listeners[t]||(this._listeners[t]=[])).push({fn:i,ctx:n||this}),this},i.prototype.off=function(t,i){if(void 0===t)this._listeners={};else if(void 0===i)this._listeners[t]=[];else for(var n=this._listeners[t],e=0;e<n.length;)n[e].fn===i?n.splice(e,1):++e;return this},i.prototype.emit=function(t){var i=this._listeners[t];if(i){for(var n=[],e=1;e<arguments.length;)n.push(arguments[e++]);for(e=0;e<i.length;)i[e].fn.apply(i[e++].ctx,n)}return this}},945:t=>{"use strict";function i(t){return"undefined"!=typeof Float32Array?function(){var i=new Float32Array([-0]),n=new Uint8Array(i.buffer),e=128===n[3];function s(t,e,s){i[0]=t,e[s]=n[0],e[s+1]=n[1],e[s+2]=n[2],e[s+3]=n[3]}function r(t,e,s){i[0]=t,e[s]=n[3],e[s+1]=n[2],e[s+2]=n[1],e[s+3]=n[0]}function o(t,e){return n[0]=t[e],n[1]=t[e+1],n[2]=t[e+2],n[3]=t[e+3],i[0]}function u(t,e){return n[3]=t[e],n[2]=t[e+1],n[1]=t[e+2],n[0]=t[e+3],i[0]}t.writeFloatLE=e?s:r,t.writeFloatBE=e?r:s,t.readFloatLE=e?o:u,t.readFloatBE=e?u:o}():function(){function i(t,i,n,e){var s=i<0?1:0;if(s&&(i=-i),0===i)t(1/i>0?0:2147483648,n,e);else if(isNaN(i))t(2143289344,n,e);else if(i>34028234663852886e22)t((s<<31|2139095040)>>>0,n,e);else if(i<11754943508222875e-54)t((s<<31|Math.round(i/1401298464324817e-60))>>>0,n,e);else{var r=Math.floor(Math.log(i)/Math.LN2);t((s<<31|r+127<<23|8388607&Math.round(i*Math.pow(2,-r)*8388608))>>>0,n,e)}}function o(t,i,n){var e=t(i,n),s=2*(e>>31)+1,r=e>>>23&255,o=8388607&e;return 255===r?o?NaN:s*(1/0):0===r?1401298464324817e-60*s*o:s*Math.pow(2,r-150)*(o+8388608)}t.writeFloatLE=i.bind(null,n),t.writeFloatBE=i.bind(null,e),t.readFloatLE=o.bind(null,s),t.readFloatBE=o.bind(null,r)}(),"undefined"!=typeof Float64Array?function(){var i=new Float64Array([-0]),n=new Uint8Array(i.buffer),e=128===n[7];function s(t,e,s){i[0]=t,e[s]=n[0],e[s+1]=n[1],e[s+2]=n[2],e[s+3]=n[3],e[s+4]=n[4],e[s+5]=n[5],e[s+6]=n[6],e[s+7]=n[7]}function r(t,e,s){i[0]=t,e[s]=n[7],e[s+1]=n[6],e[s+2]=n[5],e[s+3]=n[4],e[s+4]=n[3],e[s+5]=n[2],e[s+6]=n[1],e[s+7]=n[0]}function o(t,e){return n[0]=t[e],n[1]=t[e+1],n[2]=t[e+2],n[3]=t[e+3],n[4]=t[e+4],n[5]=t[e+5],n[6]=t[e+6],n[7]=t[e+7],i[0]}function u(t,e){return n[7]=t[e],n[6]=t[e+1],n[5]=t[e+2],n[4]=t[e+3],n[3]=t[e+4],n[2]=t[e+5],n[1]=t[e+6],n[0]=t[e+7],i[0]}t.writeDoubleLE=e?s:r,t.writeDoubleBE=e?r:s,t.readDoubleLE=e?o:u,t.readDoubleBE=e?u:o}():function(){function i(t,i,n,e,s,r){var o=e<0?1:0;if(o&&(e=-e),0===e)t(0,s,r+i),t(1/e>0?0:2147483648,s,r+n);else if(isNaN(e))t(0,s,r+i),t(2146959360,s,r+n);else if(e>17976931348623157e292)t(0,s,r+i),t((o<<31|2146435072)>>>0,s,r+n);else{var u;if(e<22250738585072014e-324)t((u=e/5e-324)>>>0,s,r+i),t((o<<31|u/4294967296)>>>0,s,r+n);else{var h=Math.floor(Math.log(e)/Math.LN2);1024===h&&(h=1023),t(4503599627370496*(u=e*Math.pow(2,-h))>>>0,s,r+i),t((o<<31|h+1023<<20|1048576*u&1048575)>>>0,s,r+n)}}}function o(t,i,n,e,s){var r=t(e,s+i),o=t(e,s+n),u=2*(o>>31)+1,h=o>>>20&2047,a=4294967296*(1048575&o)+r;return 2047===h?a?NaN:u*(1/0):0===h?5e-324*u*a:u*Math.pow(2,h-1075)*(a+4503599627370496)}t.writeDoubleLE=i.bind(null,n,0,4),t.writeDoubleBE=i.bind(null,e,4,0),t.readDoubleLE=o.bind(null,s,0,4),t.readDoubleBE=o.bind(null,r,4,0)}(),t}function n(t,i,n){i[n]=255&t,i[n+1]=t>>>8&255,i[n+2]=t>>>16&255,i[n+3]=t>>>24}function e(t,i,n){i[n]=t>>>24,i[n+1]=t>>>16&255,i[n+2]=t>>>8&255,i[n+3]=255&t}function s(t,i){return(t[i]|t[i+1]<<8|t[i+2]<<16|t[i+3]<<24)>>>0}function r(t,i){return(t[i]<<24|t[i+1]<<16|t[i+2]<<8|t[i+3])>>>0}t.exports=i(i)},199:module=>{"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(t){}return null}module.exports=inquire},662:t=>{"use strict";t.exports=function(t,i,n){var e=n||8192,s=e>>>1,r=null,o=e;return function(n){if(n<1||n>s)return t(n);o+n>e&&(r=t(e),o=0);var u=i.call(r,o,o+=n);return 7&o&&(o=1+(7|o)),u}}},997:(t,i)=>{"use strict";var n=i;n.length=function(t){for(var i=0,n=0,e=0;e<t.length;++e)(n=t.charCodeAt(e))<128?i+=1:n<2048?i+=2:55296==(64512&n)&&56320==(64512&t.charCodeAt(e+1))?(++e,i+=4):i+=3;return i},n.read=function(t,i,n){if(n-i<1)return"";for(var e,s=null,r=[],o=0;i<n;)(e=t[i++])<128?r[o++]=e:e>191&&e<224?r[o++]=(31&e)<<6|63&t[i++]:e>239&&e<365?(e=((7&e)<<18|(63&t[i++])<<12|(63&t[i++])<<6|63&t[i++])-65536,r[o++]=55296+(e>>10),r[o++]=56320+(1023&e)):r[o++]=(15&e)<<12|(63&t[i++])<<6|63&t[i++],o>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,r)),o=0);return s?(o&&s.push(String.fromCharCode.apply(String,r.slice(0,o))),s.join("")):String.fromCharCode.apply(String,r.slice(0,o))},n.write=function(t,i,n){for(var e,s,r=n,o=0;o<t.length;++o)(e=t.charCodeAt(o))<128?i[n++]=e:e<2048?(i[n++]=e>>6|192,i[n++]=63&e|128):55296==(64512&e)&&56320==(64512&(s=t.charCodeAt(o+1)))?(++o,i[n++]=(e=65536+((1023&e)<<10)+(1023&s))>>18|240,i[n++]=e>>12&63|128,i[n++]=e>>6&63|128,i[n++]=63&e|128):(i[n++]=e>>12|224,i[n++]=e>>6&63|128,i[n++]=63&e|128);return n-r}},720:t=>{t.exports=n;var i=null;try{i=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(t){}function n(t,i,n){this.low=0|t,this.high=0|i,this.unsigned=!!n}function e(t){return!0===(t&&t.__isLong__)}Object.defineProperty(n.prototype,"__isLong__",{value:!0}),n.isLong=e;var s={},r={};function o(t,i){var n,e,o;return i?(o=0<=(t>>>=0)&&t<256)&&(e=r[t])?e:(n=h(t,(0|t)<0?-1:0,!0),o&&(r[t]=n),n):(o=-128<=(t|=0)&&t<128)&&(e=s[t])?e:(n=h(t,t<0?-1:0,!1),o&&(s[t]=n),n)}function u(t,i){if(isNaN(t))return i?p:v;if(i){if(t<0)return p;if(t>=_)return R}else{if(t<=-d)return O;if(t+1>=d)return S}return t<0?u(-t,i).neg():h(t%f|0,t/f|0,i)}function h(t,i,e){return new n(t,i,e)}n.fromInt=o,n.fromNumber=u,n.fromBits=h;var a=Math.pow;function c(t,i,n){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return v;if("number"==typeof i?(n=i,i=!1):i=!!i,(n=n||10)<2||36<n)throw RangeError("radix");var e;if((e=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===e)return c(t.substring(1),i,n).neg();for(var s=u(a(n,8)),r=v,o=0;o<t.length;o+=8){var h=Math.min(8,t.length-o),l=parseInt(t.substring(o,o+h),n);if(h<8){var f=u(a(n,h));r=r.mul(f).add(u(l))}else r=(r=r.mul(s)).add(u(l))}return r.unsigned=i,r}function l(t,i){return"number"==typeof t?u(t,i):"string"==typeof t?c(t,i):h(t.low,t.high,"boolean"==typeof i?i:t.unsigned)}n.fromString=c,n.fromValue=l;var f=4294967296,_=f*f,d=_/2,m=o(1<<24),v=o(0);n.ZERO=v;var p=o(0,!0);n.UZERO=p;var g=o(1);n.ONE=g;var b=o(1,!0);n.UONE=b;var E=o(-1);n.NEG_ONE=E;var S=h(-1,2147483647,!1);n.MAX_VALUE=S;var R=h(-1,-1,!0);n.MAX_UNSIGNED_VALUE=R;var O=h(0,-2147483648,!1);n.MIN_VALUE=O;var y=n.prototype;y.toInt=function(){return this.unsigned?this.low>>>0:this.low},y.toNumber=function(){return this.unsigned?(this.high>>>0)*f+(this.low>>>0):this.high*f+(this.low>>>0)},y.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(O)){var i=u(t),n=this.div(i),e=n.mul(i).sub(this);return n.toString(t)+e.toInt().toString(t)}return"-"+this.neg().toString(t)}for(var s=u(a(t,6),this.unsigned),r=this,o="";;){var h=r.div(s),c=(r.sub(h.mul(s)).toInt()>>>0).toString(t);if((r=h).isZero())return c+o;for(;c.length<6;)c="0"+c;o=""+c+o}},y.getHighBits=function(){return this.high},y.getHighBitsUnsigned=function(){return this.high>>>0},y.getLowBits=function(){return this.low},y.getLowBitsUnsigned=function(){return this.low>>>0},y.getNumBitsAbs=function(){if(this.isNegative())return this.eq(O)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,i=31;i>0&&0==(t&1<<i);i--);return 0!=this.high?i+33:i+1},y.isZero=function(){return 0===this.high&&0===this.low},y.eqz=y.isZero,y.isNegative=function(){return!this.unsigned&&this.high<0},y.isPositive=function(){return this.unsigned||this.high>=0},y.isOdd=function(){return 1==(1&this.low)},y.isEven=function(){return 0==(1&this.low)},y.equals=function(t){return e(t)||(t=l(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&(this.high===t.high&&this.low===t.low)},y.eq=y.equals,y.notEquals=function(t){return!this.eq(t)},y.neq=y.notEquals,y.ne=y.notEquals,y.lessThan=function(t){return this.comp(t)<0},y.lt=y.lessThan,y.lessThanOrEqual=function(t){return this.comp(t)<=0},y.lte=y.lessThanOrEqual,y.le=y.lessThanOrEqual,y.greaterThan=function(t){return this.comp(t)>0},y.gt=y.greaterThan,y.greaterThanOrEqual=function(t){return this.comp(t)>=0},y.gte=y.greaterThanOrEqual,y.ge=y.greaterThanOrEqual,y.compare=function(t){if(e(t)||(t=l(t)),this.eq(t))return 0;var i=this.isNegative(),n=t.isNegative();return i&&!n?-1:!i&&n?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},y.comp=y.compare,y.negate=function(){return!this.unsigned&&this.eq(O)?O:this.not().add(g)},y.neg=y.negate,y.add=function(t){e(t)||(t=l(t));var i=0,n=0,s=0,r=0;return s+=(r+=(65535&this.low)+(65535&t.low))>>>16,n+=(s+=(this.low>>>16)+(t.low>>>16))>>>16,i+=(n+=(65535&this.high)+(65535&t.high))>>>16,i+=(this.high>>>16)+(t.high>>>16),h((s&=65535)<<16|(r&=65535),(i&=65535)<<16|(n&=65535),this.unsigned)},y.subtract=function(t){return e(t)||(t=l(t)),this.add(t.neg())},y.sub=y.subtract,y.multiply=function(t){if(this.isZero())return v;if(e(t)||(t=l(t)),i)return h(i.mul(this.low,this.high,t.low,t.high),i.get_high(),this.unsigned);if(t.isZero())return v;if(this.eq(O))return t.isOdd()?O:v;if(t.eq(O))return this.isOdd()?O:v;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(m)&&t.lt(m))return u(this.toNumber()*t.toNumber(),this.unsigned);var n=65535&this.high,s=this.low>>>16,r=65535&this.low,o=65535&t.high,a=t.low>>>16,c=65535&t.low,f=0,_=0,d=0,p=0;return d+=(p+=r*c)>>>16,_+=(d+=s*c)>>>16,d&=65535,_+=(d+=r*a)>>>16,f+=(_+=n*c)>>>16,_&=65535,f+=(_+=s*a)>>>16,_&=65535,f+=(_+=r*o)>>>16,f+=(this.high>>>16)*c+n*a+s*o+r*(t.high>>>16),h((d&=65535)<<16|(p&=65535),(f&=65535)<<16|(_&=65535),this.unsigned)},y.mul=y.multiply,y.divide=function(t){if(e(t)||(t=l(t)),t.isZero())throw Error("division by zero");var n,s,r;if(i)return this.unsigned||-2147483648!==this.high||-1!==t.low||-1!==t.high?h((this.unsigned?i.div_u:i.div_s)(this.low,this.high,t.low,t.high),i.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?p:v;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return p;if(t.gt(this.shru(1)))return b;r=p}else{if(this.eq(O))return t.eq(g)||t.eq(E)?O:t.eq(O)?g:(n=this.shr(1).div(t).shl(1)).eq(v)?t.isNegative()?g:E:(s=this.sub(t.mul(n)),r=n.add(s.div(t)));if(t.eq(O))return this.unsigned?p:v;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();r=v}for(s=this;s.gte(t);){n=Math.max(1,Math.floor(s.toNumber()/t.toNumber()));for(var o=Math.ceil(Math.log(n)/Math.LN2),c=o<=48?1:a(2,o-48),f=u(n),_=f.mul(t);_.isNegative()||_.gt(s);)_=(f=u(n-=c,this.unsigned)).mul(t);f.isZero()&&(f=g),r=r.add(f),s=s.sub(_)}return r},y.div=y.divide,y.modulo=function(t){return e(t)||(t=l(t)),i?h((this.unsigned?i.rem_u:i.rem_s)(this.low,this.high,t.low,t.high),i.get_high(),this.unsigned):this.sub(this.div(t).mul(t))},y.mod=y.modulo,y.rem=y.modulo,y.not=function(){return h(~this.low,~this.high,this.unsigned)},y.and=function(t){return e(t)||(t=l(t)),h(this.low&t.low,this.high&t.high,this.unsigned)},y.or=function(t){return e(t)||(t=l(t)),h(this.low|t.low,this.high|t.high,this.unsigned)},y.xor=function(t){return e(t)||(t=l(t)),h(this.low^t.low,this.high^t.high,this.unsigned)},y.shiftLeft=function(t){return e(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?h(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):h(0,this.low<<t-32,this.unsigned)},y.shl=y.shiftLeft,y.shiftRight=function(t){return e(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?h(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):h(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},y.shr=y.shiftRight,y.shiftRightUnsigned=function(t){if(e(t)&&(t=t.toInt()),0===(t&=63))return this;var i=this.high;return t<32?h(this.low>>>t|i<<32-t,i>>>t,this.unsigned):h(32===t?i:i>>>t-32,0,this.unsigned)},y.shru=y.shiftRightUnsigned,y.shr_u=y.shiftRightUnsigned,y.toSigned=function(){return this.unsigned?h(this.low,this.high,!1):this},y.toUnsigned=function(){return this.unsigned?this:h(this.low,this.high,!0)},y.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},y.toBytesLE=function(){var t=this.high,i=this.low;return[255&i,i>>>8&255,i>>>16&255,i>>>24,255&t,t>>>8&255,t>>>16&255,t>>>24]},y.toBytesBE=function(){var t=this.high,i=this.low;return[t>>>24,t>>>16&255,t>>>8&255,255&t,i>>>24,i>>>16&255,i>>>8&255,255&i]},n.fromBytes=function(t,i,e){return e?n.fromBytesLE(t,i):n.fromBytesBE(t,i)},n.fromBytesLE=function(t,i){return new n(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,i)},n.fromBytesBE=function(t,i){return new n(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],i)}},100:(t,i,n)=>{"use strict";t.exports=n(482)},482:(t,i,n)=>{"use strict";var e=i;function s(){e.util._configure(),e.Writer._configure(e.BufferWriter),e.Reader._configure(e.BufferReader)}e.build="minimal",e.Writer=n(173),e.BufferWriter=n(155),e.Reader=n(408),e.BufferReader=n(593),e.util=n(693),e.rpc=n(994),e.roots=n(54),e.configure=s,s()},408:(t,i,n)=>{"use strict";t.exports=h;var e,s=n(693),r=s.LongBits,o=s.utf8;function u(t,i){return RangeError("index out of range: "+t.pos+" + "+(i||1)+" > "+t.len)}function h(t){this.buf=t,this.pos=0,this.len=t.length}var a,c="undefined"!=typeof Uint8Array?function(t){if(t instanceof Uint8Array||Array.isArray(t))return new h(t);throw Error("illegal buffer")}:function(t){if(Array.isArray(t))return new h(t);throw Error("illegal buffer")},l=function(){return s.Buffer?function(t){return(h.create=function(t){return s.Buffer.isBuffer(t)?new e(t):c(t)})(t)}:c};function f(){var t=new r(0,0),i=0;if(!(this.len-this.pos>4)){for(;i<3;++i){if(this.pos>=this.len)throw u(this);if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*i)>>>0,this.buf[this.pos++]<128)return t}return t.lo=(t.lo|(127&this.buf[this.pos++])<<7*i)>>>0,t}for(;i<4;++i)if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*i)>>>0,this.buf[this.pos++]<128)return t;if(t.lo=(t.lo|(127&this.buf[this.pos])<<28)>>>0,t.hi=(t.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return t;if(i=0,this.len-this.pos>4){for(;i<5;++i)if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*i+3)>>>0,this.buf[this.pos++]<128)return t}else for(;i<5;++i){if(this.pos>=this.len)throw u(this);if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*i+3)>>>0,this.buf[this.pos++]<128)return t}throw Error("invalid varint encoding")}function _(t,i){return(t[i-4]|t[i-3]<<8|t[i-2]<<16|t[i-1]<<24)>>>0}function d(){if(this.pos+8>this.len)throw u(this,8);return new r(_(this.buf,this.pos+=4),_(this.buf,this.pos+=4))}h.create=l(),h.prototype._slice=s.Array.prototype.subarray||s.Array.prototype.slice,h.prototype.uint32=(a=4294967295,function(){if(a=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return a;if(a=(a|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return a;if(a=(a|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return a;if(a=(a|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return a;if(a=(a|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return a;if((this.pos+=5)>this.len)throw this.pos=this.len,u(this,10);return a}),h.prototype.int32=function(){return 0|this.uint32()},h.prototype.sint32=function(){var t=this.uint32();return t>>>1^-(1&t)|0},h.prototype.bool=function(){return 0!==this.uint32()},h.prototype.fixed32=function(){if(this.pos+4>this.len)throw u(this,4);return _(this.buf,this.pos+=4)},h.prototype.sfixed32=function(){if(this.pos+4>this.len)throw u(this,4);return 0|_(this.buf,this.pos+=4)},h.prototype.float=function(){if(this.pos+4>this.len)throw u(this,4);var t=s.float.readFloatLE(this.buf,this.pos);return this.pos+=4,t},h.prototype.double=function(){if(this.pos+8>this.len)throw u(this,4);var t=s.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,t},h.prototype.bytes=function(){var t=this.uint32(),i=this.pos,n=this.pos+t;if(n>this.len)throw u(this,t);return this.pos+=t,Array.isArray(this.buf)?this.buf.slice(i,n):i===n?new this.buf.constructor(0):this._slice.call(this.buf,i,n)},h.prototype.string=function(){var t=this.bytes();return o.read(t,0,t.length)},h.prototype.skip=function(t){if("number"==typeof t){if(this.pos+t>this.len)throw u(this,t);this.pos+=t}else do{if(this.pos>=this.len)throw u(this)}while(128&this.buf[this.pos++]);return this},h.prototype.skipType=function(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(t=7&this.uint32());)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+t+" at offset "+this.pos)}return this},h._configure=function(t){e=t,h.create=l(),e._configure();var i=s.Long?"toLong":"toNumber";s.merge(h.prototype,{int64:function(){return f.call(this)[i](!1)},uint64:function(){return f.call(this)[i](!0)},sint64:function(){return f.call(this).zzDecode()[i](!1)},fixed64:function(){return d.call(this)[i](!0)},sfixed64:function(){return d.call(this)[i](!1)}})}},593:(t,i,n)=>{"use strict";t.exports=r;var e=n(408);(r.prototype=Object.create(e.prototype)).constructor=r;var s=n(693);function r(t){e.call(this,t)}r._configure=function(){s.Buffer&&(r.prototype._slice=s.Buffer.prototype.slice)},r.prototype.string=function(){var t=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+t,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+t,this.len))},r._configure()},54:t=>{"use strict";t.exports={}},994:(t,i,n)=>{"use strict";i.Service=n(948)},948:(t,i,n)=>{"use strict";t.exports=s;var e=n(693);function s(t,i,n){if("function"!=typeof t)throw TypeError("rpcImpl must be a function");e.EventEmitter.call(this),this.rpcImpl=t,this.requestDelimited=Boolean(i),this.responseDelimited=Boolean(n)}(s.prototype=Object.create(e.EventEmitter.prototype)).constructor=s,s.prototype.rpcCall=function t(i,n,s,r,o){if(!r)throw TypeError("request must be specified");var u=this;if(!o)return e.asPromise(t,u,i,n,s,r);if(u.rpcImpl)try{return u.rpcImpl(i,n[u.requestDelimited?"encodeDelimited":"encode"](r).finish(),(function(t,n){if(t)return u.emit("error",t,i),o(t);if(null!==n){if(!(n instanceof s))try{n=s[u.responseDelimited?"decodeDelimited":"decode"](n)}catch(t){return u.emit("error",t,i),o(t)}return u.emit("data",n,i),o(null,n)}u.end(!0)}))}catch(t){return u.emit("error",t,i),void setTimeout((function(){o(t)}),0)}else setTimeout((function(){o(Error("already ended"))}),0)},s.prototype.end=function(t){return this.rpcImpl&&(t||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},630:(t,i,n)=>{"use strict";t.exports=s;var e=n(693);function s(t,i){this.lo=t>>>0,this.hi=i>>>0}var r=s.zero=new s(0,0);r.toNumber=function(){return 0},r.zzEncode=r.zzDecode=function(){return this},r.length=function(){return 1};var o=s.zeroHash="\0\0\0\0\0\0\0\0";s.fromNumber=function(t){if(0===t)return r;var i=t<0;i&&(t=-t);var n=t>>>0,e=(t-n)/4294967296>>>0;return i&&(e=~e>>>0,n=~n>>>0,++n>4294967295&&(n=0,++e>4294967295&&(e=0))),new s(n,e)},s.from=function(t){if("number"==typeof t)return s.fromNumber(t);if(e.isString(t)){if(!e.Long)return s.fromNumber(parseInt(t,10));t=e.Long.fromString(t)}return t.low||t.high?new s(t.low>>>0,t.high>>>0):r},s.prototype.toNumber=function(t){if(!t&&this.hi>>>31){var i=1+~this.lo>>>0,n=~this.hi>>>0;return i||(n=n+1>>>0),-(i+4294967296*n)}return this.lo+4294967296*this.hi},s.prototype.toLong=function(t){return e.Long?new e.Long(0|this.lo,0|this.hi,Boolean(t)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(t)}};var u=String.prototype.charCodeAt;s.fromHash=function(t){return t===o?r:new s((u.call(t,0)|u.call(t,1)<<8|u.call(t,2)<<16|u.call(t,3)<<24)>>>0,(u.call(t,4)|u.call(t,5)<<8|u.call(t,6)<<16|u.call(t,7)<<24)>>>0)},s.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},s.prototype.zzEncode=function(){var t=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0,this.lo=(this.lo<<1^t)>>>0,this},s.prototype.zzDecode=function(){var t=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0,this.hi=(this.hi>>>1^t)>>>0,this},s.prototype.length=function(){var t=this.lo,i=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===i?t<16384?t<128?1:2:t<2097152?3:4:i<16384?i<128?5:6:i<2097152?7:8:n<128?9:10}},693:function(t,i,n){"use strict";var e=i;function s(t,i,n){for(var e=Object.keys(i),s=0;s<e.length;++s)void 0!==t[e[s]]&&n||(t[e[s]]=i[e[s]]);return t}function r(t){function i(t,n){if(!(this instanceof i))return new i(t,n);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,i):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),n&&s(this,n)}return(i.prototype=Object.create(Error.prototype)).constructor=i,Object.defineProperty(i.prototype,"name",{get:function(){return t}}),i.prototype.toString=function(){return this.name+": "+this.message},i}e.asPromise=n(537),e.base64=n(419),e.EventEmitter=n(211),e.float=n(945),e.inquire=n(199),e.utf8=n(997),e.pool=n(662),e.LongBits=n(630),e.isNode=Boolean(void 0!==n.g&&n.g&&n.g.process&&n.g.process.versions&&n.g.process.versions.node),e.global=e.isNode&&n.g||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||this,e.emptyArray=Object.freeze?Object.freeze([]):[],e.emptyObject=Object.freeze?Object.freeze({}):{},e.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},e.isString=function(t){return"string"==typeof t||t instanceof String},e.isObject=function(t){return t&&"object"==typeof t},e.isset=e.isSet=function(t,i){var n=t[i];return!(null==n||!t.hasOwnProperty(i))&&("object"!=typeof n||(Array.isArray(n)?n.length:Object.keys(n).length)>0)},e.Buffer=function(){try{var t=e.inquire("buffer").Buffer;return t.prototype.utf8Write?t:null}catch(t){return null}}(),e._Buffer_from=null,e._Buffer_allocUnsafe=null,e.newBuffer=function(t){return"number"==typeof t?e.Buffer?e._Buffer_allocUnsafe(t):new e.Array(t):e.Buffer?e._Buffer_from(t):"undefined"==typeof Uint8Array?t:new Uint8Array(t)},e.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,e.Long=e.global.dcodeIO&&e.global.dcodeIO.Long||e.global.Long||e.inquire("long"),e.key2Re=/^true|false|0|1$/,e.key32Re=/^-?(?:0|[1-9][0-9]*)$/,e.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,e.longToHash=function(t){return t?e.LongBits.from(t).toHash():e.LongBits.zeroHash},e.longFromHash=function(t,i){var n=e.LongBits.fromHash(t);return e.Long?e.Long.fromBits(n.lo,n.hi,i):n.toNumber(Boolean(i))},e.merge=s,e.lcFirst=function(t){return t.charAt(0).toLowerCase()+t.substring(1)},e.newError=r,e.ProtocolError=r("ProtocolError"),e.oneOfGetter=function(t){for(var i={},n=0;n<t.length;++n)i[t[n]]=1;return function(){for(var t=Object.keys(this),n=t.length-1;n>-1;--n)if(1===i[t[n]]&&null!=this[t[n]])return t[n]}},e.oneOfSetter=function(t){return function(i){for(var n=0;n<t.length;++n)t[n]!==i&&delete this[t[n]]}},e.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},e._configure=function(){var t=e.Buffer;t?(e._Buffer_from=t.from!==Uint8Array.from&&t.from||function(i,n){return new t(i,n)},e._Buffer_allocUnsafe=t.allocUnsafe||function(i){return new t(i)}):e._Buffer_from=e._Buffer_allocUnsafe=null}},173:(t,i,n)=>{"use strict";t.exports=l;var e,s=n(693),r=s.LongBits,o=s.base64,u=s.utf8;function h(t,i,n){this.fn=t,this.len=i,this.next=void 0,this.val=n}function a(){}function c(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}function l(){this.len=0,this.head=new h(a,0,0),this.tail=this.head,this.states=null}var f=function(){return s.Buffer?function(){return(l.create=function(){return new e})()}:function(){return new l}};function _(t,i,n){i[n]=255&t}function d(t,i){this.len=t,this.next=void 0,this.val=i}function m(t,i,n){for(;t.hi;)i[n++]=127&t.lo|128,t.lo=(t.lo>>>7|t.hi<<25)>>>0,t.hi>>>=7;for(;t.lo>127;)i[n++]=127&t.lo|128,t.lo=t.lo>>>7;i[n++]=t.lo}function v(t,i,n){i[n]=255&t,i[n+1]=t>>>8&255,i[n+2]=t>>>16&255,i[n+3]=t>>>24}l.create=f(),l.alloc=function(t){return new s.Array(t)},s.Array!==Array&&(l.alloc=s.pool(l.alloc,s.Array.prototype.subarray)),l.prototype._push=function(t,i,n){return this.tail=this.tail.next=new h(t,i,n),this.len+=i,this},(d.prototype=Object.create(h.prototype)).fn=function(t,i,n){for(;t>127;)i[n++]=127&t|128,t>>>=7;i[n]=t},l.prototype.uint32=function(t){return this.len+=(this.tail=this.tail.next=new d((t>>>=0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this},l.prototype.int32=function(t){return t<0?this._push(m,10,r.fromNumber(t)):this.uint32(t)},l.prototype.sint32=function(t){return this.uint32((t<<1^t>>31)>>>0)},l.prototype.int64=l.prototype.uint64=function(t){var i=r.from(t);return this._push(m,i.length(),i)},l.prototype.sint64=function(t){var i=r.from(t).zzEncode();return this._push(m,i.length(),i)},l.prototype.bool=function(t){return this._push(_,1,t?1:0)},l.prototype.sfixed32=l.prototype.fixed32=function(t){return this._push(v,4,t>>>0)},l.prototype.sfixed64=l.prototype.fixed64=function(t){var i=r.from(t);return this._push(v,4,i.lo)._push(v,4,i.hi)},l.prototype.float=function(t){return this._push(s.float.writeFloatLE,4,t)},l.prototype.double=function(t){return this._push(s.float.writeDoubleLE,8,t)};var p=s.Array.prototype.set?function(t,i,n){i.set(t,n)}:function(t,i,n){for(var e=0;e<t.length;++e)i[n+e]=t[e]};l.prototype.bytes=function(t){var i=t.length>>>0;if(!i)return this._push(_,1,0);if(s.isString(t)){var n=l.alloc(i=o.length(t));o.decode(t,n,0),t=n}return this.uint32(i)._push(p,i,t)},l.prototype.string=function(t){var i=u.length(t);return i?this.uint32(i)._push(u.write,i,t):this._push(_,1,0)},l.prototype.fork=function(){return this.states=new c(this),this.head=this.tail=new h(a,0,0),this.len=0,this},l.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new h(a,0,0),this.len=0),this},l.prototype.ldelim=function(){var t=this.head,i=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=t.next,this.tail=i,this.len+=n),this},l.prototype.finish=function(){for(var t=this.head.next,i=this.constructor.alloc(this.len),n=0;t;)t.fn(t.val,i,n),n+=t.len,t=t.next;return i},l._configure=function(t){e=t,l.create=f(),e._configure()}},155:(t,i,n)=>{"use strict";t.exports=r;var e=n(173);(r.prototype=Object.create(e.prototype)).constructor=r;var s=n(693);function r(){e.call(this)}function o(t,i,n){t.length<40?s.utf8.write(t,i,n):i.utf8Write?i.utf8Write(t,n):i.write(t,n)}r._configure=function(){r.alloc=s._Buffer_allocUnsafe,r.writeBytesBuffer=s.Buffer&&s.Buffer.prototype instanceof Uint8Array&&"set"===s.Buffer.prototype.set.name?function(t,i,n){i.set(t,n)}:function(t,i,n){if(t.copy)t.copy(i,n,0,t.length);else for(var e=0;e<t.length;)i[n++]=t[e++]}},r.prototype.bytes=function(t){s.isString(t)&&(t=s._Buffer_from(t,"base64"));var i=t.length>>>0;return this.uint32(i),i&&this._push(r.writeBytesBuffer,i,t),this},r.prototype.string=function(t){var i=s.Buffer.byteLength(t);return this.uint32(i),i&&this._push(o,i,t),this},r._configure()},901:function(t,i,n){"undefined"!=typeof self&&self,t.exports=function(t){return n=[function(t,i,n){"use strict";function e(t){return"number"==typeof t}function s(t){return"string"==typeof t}function r(t){return"boolean"==typeof t}function o(t){return void 0===t}function u(t){return null!==t&&t instanceof Object}function h(t){return"function"==typeof t}function a(t){return t instanceof Array}n.d(i,"d",(function(){return e})),n.d(i,"f",(function(){return s})),n.d(i,"b",(function(){return r})),n.d(i,"g",(function(){return o})),n.d(i,"e",(function(){return u})),n.d(i,"c",(function(){return h})),n.d(i,"a",(function(){return a}))},function(t,i,n){var e=function(t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=null;try{i=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(t){}function n(t,i,n){this.low=0|t,this.high=0|i,this.unsigned=!!n}function e(t){return!0===(t&&t.__isLong__)}function s(t){var i=Math.clz32(t&-t);return t?31-i:i}Object.defineProperty(n.prototype,"__isLong__",{value:!0}),n.isLong=e;var r={},o={};function u(t,i){var n,e,s;return i?(s=0<=(t>>>=0)&&t<256)&&(e=o[t])?e:(n=a(t,0,!0),s&&(o[t]=n),n):(s=-128<=(t|=0)&&t<128)&&(e=r[t])?e:(n=a(t,t<0?-1:0,!1),s&&(r[t]=n),n)}function h(t,i){if(isNaN(t))return i?g:p;if(i){if(t<0)return g;if(d<=t)return O}else{if(t<=-m)return y;if(m<=t+1)return R}return t<0?h(-t,i).neg():a(t%_|0,t/_|0,i)}function a(t,i,e){return new n(t,i,e)}n.fromInt=u,n.fromNumber=h,n.fromBits=a;var c=Math.pow;function l(t,i,n){if(0===t.length)throw Error("empty string");if(i="number"==typeof i?(n=i,!1):!!i,"NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return i?g:p;if((n=n||10)<2||36<n)throw RangeError("radix");var e;if(0<(e=t.indexOf("-")))throw Error("interior hyphen");if(0===e)return l(t.substring(1),i,n).neg();for(var s=h(c(n,8)),r=p,o=0;o<t.length;o+=8){var u=Math.min(8,t.length-o),a=parseInt(t.substring(o,o+u),n);r=(u<8?(u=h(c(n,u)),r.mul(u)):r=r.mul(s)).add(h(a))}return r.unsigned=i,r}function f(t,i){return"number"==typeof t?h(t,i):"string"==typeof t?l(t,i):a(t.low,t.high,"boolean"==typeof i?i:t.unsigned)}n.fromString=l,n.fromValue=f;var _=4294967296,d=_*_,m=d/2,v=u(1<<24),p=u(0),g=(n.ZERO=p,u(0,!0)),b=(n.UZERO=g,u(1)),E=(n.ONE=b,u(1,!0)),S=(n.UONE=E,u(-1)),R=(n.NEG_ONE=S,a(-1,2147483647,!1)),O=(n.MAX_VALUE=R,a(-1,-1,!0)),y=(n.MAX_UNSIGNED_VALUE=O,a(0,-2147483648,!1)),T=(n.MIN_VALUE=y,n.prototype);return T.toInt=function(){return this.unsigned?this.low>>>0:this.low},T.toNumber=function(){return this.unsigned?(this.high>>>0)*_+(this.low>>>0):this.high*_+(this.low>>>0)},T.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";var i,n;if(this.isNegative())return this.eq(y)?(n=h(t),n=(i=this.div(n)).mul(n).sub(this),i.toString(t)+n.toInt().toString(t)):"-"+this.neg().toString(t);for(var e=h(c(t,6),this.unsigned),s=this,r="";;){var o=s.div(e),u=(s.sub(o.mul(e)).toInt()>>>0).toString(t);if((s=o).isZero())return u+r;for(;u.length<6;)u="0"+u;r=""+u+r}},T.getHighBits=function(){return this.high},T.getHighBitsUnsigned=function(){return this.high>>>0},T.getLowBits=function(){return this.low},T.getLowBitsUnsigned=function(){return this.low>>>0},T.getNumBitsAbs=function(){if(this.isNegative())return this.eq(y)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,i=31;0<i&&0==(t&1<<i);i--);return 0!=this.high?i+33:i+1},T.isZero=function(){return 0===this.high&&0===this.low},T.eqz=T.isZero,T.isNegative=function(){return!this.unsigned&&this.high<0},T.isPositive=function(){return this.unsigned||0<=this.high},T.isOdd=function(){return 1==(1&this.low)},T.isEven=function(){return 0==(1&this.low)},T.equals=function(t){return e(t)||(t=f(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&this.high===t.high&&this.low===t.low},T.eq=T.equals,T.notEquals=function(t){return!this.eq(t)},T.neq=T.notEquals,T.ne=T.notEquals,T.lessThan=function(t){return this.comp(t)<0},T.lt=T.lessThan,T.lessThanOrEqual=function(t){return this.comp(t)<=0},T.lte=T.lessThanOrEqual,T.le=T.lessThanOrEqual,T.greaterThan=function(t){return 0<this.comp(t)},T.gt=T.greaterThan,T.greaterThanOrEqual=function(t){return 0<=this.comp(t)},T.gte=T.greaterThanOrEqual,T.ge=T.greaterThanOrEqual,T.compare=function(t){var i,n;return e(t)||(t=f(t)),this.eq(t)?0:(i=this.isNegative(),n=t.isNegative(),i&&!n?-1:!i&&n?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1)},T.comp=T.compare,T.negate=function(){return!this.unsigned&&this.eq(y)?y:this.not().add(b)},T.neg=T.negate,T.add=function(t){e(t)||(t=f(t));var i=0,n=0,s=0,r=0;return n+=(s=s+((r+=(65535&this.low)+(65535&t.low))>>>16)+((this.low>>>16)+(t.low>>>16)))>>>16,a((s&=65535)<<16|(r&=65535),((i+=(n+=(65535&this.high)+(65535&t.high))>>>16)+((this.high>>>16)+(t.high>>>16))&65535)<<16|(n&=65535),this.unsigned)},T.subtract=function(t){return e(t)||(t=f(t)),this.add(t.neg())},T.sub=T.subtract,T.multiply=function(t){var n,s,r,o,u,c,l,_,d,m;return this.isZero()?this:(e(t)||(t=f(t)),i?a(i.mul(this.low,this.high,t.low,t.high),i.get_high(),this.unsigned):t.isZero()?this.unsigned?g:p:this.eq(y)?t.isOdd()?y:p:t.eq(y)?this.isOdd()?y:p:this.isNegative()?t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg():t.isNegative()?this.mul(t.neg()).neg():this.lt(v)&&t.lt(v)?h(this.toNumber()*t.toNumber(),this.unsigned):(o=t.high>>>16,u=65535&t.high,c=t.low>>>16,m=(m=d=_=l=0)+((_=_+((d+=(r=65535&this.low)*(t=65535&t.low))>>>16)+(s=this.low>>>16)*t)>>>16)+((_=(65535&_)+r*c)>>>16),a((_&=65535)<<16|(d&=65535),(l=(l=(l+=(m+=(n=65535&this.high)*t)>>>16)+((m=(65535&m)+s*c)>>>16)+((m=(65535&m)+r*u)>>>16))+((this.high>>>16)*t+n*c+s*u+r*o)&65535)<<16|(m&=65535),this.unsigned)))},T.mul=T.multiply,T.divide=function(t){if((t=e(t)?t:f(t)).isZero())throw Error("division by zero");var n,s,r;if(i)return this.unsigned||-2147483648!==this.high||-1!==t.low||-1!==t.high?a((this.unsigned?i.div_u:i.div_s)(this.low,this.high,t.low,t.high),i.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?g:p;if(this.unsigned){if((t=t.unsigned?t:t.toUnsigned()).gt(this))return g;if(t.gt(this.shru(1)))return E;s=g}else{if(this.eq(y))return t.eq(b)||t.eq(S)?y:t.eq(y)?b:(r=this.shr(1).div(t).shl(1)).eq(p)?t.isNegative()?b:S:(n=this.sub(t.mul(r)),r.add(n.div(t)));if(t.eq(y))return this.unsigned?g:p;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();s=p}for(n=this;n.gte(t);){r=Math.max(1,Math.floor(n.toNumber()/t.toNumber()));for(var o=Math.ceil(Math.log(r)/Math.LN2),u=o<=48?1:c(2,o-48),l=h(r),_=l.mul(t);_.isNegative()||_.gt(n);)_=(l=h(r-=u,this.unsigned)).mul(t);l.isZero()&&(l=b),s=s.add(l),n=n.sub(_)}return s},T.div=T.divide,T.modulo=function(t){return e(t)||(t=f(t)),i?a((this.unsigned?i.rem_u:i.rem_s)(this.low,this.high,t.low,t.high),i.get_high(),this.unsigned):this.sub(this.div(t).mul(t))},T.mod=T.modulo,T.rem=T.modulo,T.not=function(){return a(~this.low,~this.high,this.unsigned)},T.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},T.clz=T.countLeadingZeros,T.countTrailingZeros=function(){return this.low?s(this.low):s(this.high)+32},T.ctz=T.countTrailingZeros,T.and=function(t){return e(t)||(t=f(t)),a(this.low&t.low,this.high&t.high,this.unsigned)},T.or=function(t){return e(t)||(t=f(t)),a(this.low|t.low,this.high|t.high,this.unsigned)},T.xor=function(t){return e(t)||(t=f(t)),a(this.low^t.low,this.high^t.high,this.unsigned)},T.shiftLeft=function(t){return e(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?a(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):a(0,this.low<<t-32,this.unsigned)},T.shl=T.shiftLeft,T.shiftRight=function(t){return e(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?a(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):a(this.high>>t-32,0<=this.high?0:-1,this.unsigned)},T.shr=T.shiftRight,T.shiftRightUnsigned=function(t){return e(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?a(this.low>>>t|this.high<<32-t,this.high>>>t,this.unsigned):a(32===t?this.high:this.high>>>t-32,0,this.unsigned)},T.shru=T.shiftRightUnsigned,T.shr_u=T.shiftRightUnsigned,T.rotateLeft=function(t){var i;return e(t)&&(t=t.toInt()),0==(t&=63)?this:32===t?a(this.high,this.low,this.unsigned):t<32?a(this.low<<t|this.high>>>(i=32-t),this.high<<t|this.low>>>i,this.unsigned):a(this.high<<(t-=32)|this.low>>>(i=32-t),this.low<<t|this.high>>>i,this.unsigned)},T.rotl=T.rotateLeft,T.rotateRight=function(t){var i;return e(t)&&(t=t.toInt()),0==(t&=63)?this:32===t?a(this.high,this.low,this.unsigned):t<32?a(this.high<<(i=32-t)|this.low>>>t,this.low<<i|this.high>>>t,this.unsigned):a(this.low<<(i=32-(t-=32))|this.high>>>t,this.high<<i|this.low>>>t,this.unsigned)},T.rotr=T.rotateRight,T.toSigned=function(){return this.unsigned?a(this.low,this.high,!1):this},T.toUnsigned=function(){return this.unsigned?this:a(this.low,this.high,!0)},T.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},T.toBytesLE=function(){var t=this.high,i=this.low;return[255&i,i>>>8&255,i>>>16&255,i>>>24,255&t,t>>>8&255,t>>>16&255,t>>>24]},T.toBytesBE=function(){var t=this.high,i=this.low;return[t>>>24,t>>>16&255,t>>>8&255,255&t,i>>>24,i>>>16&255,i>>>8&255,255&i]},n.fromBytes=function(t,i,e){return e?n.fromBytesLE(t,i):n.fromBytesBE(t,i)},n.fromBytesLE=function(t,i){return new n(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,i)},n.fromBytesBE=function(t,i){return new n(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],i)},t.default=n,"default"in t?t.default:t}({});void 0!==(i=function(){return e}.apply(i,[]))&&(t.exports=i)},function(t,i,n){function e(t){var i;return(r[t]||(i=r[t]={i:t,l:!1,exports:{}},s[t].call(i.exports,i,i.exports,e),i.l=!0,i)).exports}var s,r;t.exports=(s=[function(t,i,n){"use strict";n.r(i),n.d(i,"ZegoLogger",(function(){return at})),n.d(i,"ZegoDataReport",(function(){return d})),n.d(i,"createZegoWebSocket",(function(){return f})),n.d(i,"LoggerStateCenter",(function(){return r})),o.getInstance=function(){return o.instance||(o.instance=new o).u(),o.instance},o.prototype.u=function(){},Object.defineProperty(o.prototype,"testEnvironment",{get:function(){return this.h},set:function(t){this.h=t},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"ENV",{get:function(){return this.v},set:function(t){this.v=t},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"debug",{get:function(){return this.g},set:function(t){this.g=t},enumerable:!1,configurable:!0}),o.instance=new o;var e,s,r=o;function o(){this.h=!0,this.v=0,this.g=!0}(n=h=h||{})[n.IE=0]="IE",n[n.FIREFOX=1]="FIREFOX",n[n.CHROME=2]="CHROME",n[n.SAFARI=3]="SAFARI",n[n.OPERA=4]="OPERA",n[n.WEIXIN=5]="WEIXIN",n[n.WEIXINMINI=6]="WEIXINMINI",n[n.UNKOWN=7]="UNKOWN",(i=e=e||{})[i.BROWSER=0]="BROWSER",i[i.WEIXINMINI=1]="WEIXINMINI";var u=0,h=s={DISABLE:0,0:"DISABLE",WEBSOCKET:1,1:"WEBSOCKET",HTTPS:2,2:"HTTPS"},a={DEBUG:0,INFO:1,WARN:2,ERROR:3,REPORT:99,DISABLE:100,debug:0,info:1,warn:2,error:3,report:99,disable:100},c=(l.prototype.init=function(){var t=this;this.O&&(this.readyState=0,this.O.onOpen((function(i){t.readyState=t.O.readyState,"function"==typeof t.onopen&&(t.onopen(i),t.O.onClose((function(i){t.readyState=t.O.readyState,"function"==typeof t.onclose&&t.onclose(i)})),t.O.onMessage((function(i){"function"==typeof t.onmessage&&t.onmessage(i)})))})),this.O.onError((function(i){t.readyState=t.O.readyState,"function"==typeof t.onerror&&t.onerror(i)})))},l.prototype.onopen=function(t){},l.prototype.onerror=function(t){},l.prototype.onclose=function(t){},l.prototype.onmessage=function(t){},l.prototype.send=function(t){this.O&&this.O.send({data:t})},l.prototype.close=function(){this.O&&this.O.close()},l);function l(t,i){this.url=t,this.readyState=3,this.O=wx.connectSocket({url:t}),this.init()}function f(t,i,n){return i%2===e.BROWSER?(i=t,n?n.createSocket(i,1):new WebSocket(i)):new c(t)}var _=function(){return(_=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t}).apply(this,arguments)},d=(m.prototype.newReport=function(t,i){this.dataStatistics[t]={event_time:Date.now(),time_consumed:0,seq:t,error:0,message:"success",event:i,events:[]}},m.prototype.addMsgExt=function(t,i){this.dataStatistics[t]?this.dataStatistics[t].msg_ext=i:console.warn(t+" not exist")},m.prototype.addMsgInfo=function(t,i){this.dataStatistics[t]?Object.assign(this.dataStatistics[t],i):console.warn(t+" not exist")},m.prototype.eventStart=function(t,i){this.dataStatistics[t]?null==this.dataStatistics[t].events?this.logger.warn("zd.es.0 no events"):this.dataStatistics[t].events.push({event:i,event_time:Date.now(),time_consumed:0}):this.logger.warn("zd.es.0 no seq match")},m.prototype.eventEnd=function(t,i,n){if(this.dataStatistics[t]){var e=this.dataStatistics[t].events;if(e&&0!==e.length){for(var s=e.length-1;0<=s;s--)if(e[s].event==i&&0==e[s].time_consumed){e[s].time_consumed=Date.now()-e[s].event_time;break}}else this.logger.info("zd.ee.0 no events")}else this.logger.info("zd.ee.0 no seq match")},m.prototype.eventEndWithMsg=function(t,i,n){if(this.dataStatistics[t]){var e=this.dataStatistics[t].events;if(e){for(var s=e.length-1;0<=s;s--)if(e[s].event==i&&0==e[s].time_consumed){e[s].time_consumed=Date.now()-e[s].event_time,null==e[s].msg_ext&&(e[s].msg_ext={}),e[s].msg_ext=_({},n);break}}else this.logger.warn("zd.ee.0 no events")}else this.logger.warn("zd.ee.0 no seq match")},m.prototype.eventEndWithMsgInfo=function(t,i,n){if(this.dataStatistics[t]){var e=this.dataStatistics[t].events;if(e){for(var s=e.length-1;0<=s;s--)if(e[s].event==i&&0==e[s].time_consumed){e[s].time_consumed=Date.now()-e[s].event_time,Object.assign(e[s],n);break}}else this.logger.warn("zd.ee.0 no events")}else this.logger.warn("zd.ee.0 no seq match")},m.prototype.addEventInfo=function(t,i,n,e){if(this.dataStatistics[t]){var s=this.dataStatistics[t].events;if(null==s)this.logger.warn("zd.aei.0 no events");else for(var r=s.length-1;0<=r;r--)if(s[r].event==i&&null!=s[r].time_consumed){null==s[r].msg_ext?s[r].msg_ext={}:s[r].msg_ext&&(s[r].msg_ext[n]=e);break}}else this.logger.warn("zd.aei.0 no seq match")},m.prototype.addEventMsg=function(t,i,n,e){if(this.dataStatistics[t]){var s=this.dataStatistics[t].events;if(null==s)this.logger.warn("zd.aem.0 no events");else for(var r=s.length-1;0<=r;r--)if(s[r].event==i){s[r][n]=e;break}}else this.logger.warn("zd.aem.0 no seq match")},m.prototype.addEvent=function(t,i,n){this.dataStatistics[t]?this.dataStatistics[t].events&&this.dataStatistics[t].events.push(n?{event:i,event_time:Date.now(),msg_ext:n}:{event:i,event_time:Date.now()}):this.logger.warn("zd.ae.0 no seq match")},m.prototype.uploadReport=function(t,i,n,e){var s=this.dataStatistics[t];null!=s&&(i&&(s.event=i),s.time_consumed=Date.now()-s.event_time,n&&this.addMsgInfo(t,{error:n.code,message:n.message||n.msg+" "+(e||"")}),this.logger.report(s),delete this.dataStatistics[t])},m);function m(t){this.dataStatistics={},this.logger=t}var v,p=["00","01","02","03","04","05","06","07","08","09"];function g(){var t=new Date;return[t.getFullYear()+"/",(p[t.getMonth()+1]||t.getMonth()+1)+"/",(p[t.getDate()]||t.getDate())+" ",(p[t.getHours()]||t.getHours())+":",(p[t.getMinutes()]||t.getMinutes())+":",p[t.getSeconds()]||t.getSeconds(),"."+t.getTime()%1e3].join("")}n=v={WEBSOCKET_STATE_CHANGE:"zl.net.wsc",OPEN_WS:"zl.net.opws"},Object.defineProperty(E.prototype,"url",{get:function(){return this._.url},set:function(t){this._.url=t},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"strategy",{get:function(){return this.j.strategy},enumerable:!1,configurable:!0}),E.prototype.setStrategy=function(t){this.j.setStrategy(t),this.S=this.j.build()},E.prototype.addRemoteWsLog=function(t){var i;if(this._.env!=e.BROWSER)throw new Error("cannot use net strategy on wx mini program");this.closed()&&(i=this.url,this.url="",this.openWebSocketLogServer(i)),this.N.push(t),this.connected()&&this.S&&this.S.active()},E.prototype.stopWebSocketServer=function(){this.O&&(this.O.onclose=null,this.O.onerror=null,this.O.close(),this.O=null)},E.prototype.I=function(){this.O&&this._.useStrategy&&(this.j.setWs(this.O),this.j.setCache(this.N),this.S=this.j.build())},E.prototype.A=function(t){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];var e=this.D=this.k,s="";switch(t){case"onconnecting":this.k="never_opened"===this.k?"first_connecting":"reconnecting";break;case"onopen":this.k="connected";break;case"onclosed":this.k="closed";var r=i[0];r&&(s+=" close code="+r.code);break;case"onerror":this.k="error"}t=v.WEBSOCKET_STATE_CHANGE+" log ws state change: "+e+" -> "+this.k,s&&(t+=s),"error"===this.k?this.R.warn(t):this.R.info(t)},E.prototype.openWebSocketLogServer=function(t,i){var n,e=this;void 0===i&&(i=!1),this.url!=t&&((this.url&&""!==this.url||"never_opened"===this.k)&&this.R.info(v.OPEN_WS+" log url change to: "+t),this.url=t)&&(n=function(){e.T&&(clearTimeout(e.T),e.T=null),e.stopWebSocketServer(),e.O=f(t,e._.env,e.J),e.I(),e.A("onconnecting"),e.O.onopen=function(){var t;e._.useStrategy&&null!=(t=e.S)&&t.active(),e.A("onopen")},e.O.onclose=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];e.A.apply(e,function(){for(var t=0,i=0,n=arguments.length;i<n;i++)t+=arguments[i].length;var e=Array(t),s=0;for(i=0;i<n;i++)for(var r=arguments[i],o=0,u=r.length;o<u;o++,s++)e[s]=r[o];return e}(["onclosed"],t))},e.O.onmessage=function(){},e.O.onerror=function(){for(var t=0;t<arguments.length;t++);e.A("onerror")}},i||"error"!==this.k&&"error"!==this.D?n():this.T||(this.T=setTimeout(n,5e3)))},E.prototype.closed=function(){return null==this.O||2==this.O.readyState||3==this.O.readyState},E.prototype.connected=function(){return null!==this.O&&1==this.O.readyState},E.prototype.connecting=function(){return null!==this.O&&0==this.O.readyState},E.prototype.wsSend=function(t){this.O&&this.O.send(t)},E.prototype.destroy=function(){this.O=null};var b=E;function E(t,i,n,e){this.N=t,this._=i,this.R=n,this.J=e,this.O=null,this.k="never_opened",this.D="never_opened",this.j=new Y,this.S=null,this.T=null}O.prototype.active=function(){var t=this;this.W&&1===this.W.readyState&&0!==this.N.size()&&this.q.canSendLog()&&(this.q.getLog().forEach((function(i){t.W.send(i)})),this.q.onSendLog())};var S,R=O;function O(t,i,n){this.W=t,this.N=i,this.q=n,this.q.onCanSendActive=this.active.bind(this)}function y(t){this.cache=t}function T(){this.constructor=S}n=w=y,function(t,i){(Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n])}))(t,i)}(S=z,n),S.prototype=null===n?Object.create(n):(T.prototype=n.prototype,new T),z.prototype.getLog=function(){return this.cache.clear()},z.prototype.canSendLog=function(){return 0<this.cache.size()},z.prototype.onSendLog=function(){};var w,I,N,C,k=z;function z(t){return w.call(this,t)||this}function A(){this.constructor=I}function D(){var t=null!==N&&N.apply(this,arguments)||this;return t.maxDelay=10,t.maxPacketLen=20480,t.locked=!1,t}function M(){this.constructor=C}n=N=y,function(t,i){(Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n])}))(t,i)}(I=D,n),I.prototype=null===n?Object.create(n):(A.prototype=n.prototype,new A),D.prototype.canSendLog=function(){return!this.locked&&0<this.cache.size()},D.prototype.getLog=function(){for(var t=[],i=0;i<this.maxPacketLen-4e3;){var n=this.cache.getOneLogPacket();if(!n||n.length<=0)break;i+=n.length||0,t.push(n)}return t},D.prototype.onSendLog=function(){var t=this;this.locked=!0,setTimeout((function(){t.locked=!1,t.onCanSendActive&&t.onCanSendActive()}),this.maxDelay)},n=P=i=D,function(t,i){(Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n])}))(t,i)}(C=$,n),C.prototype=null===n?Object.create(n):(M.prototype=n.prototype,new M);var P,x,U,L,q,j,G,H=$;function $(t){return(t=P.call(this,t)||this).maxDelay=10,t.maxPacketLen=20480,t}function V(){this.constructor=U}function B(){this.constructor=q}function J(){this.constructor=G}n=x=i,function(t,i){(Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n])}))(t,i)}(U=function(){return null!==x&&x.apply(this,arguments)||this},n),U.prototype=null===n?Object.create(n):(V.prototype=n.prototype,new V),n=L=i,function(t,i){(Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n])}))(t,i)}(q=function(){return null!==L&&L.apply(this,arguments)||this},n),q.prototype=null===n?Object.create(n):(B.prototype=n.prototype,new B),n=j=i,function(t,i){(Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n])}))(t,i)}(G=function(){return null!==j&&j.apply(this,arguments)||this},n),G.prototype=null===n?Object.create(n):(J.prototype=n.prototype,new J),Object.defineProperty(F.prototype,"strategy",{get:function(){return this.q},enumerable:!1,configurable:!0}),F.prototype.setWs=function(t){this.W=t},F.prototype.setCache=function(t){this.N=t},F.prototype.setStrategy=function(t){t&&(this.q=t)},F.prototype.build=function(){if(this.W&&this.N)return new R(this.W,this.N,this.q!==u?new k(this.N):new H(this.N));throw new Error("cannot build log sender")};var Y=F;function F(){this.q=u}X.M=function(){return!(!window||!window.localStorage)},X.bin2hex=function(t){for(var i,n="",e=0,s=(t+="").length;e<s;e++)n+=(i=t.charCodeAt(e).toString(16)).length<2?"0"+i:i;return n},X.getCanvasFingerprint=function(t){var i=document.createElement("canvas"),n=((n=i.getContext("2d")).textBaseline="top",n.font="14px 'Arial'",n.fillStyle="#f60",n.fillRect(125,1,62,20),n.fillStyle="#069",n.fillText(t,2,15),n.fillStyle="rgba(102, 204, 0, 0.7)",n.fillText(t,4,17),i.toDataURL().replace("data:image/png;base64,",""));return t=atob(n),this.bin2hex(t.slice(-16,-12))},X.generateUUID=function(){var t,i,n=localStorage.getItem(this.B);return n||(t=(new Date).getTime(),n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(i){var n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==i?n:3&n|8).toString(36)})),i=this.getCanvasFingerprint("hello, zego")+n.slice(8),localStorage.setItem(this.B,i),n)},X.id=function(){var t;return X.M()?((t=localStorage.getItem(this.B))||(t=X.generateUUID(),localStorage.setItem(this.B,t)),t):""},X.B="z_deviceID";var W=X;function X(){}function Z(){this.url="",this.env=e.BROWSER,this.useStrategy=!0,this.token="",this.deviceid=W.id()}function K(){this.queue=[]}Object.defineProperty(K.prototype,"buffer",{get:function(){return this.queue},set:function(t){this.queue=t},enumerable:!1,configurable:!0}),K.prototype.push=function(t){if(!t)throw new Error("item null!");t&&this.queue.push(t)},K.prototype.pop=function(){return this.queue.shift()},K.prototype.front=function(){return this.queue[0]};var Q,tt,it=function(t,i){return(it=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n])}))(t,i)},nt=function(){return(nt=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t}).apply(this,arguments)},et=(i=Q=h=K,it(tt=rt,i),tt.prototype=null===i?Object.create(i):(st.prototype=i.prototype,new st),rt.prototype.size=function(){return this.queue.length},rt.prototype.getOneLogPacket=function(){var t="";if(this.size()){var i=JSON.parse(this.queue[this.queue.length-1]).userid,n=this._.userid||i;if(n){for(;0<this.queue.length;){if(4e3<(t+this.queue[0]).length)return t;var e=JSON.parse(this.queue[0]);e=nt(nt({},e),{userid:e.userid||n,roomid:e.roomid||this._.roomid,userName:e.userName||this._.userName}),t=t+JSON.stringify(e)+"\n",this.queue.shift()}return""===t?void 0:t}}},rt.prototype.clear=function(){for(var t=[];0<this.queue.length;){var i=this.getOneLogPacket();if(!i)break;t.push(i)}return t},rt);function st(){this.constructor=tt}function rt(t){var i=Q.call(this)||this;return i._=t,i}function ot(t,i,n,e){return new(n=n||Promise)((function(s,r){function o(t){try{h(e.next(t))}catch(t){r(t)}}function u(t){try{h(e.throw(t))}catch(t){r(t)}}function h(t){var i;t.done?s(t.value):((i=t.value)instanceof n?i:new n((function(t){t(i)}))).then(o,u)}h((e=e.apply(t,i||[])).next())}))}function ut(t,i){var n,e,s,r={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},o={next:u(0),throw:u(1),return:u(2)};return"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){var h=[o,u];if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,e&&(s=2&h[0]?e.return:h[0]?e.throw||((s=e.return)&&s.call(e),0):e.next)&&!(s=s.call(e,h[1])).done)return s;switch(e=0,(h=s?[2&h[0],s.value]:h)[0]){case 0:case 1:s=h;break;case 4:return r.label++,{value:h[1],done:!1};case 5:r.label++,e=h[1],h=[0];continue;case 7:h=r.ops.pop(),r.trys.pop();continue;default:if(!(s=0<(s=r.trys).length&&s[s.length-1])&&(6===h[0]||2===h[0])){r=0;continue}if(3===h[0]&&(!s||h[1]>s[0]&&h[1]<s[3]))r.label=h[1];else if(6===h[0]&&r.label<s[1])r.label=s[1],s=h;else{if(!(s&&r.label<s[2])){s[2]&&r.ops.pop(),r.trys.pop();continue}r.label=s[2],r.ops.push(h)}}h=i.call(t,r)}catch(u){h=[6,u],e=0}finally{n=s=0}if(5&h[0])throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}}}var ht=function(){return(ht=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t}).apply(this,arguments)},at=(Object.defineProperty(ct.prototype,"url",{get:function(){return this._.url||""},set:function(t){this._.url=t},enumerable:!1,configurable:!0}),Object.defineProperty(ct.prototype,"logType",{get:function(){return this._.logType||s.DISABLE},set:function(t){this._.logType=t},enumerable:!1,configurable:!0}),Object.defineProperty(ct.prototype,"env",{get:function(){return this._.env},set:function(t){this._.env=t},enumerable:!1,configurable:!0}),Object.defineProperty(ct.prototype,"appid",{get:function(){return this._.appid},set:function(t){this._.appid=t},enumerable:!1,configurable:!0}),Object.defineProperty(ct.prototype,"roomid",{get:function(){return this._.roomid},set:function(t){this._.roomid=t},enumerable:!1,configurable:!0}),Object.defineProperty(ct.prototype,"sessionid",{get:function(){return this._.sessionid},set:function(t){this._.sessionid=t},enumerable:!1,configurable:!0}),Object.defineProperty(ct.prototype,"userid",{get:function(){return this._.userid},set:function(t){this._.userid=t},enumerable:!1,configurable:!0}),Object.defineProperty(ct.prototype,"userName",{get:function(){return this._.userName},set:function(t){this._.userName=t},enumerable:!1,configurable:!0}),Object.defineProperty(ct.prototype,"version",{get:function(){return this._.version},set:function(t){this._.version=t},enumerable:!1,configurable:!0}),ct.prototype.setLogLevel=function(t){return void 0!==(t=a[t])&&(this.logLevel=t,!0)},ct.prototype.setRemoteLogLevel=function(t){return void 0!==(t=a[t])&&(this.logRemoteLevel=t,!0)},ct.prototype.setSessionInfo=function(t,i,n,e,s,r){this.appid=t,this.roomid=i,this.sessionid=n,this.userid=e,this.userName=s,this.version=r},ct.prototype.setTokenInfo=function(t,i,n){this._.token=t||"",i&&(this._.userid=i),n&&(this._.userName=n)},ct.prototype.setZipLogConfig=function(t,i){},ct.prototype.setZipLogUploadUrl=function(t){},ct.prototype.makeZipLogSpaceUpload=function(){return ot(this,void 0,void 0,(function(){return ut(this,(function(t){return[2]}))}))},ct.prototype.uploadStorageLog=function(){return ot(this,void 0,void 0,(function(){return ut(this,(function(t){return[2]}))}))},ct.prototype.report=function(t){t=this.F(a.REPORT,t),this.logLevel!==a.DISABLE&&this.logLevel<=a.REPORT&&!this.isDestroy&&console.debug(t),this.L(a.REPORT,t,!0)},ct.prototype.debug=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=this.P(a.DEBUG,t.join(""));this.logLevel!==a.DISABLE&&this.logLevel<=a.DEBUG&&!this.isDestroy&&console.debug(n),this.X(a.DEBUG,n)},ct.prototype.info=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=this.P(a.INFO,t.join(""));this.logLevel!==a.DISABLE&&this.logLevel<=a.INFO&&!this.isDestroy&&console.info(n),this.X(a.INFO,n)},ct.prototype.warn=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=this.P(a.WARN,t.join(""));this.logLevel!==a.DISABLE&&this.logLevel<=a.WARN&&!this.isDestroy&&console.warn(n),this.X(a.WARN,n)},ct.prototype.remoteReport=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=this.P(a.INFO,t.join(""));this.X(a.INFO,n)},ct.prototype.error=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=wx,s=this.P(a.ERROR,t.join(""));this.logLevel!==a.DISABLE&&this.logLevel<=a.ERROR&&!this.isDestroy&&(console.error(s),this.env%2===e.BROWSER&&window?this.stateCenter.debug&&window.alert(t.join("").substr(t.join("").indexOf(" ")+1,4500)):this.env%2===e.WEIXINMINI&&n&&this.stateCenter.debug&&wx.showModal({title:"",content:t.join("").substr(t.join("").indexOf(" ")+1,4500)})),this.X(a.ERROR,s)},ct.prototype.X=function(t,i){this.logRemoteLevel!==a.DISABLE&&this.logRemoteLevel<=t&&(this.L(t,i),this._zipLogContext)&&this._zipLogContext.saveLog(i)},ct.prototype.setLogServer=function(t){if(this.isDestroy)return!1;try{return t.startsWith("wss:")?(this.logType=s.WEBSOCKET,this.C.openWebSocketLogServer(t,!0)):t.startsWith("https:")?(this.logType=s.HTTPS,this.U(t)):this.logType=s.DISABLE,!0}catch(t){return this.error(JSON.stringify(t)),!1}},ct.prototype.Z=function(){this.logType==s.WEBSOCKET?this.G():this.logType==s.HTTPS&&(this.H(),this.K()),this.logType=s.DISABLE},ct.prototype.G=function(){this.C.stopWebSocketServer()},ct.prototype.U=function(t){var i=this;(this.url=t)&&(this.K(),this.logUploadTimer||(this.logUploadTimer=setInterval((function(){i.H()}),this.logUploadInterval)))},ct.prototype.K=function(){this.logUploadTimer&&(clearInterval(this.logUploadTimer),this.logUploadTimer=null)},ct.prototype.L=function(t,i,n){return void 0===n&&(n=!1),ot(this,void 0,void 0,(function(){return ut(this,(function(e){if(!this.isDestroy)if(this.logType==s.WEBSOCKET)this.V(t,i);else if(this.logType==s.HTTPS)this.Y(t,i,n);else if(this.logLevel!==a.DISABLE&&this.logLevel<=t)for(this.$.push(i);this.$.size()>this.tt;)this.$.pop();return[2]}))}))},ct.prototype.nt=function(){var t=this;this.C.connected()&&this.$.clear().forEach((function(i){t.C.wsSend(i)}))},ct.prototype.clearCache=function(){0!==this.$.size()&&this.nt()},ct.prototype.it=function(t){this.$.size()<this.tt&&this.$.push(t)},ct.prototype.et=function(t){this.C.connected()?this.C.wsSend(t):this.it(t)},ct.prototype.V=function(t,i){return ot(this,void 0,void 0,(function(){var t;return ut(this,(function(n){return"string"==typeof i&&4e3<i.length?console.info("log over maximum, ignore"):this._.useStrategy&&this.env==e.BROWSER?this.C.addRemoteWsLog(i):this.C.closed()?(t=this.url,this.url="",this.setLogServer(t),this.it(i)):this.C.connecting()?this.it(i):this.C.connected()&&(this.clearCache(),this.et(i)),[2]}))}))},ct.prototype.Y=function(t,i,n){this.$.push(i),(this.$.size()>=this.tt||!0===n)&&this.H()},ct.prototype.P=function(t,i){return t={time:g(),level:t,action:(i=[i.substr(0,i.indexOf(" "))||i,i.substr(i.indexOf(" ")+1,4500)||i])[0],content:i[1],appid:this.appid,roomid:this.roomid,userid:this.userid,userName:this.userName,sessionid:this.sessionid},JSON.stringify(t)},ct.prototype.F=function(t,i){var n=g(),s=this.env%2===e.BROWSER?"rtc":"xcx";return i=ht(ht({},i),{time:n,level:t,console:s,appid:this.appid,room_id:this.roomid,roomid:this.roomid,userid:this.userid,id_name:this.userid,userName:this.userName,sessionid:this.sessionid,sdk_version:this.version,test_environment:this.stateCenter.testEnvironment,version:this.version,event_id:this.appid+"_"+this.userid+"_"+i.event_time+"_"+i.seq}),JSON.stringify(i)},ct.prototype.H=function(){0!=this.$.size()&&(this.env%2===e.BROWSER?this.st():this.SendHttpsLogWeChatMini())},ct.prototype.st=function(){},ct.prototype.SendHttpsLogWeChatMini=function(){var t=this;if(!this.existUserID){if(!this.userid)return void console.log("no userid");this.$.buffer.forEach((function(i,n){(i=JSON.parse(i))&&""==i.userid?(i.userid=t.userid,i.id_name=i.id_name||t.userid,i.roomid=i.roomid||t.roomid,i.userName=i.userName||t.userName,t.$.buffer[n]=JSON.stringify(i)):t.existUserID=!0}))}var i=this.$.buffer.join("\n"),n=this.$.buffer;i=1==this.env?i:JSON.stringify({user_id:this.userid,log:i}),(0,wx.request)({url:this.url,data:i,method:"POST",success:function(i){0!=i.data.length&&("number"==typeof(i=i&&i.data&&i.data.interval)&&t.logUploadInterval!==i&&(t.timeInterval=i,t.U(t.url)),n=null)},fail:function(i){t.$.buffer=n.concat(t.$.buffer),console.log("send failed "+i.statusCode),n=null}}),this.$.buffer=[]},ct.prototype.destroy=function(){this.Z(),this.logUploadTimer&&clearTimeout(this.logUploadTimer),r.instance=void 0,this.C.destroy(),this._zipLogContext&&this._zipLogContext.destroy(),this.url="",this.isDestroy=!0},ct.logVersion="1.4.6",ct);function ct(t,i){var n=this;this.proxyCtrl=i,this.logLevel=a.INFO,this.logRemoteLevel=0,this.logUploadTimer=null,this.logUploadInterval=1e4,this.existUserID=!1,this.isDestroy=!1,this.tt=8192,this.R={debug:function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];n.debug.apply(n,t)},info:function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];n.info.apply(n,t)},warn:function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];n.warn.apply(n,t)},error:function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];n.error.apply(n,t)}},this.stateCenter=r.getInstance(),this._=new Z,this._.env=t,this.$=new et(this._),this.C=new b(this.$,this._,this.R,this.proxyCtrl)}}],r={},e.m=s,e.c=r,e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:n})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"rt",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.rt)return t;var n=Object.create(null);if(e.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var s in t)e.d(n,s,function(i){return t[i]}.bind(null,s));return n},e.n=function(t){var i=t&&t.rt?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p="",e(e.s=0))},function(i,n){i.exports=t},function(t,i,n){(function(i){var e;t.exports=(e=function(t){var e;if("undefined"!=typeof window&&window.crypto&&(e=window.crypto),"undefined"!=typeof self&&self.crypto&&(e=self.crypto),!(e=!(e=!(e="undefined"!=typeof globalThis&&globalThis.crypto?globalThis.crypto:e)&&"undefined"!=typeof window&&window.msCrypto?window.msCrypto:e)&&void 0!==i&&i.crypto?i.crypto:e))try{e=n(9)}catch(o){}var s=Object.create||function(t){return r.prototype=t,t=new r,r.prototype=null,t};function r(){}var o={},u=o.lib={},h=u.Base={extend:function(t){var i=s(this);return t&&i.mixIn(t),i.hasOwnProperty("init")&&this.init!==i.init||(i.init=function(){i.$super.init.apply(this,arguments)}),(i.init.prototype=i).$super=this,i},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var i in t)t.hasOwnProperty(i)&&(this[i]=t[i]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},a=u.WordArray=h.extend({init:function(t,i){t=this.words=t||[],this.sigBytes=null!=i?i:4*t.length},toString:function(t){return(t||l).stringify(this)},concat:function(t){var i=this.words,n=t.words,e=this.sigBytes,s=t.sigBytes;if(this.clamp(),e%4)for(var r=0;r<s;r++)i[e+r>>>2]|=(n[r>>>2]>>>24-r%4*8&255)<<24-(e+r)%4*8;else for(var o=0;o<s;o+=4)i[e+o>>>2]=n[o>>>2];return this.sigBytes+=s,this},clamp:function(){var i=this.words,n=this.sigBytes;i[n>>>2]&=4294967295<<32-n%4*8,i.length=t.ceil(n/4)},clone:function(){var t=h.clone.call(this);return t.words=this.words.slice(0),t},random:function(t){for(var i=[],n=0;n<t;n+=4)i.push(function(){if(e){if("function"==typeof e.getRandomValues)try{return e.getRandomValues(new Uint32Array(1))[0]}catch(t){}if("function"==typeof e.randomBytes)try{return e.randomBytes(4).readInt32LE()}catch(t){}}throw new Error("Native crypto module could not be used to get secure random number.")}());return new a.init(i,t)}}),c=o.enc={},l=c.Hex={stringify:function(t){for(var i=t.words,n=t.sigBytes,e=[],s=0;s<n;s++){var r=i[s>>>2]>>>24-s%4*8&255;e.push((r>>>4).toString(16)),e.push((15&r).toString(16))}return e.join("")},parse:function(t){for(var i=t.length,n=[],e=0;e<i;e+=2)n[e>>>3]|=parseInt(t.substr(e,2),16)<<24-e%8*4;return new a.init(n,i/2)}},f=c.Latin1={stringify:function(t){for(var i=t.words,n=t.sigBytes,e=[],s=0;s<n;s++)e.push(String.fromCharCode(i[s>>>2]>>>24-s%4*8&255));return e.join("")},parse:function(t){for(var i=t.length,n=[],e=0;e<i;e++)n[e>>>2]|=(255&t.charCodeAt(e))<<24-e%4*8;return new a.init(n,i)}},_=c.Utf8={stringify:function(t){try{return decodeURIComponent(escape(f.stringify(t)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(t){return f.parse(unescape(encodeURIComponent(t)))}},d=u.BufferedBlockAlgorithm=h.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=_.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(i){var n,e=this._data,s=e.words,r=e.sigBytes,o=this.blockSize,u=r/(4*o),h=(u=i?t.ceil(u):t.max((0|u)-this._minBufferSize,0))*o;if(i=t.min(4*h,r),h){for(var c=0;c<h;c+=o)this._doProcessBlock(s,c);n=s.splice(0,h),e.sigBytes-=i}return new a.init(n,i)},clone:function(){var t=h.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0}),m=(u.Hasher=d.extend({cfg:h.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){d.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(i,n){return new t.init(n).finalize(i)}},_createHmacHelper:function(t){return function(i,n){return new m.HMAC.init(t,n).finalize(i)}}}),o.algo={});return o}(Math),e)}).call(this,n(8))},function(t,i,n){function e(t){var i;return(u[t]||(i=u[t]={i:t,l:!1,exports:{}},o[t].call(i.exports,i,i.exports,e),i.l=!0,i)).exports}var s,r,o,u;t.exports=(s=n(1),r=n(3),o=[function(t,i){t.exports=s},function(t,i){t.exports=r},function(t,i,n){"use strict";var e,s,r,o,u,h,a,c;n.r(i),n.d(i,"ZegoConnectionAgent",(function(){return Ct})),n.d(i,"NetAgentPCRequest",(function(){return ht})),n.d(i,"NetAgentHttpRequest",(function(){return dt})),n.d(i,"BusinessService",(function(){return r})),n.d(i,"BrokenType",(function(){return m})),n.d(i,"NET_ACCESS_CONFIG",(function(){return X})),n.d(i,"ConnectedType",(function(){return d})),n.d(i,"DisconnectedType",(function(){return _})),n.d(i,"Mode",(function(){return u})),n.d(i,"Method",(function(){return f})),(i=e=e||{})[i.offline=0]="offline",i[i.online=1]="online",(i=s=s||{})[i.MSG_TYPE_STREAM_CLOSED=2]="MSG_TYPE_STREAM_CLOSED",i[i.MSG_TYPE_CLOSE_CONNECTION=3]="MSG_TYPE_CLOSE_CONNECTION",i[i.MSG_TYPE_HTTP_REQUEST=4]="MSG_TYPE_HTTP_REQUEST",i[i.MSG_TYPE_HTTP_RESPONSE=5]="MSG_TYPE_HTTP_RESPONSE",i[i.MSG_TYPE_HB_REQUEST=12]="MSG_TYPE_HB_REQUEST",i[i.MSG_TYPE_HB_RESPONSE=13]="MSG_TYPE_HB_RESPONSE",i[i.MSG_TYPE_GET_CONFIG_REQUEST=14]="MSG_TYPE_GET_CONFIG_REQUEST",i[i.MSG_TYPE_GET_CONFIG_RESPONSE=15]="MSG_TYPE_GET_CONFIG_RESPONSE",i[i.MSG_TYPE_HTTP_REQUEST_ACK=16]="MSG_TYPE_HTTP_REQUEST_ACK",i[i.MSG_TYPE_PC_UPWARD_MESSAGE=17]="MSG_TYPE_PC_UPWARD_MESSAGE",i[i.MSG_TYPE_PC_UPWARD_MESSAGE_ACK=18]="MSG_TYPE_PC_UPWARD_MESSAGE_ACK",i[i.MSG_TYPE_PC_ESTABLISHED=19]="MSG_TYPE_PC_ESTABLISHED",i[i.MSG_TYPE_PC_BROKEN=20]="MSG_TYPE_PC_BROKEN",i[i.MSG_TYPE_PC_DOWNWARD_MESSAGE=21]="MSG_TYPE_PC_DOWNWARD_MESSAGE",i[i.MSG_TYPE_REDIRECT=22]="MSG_TYPE_REDIRECT",i[i.MSG_TYPE_GET_APPCONFIG_REQUEST=23]="MSG_TYPE_GET_APPCONFIG_REQUEST",i[i.MSG_TYPE_GET_APPCONFIG_RESPONSE=24]="MSG_TYPE_GET_APPCONFIG_RESPONSE",i[i.MSG_TYPE_PUSH_APPCONFIG=25]="MSG_TYPE_PUSH_APPCONFIG",i[i.MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST=26]="MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST",i[i.MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE=27]="MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE",i[i.MSG_TYPE_PUSH_EXCEPTION=30]="MSG_TYPE_PUSH_EXCEPTION",i[i.MSG_TYPE_HTTP_REQUEST2=33]="MSG_TYPE_HTTP_REQUEST2",i[i.MSG_TYPE_REDIRECT2=34]="MSG_TYPE_REDIRECT2",i[i.MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST2=35]="MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST2",i[i.MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE2=36]="MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE2",i[i.MSG_TYPE_GET_SVRADDR_REQUEST=39]="MSG_TYPE_GET_SVRADDR_REQUEST",i[i.MSG_TYPE_GET_SVRADDR_RESPONSE=40]="MSG_TYPE_GET_SVRADDR_RESPONSE",(i=g=g||{})[i.ACCESSHUB_INVALID_FRAME=2e4]="ACCESSHUB_INVALID_FRAME",i[i.ACCESSHUB_NEED_ENCRYPT=20001]="ACCESSHUB_NEED_ENCRYPT",i[i.ACCESSHUB_DECRYPT=20002]="ACCESSHUB_DECRYPT",i[i.ACCESSHUB_MSGTYPE=20003]="ACCESSHUB_MSGTYPE",i[i.ACCESSHUB_UNMARSHAL=20004]="ACCESSHUB_UNMARSHAL",i[i.ACCESSHUB_TIMEOUT=20005]="ACCESSHUB_TIMEOUT",i[i.ACCESSHUB_CONNECT=20006]="ACCESSHUB_CONNECT",i[i.ACCESSHUB_BROKEN=20007]="ACCESSHUB_BROKEN",i[i.ACCESSHUB_INTERNAL_ERROR=20008]="ACCESSHUB_INTERNAL_ERROR",i[i.ACCESSHUB_MARSHAL=20009]="ACCESSHUB_MARSHAL",i[i.ACCESSHUB_UNSUPPORTED_SERVICE=20010]="ACCESSHUB_UNSUPPORTED_SERVICE",i[i.ACCESSHUB_TOO_FREQUENTLY=20011]="ACCESSHUB_TOO_FREQUENTLY",i[i.ACCESSHUB_INVALID_APPID=20012]="ACCESSHUB_INVALID_APPID",i[i.ACCESSHUB_HB_TIMEOUT=20013]="ACCESSHUB_HB_TIMEOUT",i[i.ACCESSHUB_INVALID_SIGNATURE=20014]="ACCESSHUB_INVALID_SIGNATURE",(i=r=r||{})[i.SERVICE_UNSET=0]="SERVICE_UNSET",i[i.SERVICE_MEDIAGW=1]="SERVICE_MEDIAGW",i[i.SERVICE_LIVEROOM=2]="SERVICE_LIVEROOM",i[i.SERVICE_MIX=3]="SERVICE_MIX",i[i.SERVICE_ZEUS=4]="SERVICE_ZEUS",i[i.SERVICE_ZPUSH=5]="SERVICE_ZPUSH",i[i.SERVICE_L3=6]="SERVICE_L3",i[i.SERVICE_TALKLINE=7]="SERVICE_TALKLINE",i[i.SERVICE_EDUSUITE=8]="SERVICE_EDUSUITE",i[i.SERVICE_ZIM=9]="SERVICE_ZIM",i[i.SERVICE_ClOUD_SETTING=10]="SERVICE_ClOUD_SETTING",i[i.SERVICE_ZEUSHB=11]="SERVICE_ZEUSHB",i[i.SERVICE_USER_LOGIC=12]="SERVICE_USER_LOGIC",i[i.SERVICE_UNIFYDISPATCH=13]="SERVICE_UNIFYDISPATCH",i[i.SERVICE_QUALITY=14]="SERVICE_QUALITY",i[i.SERVICE_SECURITY=15]="SERVICE_SECURITY",i[i.SERVICE_KTVCPR=16]="SERVICE_KTVCPR",i[i.SERVICE_SWITCH4LIVEROOM=17]="SERVICE_SWITCH4LIVEROOM",i[i.SERVICE_WEBRTC_SIGNAL=18]="SERVICE_WEBRTC_SIGNAL",i[i.SERVICE_L3_WEBRTC_SIGNAL=19]="SERVICE_L3_WEBRTC_SIGNAL",i[i.SERVICE_VIDEOCPR=20]="SERVICE_VIDEOCPR",i[i.SERVICE_CDN=21]="SERVICE_CDN",i[i.SERVICE_CLOUDRECORD=22]="SERVICE_CLOUDRECORD",i[i.SERVICE_INNER_ECHO=23]="SERVICE_INNER_ECHO",i[i.SERVICE_OUTER_ECHO=24]="SERVICE_OUTER_ECHO",i[i.SERVICE_LOCALHOST_ECHO=25]="SERVICE_LOCALHOST_ECHO",i[i.SERVICE_ECHO=26]="SERVICE_ECHO",i[i.SERVICE_DOCSERVICE=27]="SERVICE_DOCSERVICE",i[i.SERVICE_AUTHSVR=28]="SERVICE_AUTHSVR",(i=o=o||{})[i.ZEGOCONN_RUN_ENV_UNSET=0]="ZEGOCONN_RUN_ENV_UNSET",i[i.ZEGOCONN_RUN_ENV_BROWSER=1]="ZEGOCONN_RUN_ENV_BROWSER",i[i.ZEGOCONN_RUN_ENV_APPLET=2]="ZEGOCONN_RUN_ENV_APPLET",(i=u=u||{})[i.Mode_UNSET=0]="Mode_UNSET",i[i.MODE_ONLINE=1]="MODE_ONLINE",i[i.MODE_TEST=2]="MODE_TEST",i[i.MODE_ALPHA=3]="MODE_ALPHA",(i=h=h||{})[i.HTTP=0]="HTTP",i[i.PC=1]="PC",i[i.OTHER=2]="OTHER",(i=a=a||{})[i.NONE=0]="NONE",i[i.BROKEN=1]="BROKEN",i[i.DISCONNECT=2]="DISCONNECT",(i=c=c||{})[i.CONNECTED=0]="CONNECTED",i[i.DISCONNECT=1]="DISCONNECT",i[i.BROKEN=2]="BROKEN";var l,f,_,d,m,v=[g.ACCESSHUB_INVALID_APPID,g.ACCESSHUB_INVALID_SIGNATURE],p=((i=l=l||{})[i.ACTION_RESERVED=0]="ACTION_RESERVED",i[i.ACTION_DISPATCH=1]="ACTION_DISPATCH",i[i.ACTION_RETRY=2]="ACTION_RETRY",i[i.ACTION_NEXT_NODE=3]="ACTION_NEXT_NODE",i[i.ACTION_ABORT=4]="ACTION_ABORT",i[i.ACTION_NEXT_GROUP=5]="ACTION_NEXT_GROUP",(g=f=f||{})[g.METHOD_UNSET=0]="METHOD_UNSET",g[g.METHOD_GET=1]="METHOD_GET",g[g.METHOD_POST=2]="METHOD_POST",g[g.METHOD_PUT=3]="METHOD_PUT",g[g.METHOD_PATCH=4]="METHOD_PATCH",g[g.METHOD_DELETE=5]="METHOD_DELETE",g[g.METHOD_HEAD=6]="METHOD_HEAD",g[g.METHOD_OPTIONS=7]="METHOD_OPTIONS",(i=_=_||{})[i.CLOSE=0]="CLOSE",i[i.TEMP=1]="TEMP",i[i.TIMEOUT=2]="TIMEOUT",(g=d=d||{})[g.AUTO=0]="AUTO",g[g.MANUAL=1]="MANUAL",(i=m=m||{})[i.EMPTY=0]="EMPTY",i[i.CLOSE=1]="CLOSE",{2:"stream_closed",3:"close_connection",4:"http_request",5:"http_response",12:"hb_request",13:"hb_response",14:"get_config_request",15:"get_config_response",16:"http_request_ack",17:"pc_upward_message",18:"pc_upward_message_ack",19:"pc_established",20:"pc_broken",21:"pc_downward_message",22:"redirect",23:"get_appconfig_request",24:"get_appconfig_response",25:"push_appconfig",26:"accesshub_dispatch_request",27:"accesshub_dispatch_response",30:"push_exception",33:"http_request2",34:"redirect2",35:"accesshub_dispatch_request2",36:"accesshub_dispatch_response2",39:"get_svraddr_request",40:"get_svraddr_response"}),g=n(0),b=n.n(g),E=(i=n(1),n(1));g=n(0),E.util.Long=g,E.util.Long.fromBits=E.util.Long?E.util.Long.fromBits:function(){return 0};for(var S=E.roots,R=E.types?E.types.basic:{double:1,float:5,int32:0,uint32:0,sint32:0,fixed32:5,sfixed32:5,int64:0,uint64:0,sint64:0,fixed64:1,sfixed64:1,bool:0,string:2,bytes:2},O=E.types?E.types.packed:{double:1,float:5,int32:0,uint32:0,sint32:0,fixed32:5,sfixed32:5,int64:0,uint64:0,sint64:0,fixed64:1,sfixed64:1,bool:0},y=Object.keys(R),T={$:function(t){return T[t]?T[t].call(this):S[t].decode?S[t].decode(this,this.uint32()):T.$.call(this,"int32")}},w={$:function(t,i,n){var e=R[t];return void 0===e?S[t].encode?(this.uint32((n<<3|2)>>0).fork(),S[t].encode(i,this).ldelim()):w.$.call(this,"int32",i,n):w[t].call(this.uint32(n<<3|e),i)}},I=0;I<y.length;I++)T[y[I]]=E.Reader.prototype[y[I]],w[y[I]]=E.Writer.prototype[y[I]];!function t(i,n,e,s){for(var r=0,o=Object.keys(i);r<o.length;r++){var u=o[r];i[u].$m&&Object.keys(i[u].$m).every((function(t){return Number(t)}))?e[u]=function(i,e){function s(t){for(var n in i)"{"===(n=i[n])[1].charAt(0)?this[n[0]]={}:"["!==n[1].charAt(0)&&"<"!==n[1].charAt(0)||(this[n[0]]=[]);if(t)for(var e=Object.keys(t),s=0;s<e.length;++s)null!=t[e[s]]&&(this[e[s]]=t[e[s]])}var r,o={};for(r in i){var u=i[r],h=u[1];"{"===h.charAt(0)?(s.prototype[u[0]]=E.util.emptyObject,o[h]={$m:h.substring(1).split(",").map((function(t,i){return["$"+(i+1),t,null]})).reduce((function(t,i,n){return t[n+1]=i,t}),{})}):s.prototype[u[0]]="["===h.charAt(0)||"<"===h.charAt(0)?E.util.emptyArray:"bytes"===h?E.util.newBuffer([]):u[2]&&u[2].hasOwnProperty("low")&&u[2].hasOwnProperty("high")?E.util.Long.fromBits(u[2].low,u[2].high,u[2].unsigned):u[2]}return s.create=function(t){return new s(t)},s.decode=function(t,n){t instanceof E.Reader||(t=E.Reader.create(t));for(var e=void 0===n?t.len:t.pos+n,r=new s;t.pos<e;){var o=t.uint32(),u=o>>>3;if(0<u&&i[u]){var h=i[u][0],a=i[u][1];if("{"===a.charAt(0))r[h]===E.util.emptyObject&&(r[h]={}),u=s.$namespace[a].decode(t,t.uint32()),r[h][u.$1]=u.$2;else if("["===a.charAt(0)||"<"===a.charAt(0))if(a=a.substring(1),r[h]&&r[h].length||(r[h]=[]),void 0!==O[a=T[a]||S[a].decode?a:"int32"]&&2==(7&o))for(var c=t.uint32()+t.pos;t.pos<c;)r[h].push(T.$.call(t,a));else r[h].push(T.$.call(t,a));else r[h]=T.$.call(t,a)}else t.skipType(7&o)}return r},s.encode=function(t,n){for(var e in n=n||E.Writer.create(),i){var r=i[e][0];if("{"===(a=i[e][1]).charAt(0)){if(null!=t[r]&&t.hasOwnProperty(r))for(var o=0,u=Object.keys(t[r]);o<u.length;++o)n.uint32((e<<3|2)>>0).fork(),s.$namespace[a].encode({$1:u[o],$2:t[r][u[o]]},n).ldelim()}else if("["===a.charAt(0)||"<"===a.charAt(0)){var h="<"===a.charAt(0),a=a.substring(1),c=t[r];if(null!=c&&c.length)if(a=void 0!==R[a]||S[a].encode?a:"int32",h&&void 0!==O[a]){for(n.uint32((e<<3|2)>>0).fork(),o=0;o<c.length;o++)w[a].call(n,c[o]);n.ldelim()}else for(o=0;o<c.length;o++)w.$.call(n,a,c[o],e)}else null!=t[r]&&t.hasOwnProperty(r)&&w.$.call(n,a,t[r],e)}return n},Object.keys(o).length&&(s.$namespace=t(o,n+"."+e,s.$namespace||{},!0)),s}(i[u].$m,u):i[u].$s?e[u]=function(t,i){function e(t,i,n){E.rpc.Service.call(this,t,i,n)}return((e.prototype=Object.create(E.rpc.Service.prototype)).constructor=e).create=function(t,i,n){return new e(t,i,n)},Object.keys(t).forEach((function(s){var r=t[s];function o(t,i){return this.rpcCall(o,S[r[0]],S[r[1]],t,i)}Object.defineProperty(o,"name",{value:s}),Object.defineProperty(o,"path",{value:n+"."+i}),e.prototype[s]=o})),e}(i[u].$s,u):i[u].$e&&Object.values(i[u].$e).every((function(t){return Number(t)===t}))&&(e[u]=function(t){for(var i=Object.keys(t),n={},e=0;e<i.length;e++)n[n[i[e]]=t[i[e]]]=i[e];return n}(i[u].$e)),e[u]&&!s&&(S[n+"."+u]=e[u]),delete i[u].$m,delete i[u].$s,delete i[u].$e,e[u]=t(i[u],n?n+"."+u:u,e[u]||{})}return e}({zego_connection:{proto_accesshub:{AccesshubAddr:{$m:{1:["ipv4","fixed32",0],2:["ipv6","zego_connection.proto_accesshub.IPV6Addr",null],3:["quic_port","uint32",0],4:["wss_port","uint32",0]}},AccesshubDispatchGroup:{$m:{1:["group","string",""],2:["quic_nodes","<string",null],3:["mtcp_nodes","<string",null],4:["wss_nodes","<string",null]}},AccesshubDispatchGroup2:{$m:{1:["group","string",""],2:["nodes","<zego_connection.proto_accesshub.AccesshubAddr",null],3:["nodes_dual","<zego_connection.proto_accesshub.AccesshubAddr",null],4:["weight","uint32",0]}},AccesshubDispatchRequest2:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["appid","uint32",0],3:["biz_type","uint32",0],4:["mode_no","zego_connection.proto_accesshub.Mode",0],5:["id_name","string",""],6:["sdk_type","zego_connection.proto_accesshub.SdkType",0],7:["zegoconn_version","uint32",0],8:["zegoconn_run_env","zego_connection.proto_accesshub.ZegoconnRunEnv",0],9:["device_id","string",""],10:["client_ip","string",""],11:["geofencing_type","uint32",0],12:["geofencings","[uint32",null],13:["addr_type","uint32",0]}},AccesshubDispatchResponse2:{$m:{1:["code","int32",0],2:["message","string",""],3:["data","zego_connection.proto_accesshub.AccesshubDispatchResponseData2",null]}},AccesshubDispatchResponseData2:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["rand","string",""],3:["secret","string",""],4:["groups","<zego_connection.proto_accesshub.AccesshubDispatchGroup2",null],5:["wss_groups","<zego_connection.proto_accesshub.WssAccesshubDispatchGroup",null],6:["ttl","uint32",0]}},BackendConnType:{$e:{BACKEND_CONN_TYPE_UNSET:0,BACKEND_CONN_TYPE_TCP:1,BACKEND_CONN_TYPE_WSS:2}},CheckServiceAreaRequest:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["appid","uint32",0],3:["biz_type","uint32",0],4:["mode","zego_connection.proto_accesshub.Mode",0],5:["id_name","string",""],6:["sdk_type","zego_connection.proto_accesshub.SdkType",0],7:["zegoconn_run_env","zego_connection.proto_accesshub.ZegoconnRunEnv",0],8:["zegoconn_version","uint32",0],9:["device_id","string",""],10:["user_agent","string",""],11:["language","string",""],12:["timezone","string",""],13:["carrier","string",""],14:["dns_result","zego_connection.proto_accesshub.IPAddr",null]}},CheckServiceAreaResponse:{$m:{1:["code","int32",0],2:["message","string",""],3:["data","zego_connection.proto_accesshub.CheckServiceAreaResponseData",null]}},CheckServiceAreaResponseData:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}]}},CloseConnection:{$m:{1:["reason","int32",0],2:["msg","string",""],3:["action","int32",0]},Action:{$e:{ACTION_RESERVED:0,ACTION_DISPATCH:1,ACTION_RETRY:2,ACTION_NEXT_NODE:3,ACTION_ABORT:4,ACTION_NEXT_GROUP:5,ACTION_IDLE:6}}},ConnectionClosed:{$m:{1:["code","int32",0],2:["msg","string",""]}},ErrorCode:{$e:{OK:0,DISPATCH_NO_AVAILABLE_NODE:1e4,DISPATCH_INTERNAL_ERROR:10001,DISPATCH_INVALID_FRAME:10002,DISPATCH_UNMARSHAL:10003,DISPATCH_MSGTYPE:10004,DISPATCH_MARSHAL:10005,DISPATCH_TOO_FREQUENTLY:10006,DISPATCH_EMPTY_GEOFENCING:10007,ACCESSHUB_INVALID_FRAME:2e4,ACCESSHUB_NEED_ENCRYPT:20001,ACCESSHUB_DECRYPT:20002,ACCESSHUB_MSGTYPE:20003,ACCESSHUB_UNMARSHAL:20004,ACCESSHUB_TIMEOUT:20005,ACCESSHUB_CONNECT:20006,ACCESSHUB_BROKEN:20007,ACCESSHUB_INTERNAL_ERROR:20008,ACCESSHUB_MARSHAL:20009,ACCESSHUB_UNSUPPORTED_SERVICE:20010,ACCESSHUB_TOO_FREQUENTLY:20011,ACCESSHUB_INVALID_APPID:20012,ACCESSHUB_HB_TIMEOUT:20013,ACCESSHUB_INVALID_SIGNATURE:20014,ACCESSHUB_AUTH_FAILED:20015,ACCESSHUB_UNSUPPORTED_INTERFACE:20016,ACCESSHUB_EMPTY_GEOFENCING:20017,ACCESSHUB_ACCESS_DENIED:20018,ACCESSHUB_SPECIAL_CUSTOMER:20019,ACCESSHUB_IDLE_CONNECTION:20020,ACCESSHUB_GET_STREAM_FAILED:3e4,ACCESSHUB_GET_CONN_FAILED:30001,ACCESSHUB_DO_HTTP_REQUEST_FAILED:30002,ACCESSHUB_UNMARSHAL_HB_FAILED:30003,ACCESSHUB_DO_BACKEND_DISPATCH_FAILED:30004}},GeoFencing:{$e:{CN:2,NA:3,EU:4,AS:5,IN:6,NCN:7}},GeoFencingType:{$e:{NONE:0,UNION:1,EXCLUDE:2}},GetAppConfigRequest:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["appid","uint32",0],3:["biz_type","uint32",0],4:["mode_no","zego_connection.proto_accesshub.Mode",0],5:["id_name","string",""],6:["config_key","string",""],7:["ts","uint64",{low:0,high:0,unsigned:!0}],8:["signature","bytes",[]],9:["lite_sign","string",""],10:["token","string",""],11:["sdk_type","zego_connection.proto_accesshub.SdkType",0],12:["zegoconn_version","uint32",0],13:["zegoconn_run_env","zego_connection.proto_accesshub.ZegoconnRunEnv",0],14:["device_id","string",""],15:["etag","uint32",0],16:["is_special_customer","uint32",0]}},GetAppConfigResponse:{$m:{1:["code","int32",0],2:["message","string",""],3:["data","zego_connection.proto_accesshub.GetAppConfigResponseData",null]}},GetAppConfigResponseData:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["data","bytes",[]],3:["ts","uint64",{low:0,high:0,unsigned:!0}],4:["etag","uint32",0]}},GetConfigRequest:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["appid","uint32",0],3:["biz_type","uint32",0],4:["mode","string",""],5:["id_name","string",""],6:["reqid","string",""],7:["zegoconn_version","uint32",0],8:["sdk_type","zego_connection.proto_accesshub.SdkType",0],9:["zegoconn_run_env","zego_connection.proto_accesshub.ZegoconnRunEnv",0],10:["device_id","string",""],11:["mode_no","zego_connection.proto_accesshub.Mode",0],12:["geofencing_type","uint32",0],13:["geofencings","[uint32",null]}},GetConfigResponse:{$m:{1:["code","int32",0],2:["message","string",""],3:["data","zego_connection.proto_accesshub.GetConfigResponseData",null]}},GetConfigResponseData:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["quic_hb_interval","uint32",0],3:["quic_hb_timeout","uint32",0],4:["logic_hb_interval","uint32",0],5:["logic_hb_timeout","uint32",0],6:["pc_establish_timeout","uint32",0],7:["sdk_link_detect_interval","uint32",0],8:["sdk_link_detect_duration","uint32",0],9:["client_outer_ip","string",""],10:["ntp_time","uint64",{low:0,high:0,unsigned:!0}],11:["root_rsa_certs_ver","uint32",0],12:["geofencing_id","uint32",0],13:["svraddr_ver","uint32",0],14:["root_ecc_certs_ver","uint32",0]}},GetSvraddrRequest:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["appid","uint32",0],3:["biz_type","uint32",0],4:["mode","zego_connection.proto_accesshub.Mode",0],5:["id_name","string",""],6:["sdk_type","zego_connection.proto_accesshub.SdkType",0],7:["zegoconn_run_env","zego_connection.proto_accesshub.ZegoconnRunEnv",0],8:["zegoconn_version","uint32",0],9:["device_id","string",""],10:["geofencing_type","uint32",0],11:["geofencings","[uint32",null],12:["addr_type","uint32",0]}},GetSvraddrResponse:{$m:{1:["code","int32",0],2:["msg","string",""],3:["data","zego_connection.proto_accesshub.GetSvraddrResponseData",null]}},GetSvraddrResponseData:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["geofencing_id","uint32",0],3:["svraddr_ver","uint32",0],4:["anycast_ips","<zego_connection.proto_accesshub.IPAddr",null],5:["zegons_domain","string",""],6:["zegons_ips","<zego_connection.proto_accesshub.IPAddr",null],7:["accesshub_domain","string",""],8:["accesshub_ips","<zego_connection.proto_accesshub.IPAddr",null],9:["logreport_domain","string",""],10:["logreport_ips","<zego_connection.proto_accesshub.IPAddr",null],11:["detaillog_domain","string",""],12:["detaillog_ips","<zego_connection.proto_accesshub.IPAddr",null],13:["stunsvr_domain","string",""],14:["stunsvr_ips","<zego_connection.proto_accesshub.IPAddr",null],15:["zimfile_domain","string",""],16:["zimfile_ips","<zego_connection.proto_accesshub.IPAddr",null],17:["accesshub_sni","string",""],18:["detectsvr_domain","string",""],19:["accesscube_domain","string",""]}},HBRequest:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["ts","int64",{low:0,high:0,unsigned:!1}]}},HBResponse:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["ts","int64",{low:0,high:0,unsigned:!1}],3:["ntp_time","uint64",{low:0,high:0,unsigned:!0}]}},HTTPRequest:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["appid","uint32",0],3:["biz_type","uint32",0],4:["mode","string",""],5:["id_name","string",""],6:["reqid","string",""],7:["stick","string",""],8:["service","string",""],9:["location","string",""],10:["method","string",""],11:["headers","<zego_connection.proto_accesshub.HTTPRequest.HTTPHeader",null],12:["body","bytes",[]],13:["ack","bool",!1],14:["mode_no","zego_connection.proto_accesshub.Mode",0],15:["service_no","zego_connection.proto_accesshub.Service",0],16:["method_no","zego_connection.proto_accesshub.Method",0],17:["sdk_type","zego_connection.proto_accesshub.SdkType",0],18:["zegoconn_run_env","zego_connection.proto_accesshub.ZegoconnRunEnv",0],19:["zegoconn_version","uint32",0],20:["device_id","string",""],21:["reduce_resp_header","uint32",0]},HTTPHeader:{$m:{1:["name","string",""],2:["val","string",""]}}},HTTPRequest2:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["appid","uint32",0],3:["biz_type","uint32",0],4:["mode","zego_connection.proto_accesshub.Mode",0],5:["id_name","string",""],6:["sdk_type","zego_connection.proto_accesshub.SdkType",0],7:["zegoconn_run_env","zego_connection.proto_accesshub.ZegoconnRunEnv",0],8:["zegoconn_version","uint32",0],9:["headers","<zego_connection.proto_accesshub.HTTPRequest.HTTPHeader",null],10:["method","zego_connection.proto_accesshub.Method",0],11:["interface_id","uint32",0],12:["res_id","string",""],13:["params","string",""],14:["body","bytes",[]],15:["ack","bool",!1],16:["device_id","string",""],17:["ts","uint64",{low:0,high:0,unsigned:!0}],18:["signature","bytes",[]],19:["token","string",""],20:["lite_sign","string",""],21:["reduce_resp_header","uint32",0]}},HTTPRequestAck:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}]}},HTTPRequestDroped:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["reason","int32",0],3:["msg","string",""]}},HTTPResponse:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["headers","<zego_connection.proto_accesshub.HTTPRequest.HTTPHeader",null],3:["status_code","int32",0],4:["body","bytes",[]]}},IPAddr:{$m:{1:["ipv4","fixed32",0],2:["ipv6","zego_connection.proto_accesshub.IPV6Addr",null]}},IPV6Addr:{$m:{1:["high","fixed64",{low:0,high:0,unsigned:!1}],2:["low","fixed64",{low:0,high:0,unsigned:!1}]}},MessageType:{$e:{MSG_TYPE_EMPTY:0,MSG_TYPE_CONNECTION_CLOSED:1,MSG_TYPE_STREAM_CLOSED:2,MSG_TYPE_CLOSE_CONNECTION:3,MSG_TYPE_HTTP_REQUEST:4,MSG_TYPE_HTTP_RESPONSE:5,MSG_TYPE_HTTP_REQUEST_DROPED:6,MSG_TYPE_PROXY_CONNECT:7,MSG_TYPE_PROXY_CONNECTED:8,MSG_TYPE_PROXY_CONNECTION_CLOSED:9,MSG_TYPE_PROXY_SEND_DATA:10,MSG_TYPE_PROXY_RECV_DATA:11,MSG_TYPE_HB_REQUEST:12,MSG_TYPE_HB_RESPONSE:13,MSG_TYPE_GET_CONFIG_REQUEST:14,MSG_TYPE_GET_CONFIG_RESPONSE:15,MSG_TYPE_HTTP_REQUEST_ACK:16,MSG_TYPE_PC_UPWARD_MESSAGE:17,MSG_TYPE_PC_UPWARD_MESSAGE_ACK:18,MSG_TYPE_PC_ESTABLISHED:19,MSG_TYPE_PC_BROKEN:20,MSG_TYPE_PC_DOWNWARD_MESSAGE:21,MSG_TYPE_REDIRECT:22,MSG_TYPE_GET_APPCONFIG_REQUEST:23,MSG_TYPE_GET_APPCONFIG_RESPONSE:24,MSG_TYPE_PUSH_APPCONFIG:25,MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST:26,MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE:27,MSG_TYPE_GET_IM_CONFIG_REQUEST:28,MSG_TYPE_GET_IM_CONFIG_RESPONSE:29,MSG_TYPE_PUSH_EXCEPTION:30,MSG_TYPE_RESOLVE_DOMAIN_REQUEST:31,MSG_TYPE_RESOLVE_DOMAIN_RESPONSE:32,MSG_TYPE_HTTP_REQUEST2:33,MSG_TYPE_REDIRECT2:34,MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST2:35,MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE2:36,MSG_TYPE_GET_ROOTCERTS_REQUEST:37,MSG_TYPE_GET_ROOTCERTS_RESPONSE:38,MSG_TYPE_GET_SVRADDR_REQUEST:39,MSG_TYPE_GET_SVRADDR_RESPONSE:40,MSG_TYPE_CHECK_SERVICEAREA_REQUEST:41,MSG_TYPE_CHECK_SERVICEAREA_RESPONSE:42,MSG_TYPE_UA_DISPATCH_REQUEST:50,MSG_TYPE_UA_DISPATCH_RESPONSE:51,MSG_TYPE_UA_ECHO_REQUEST:52,MSG_TYPE_UA_ECHO_RESPONSE:53,MSG_TYPE_NODE_REGISTER_REQUEST:100,MSG_TYPE_NODE_REGISTER_RESPONSE:101,MSG_TYPE_NODE_HB_REQUEST:102,MSG_TYPE_NODE_HB_RESPONSE:103}},Method:{$e:{METHOD_UNSET:0,METHOD_GET:1,METHOD_POST:2,METHOD_PUT:3,METHOD_PATCH:4,METHOD_DELETE:5,METHOD_HEAD:6,METHOD_OPTIONS:7}},Mode:{$e:{Mode_UNSET:0,MODE_ONLINE:1,MODE_TEST:2,MODE_ALPHA:3}},PCBroken:{$m:{}},PCDownwardMessage:{$m:{1:["payload","bytes",[]],2:["wss_message_type","uint32",0],3:["ts","uint64",{low:0,high:0,unsigned:!0}]}},PCEstablished:{$m:{1:["elapse","uint32",0],2:["from","uint32",0]}},PCUpwardMessage:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["appid","uint32",0],3:["biz_type","uint32",0],4:["mode_no","zego_connection.proto_accesshub.Mode",0],5:["id_name","string",""],6:["service_no","zego_connection.proto_accesshub.Service",0],7:["ack","bool",!1],8:["payload","bytes",[]],9:["sdk_type","zego_connection.proto_accesshub.SdkType",0],10:["wss_message_type","uint32",0],11:["wss_path","string",""],12:["wss_raw_query","string",""],13:["zegoconn_version","uint32",0],14:["zegoconn_run_env","zego_connection.proto_accesshub.ZegoconnRunEnv",0],15:["backend_conn_type","zego_connection.proto_accesshub.BackendConnType",0],16:["device_id","string",""],17:["geofencing_type","uint32",0],18:["geofencings","[uint32",null],19:["addr_type","uint32",0]}},PCUpwardMessageAck:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}]}},ProxyConnectionClosed:{$m:{1:["code","int32",0],2:["msg","string",""],3:["connected","int32",0]}},PushAppConfig:{$m:{1:["config_key","string",""],2:["data","bytes",[]]}},PushException:{$m:{1:["reason","int32",0],2:["msg","string",""],3:["txid","uint64",{low:0,high:0,unsigned:!0}]}},Redirect2:{$m:{1:["rand","string",""],2:["secret","string",""],3:["groups","<zego_connection.proto_accesshub.AccesshubDispatchGroup2",null],4:["wss_groups","<zego_connection.proto_accesshub.WssAccesshubDispatchGroup",null],5:["ttl","uint32",0]}},SdkType:{$e:{SDK_TYPE_UNSET:0,SDK_TYPE_NATIVE:1,SDK_TYPE_WSS_WEB:3,SDK_TYPE_ZIM_WEB:4}},Service:{$e:{SERVICE_UNSET:0,SERVICE_MEDIAGW:1,SERVICE_LIVEROOM:2,SERVICE_MIX:3,SERVICE_ZEUS:4,SERVICE_ZPUSH:5,SERVICE_L3:6,SERVICE_TALKLINE:7,SERVICE_EDUSUITE:8,SERVICE_ZIM:9,SERVICE_ClOUD_SETTING:10,SERVICE_ZEUSHB:11,SERVICE_USER_LOGIC:12,SERVICE_UNIFYDISPATCH:13,SERVICE_QUALITY:14,SERVICE_SECURITY:15,SERVICE_KTVCPR:16,SERVICE_SWITCH4LIVEROOM:17,SERVICE_WEBRTC_SIGNAL:18,SERVICE_L3_WEBRTC_SIGNAL:19,SERVICE_VIDEOCPR:20,SERVICE_CDN:21,SERVICE_CLOUDRECORD:22,SERVICE_INNER_ECHO:23,SERVICE_OUTER_ECHO:24,SERVICE_LOCALHOST_ECHO:25,SERVICE_ECHO:26,SERVICE_DOCSERVICE:27,SERVICE_AUTHSVR:28,SERVICE_WEBLIVEROOM:29,SERVICE_WHITEBOARD:30,SERVICE_METAWORLD:31,SERVICE_ZEGOLAND:32}},StreamClosed:{$m:{1:["code","int32",0],2:["msg","string",""]}},WssAccesshubDispatchGroup:{$m:{1:["group","string",""],2:["host","string",""],3:["main_domain","string",""]}},ZegoconnRunEnv:{$e:{ZEGOCONN_RUN_ENV_UNSET:0,ZEGOCONN_RUN_ENV_BROWSER:1,ZEGOCONN_RUN_ENV_APPLET:2}}},proto_initconfig:{AppConfig:{$m:{1:["test_id","int32",0],2:["domain","string",""],3:["flexible_domain","string",""],4:["replace_flexible_domain","string",""]}},InitConfig:{$m:{1:["app_config","zego_connection.proto_initconfig.AppConfig",null],4:["speedlog_config","zego_connection.proto_initconfig.SpeedlogConfig",null],5:["media_config","zego_connection.proto_initconfig.MediaConfig",null]}},MediaConfig:{$m:{1:["play_config","zego_connection.proto_initconfig.MediaPlayConfig",null],2:["publish_config","zego_connection.proto_initconfig.MediaPublishConfig",null]}},MediaPlayConfig:{$m:{5:["resource_info","<zego_connection.proto_initconfig.MediaResourceInfo",null]}},MediaPublishConfig:{$m:{2:["resource_info","<zego_connection.proto_initconfig.MediaResourceInfo",null],5:["enable_subject_segmentation","int32",0],6:["object_segmentation_platform","int32",0]}},MediaResourceInfo:{$m:{1:["resource_type","zego_connection.proto_initconfig.ResourceType",0],2:["service_info","<zego_connection.proto_initconfig.MediaServiceProtocolInfo",null]}},MediaServiceProtocolInfo:{$m:{1:["config_id","string",""],2:["protocol","zego_connection.proto_initconfig.ProtocolType",0],3:["url_template","string",""],4:["resolve_type","zego_connection.proto_initconfig.ResolveType",0],5:["push_cdn_authentication","int32",0],6:["cdn_quic_version","<int32",null]}},ProtocolType:{$e:{UDP:0,RTMP:1,FLV:2,HLS:3,WEBRTC:4}},ResolveType:{$e:{LOCAL_DNS:0,DISPATCH:1}},ResourceType:{$e:{CDN:0,RTC:1,L3:2,CDN_PLUS:3,CDN_PLUS_BACKUP:4}},SpeedlogConfig:{$m:{1:["report_count","int32",0],2:["report_retry_interval","int32",0],3:["push_quality_sample_count","int32",0],4:["pull_quality_sample_count","int32",0],5:["hardware_report_cycle","int32",0],6:["room_user_max_count","int32",0],7:["room_stream_max_count","int32",0],8:["charge_info_report_cycle","int32",0],9:["charge_info_report_mode","int32",0],10:["disable_report_pull","<zego_connection.proto_initconfig.ResourceType",null],11:["report_max_bytes","int32",0],12:["push_quality_report_freq","int32",0],13:["pull_quality_report_freq","int32",0],14:["charge_info_report_no_playing","int32",0]}}}}},"",S,!1);var N=S.zego_connection,C=function(){return(C=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t}).apply(this,arguments)};i.util.Long=b.a,i.configure(),U.prototype.encodeRequest=function(t,i,n){var e,s=(r=this._[t])[0],r=r[1];return r=(s=this.v(this.h[s][r],i)).length,0===this.stateCenter.appInfo.model?((e=new Uint8Array(13+r))[0]=175,e[1]=0,e[2]=t>>8,e[3]=t-(e[2]<<8),e.set(new Uint8Array(Int32Array.from([r]).buffer).reverse(),4),e.set(new Uint8Array(Int32Array.from([n]).buffer).reverse(),8),e[12]=0):((e=new Uint8Array(13+r))[0]=172,e[1]=0,e[2]=0,e.set(new Uint8Array(Int32Array.from([n]).buffer).reverse(),3),e[7]=t>>8,e[8]=t-(e[2]<<8),e.set(new Uint8Array(Int32Array.from([r]).buffer).reverse(),9)),e.set(s,13),e},U.prototype.decodeResponse=function(t){var i,n=0===this.stateCenter.appInfo.model?(i=(t[2]<<8)+t[3],new DataView(t.buffer).getUint32(8)):(i=(t[7]<<8)+t[8],new DataView(t.buffer).getUint32(3)),e=t.slice(13);try{var s=this._[i];return[n,i,this.S(this.h[s[0]][s[1]],e)]}catch(t){return[n,i,{code:1}]}},U.prototype.decodeConfigMessage=function(t){return this.S(this.h.proto_initconfig.InitConfig,t)},U.prototype.v=function(t,i){return t.encode(new t(i)).finish()},U.prototype.S=function(t,i){return C({},t.decode(i))};var k,z=U,A=(Object.defineProperty(x.prototype,"id",{get:function(){return this.g||null},set:function(t){this.g=t},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"data",{get:function(){return this.T},set:function(t){this.T=t},enumerable:!1,configurable:!0}),x.prototype.hasNext=function(){return this.next&&this.next.id},x.prototype.hasPrev=function(){return this.prev&&this.prev.id},x),D=(P.prototype.insertBefore=function(t,i){return(i=new A(this.C,i)).next=t,i.prev=t.prev,t.prev&&(t.prev.next=i),t.prev=i,++this.C,++this.R,i},P.prototype.addLast=function(t){return this.insertBefore(this.end,t)},P.prototype.add=function(t){return this.addLast(t)},P.prototype.getFirst=function(){return 0===this.R?null:this.start.next},P.prototype.getLast=function(){return 0===this.R?null:this.end.prev},P.prototype.size=function(){return this.R},P.prototype.getFromFirst=function(t){var i=0,n=this.start.next;if(0<=t)for(;i<t&&null!==n;)n=n.next,++i;else n=null;if(null===n)throw"Index out of bounds.";return n},P.prototype.get=function(t){return 0===t?this.getFirst():t===this.R-1?this.getLast():this.getFromFirst(t)},P.prototype.remove=function(t){return t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),--this.R,t},P.prototype.removeFirst=function(){var t=null;return 0<this.R&&this.start.next?this.remove(this.start.next):t},P.prototype.removeLast=function(){var t=null;return 0<this.R&&this.end.prev?this.remove(this.end.prev):t},P.prototype.removeAll=function(){this.start.next=this.end,this.end.prev=this.start,this.R=0,this.C=0},P.prototype.each=function(t){for(var i=this.start;i.hasNext();)t(i=i.next)},P.prototype.find=function(t){for(var i=this.start,n=!1,e=null;i.hasNext()&&!n;)t(i=i.next)&&(e=i,n=!0);return e},P.prototype.map=function(t){for(var i=this.start,n=[];i.hasNext();)t(i=i.next)&&n.push(i);return n},P.prototype.push=function(t){return this.addLast(t)},P.prototype.unshift=function(t){this.insertBefore(0<this.R?this.start.next:this.end,t)},P.prototype.pop=function(){return this.removeLast()},P.prototype.shift=function(){return this.removeFirst()},P);function M(){this.txid=0,this.linkRetryTime=60,this.updatedMsgTime=0,this.connectServer=""}function P(){this.start=new A,this.end=new A,this.C=0,this.R=0,this.start.next=this.end,this.start.prev=null,this.end.prev=this.start,this.end.next=null}function x(t,i){void 0===t&&(t=null),void 0===i&&(i=null),this.next=null,this.prev=null,this.g=t,this.T=i}function U(t){this.stateCenter=t,this.h=N,this._=((t={})[s.MSG_TYPE_STREAM_CLOSED]=["proto_accesshub","ConnectionClosed"],t[s.MSG_TYPE_CLOSE_CONNECTION]=["proto_accesshub","CloseConnection"],t[s.MSG_TYPE_HTTP_REQUEST]=["proto_accesshub","HTTPRequest"],t[s.MSG_TYPE_HTTP_RESPONSE]=["proto_accesshub","HTTPResponse"],t[s.MSG_TYPE_HTTP_REQUEST2]=["proto_accesshub","HTTPRequest2"],t[s.MSG_TYPE_HB_REQUEST]=["proto_accesshub","HBRequest"],t[s.MSG_TYPE_HB_RESPONSE]=["proto_accesshub","HBResponse"],t[s.MSG_TYPE_GET_CONFIG_REQUEST]=["proto_accesshub","GetConfigRequest"],t[s.MSG_TYPE_GET_CONFIG_RESPONSE]=["proto_accesshub","GetConfigResponse"],t[s.MSG_TYPE_GET_SVRADDR_REQUEST]=["proto_accesshub","GetSvraddrRequest"],t[s.MSG_TYPE_GET_SVRADDR_RESPONSE]=["proto_accesshub","GetSvraddrResponse"],t[s.MSG_TYPE_HTTP_REQUEST_ACK]=["proto_accesshub","HTTPRequestAck"],t[s.MSG_TYPE_PC_UPWARD_MESSAGE]=["proto_accesshub","PCUpwardMessage"],t[s.MSG_TYPE_PC_UPWARD_MESSAGE_ACK]=["proto_accesshub","PCUpwardMessageAck"],t[s.MSG_TYPE_PC_ESTABLISHED]=["proto_accesshub","PCEstablished"],t[s.MSG_TYPE_PC_BROKEN]=["proto_accesshub","PCBroken"],t[s.MSG_TYPE_PC_DOWNWARD_MESSAGE]=["proto_accesshub","PCDownwardMessage"],t[s.MSG_TYPE_REDIRECT]=["proto_accesshub","Redirect"],t[s.MSG_TYPE_REDIRECT2]=["proto_accesshub","Redirect2"],t[s.MSG_TYPE_GET_APPCONFIG_REQUEST]=["proto_accesshub","GetAppConfigRequest"],t[s.MSG_TYPE_GET_APPCONFIG_RESPONSE]=["proto_accesshub","GetAppConfigResponse"],t[s.MSG_TYPE_PUSH_APPCONFIG]=["proto_accesshub","PushAppConfig"],t[s.MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST]=["proto_accesshub","AccesshubDispatchRequest"],t[s.MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE]=["proto_accesshub","AccesshubDispatchResponse"],t[s.MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST2]=["proto_accesshub","AccesshubDispatchRequest2"],t[s.MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE2]=["proto_accesshub","AccesshubDispatchResponse2"],t[s.MSG_TYPE_PUSH_EXCEPTION]=["proto_accesshub","PushException"],t)}M.prototype.createSocket=function(t){},M.prototype.setState=function(t){},M.prototype.initEvent=function(t,i,n,e){},M.prototype.sendMessage=function(t,i,n,e,s,r,o,u){void 0===e&&(e=!0),void 0===s&&(s=null),void 0===r&&(r=null),void 0===o&&(o=null)},n=M,(g=k=k||{})[g.BROWSER=0]="BROWSER",g[g.WEIXINMINI=1]="WEIXINMINI",q.prototype.init=function(){var t=this;this.A&&(this.readyState=0,this.A.onOpen((function(i){t.readyState=t.A.readyState,"function"==typeof t.onopen&&(t.onopen(i),t.A.onClose((function(i){t.readyState=t.A.readyState,"function"==typeof t.onclose&&t.onclose(i)})),t.A.onMessage((function(i){"function"==typeof t.onmessage&&t.onmessage(i)})))})),this.A.onError((function(i){t.readyState=t.A.readyState,"function"==typeof t.onerror&&t.onerror(i)})))},q.prototype.onopen=function(t){},q.prototype.onerror=function(t){},q.prototype.onclose=function(t){},q.prototype.onmessage=function(t){},q.prototype.send=function(t){t instanceof Uint8Array&&(t=new Uint8Array(t).buffer),this.A&&this.A.send({data:t})},q.prototype.close=function(){this.A&&this.A.close()};var L=q;function q(t,i){this.url=t,this.readyState=3,this.A=wx.connectSocket({url:t}),this.init()}function j(t,i,n){if(n||2===arguments.length)for(var e,s=0,r=i.length;s<r;s++)!e&&s in i||((e=e||Array.prototype.slice.call(i,0,s))[s]=i[s]);return t.concat(e||Array.prototype.slice.call(i))}it.prototype.createSocket=function(t){var i,n;this.O=(n=this.proxyCtrl,(i=this.ENV%2)%2===k.BROWSER?(i=t,n?n.createSocket(i,0):new WebSocket(i)):new L(t))},it.prototype.openHandler=function(t){var i=this;this.O&&(this.O.onopen=function(n){i.O.binaryType="arraybuffer",i.responseHandler(),t(n)})},it.prototype.responseHandler=function(){var t=this;this.O&&(this.O.onmessage=function(i){i="string"==typeof i.data?JSON.parse(i.data):i.data,t.onMessage(i)})},it.prototype.onMessage=function(t){},it.prototype.closeHandler=function(t){this.O&&(this.O.onclose=function(i){t(i)})},it.prototype.errorHandler=function(t){this.O&&(this.O.onerror=t)},it.prototype.closeSocket=function(){this.O&&(this.O.onclose=null,this.O.onerror=null,this.O.close(),this.O=null)},it.prototype.isDisConnect=function(){return!this.O||1!==this.O.readyState},it.prototype.sendMessage=function(t){this.isDisConnect()||this.O&&this.O.send(t)};var G,H,$=it,V={code:1100002,msg:"network timeout."},B={code:1100004,msg:"net agent timeout"},J=1100006,Y={code:1100007,msg:"the user breaks the network connection"},F="zn.nab.gsa",W="zn.napr.ope",X={domains:["accesshub-wss.zego.im"],mode:"online",modeNo:u.MODE_ONLINE,sdkType:3,connectVer:31,pcEstablishTimeout:15,scheme:"wss",location:"accesshub",wssMessageType:1,model:0},Z=(G=function(t,i){return(G=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}))(t,i)},function(){return(Z=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t}).apply(this,arguments)}),K=function(t){function i(i,n,e,r,o,u){var h=t.call(this)||this;return h.P=i,h.I=n,h.N=e,h.D=r,h.M=o,h.proxyCtrl=u,h.socketService=new $(h.I,h.proxyCtrl),h.urlIndex=0,h.updatedMsgTime=0,h.unUpdateMsgTimeTypes=[s.MSG_TYPE_HB_REQUEST,s.MSG_TYPE_HB_RESPONSE,s.MSG_TYPE_GET_CONFIG_REQUEST,s.MSG_TYPE_GET_CONFIG_RESPONSE,s.MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST2,s.MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE2,s.MSG_TYPE_GET_SVRADDR_REQUEST,s.MSG_TYPE_GET_SVRADDR_RESPONSE,s.MSG_TYPE_GET_APPCONFIG_REQUEST,s.MSG_TYPE_GET_APPCONFIG_RESPONSE],h.netLinkState=0,h.sendCommandList=new D,h.unSendCommandList=new D,h.sendCommandMap={},h.unSendCommandMap={},h.U=100,h.H=15e3,h.G=1e3,h.Y=5e3,h.connectInterval=1e4,h.connectTimer=null,h.connectRsp={},h.unlogTypes=[12,13],h.tryServers=[],h.tryConnectEvents=[],h.connectStartTime=0,h.updatedMsgTime=Date.now(),h}var n=i,e=t;if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=n}return G(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r),Object.defineProperty(i.prototype,"HBHandler",{set:function(t){this.V=t},enumerable:!1,configurable:!0}),i.prototype.initEvent=function(t,i,n,e){this.B=t,this.k=i,this.L=n,this.q=e},i.prototype.createSocket=function(t){this.servers=t,this.urlIndex=0},i.prototype.destroySocket=function(t,i){this.D.info("zn.wl.ds.0 call "+t),this.socketService.closeSocket(),this.netLinkState=0,t!==a.NONE&&(i&&(this.j(this.servers?this.servers[this.urlIndex]:"",i.code,!0),this.B)&&this.B(this.tryServers,this.tryConnectEvents),this.k)&&this.k(t===a.BROKEN),this.resetConnect()},i.prototype.refreshServers=function(t){this.servers=j(j([],t,!0),this.servers,!0)},i.prototype.connectSocket=function(t,i,n){var e=this,s=(void 0===t&&(t=!0),this.D.info("zn.wl.cs.0 call"),this.connectRsp.suc=i,!1),r=(this.connectRsp.fail=function(){n&&(s?e.D.info("zn.wl.cs.0 fail cb has exec"):(n(),s=!0))},t&&(this.urlIndex=(this.urlIndex+1)%this.servers.length),this.servers[this.urlIndex]);return this.connectServer=r,this.D.info("zn.wl.cs.0 server "+r),this.tryServers.push(r),this.connectStartTime=Date.now(),this.closeSocket(),this.netLinkState=1,this.socketService.createSocket(r),this.L&&this.L(!0),this.bindSocketEvent(),this.connectTimer=setTimeout((function(){e.D.info("zn.wl.cs.0 timeout"),e.j(r,J),e.connectRsp.fail&&e.connectRsp.fail()}),this.connectInterval),!0},i.prototype.bindSocketEvent=function(){var t=this;this.openHandler((function(){t.D.info("zn.wl.bse open"),t.resetConnect(),t.connectRsp.suc&&t.connectRsp.suc(),t.netLinkState=2,t.j(t.connectServer,0),t.B&&t.B(t.tryServers,t.tryConnectEvents),t.tryConnectEvents=[],t.checkUnSendMsgs(t.unSendCommandList,t.unSendCommandMap)})),this.closeHandler((function(i){t.D.warn("zn.wl.bse close "+JSON.stringify(i.code||i)),t.resetConnect(),t.connectRsp.fail&&t.connectRsp.fail(),t.j(t.connectServer,(null==i?void 0:i.code)||J),t.k&&t.k(!0),t.netLinkState=0})),this.errorHandler((function(i){t.D.warn("zn.wl.bse error "+JSON.stringify(i.code||i)),t.resetConnect(),t.connectRsp.fail&&t.connectRsp.fail(),t.j(t.connectServer,(null==i?void 0:i.code)||J),t.k&&t.k(!0),t.netLinkState=0})),this.onMessage()},i.prototype.closeSocket=function(){this.D.info("zn.wl.cs.1 call"),this.socketService.closeSocket(),this.netLinkState=0},i.prototype.j=function(t,i,n){(this.connectStartTime||n)&&(n=this.connectStartTime?Date.now()-this.connectStartTime:0,this.tryConnectEvents.push({url:t,time_consumed:n,connect_type:3,error:i}))},i.prototype.resetConnect=function(){this.connectTimer&&(clearTimeout(this.connectTimer),this.connectTimer=null)},i.prototype.release=function(){this.stopCheck()},i.prototype.isConnect=function(){return 2===this.netLinkState},i.prototype.isDisConnect=function(){return!this.socketService||this.socketService.isDisConnect()},i.prototype.isConnecting=function(){return 1===this.netLinkState},i.prototype.setState=function(t){this.netLinkState=t},i.prototype.closeHandler=function(t){this.socketService.closeHandler(t)},i.prototype.openHandler=function(t){this.socketService.openHandler(t)},i.prototype.errorHandler=function(t){this.socketService.errorHandler(t)},i.prototype.sendMessage=function(t,i,n,e,r,u,h,a){void 0===e&&(e=!0),void 0===r&&(r=null),void 0===u&&(u=null),void 0===h&&(h=null),void 0===(a=void 0===a?{}:a).timeout&&(a.timeout=5e3),void 0===a.isInSendMap&&(a.isInSendMap=!0),void 0===a.isMsgCache&&(a.isMsgCache=!0),this.txid++;var c={appid:this.P,biz_type:0,mode_no:(null==(c=this.M.appInfo)?void 0:c.mode)||X.modeNo,id_name:this.M.userId,sdk_type:X.sdkType,zegoconn_run_env:0===this.I?o.ZEGOCONN_RUN_ENV_BROWSER:o.ZEGOCONN_RUN_ENV_APPLET,zegoconn_version:(null==(c=this.M.appInfo)?void 0:c.connVer)||X.connectVer};null!=(l=this.M.appInfo)&&l.deviceID&&(c.device_id=null==(l=this.M.appInfo)?void 0:l.deviceID);var l=Z(Z({txid:this.txid},e?c:{}),n);e={data:l,txid:this.txid,sendTime:Date.now(),streamID:i,type:t,timeOut:a.timeout||this.Y,ack:n.ack,success:r,error:u,ackFunc:h,isSend:!0,isCheck:t!==s.MSG_TYPE_PC_UPWARD_MESSAGE,extras:a.extras},a.isInSendMap&&(c=this.sendCommandList.push(e),this.sendCommandMap[this.txid]=c,this.F||this.startCheck()),10!==l.service&&14!==l.interface_id&&this.unUpdateMsgTimeTypes.includes(t)||(this.updatedMsgTime=Date.now()),-1===this.unlogTypes.indexOf(t)&&this.D.info("zn.wl.sm type: "+t+"-"+p[t]+" streamID: "+i+" txid: "+this.txid),this.isConnect()?this.sendUint8Data(t,l,i,a.extras):a.isMsgCache&&(e.isSend=!1,n=this.unSendCommandList.push(e),this.unSendCommandMap[this.txid]=n)},i.prototype.checkUnSendMsgs=function(t,i){for(var n,e=t.getFirst();null!=e;)e.T&&delete i[null==(n=e.T)?void 0:n.txid],t.remove(e),e.T&&!1===(null==(n=e.T)?void 0:n.isSend)&&e.T.type&&e.T.streamID&&e.T.data&&(this.sendUint8Data(e.T.type,e.T.data,e.T.streamID),e.T.isSend=!0),e=t.getFirst()},i.prototype.W=function(t){return t.buffer.slice(t.byteOffset,t.byteLength+t.byteOffset)},i.prototype.sendUint8Data=function(t,i,n,e){t=this.N.encodeRequest(t,i,n),this.socketService.sendMessage(this.W(t)),null!=(i=this.V)&&i.startHB()},i.prototype.onMessage=function(){var t=this;this.socketService.onMessage=function(i){i=new Uint8Array(i);var n,e,s=(e=t.N.decodeResponse(i))[0],r=e[1],o=((e=e[2]).txid&&b.a.isLong(e.txid)&&e.txid.toNumber&&(e.txid=e.txid.toNumber()),t.unUpdateMsgTimeTypes.includes(r)||(t.updatedMsgTime=Date.now()),(null==e?void 0:e.txid)||(null==(o=null==e?void 0:e.data)?void 0:o.txid));-1===t.unlogTypes.indexOf(r)&&(n=o?", txid: ".concat(o):"",t.D.info("zn.wl.om"+" streamID: ".concat(s,", msgType: ").concat(r,"-").concat(p[r])+n)),o&&t.isRspMsg(o)?t.handleSendCommandMsgRsp(s,r,o,e,{size:i.length}):t.q(s,r,e,{size:i.length})}},i.prototype.isRspMsg=function(t){return void 0!==this.sendCommandMap[t]},i.prototype.startCheck=function(){var t=this;this.K(this.sendCommandList,this.sendCommandMap,this.unSendCommandList,this.unSendCommandMap),this.F=setTimeout((function(){t.startCheck()}),this.G)},i.prototype.stopCheck=function(){this.Z(this.sendCommandList),this.F&&(clearTimeout(this.F),this.F=null)},i.prototype.K=function(t,i,n,e){for(var s,r,o=t.getFirst(),u=t.size(),h=Date.now(),a=0,c=0;null!=o;){if(o.T&&o.T.sendTime+o.T.timeOut>h){if(++c<u){var l=t.removeFirst();l&&null!=l&&l.data&&(l=t.push(null==l?void 0:l.data),null!=(r=o.T))&&r.txid&&(i[null==(r=o.T)?void 0:r.txid]=l),o=t.getFirst();continue}break}if(t.remove(o),o.T&&(delete i[o.T.txid],r=e[o.T.txid])&&(n.remove(r),delete e[o.T.txid]),++c,o.T&&null==o.T.error||o.T&&o.T.sendTime+this.H<h||(l=o&&o.T&&o.T.error,o&&o.T&&null!=(s=o.T)&&s.isCheck&&l&&l({},o&&o.T&&o.T.txid,V)),++a>=this.U)break;o=t.getFirst()}},i.prototype.Z=function(t){for(var i,n=t.getFirst();null!=n&&n.T;)!function(){var e,s,r;t.remove(n),n.T.isSend&&n.T.error&&(e=n&&n.T&&n.T.error,s=n&&n.T&&n.T.txid,r=n&&n.T&&(null==(i=n.T)?void 0:i.isCheck),setTimeout((function(){r&&e&&e({},s,V)}),0)),n=t.getFirst()}()},i.prototype.handleSendCommandMsgRsp=function(t,i,n,e,r){var o,u=this.sendCommandMap[n];null!=u&&(null!=(o=u.T)&&o.ack||(delete this.sendCommandMap[n],this.sendCommandList.remove(u)),e.code&&0!==e.code?o&&null!=o.error&&(o.error(e,n),o.success=null,o.error=null):i===s.MSG_TYPE_PUSH_EXCEPTION?(e.code=e.reason,e.message=e.msg,delete e.reason,delete e.msg,o&&null!=o.error&&(o.error(e,n),o.success=null,o.error=null)):i===s.MSG_TYPE_HTTP_REQUEST_ACK?o&&null!=o.ackFunc&&o.ackFunc(e,n):o&&null!=o.success&&(o.success(e,n,r),o.success=null,o.error=null))},i}(n),Q=(tt.prototype.getConfig=function(t,i){var n;this.D.info("zn.nab.gc call"),this.J.createStream(h.OTHER).sendMessage(s.MSG_TYPE_GET_CONFIG_REQUEST,{geofencing_type:null==(n=this.stateCenter.appInfo.geoFencing)?void 0:n.type,geofencings:null==(n=this.stateCenter.appInfo.geoFencing)?void 0:n.list},t,i)},tt.prototype.dispatchURL=function(t,i){var n,e=this;this.D.info("zn.nab.du call"),this.J.createStream(h.OTHER).sendMessage(s.MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST2,{geofencing_type:null==(n=this.stateCenter.appInfo.geoFencing)?void 0:n.type,geofencings:null==(n=this.stateCenter.appInfo.geoFencing)?void 0:n.list},(function(i){e.D.info("zn.nab.du suc "),t&&t(i)}),(function(t,n,s){e.D.info("zn.nab.du fail"),i&&i(s||t)}))},tt.prototype.getAppConfig=function(t,i,n,e,r,o){var u=this;return new Promise((function(a,c){function l(t,i,n){n?(u.D.error("zn.nab.gac fail "+JSON.stringify(n)),c(n)):0===t.code?(u.D.info("zn.nab.gac suc"),n=u.decodeConfigMessage(t.data.data),a({code:0,data:n,etag:t.data.etag})):(u.D.error("zn.nab.gac fail "+t.code),c({code:t.code}))}u.D.info("zn.nab.gac call");var f={id_name:i,config_key:t,token:n,mode_no:(null==(f=u.stateCenter.appInfo)?void 0:f.mode)||X.modeNo,etag:r,is_special_customer:null!=o&&o.isSpecial?1:0};u.J.createStream(h.OTHER).sendMessage(s.MSG_TYPE_GET_APPCONFIG_REQUEST,f,l,l,null,{timeout:e})}))},tt.prototype.decodeConfigMessage=function(t){return this.N.decodeConfigMessage(t)},tt.prototype.getSvrAddr=function(){var t=this;return new Promise((function(i,n){var e;t.D.info("".concat(F," call")),t.J.createStream(h.OTHER).sendMessage(s.MSG_TYPE_GET_SVRADDR_REQUEST,{geofencing_type:null==(e=t.stateCenter.appInfo.geoFencing)?void 0:e.type,geofencings:null==(e=t.stateCenter.appInfo.geoFencing)?void 0:e.list},(function(n){t.D.info("".concat(F," suc")),i(n)}),(function(i,e,s){t.D.info("".concat(F," fail")),n(s||i)}))}))},tt);function tt(t,i,n,e){this.J=t,this.N=i,this.D=n,this.stateCenter=e}function it(t,i){this.proxyCtrl=i,this.O=null,this.ENV=t}function nt(t){var i=unescape||window.unescape;return Uint8Array.from(Array.from(i(encodeURIComponent(t))).map((function(t){return t.charCodeAt(0)})))}function et(t){var i=escape||window.escape;return decodeURIComponent(i(String.fromCharCode.apply(String,Array.from(t))))}function st(t,i,n){if(n||2===arguments.length)for(var e,s=0,r=i.length;s<r;s++)!e&&s in i||((e=e||Array.prototype.slice.call(i,0,s))[s]=i[s]);return t.concat(e||Array.prototype.slice.call(i))}(i=H=H||{}).Lazy="lazy",i.Periodic="periodic",It.prototype.init=function(t){this.D.info("zn.nhb.ii call"),this.rn||(this.rn=this.J.createStream(h.OTHER)),1<=t.data.logic_hb_interval&&t.data.logic_hb_interval<=10&&(this.nn=t.data.logic_hb_interval),3<=t.data.logic_hb_timeout&&t.data.logic_hb_timeout<=30&&(this.tn=t.data.logic_hb_timeout),this.sn=0,this.en=this.tn/this.nn,this.startHB()},It.prototype.startHB=function(){var t=this;if(this.rn){if(this.D.debug("zn.nhb.rs call ."),null!==this.X){if(this.mode===H.Periodic)return;clearTimeout(this.X)}var i=this.X=setTimeout((function(){t.X===i&&(t.X=null),t.cn()}),1e3*this.nn)}},It.prototype.cn=function(){var t,i,n,e=this;this.rn&&(this.D.debug("zn.nhb.s call ."+this.sn++),t=(new Date).getTime(),i=function(i,n,s){var r=(new Date).getTime()-t;e.D.debug("zn.nhb.s hb callback "+r),s&&0!==(null==s?void 0:s.code)?e.D.info("zn.nhb.s fail "+JSON.stringify(s)):(null!=i&&i.ntp_time&&(s="number"==typeof(r=i.ntp_time)?r:r.toNumber(),i=(new Date).getTime(),0===e.M.appInfo.env)&&e.M.updateNTP(t,s,i),e.sn=0)},n={ts:Date.now()},this.rn.sendMessage(s.MSG_TYPE_HB_REQUEST,n,i,i,null),this.rn.isFirst=!1)},It.prototype.stop=function(){this.X&&(clearTimeout(this.X),this.X=null),this.sn=0};var rt=It,ot=(wt.prototype.addEventHandler=function(t,i){if(this.un[t]||(this.un[t]=[]),"function"!=typeof i)throw new Error("Params callBack is not a Function");return this.un[t]&&-1==this.un[t].indexOf(i)&&this.un[t].push(i),!0},wt.prototype.removeEventHandler=function(t,i){return!!this.un[t]&&(this.un[t]=i?this.un[t].filter((function(t){return t!==i})):[],!0)},wt.prototype.emit=function(t){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];this.un[t]&&this.un[t].forEach((function(n){try{n.apply(void 0,i)}catch(n){console.error('Fail to execute callback of event "'.concat(t,'" : ').concat(n))}}))},wt),ut=function(){return(ut=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t}).apply(this,arguments)},ht=(Tt.prototype.sendRequest=function(t,i,n,e){var r=this,o=t.payload,u=(null!=(u=this.an)&&u.encode&&(o=nt(t.payload)),{service_no:this.hn,ack:t.ack,payload:o,wss_message_type:null!=(o=null==(u=this.an)?void 0:u.messageType)?o:X.wssMessageType,wss_path:null==(u=this.an)?void 0:u.path,wss_raw_query:null==(o=this.an)?void 0:o.query,zegoconn_version:X.connectVer});this.netPcStream.isConnect()||(this.D.info("zn.napr.sr pc is not connect"),this.eventManager.emit("connectStart")),this.netPcStream.sendMessage(s.MSG_TYPE_PC_UPWARD_MESSAGE,u,(function(){r.D.info("zn.napr.sr suc"),n&&n()}),(function(t){r.D.error("zn.napr.sr fail"),i&&i(t)}),null,{isInSendMap:"boolean"==typeof t.isInSendMap&&t.isInSendMap,extras:e,isMsgCache:null==(o=this.an)?void 0:o.isMsgCache})},Tt.prototype.onPushEvent=function(t,i,n){var e;switch(this.D.info(W+" msgType: ".concat(t)),t){case s.MSG_TYPE_PC_ESTABLISHED:this.netPcStream.isFirst=!1,this.pcEstablished(i,this.netPcStream.StreamID);break;case s.MSG_TYPE_PC_BROKEN:this.pcBroken();break;case s.MSG_TYPE_PC_DOWNWARD_MESSAGE:this.D.info(W+" ".concat(this.hn," down ").concat((null==i?void 0:i.ts)&&i.ts.toNumber&&i.ts.toNumber()||i.ts));var r=i.payload;null!=(e=this.an)&&e.encode&&(r=et(i.payload)),this.eventManager.emit("downLoadMessage",r,n);break;case s.MSG_TYPE_PUSH_EXCEPTION:this.D.info(W+" ".concat(this.hn," exception ").concat(JSON.stringify(i))),this.eventManager.emit("exception",i,n)}},Tt.prototype.on=function(t,i){return this.eventManager.addEventHandler(t,i)},Tt.prototype.off=function(t,i){this.eventManager.removeEventHandler(t,i)},Tt.prototype.pcEstablished=function(t,i){this.D.info("zn.napr.pe call "+JSON.stringify(t)),this.setConnectState(c.CONNECTED);var n=d.MANUAL;this.lastConnectState===c.BROKEN&&this.connectState===c.CONNECTED&&(n=d.AUTO),this.eventManager.emit("connected",n),this.reportEvent("pcConnectedEvent",{proxy_link_sources:null==t?void 0:t.from,connect_stream:i}),this.brokenTimer&&clearTimeout(this.brokenTimer)},Tt.prototype.pcBroken=function(){var t=this;this.D.info("zn.napr.pb call"),this.setConnectState(c.BROKEN),this.eventManager.emit("broken"),this.reportEvent("pcBrokenEvent"),this.brokenTimer=setTimeout((function(){t.eventManager.emit("disconnected",_.TEMP),t.reportEvent("pcDisconnectedEvent")}),1e3*this._n)},Tt.prototype.resetBrokenTimer=function(){this.brokenTimer&&clearTimeout(this.brokenTimer)},Tt.prototype.ln=function(t,i){var n;this.D.info("zn.napr.cr call "+this.hn+" "+this.connectState),this.connectState!==c.DISCONNECT&&(this.netPcStream.closeStream(0,""),this.resetBrokenTimer(),n=this.J.getStreamID(),this.netPcStream.refresh(n),this.eventManager.emit(t,i),n="","broken"===t?n="pcBrokenEvent":"disconnected"===t&&(n="pcDisconnectedEvent"),n)&&this.reportEvent(n),this.setConnectState(c.DISCONNECT)},Tt.prototype.closePc=function(){this.ln("broken")},Tt.prototype.closeRequest=function(){this.ln("disconnected",_.CLOSE)},Tt.prototype.setConnectState=function(t){this.connectState!==t&&(this.lastConnectState=this.connectState,this.connectState=t)},Tt.prototype.reportEvent=function(t,i){this.eventManager.emit(t,ut({service_no:this.hn},i))},Tt),at=(yt.prototype.getRequest=function(t,i){return t=new ht(this.D,t,this.J,this.pcEstablishTimeout,i),this.pcStreamRequests.push(t),t},yt.prototype.updateConnectState=function(t,i,n){this.D.info("zn.naprm.ucs call "+t+" "+i),this.pcStreamRequests.forEach((function(e){t===c.BROKEN?(e.eventManager.emit("broken"),e.reportEvent("pcBrokenEvent")):t===c.DISCONNECT&&(e.eventManager.emit("disconnected",i,n),e.reportEvent("pcDisconnectedEvent"))}))},yt.prototype.closePCs=function(){this.pcStreamRequests.forEach((function(t){t.closePc()}))},yt.prototype.setEstablishTimeout=function(t){this.pcEstablishTimeout=t},yt),ct=(Ot.prototype.initLink=function(t){this.link=t},Ot.prototype.startMaxTime=function(){var t=this;this.D.info("zn.rlh.sm call"),this.maxTimer||(this.D.info("zn.rlh.sm start max timer"),this.maxTimer=setTimeout((function(){t.D.warn("zn.rlh.sm"+" over max time ".concat(t.RETRY_MAX_TIME,"s, stop retry")),t.isOverTime=!0,t.link.destroySocket(a.NONE),t.stopMaxTime(),t.invalid(),t.onactive(!1,B)}),1e3*this.RETRY_MAX_TIME))},Ot.prototype.stopMaxTime=function(){this.D.info("zn.rlh.sm.1 call"),this.maxTimer&&clearTimeout(this.maxTimer),this.maxTimer=null},Ot.prototype.active=function(t,i,n){var s=this;if(void 0===n&&(n=!1),this.D.info("zn.rlh.at call "+t+" "+(i=void 0!==i&&i)),this.M.isDestroyed)return!1;if(this.retryTimer)return this.D.info("zn.rlh.at has actived, ignore"),!1;var r=this.M.networkState==e.offline;if(r){if(this.D.info("zn.rlh.at  check if really offline. "+this.En),this.En>=this.dn)return this.D.warn("zn.rlh.at network is broken, stop retry"),!1}else this.En=0;return this.link.isConnecting()&&!n?(this.D.info("zn.rlh.at link is connecting, ignore"),!1):this.isOverTime?(this.D.info("zn.rlh.at retry over time, stop retry"),!1):(1==this.fn?this.vn=Math.floor(Math.random()*(1-this.RETRY_START_TIME_INTERVAL)+this.RETRY_START_TIME_INTERVAL):(n=Math.pow(2,Math.round(this.fn/this.RETRY_CONTINUE_COUNT+1)),this.vn=n>this.RETRY_MAX_TIME_INTERVAL?this.RETRY_MAX_TIME_INTERVAL:n),this.D.info("zn.rlh.at interval "+this.vn),this.retryTimer=setTimeout((function(){s.link.destroySocket(a.BROKEN),s.link.connectSocket(t,(function(){s.D.info("zn.rlh.at suc"),s.M.networkState=e.online,s.stopMaxTime(),s.invalid(),s.onactive(!0)}),(function(){s.D.info("zn.rlh.at fail"),s.maxTimer||s.startMaxTime(),s.active(!0,!1,!0)})),s.retryTimer&&clearTimeout(s.retryTimer),s.retryTimer=null,r?s.En++:s.fn++}),i?0:1e3*this.vn),!0)},Ot.prototype.onactive=function(){for(var t=0;t<arguments.length;t++);},Ot.prototype.init=function(t,i,n,e){this.invalid(),this.stopMaxTime(),this.isOverTime=!1,"number"==typeof t&&t<3600&&(this.RETRY_MAX_TIME=t),"number"==typeof i&&(this.RETRY_START_TIME_INTERVAL=i),"number"==typeof n&&(this.RETRY_CONTINUE_COUNT=n),"number"==typeof e&&(this.RETRY_MAX_TIME_INTERVAL=e)},Ot.prototype.invalid=function(){this.D.info("zn.rlh.ivd end retry"),this.retryTimer&&clearTimeout(this.retryTimer),this.retryTimer=null,this.fn=1,this.En=0},Ot),lt=(Rt.prototype.updateNTP=function(t,i,n){var e;n<t||(e=n-t,this.timeOffset=Math.round((i-t+(i-n))/2),t=Math.round(i+e/2),(!this.networkRTT||e<this.networkRTT)&&(this.networkRTT=e,this.ntpTimeInfo={performanceTime:Math.round(performance.now()),ntp:t}))},Rt),ft=(St.prototype.log=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=t.join(" ");console.log(n)},St.prototype.debug=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=t.join(" ");console.debug(n)},St.prototype.info=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=t.join(" ");console.info(n)},St.prototype.warn=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=t.join(" ");console.warn(n)},St.prototype.error=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=t.join(" ");console.error(n)},St),_t=function(){return(_t=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t}).apply(this,arguments)},dt=(Et.prototype.sendRequest=function(t,i,n,e,r){var o=this,u=t.disableLog;t={service_no:this.hn,ack:t.ack,headers:t.headers,body:nt(JSON.stringify(t.body)),id_name:t.idName,method_no:t.method_no,stick:t.stick,location:t.location,reduce_resp_header:t.reduceRspHeaders?1:0},this.netHttpStream.sendMessage(s.MSG_TYPE_HTTP_REQUEST,t,(function(t){o.closeStream();var n=("gzip"===(null==(n=(null==t?void 0:t.headers).find((function(t){return"Content-Encoding"===(null==t?void 0:t.name)})))?void 0:n.val)?u||o.D.info("zn.nahr.sr gzip"):t.body&&(n=et(t.body),t.body=n),_t(_t({},t),{body:void 0}));u||o.D.info("zn.nahr.sr suc "+JSON.stringify(n)),i&&i(t)}),(function(t,i,e){o.closeStream(),u||o.D.error("zn.nahr.sr fail"),n&&n(e||t)}),(function(t){u||o.D.error("zn.nahr.sr ack"),e&&e(t)}),r),this.netHttpStream.isFirst=!1},Et.prototype.sendRequest2=function(t,i,n,e,r){var o=this,u=1===t.format?nt(JSON.stringify(t.body)):t.body;u={ack:t.ack,body:u,id_name:t.idName,method:t.method,interface_id:t.interfaceID,token:t.token,reduce_resp_header:t.reduceRspHeaders?1:0},t.headers&&(u.headers=t.headers),t.resID&&(u.res_id=t.resID),t.urlParams&&(u.params=t.urlParams),t.mode&&(u.mode=t.mode),this.netHttpStream.sendMessage(s.MSG_TYPE_HTTP_REQUEST2,u,(function(e,s){o.closeStream();var r=(null==e?void 0:e.headers).find((function(t){return"Content-Encoding"===(null==t?void 0:t.name)}));if(200===e.status_code){if("gzip"===(null==r?void 0:r.val))o.D.info("zn.nahr.sr2 gzip");else if(e.body&&1===t.format)try{u=et(e.body),e.body=u}catch(s){o.D.info("zn.nahr.sr2 decode "+JSON.stringify(s))}r=_t(_t({},e),{body:void 0}),o.D.info("zn.nahr.sr2 suc "+JSON.stringify(r)),i&&i(e,s)}else{try{var u=et(e.body);e.body=u}catch(s){o.D.info("zn.nahr.sr2 status "+e.status_code+" "+JSON.stringify(s))}n&&n(e)}}),(function(t,i,e){o.closeStream(),o.D.error("zn.nahr.sr2 fail"),n&&n(e||t)}),(function(t){o.D.error("zn.nahr.sr2 ack"),e&&e(t)}),r),this.netHttpStream.isFirst=!1},Et.prototype.closeStream=function(){this.D.info("zn.nahr.cs call"),this.netHttpStream.closeStream(0,"")},Et),mt=(Object.defineProperty(bt.prototype,"StreamID",{get:function(){return this.gn},enumerable:!1,configurable:!0}),bt.prototype.refresh=function(t){this.gn=t,this.isFirst=!0},bt.prototype.sendMessage=function(t,i,n,e,s,r){var o=this;void 0===n&&(n=null),void 0===e&&(e=null),this.pn.sendMessage(t,this.gn,i,this.isFirst,(function(t,i,e){o.Sn!==h.PC&&(o.isFree=!0),n&&n(t,e)}),(function(t,i,n){o.Sn!==h.PC&&(o.isFree=!0),e&&e(t,i,n)}),s=void 0===s?null:s,r=void 0===r?{timeout:5e3,isInSendMap:!0}:r)},bt.prototype.onPushEvent=function(t,i,n){},bt.prototype.closeStream=function(t,i){this.pn.sendMessage(s.MSG_TYPE_STREAM_CLOSED,this.gn,{code:t,msg:i},void 0,void 0,void 0,void 0,{isInSendMap:!1})},bt.prototype.isConnect=function(){return this.pn.isConnect()},bt),vt=(gt.prototype.createStream=function(t){var i=new mt(t,this.streamID++,this.pn);return t===h.PC&&this.pcStreams.push(i),i},gt.prototype.onPushEvent=function(t,i,n,e){var s=this.pcStreams.find((function(i){return i.StreamID===t}));s&&s.onPushEvent(i,n,e)},gt.prototype.getStreamID=function(){return this.streamID++},gt),pt=function(){return(pt=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t}).apply(this,arguments)};function gt(t){this.pn=t,this.streamID=1,this.httpStreams=[],this.pcStreams=[]}function bt(t,i,n){this.Sn=t,this.gn=i,this.pn=n,this.isFree=!1,this.isFirst=!0}function Et(t,i,n){this.D=t,this.J=i,this.hn=n,this.netHttpStream=this.J.createStream(h.HTTP)}function St(){}function Rt(){this.networkState=e.online,this.useNetAgent=!0,this.specified=!1,this.clientIP="",this.timeOffset=0,this.networkRTT=0,this.isDestroyed=!1}function Ot(t,i){this.D=t,this.M=i,this.RETRY_START_TIME_INTERVAL=4,this.RETRY_CONTINUE_COUNT=2,this.RETRY_MAX_TIME_INTERVAL=32,this.retryTimer=null,this.maxTimer=null,this.fn=1,this.En=0,this.dn=3,this.isOverTime=!1,this.RETRY_MAX_TIME=90}function yt(t,i){this.J=t,this.D=i,this.pcStreamRequests=[],this.pcEstablishTimeout=X.pcEstablishTimeout}function Tt(t,i,n,e,s){this.D=t,this.hn=i,this.J=n,this._n=e,this.an=s,this.connectState=c.DISCONNECT,this.lastConnectState=c.DISCONNECT,this.brokenTimer=null,this.listenerList={connected:[],broken:[]},this.netPcStream=this.J.createStream(h.PC),this.eventManager=new ot,this.netPcStream.onPushEvent=this.onPushEvent.bind(this)}function wt(){this.un={}}function It(t,i,n){this.J=t,this.D=i,this.M=n,this.X=null,this.nn=5,this.tn=10,this.en=0,this.sn=0,this.mode=H.Lazy}function Nt(t){return Error("Failed to excute ".concat(t," before init."))}Object.defineProperty(kt.prototype,"isDestroy",{get:function(){return!this.stateCenter||this.stateCenter.isDestroyed},enumerable:!1,configurable:!0}),Object.defineProperty(kt.prototype,"clientIP",{get:function(){var t;return null==(t=this.stateCenter)?void 0:t.clientIP},enumerable:!1,configurable:!0}),Object.defineProperty(kt.prototype,"timeOffset",{get:function(){var t;return null==(t=this.stateCenter)?void 0:t.timeOffset},enumerable:!1,configurable:!0}),Object.defineProperty(kt.prototype,"linkConnectState",{get:function(){return this.Cn},set:function(t){this.lastLinkConnectState=this.Cn,this.Cn=t},enumerable:!1,configurable:!0}),kt.prototype.init=function(){var t;this.inited?null!=(t=this.logger)&&t.info("zn.init already init."):(this.logger=new ft,this.stateCenter=new lt,this.protobuf=new z(this.stateCenter),this.eventManager=new ot,this.Nn(),this.inited=!0)},kt.prototype.unInit=function(){var t;this.inited=!1,null!=(t=this.zegoLink)&&t.release()},kt.prototype.setAppInfo=function(t){if(null!=(i=this.logger)&&i.info("zn.sai.0 "+JSON.stringify(t)),!this.inited)throw Nt("setAppInfo");var i=this.stateCenter,n=(i.appInfo=pt({model:X.model},t),i.networkState=!navigator||navigator.onLine?e.online:e.offline,0===t.env?this.zn():1===t.env&&this.Dn(),this.logger),s=this.protobuf;this.zegoLink=new K(t.appID,t.env,s,n,i,this.proxyCtrl),this.zegoLink.initEvent(this.B,this.k,this.L,this.q),this.streamManager=new vt(this.zegoLink),this.businessRequestMgr=new Q(this.streamManager,s,n,i),this.zegoLink.HBHandler=this.netHeartBeatHandler=new rt(this.streamManager,n,i),this.netAgentPCRequestMgr=new at(this.streamManager,n)},kt.prototype.setUserInfo=function(t){if(!this.stateCenter)throw Nt("setUserInfo");this.stateCenter.userId=t},kt.prototype.setNetAgentDefaultServers=function(t){this.connectServers=st([],t,!0)},kt.prototype.setNetAgentSpecifiedServers=function(t){var i;throw null!=(i=this.logger)&&i.info("zn.sss.0 "+JSON.stringify(t)),Error("not support")},kt.prototype.setBackupDomains=function(t){throw Error("not support")},kt.prototype.setDispatchConnectServers=function(t){this.Mn(t)},kt.prototype.startHttpRequest=function(t,i,n,e,s){var r,o=this;if(!this.inited||!this.streamManager)throw Nt("startHttpRequest");if(s&&"number"==typeof(null==s?void 0:s.timeout)&&((null==s?void 0:s.timeout)<1e3||1e4<(null==s?void 0:s.timeout)))throw Error("timeout must between 1 and 10 second");var u=this.reportSeq++;null!=(r=this.eventManager)&&r.emit("requestEvent",u,"start"),this.isConnect()||(null!=(r=this.logger)&&r.info("zn.shq.0 link is not connect"),this.innerReconnect()),new dt(this.logger,this.streamManager,t.service).sendRequest(t,(function(n){var e;null!=(e=o.eventManager)&&e.emit("requestEvent",u,"end",{na_req_location:t.location,status_code:n.status_code,err_code:0}),i&&i(n)}),(function(i){var e;null!=(e=o.eventManager)&&e.emit("requestEvent",u,"end",{na_req_location:t.location,err_code:i.code||0}),n&&n(i)}),e,s)},kt.prototype.startHttpRequest2=function(t,i,n,e,s){var r,o=this;if(!this.inited||!this.streamManager)throw Nt("startHttpRequest2");var u=this.reportSeq++;null!=(r=this.eventManager)&&r.emit("requestEvent",u,"start"),this.isConnect()||(null!=(r=this.logger)&&r.info("zn.shq.0 link is not connect"),this.innerReconnect()),new dt(this.logger,this.streamManager).sendRequest2(t,(function(n,e){var s;null!=(s=o.eventManager)&&s.emit("requestEvent",u,"end",{na_req_interface:t.interfaceID,status_code:n.status_code,err_code:0}),i&&i(n,e)}),(function(i){var e;null!=(e=o.eventManager)&&e.emit("requestEvent",u,"end",{na_req_interface:t.interfaceID,err_code:i.code||0}),n&&n(i)}),e,s)},kt.prototype.getAppConfigByAgent=function(t,i,n,e,s){var r;if(this.stateCenter)return this.isConnect()||(null!=(r=this.logger)&&r.info("zn.gab.0 link is not connect"),this.innerReconnect()),this.Un(t,this.stateCenter.userId,i,n,e,s);throw Nt("getAppConfigByAgent")},kt.prototype.getPCRequest=function(t,i){var n=this;return(i=this.netAgentPCRequestMgr.getRequest(t,i)).on("disconnected",(function(i){var e;null!=(e=n.logger)&&e.warn("zn.zca.gpr "+t+" disconnect "+i),i===_.TEMP&&(n.On(),n.Hn())})),i.on("connectStart",(function(){n.innerReconnect()})),i},kt.prototype.connectUa=function(){var t;this.isDestroy?null!=(t=this.logger)&&t.info("zn.zca.cua destroy"):(null!=(t=this.logger)&&t.info("zn.zca.cua call"),this.retryLinkHandler&&(this.retryLinkHandler.init(),this.Hn(!1,!0)))},kt.prototype.destroyConnect=function(t){var i;null!=(i=this.logger)&&i.info("zn.zca.dc.0 call"),this.yn(t)},kt.prototype.destroy=function(){var t;null!=(t=this.logger)&&t.info("zn.zca.dy.0 call"),this.destroyConnect(2!==this.linkConnectState?Y:void 0),this.Tn&&clearTimeout(this.Tn),this.retryLinkHandler&&this.retryLinkHandler.invalid(),this.retryLinkHandler&&this.retryLinkHandler.stopMaxTime(),this.stateCenter&&(this.stateCenter.isDestroyed=!0)},kt.prototype.isConnect=function(){var t;return!(null==(t=this.zegoLink)||!t.isConnect())},kt.prototype.isDisConnect=function(){var t;return!(null==(t=this.zegoLink)||!t.isDisConnect())},kt.prototype.on=function(t,i){var n;return null!=(n=this.logger)&&n.info("zn.zca.o.0 "+t),!(null==(n=this.eventManager)||!n.addEventHandler(t,i))},kt.prototype.off=function(t,i){var n;null!=(n=this.logger)&&n.info("zn.zca.o.1 "+t),null!=(n=this.eventManager)&&n.removeEventHandler(t,i)},kt.prototype.setLogger=function(t){if(!this.inited)throw Nt("setLogger");this.logger=t},kt.prototype.setAccess=function(t){if(!this.stateCenter)throw Nt("setAccess");this.stateCenter.useNetAgent=t},kt.prototype.getVersion=function(){return"1.1.9"},kt.prototype.zn=function(){var t=this;window.addEventListener("offline",(function(){t.Gn()})),window.addEventListener("online",(function(){t.wn()}))},kt.prototype.Dn=function(){var t=this;wx.onNetworkStatusChange((function(i){i.isConnected?t.wn():t.Gn()}))},kt.prototype.wn=function(){var t;this.stateCenter&&(null!=(t=this.logger)&&t.info("zn.zca.noh.0 network is online"),this.stateCenter.networkState=e.online,this.stateCenter.useNetAgent)&&this.Yn()},kt.prototype.Gn=function(){var t;this.stateCenter&&(null!=(t=this.logger)&&t.info("zn.zca.noh.1 network is broken"),this.stateCenter.networkState=e.offline,this.stateCenter.useNetAgent)&&this.Vn()},kt.prototype.Nn=function(){var t,i=this;if(null!=(n=this.stateCenter)&&n.useNetAgent){if(this.isConnect()&&this.zegoLink){var n=Date.now()-this.zegoLink.updatedMsgTime;if(n>1e3*this.linkMsgMaxInterval)return null!=(t=this.logger)&&t.info("zn.zca.clm interval: "+n),void this.yn()}this.Tn&&clearTimeout(this.Tn),this.Tn=setTimeout((function(){i.Nn()}),1e3*this.linkMsgCheckInterval)}},kt.prototype.Mn=function(t){var i=this,n=this.zegoLink,e=this.logger;if(!this.inited||!n||!this.stateCenter)throw Nt("setDispatchConnectServers");0<t.length&&(this.connectServers=st([],t,!0)),0<this.defaultConnectServers.length&&this.defaultConnectServers.forEach((function(t){i.connectServers.includes(t)||i.connectServers.push(t)})),this.connectServers.length<=0?null!=(t=this.logger)&&t.error("zn.zca.oce #### not server url"):(n.createSocket(this.connectServers),this.retryLinkHandler||(this.retryLinkHandler=new ct(e,this.stateCenter)),this.retryLinkHandler.init(),this.retryLinkHandler.initLink(n),this.retryLinkHandler.onactive=function(t,n){var e;n===B&&(null!=(e=i.eventManager)&&e.emit("disconnected",n),i.Pn(),i.netAgentPCRequestMgr.updateConnectState(c.DISCONNECT,_.TIMEOUT,n))},this.Hn(!1,!0))},kt.prototype.yn=function(t){this.netHeartBeatHandler&&this.netHeartBeatHandler.stop(),this.zegoLink&&this.zegoLink.destroySocket(a.DISCONNECT,t)},kt.prototype.Rn=function(){function t(t,e,s){var r;s?null!=(r=i.logger)&&r.info("zn.zca.gc fail "+JSON.stringify(s)):0===t.code?(null!=(r=i.logger)&&r.info("zn.zca.gc suc "+JSON.stringify(t)),i.Bn(t,n)):null!=(s=i.logger)&&s.info("zn.zca.gc fail "+JSON.stringify(t))}var i=this,n=(new Date).getTime();this.businessRequestMgr.getConfig(t,t)},kt.prototype.Bn=function(t,i){null!=(n=this.netHeartBeatHandler)&&n.init(t),this.netAgentPCRequestMgr.setEstablishTimeout(t.data.pc_establish_timeout),null!=(n=null==t?void 0:t.data)&&n.client_outer_ip&&this.stateCenter&&(this.stateCenter.clientIP=t.data.client_outer_ip),null!=(n=null==t?void 0:t.data)&&n.ntp_time&&(n="number"==typeof(n=t.data.ntp_time)?n:n.toNumber(),e=(new Date).getTime(),0===(null==(s=this.stateCenter)?void 0:s.appInfo.env))&&this.stateCenter.updateNTP(i,n,e);var n,e,s=t.data.geofencing_id;null!=(i=this.eventManager)&&i.emit("clientInfo",{clientIP:this.clientIP,timeOffset:this.timeOffset,geofencingID:s})},kt.prototype.An=function(){var t=this;return new Promise((function(i,n){t.businessRequestMgr.dispatchURL((function(n){n=n.data.wss_groups;var e=(null!=(e=t.logger)&&e.info("zn.nab.du wss_groups: "+JSON.stringify(n)),n.some((function(t){return t.host.includes("geo")}))),s=null!=(s=null==(s=t.stateCenter)?void 0:s.appInfo)&&s.geoFencing||e?n:t.kn(n);e=t.Ln(s),i({servers:e,domains:s})}),(function(t){n(t)}))}))},kt.prototype.bn=function(){var t=this;return new Promise((function(i,n){t.businessRequestMgr.getSvrAddr().then((function(e){var s,r,o,u,h=e.code,a=e.msg;e=e.data,0===h?(r=e.accesshub_domain,o=e.logreport_domain,u=e.detaillog_domain,e=e.geofencing_id,null!=(s=t.logger)&&s.info("".concat(F," domains: ").concat(r," ").concat(o," ").concat(u)),i({accesshub_domain:r,logreport_domain:o,detaillog_domain:u,geofencing_id:e})):n({code:h,msg:a})})).catch((function(t){n(t)}))}))},kt.prototype.Ln=function(t){return Array.isArray(t)&&0<t.length?t.map((function(t){return X.scheme+"://"+t.host+"/"+X.location})):[]},kt.prototype.kn=function(t){return(t=st([],t,!0)).filter((function(t){return!!t.host}))},kt.prototype.Un=function(t,i,n,e,s,r){var o=this;return new Promise((function(u,h){var a;"string"==typeof i&&"string"==typeof n?o.businessRequestMgr.getAppConfig(t,i,n,e,s,r).then((function(t){u(pt(pt({},t),{retryCount:o.getAppConfigFailCount}))})).catch((function(e){var r,a;null!=(r=o.logger)&&r.error("zn.zca.gac "+JSON.stringify(e)),!(-1<v.indexOf(e.code))&&(o.getAppConfigFailCount++,20008===e.code||1100002===e.code)&&o.getAppConfigFailCount<3?o.Un(t,i,n,s).then((function(t){return u(t)})).catch((function(t){return h(t)})):(a=o.getAppConfigFailCount,o.getAppConfigFailCount=0,h(pt(pt({},e),{retryCount:a})))})):null!=(a=o.logger)&&a.error("zn.zca.gac userID or token must be string")}))},kt.prototype.Pn=function(){var t,i=(new Date).getTime()-this.connectedTime;this.connectid&&null!=(t=this.eventManager)&&t.emit("disConnectedEvent",{duration:i,server:null==(t=this.zegoLink)?void 0:t.connectServer,connectid:this.connectid})},kt.prototype.mn=function(t){if(!this.zegoLink||!this.stateCenter)throw Nt("_redirect");null!=(i=this.logger)&&i.info("zn.zca.rd"+" ".concat(JSON.stringify(t.wss_groups)));var i=this.Ln(t.wss_groups);i&&Array.isArray(i)&&0<i.length?(this.On(),this.stateCenter.specified&&(null!=(t=this.logger)&&t.info("zn.zca.rd specified"),i=this.specifiedServers),this.zegoLink.createSocket(i),this.Hn(!1,!0)):null!=(t=this.logger)&&t.warn("zn.zca.rd wss_groups null")},kt.prototype.In=function(t){var i,n,e=this;if(!this.zegoLink)throw Nt("_connectClosed");switch(null!=(i=this.logger)&&i.info("zn.zca.cc"+" ".concat(t.reason," ").concat(t.msg," ").concat(t.action)),t.action){case l.ACTION_DISPATCH:var s=this.reportSeq++;null!=(n=this.eventManager)&&n.emit("dispatchEvent",s,"start"),this.An().then((function(t){var i,n=t.servers;t=t.domains,null!=(i=e.eventManager)&&i.emit("dispatchEvent",s,"end",{domains:t,reason:"ConnectClosed"}),Array.isArray(n)&&0<n.length&&(null!=(i=e.eventManager)&&i.emit("dispatchResultUpdate",{servers:n,domains:t}),t=null!=(i=e.stateCenter)&&i.specified?e.specifiedServers:n,e.On(),null!=(i=e.zegoLink)&&i.createSocket(t),e.Hn(!1,!0))})).catch((function(t){var i;null!=(i=e.logger)&&i.info("zn.zca.cc dispatch fail")}));break;case l.ACTION_RETRY:this.On(),this.Hn(!1);break;case l.ACTION_NEXT_GROUP:this.netAgentPCRequestMgr.closePCs(),null!=(n=this.eventManager)&&n.emit("broken",m.CLOSE),this.Hn()}},kt.prototype.Yn=function(){if(!this.zegoLink)throw Nt("_netOnLineHandler");this.retryLinkHandler&&(this.zegoLink.isConnect()?this.retryLinkHandler.stopMaxTime():this.Hn())},kt.prototype.Vn=function(){if(!this.zegoLink)throw Nt("_netOffLineHandler");this.On(),this.retryLinkHandler&&(this.retryLinkHandler.invalid(),this.retryLinkHandler.startMaxTime(),this.zegoLink.setState(0))},kt.prototype.innerReconnect=function(){var t;null!=(t=this.logger)&&t.info("zn.zca.ir.0"+" call ".concat(!!this.retryLinkHandler)),this.isDestroy?null!=(t=this.logger)&&t.info("zn.zca.ir.0 destroy"):this.retryLinkHandler&&(this.retryLinkHandler.startMaxTime(),this.Hn())},kt.prototype.Hn=function(t,i){var n;null!=(n=this.retryLinkHandler)&&n.active(t,i)&&this.$n()},kt.prototype.$n=function(){var t,i=this.reportSeq++;this.connectSeq=i,null!=(t=this.eventManager)&&t.emit("connectedEvent",i,"start")},kt.prototype.On=function(){var t;null!=(t=this.logger)&&t.info("zn.zca.dc.1 call"),this.netAgentPCRequestMgr.closePCs(),null!=(t=this.eventManager)&&t.emit("broken"),2===this.lastLinkConnectState&&0===this.linkConnectState&&this.Pn()},kt.prototype.getNetworkTimeInfo=function(){var t,i,n,e;if(this.stateCenter)return e=Date.now()+this.stateCenter.timeOffset,t=Math.round(this.stateCenter.networkRTT/2),(i=this.stateCenter.ntpTimeInfo)&&(n=performance.now()-i.performanceTime,e=Math.round(i.ntp+n)),{timestamp:e,maxDeviation:t};throw Nt("getNetworkTimeInfo")},kt.prototype.setHeartBeatMode=function(t){var i,n;this.netHeartBeatHandler&&(n=this.netHeartBeatHandler.mode)!==t&&(null!=(i=this.logger)&&i.info("zn.shbm"+" change mode from ".concat(n," to ").concat(t)),this.netHeartBeatHandler.mode=t)};var Ct=kt;function kt(t){var i=this;this.proxyCtrl=t,this.Tn=null,this.connectServers=[],this.specifiedServers=[],this.getAppConfigFailCount=0,this.getAppConfigTime=0,this.inited=!1,this.linkMsgMaxInterval=90,this.linkMsgCheckInterval=5,this.connectedTime=0,this.connectid="",this.reportSeq=0,this.connectSeq=0,this.defaultConnectServers=[],this.Cn=0,this.lastLinkConnectState=0,this.B=function(t,n){var e,s;i.stateCenter&&(i.linkConnectState=2,i.Rn(),0===i.stateCenter.appInfo.env&&(s=i.reportSeq++,null!=(e=i.eventManager)&&e.emit("dispatchEvent",s,"start"),i.An().then((function(t){var n,e=t.servers;t=t.domains.map((function(t){return t.host})),null!=(n=i.eventManager)&&n.emit("dispatchEvent",s,"end",{domains:t}),0<e.length&&null!=(n=i.eventManager)&&n.emit("dispatchResultUpdate",{servers:e,domains:t})})).catch((function(t){})),i.bn().then((function(t){var n,e=t.accesshub_domain,s=t.logreport_domain,r=t.detaillog_domain;t=t.geofencing_id,null!=(n=i.eventManager)&&n.emit("svrAddrResultUpdate",{accesshub_domain:e,logreport_domain:s,detaillog_domain:r,geofencing_id:t})})).catch((function(t){}))),null!=(e=i.eventManager)&&e.emit("connected"),i.connectedTime=(new Date).getTime(),i.connectid=function(t){var i,n="0123456789".split(""),e=[];for(t=n.length,i=0;i<16;i++)e[i]=n[0|Math.random()*t];return e.join("")}(),null!=(e=i.eventManager))&&e.emit("connectedEvent",i.connectSeq,"end",{servers:t,count:t.length,connectid:i.connectid,connectEvents:n})},this.L=function(){var t;null!=(t=i.logger)&&t.info("zn.zca.oce call"),i.linkConnectState=1},this.k=function(t){var n;null!=(n=i.logger)&&n.info("zn.zca.ode"+" ".concat(t)),i.linkConnectState=0,t?(i.On(),i.netAgentPCRequestMgr.updateConnectState(c.BROKEN)):(null!=(n=i.eventManager)&&n.emit("disconnected"),i.netAgentPCRequestMgr.updateConnectState(c.DISCONNECT),i.Pn())},this.q=function(t,n,e,r){var o;switch(n){case s.MSG_TYPE_REDIRECT:case s.MSG_TYPE_REDIRECT2:i.mn(e);break;case s.MSG_TYPE_CLOSE_CONNECTION:i.In(e);break;case s.MSG_TYPE_PC_BROKEN:case s.MSG_TYPE_PC_ESTABLISHED:case s.MSG_TYPE_PC_DOWNWARD_MESSAGE:case s.MSG_TYPE_PUSH_EXCEPTION:null!=(o=i.streamManager)&&o.onPushEvent(t,n,e,r);break;case s.MSG_TYPE_PUSH_APPCONFIG:i.businessRequestMgr.decodeConfigMessage(e.data)}}}}],u={},e.m=o,e.c=u,e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:n})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"u",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.u)return t;var n=Object.create(null);if(e.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var s in t)e.d(n,s,function(i){return t[i]}.bind(null,s));return n},e.n=function(t){var i=t&&t.u?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p="",e(e.s=2))},function(t,i,n){var e;t.exports=(e=n(4),function(){var t,i;"function"==typeof ArrayBuffer&&(i=(t=e.lib.WordArray).init,(t.init=function(t){if((t=(t=t instanceof ArrayBuffer?new Uint8Array(t):t)instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array||t instanceof Float64Array?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t)instanceof Uint8Array){for(var n=t.byteLength,e=[],s=0;s<n;s++)e[s>>>2]|=t[s]<<24-s%4*8;i.call(this,e,n)}else i.apply(this,arguments)}).prototype=t)}(),e.lib.WordArray)},function(t,i,n){t.exports=function(t){for(var i=Math,n=t,e=n.lib,s=e.WordArray,r=e.Hasher,o=n.algo,u=[],h=0;h<64;h++)u[h]=4294967296*i.abs(i.sin(h+1))|0;var a=o.MD5=r.extend({_doReset:function(){this._hash=new s.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(t,i){for(var n=0;n<16;n++){var e=i+n,s=t[e];t[e]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8)}var r=this._hash.words,o=t[i+0],h=t[i+1],a=t[i+2],d=t[i+3],m=t[i+4],v=t[i+5],p=t[i+6],g=t[i+7],b=t[i+8],E=t[i+9],S=t[i+10],R=t[i+11],O=t[i+12],y=t[i+13],T=t[i+14],w=t[i+15],I=r[0],N=r[1],C=r[2],k=r[3];I=c(I,N,C,k,o,7,u[0]),k=c(k,I,N,C,h,12,u[1]),C=c(C,k,I,N,a,17,u[2]),N=c(N,C,k,I,d,22,u[3]),I=c(I,N,C,k,m,7,u[4]),k=c(k,I,N,C,v,12,u[5]),C=c(C,k,I,N,p,17,u[6]),N=c(N,C,k,I,g,22,u[7]),I=c(I,N,C,k,b,7,u[8]),k=c(k,I,N,C,E,12,u[9]),C=c(C,k,I,N,S,17,u[10]),N=c(N,C,k,I,R,22,u[11]),I=c(I,N,C,k,O,7,u[12]),k=c(k,I,N,C,y,12,u[13]),C=c(C,k,I,N,T,17,u[14]),I=l(I,N=c(N,C,k,I,w,22,u[15]),C,k,h,5,u[16]),k=l(k,I,N,C,p,9,u[17]),C=l(C,k,I,N,R,14,u[18]),N=l(N,C,k,I,o,20,u[19]),I=l(I,N,C,k,v,5,u[20]),k=l(k,I,N,C,S,9,u[21]),C=l(C,k,I,N,w,14,u[22]),N=l(N,C,k,I,m,20,u[23]),I=l(I,N,C,k,E,5,u[24]),k=l(k,I,N,C,T,9,u[25]),C=l(C,k,I,N,d,14,u[26]),N=l(N,C,k,I,b,20,u[27]),I=l(I,N,C,k,y,5,u[28]),k=l(k,I,N,C,a,9,u[29]),C=l(C,k,I,N,g,14,u[30]),I=f(I,N=l(N,C,k,I,O,20,u[31]),C,k,v,4,u[32]),k=f(k,I,N,C,b,11,u[33]),C=f(C,k,I,N,R,16,u[34]),N=f(N,C,k,I,T,23,u[35]),I=f(I,N,C,k,h,4,u[36]),k=f(k,I,N,C,m,11,u[37]),C=f(C,k,I,N,g,16,u[38]),N=f(N,C,k,I,S,23,u[39]),I=f(I,N,C,k,y,4,u[40]),k=f(k,I,N,C,o,11,u[41]),C=f(C,k,I,N,d,16,u[42]),N=f(N,C,k,I,p,23,u[43]),I=f(I,N,C,k,E,4,u[44]),k=f(k,I,N,C,O,11,u[45]),C=f(C,k,I,N,w,16,u[46]),I=_(I,N=f(N,C,k,I,a,23,u[47]),C,k,o,6,u[48]),k=_(k,I,N,C,g,10,u[49]),C=_(C,k,I,N,T,15,u[50]),N=_(N,C,k,I,v,21,u[51]),I=_(I,N,C,k,O,6,u[52]),k=_(k,I,N,C,d,10,u[53]),C=_(C,k,I,N,S,15,u[54]),N=_(N,C,k,I,h,21,u[55]),I=_(I,N,C,k,b,6,u[56]),k=_(k,I,N,C,w,10,u[57]),C=_(C,k,I,N,p,15,u[58]),N=_(N,C,k,I,y,21,u[59]),I=_(I,N,C,k,m,6,u[60]),k=_(k,I,N,C,R,10,u[61]),C=_(C,k,I,N,a,15,u[62]),N=_(N,C,k,I,E,21,u[63]),r[0]=r[0]+I|0,r[1]=r[1]+N|0,r[2]=r[2]+C|0,r[3]=r[3]+k|0},_doFinalize:function(){var t=this._data,n=t.words,e=8*this._nDataBytes,s=8*t.sigBytes;n[s>>>5]|=128<<24-s%32;var r=i.floor(e/4294967296),o=e;n[15+(s+64>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),n[14+(s+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),t.sigBytes=4*(n.length+1),this._process();for(var u=this._hash,h=u.words,a=0;a<4;a++){var c=h[a];h[a]=16711935&(c<<8|c>>>24)|4278255360&(c<<24|c>>>8)}return u},clone:function(){var t=r.clone.call(this);return t._hash=this._hash.clone(),t}});function c(t,i,n,e,s,r,o){var u=t+(i&n|~i&e)+s+o;return(u<<r|u>>>32-r)+i}function l(t,i,n,e,s,r,o){var u=t+(i&e|n&~e)+s+o;return(u<<r|u>>>32-r)+i}function f(t,i,n,e,s,r,o){var u=t+(i^n^e)+s+o;return(u<<r|u>>>32-r)+i}function _(t,i,n,e,s,r,o){var u=t+(n^(i|~e))+s+o;return(u<<r|u>>>32-r)+i}return n.MD5=r._createHelper(a),n.HmacMD5=r._createHmacHelper(a),t.MD5}(n(4))},function(t,i){var n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,i){},function(t,i,n){"use strict";n.r(i),n.d(i,"ZegoExpressWebRTMEngine",(function(){return Xn})),n.d(i,"getReportSeq",(function(){return d})),n.d(i,"getSeq",(function(){return _})),n.d(i,"ZegoLogger",(function(){return s.ZegoLogger})),n.d(i,"ZegoDataReport",(function(){return s.ZegoDataReport})),n.d(i,"ZegoExpressWebRTM",(function(){return Vn})),n.d(i,"BusinessService",(function(){return O})),n.d(i,"NetConnection",(function(){return I})),n.d(i,"ZReporter",(function(){return Fn})),n.d(i,"getUserAgent",(function(){return Sn})),n.d(i,"isIos",(function(){return Rn})),n.d(i,"isMacOs",(function(){return On})),n.d(i,"isAndroid",(function(){return yn})),n.d(i,"isHarmony",(function(){return Tn})),n.d(i,"isWindows",(function(){return wn})),n.d(i,"isWin32",(function(){return In})),n.d(i,"isLinux",(function(){return Nn})),n.d(i,"getOsType",(function(){return Cn})),n.d(i,"getNetTypeNum",(function(){return kn}));var e,s=n(2);(i=e=e||{})[i.SWITCH_ONE=1]="SWITCH_ONE",i[i.SWITCH_TWO=2]="SWITCH_TWO";var r,o,u,h,a,c,l,f,_=((i=r=r||{})[i.TT_NONE=0]="TT_NONE",i[i.TT_PC=1]="TT_PC",i[i.TT_IOS=2]="TT_IOS",i[i.TT_ANDROID=3]="TT_ANDROID",i[i.TT_MAC=4]="TT_MAC",i[i.TT_LINUX=5]="TT_LINUX",i[i.TT_WEB=6]="TT_WEB",i[i.TT_MINIPROGRAM=7]="TT_MINIPROGRAM",i[i.TT_UNKNOWN=32]="TT_UNKNOWN",(i=o=o||{})[i.logout=0]="logout",i[i.trylogin=1]="trylogin",i[i.login=2]="login",(i=u=u||{})[i.I=0]="I",i[i.H=10]="H",i[i.M=100]="M",i[i.L=1e3]="L",(i=h=h||{})[i.offline=0]="offline",i[i.online=1]="online",(i=a=a||{})[i.NT_NONE=0]="NT_NONE",i[i.NT_LINE=1]="NT_LINE",i[i.NT_WIFI=2]="NT_WIFI",i[i.NT_2G=3]="NT_2G",i[i.NT_3G=4]="NT_3G",i[i.NT_4G=5]="NT_4G",i[i.NT_UNKNOWN=32]="NT_UNKNOWN",(i=c=c||{}).WIN32="WIN32",i.MAC="Mac",i.ANDROID="Android",i.LINUX="Linux",i.IOS="iOS",i.Harmony="Harmony",i.UNKNOWN="WTF",function(){return l++}),d=(f=l=1,function(){return f++}),m=(Object.defineProperty(v.prototype,"id",{get:function(){return this._id||null},set:function(t){this._id=t},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t},enumerable:!1,configurable:!0}),v.prototype.hasNext=function(){return this.next&&this.next.id},v.prototype.hasPrev=function(){return this.prev&&this.prev.id},v);function v(t,i){void 0===t&&(t=null),void 0===i&&(i=null),this.next=null,this.prev=null,this._id=t,this._data=i}g.prototype.insertBefore=function(t,i){return(i=new m(this._idCounter,i)).next=t,i.prev=t.prev,t.prev&&(t.prev.next=i),t.prev=i,++this._idCounter,++this._numNodes,i},g.prototype.addLast=function(t){return this.insertBefore(this.end,t)},g.prototype.add=function(t){return this.addLast(t)},g.prototype.getFirst=function(){return 0===this._numNodes?null:this.start.next},g.prototype.getLast=function(){return 0===this._numNodes?null:this.end.prev},g.prototype.size=function(){return this._numNodes},g.prototype.getFromFirst=function(t){var i=0,n=this.start.next;if(0<=t)for(;i<t&&null!==n;)n=n.next,++i;else n=null;if(null===n)throw"Index out of bounds.";return n},g.prototype.get=function(t){return 0===t?this.getFirst():t===this._numNodes-1?this.getLast():this.getFromFirst(t)},g.prototype.remove=function(t){return t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),--this._numNodes,t},g.prototype.removeFirst=function(){var t=null;return 0<this._numNodes&&this.start.next?this.remove(this.start.next):t},g.prototype.removeLast=function(){var t=null;return 0<this._numNodes&&this.end.prev?this.remove(this.end.prev):t},g.prototype.removeAll=function(){this.start.next=this.end,this.end.prev=this.start,this._numNodes=0,this._idCounter=0},g.prototype.each=function(t){for(var i=this.start;i.hasNext();)t(i=i.next)},g.prototype.find=function(t){for(var i=this.start,n=!1,e=null;i.hasNext()&&!n;)t(i=i.next)&&(e=i,n=!0);return e},g.prototype.map=function(t){for(var i=this.start,n=[];i.hasNext();)t(i=i.next)&&n.push(i);return n},g.prototype.push=function(t){return this.addLast(t)},g.prototype.unshift=function(t){this.insertBefore(0<this._numNodes?this.start.next:this.end,t)},g.prototype.pop=function(){return this.removeLast()},g.prototype.shift=function(){return this.removeFirst()};var p=g;function g(){this.start=new m,this.end=new m,this._idCounter=0,this._numNodes=0,this.start.next=this.end,this.start.prev=null,this.end.prev=this.start,this.end.next=null}var b,E,S,R,O,y,T="未引入消息模块",w=n(5).ZegoConnectionAgent,I=(Object.defineProperty(N.prototype,"clientIP",{get:function(){var t;return(null==(t=this.connection)?void 0:t.clientIP)||""},enumerable:!1,configurable:!0}),Object.defineProperty(N.prototype,"timeOffset",{get:function(){var t;return null==(t=this.connection)?void 0:t.timeOffset},enumerable:!1,configurable:!0}),N.prototype.init=function(){var t;null!=(t=this.connection)&&t.init()},N.prototype.unInit=function(){var t;null!=(t=this.connection)&&t.unInit()},N.prototype.setAppInfo=function(t){var i;null!=(i=this.connection)&&i.setAppInfo(t)},N.prototype.setUserInfo=function(t){var i;null!=(i=this.connection)&&i.setUserInfo(t)},N.prototype.setNetAgentDefaultServers=function(t){var i;null!=(i=this.connection)&&i.setNetAgentDefaultServers(t)},N.prototype.setBackupDomains=function(t){var i;null!=(i=this.connection)&&i.setBackupDomains(t)},N.prototype.setDispatchConnectServers=function(t){var i;null!=(i=this.connection)&&i.setDispatchConnectServers(t)},N.prototype.setNetAgentSpecifiedServers=function(t){var i;null!=(i=this.connection)&&i.setNetAgentSpecifiedServers(t)},N.prototype.startHttpRequest=function(t,i,n,e,s){var r;null!=(r=this.connection)&&r.startHttpRequest(t,i,n,e,s)},N.prototype.startHttpRequest2=function(t,i,n,e,s){var r;null!=(r=this.connection)&&r.startHttpRequest2(t,i,n,e,s)},N.prototype.getAppConfigByAgent=function(t,i,n,e,s){var r;return null==(r=this.connection)?void 0:r.getAppConfigByAgent(t,i,n,e,s)},N.prototype.getPCRequest=function(t,i){var n;return(null==(n=this.connection)?void 0:n.getPCRequest(t,i))||null},N.prototype.connectUa=function(){var t;null!=(t=this.connection)&&t.connectUa()},N.prototype.destroyConnect=function(){var t;null!=(t=this.connection)&&t.destroyConnect()},N.prototype.destroy=function(){var t;null!=(t=this.connection)&&t.destroy()},N.prototype.isConnect=function(){return!!this.connection&&this.connection.isConnect()},N.prototype.on=function(t,i){var n;return(null==(n=this.connection)?void 0:n.on(t,i))||!0},N.prototype.off=function(t,i){var n;return null==(n=this.connection)?void 0:n.off(t,i)},N.prototype.setLogger=function(t){var i;return null==(i=this.connection)?void 0:i.setLogger(t)},N.prototype.setAccess=function(t){var i;return null==(i=this.connection)?void 0:i.setAccess(t)},N.prototype.getNTP=function(){return{timestamp:0,maxDeviation:0}},N.prototype.setHeartBeatMode=function(t){this.connection.setHeartBeatMode(t)},N);function N(){this.isLoad=!1,this.callBackList=[],this.connection=new w}(i=b=b||{})[i.AUTO=0]="AUTO",i[i.MANUAL=1]="MANUAL",(i=E=E||{})[i.EMPTY=0]="EMPTY",i[i.CLOSE=1]="CLOSE",(i=S=S||{})[i.Mode_UNSET=0]="Mode_UNSET",i[i.MODE_ONLINE=1]="MODE_ONLINE",i[i.MODE_TEST=2]="MODE_TEST",i[i.MODE_ALPHA=3]="MODE_ALPHA",(i=R=R||{})[i.CLOSE=0]="CLOSE",i[i.TEMP=1]="TEMP",i[i.TIMEOUT=2]="TIMEOUT",(i=O=O||{})[i.SERVICE_UNSET=0]="SERVICE_UNSET",i[i.SERVICE_MEDIAGW=1]="SERVICE_MEDIAGW",i[i.SERVICE_LIVEROOM=2]="SERVICE_LIVEROOM",i[i.SERVICE_MIX=3]="SERVICE_MIX",i[i.SERVICE_ZEUS=4]="SERVICE_ZEUS",i[i.SERVICE_ZPUSH=5]="SERVICE_ZPUSH",i[i.SERVICE_L3=6]="SERVICE_L3",i[i.SERVICE_TALKLINE=7]="SERVICE_TALKLINE",i[i.SERVICE_EDUSUITE=8]="SERVICE_EDUSUITE",i[i.SERVICE_ZIM=9]="SERVICE_ZIM",i[i.SERVICE_ClOUD_SETTING=10]="SERVICE_ClOUD_SETTING",i[i.SERVICE_ZEUSHB=11]="SERVICE_ZEUSHB",i[i.SERVICE_USER_LOGIC=12]="SERVICE_USER_LOGIC",i[i.SERVICE_UNIFYDISPATCH=13]="SERVICE_UNIFYDISPATCH",i[i.SERVICE_QUALITY=14]="SERVICE_QUALITY",i[i.SERVICE_SECURITY=15]="SERVICE_SECURITY",i[i.SERVICE_KTVCPR=16]="SERVICE_KTVCPR",i[i.SERVICE_SWITCH4LIVEROOM=17]="SERVICE_SWITCH4LIVEROOM",i[i.SERVICE_WEBRTC_SIGNAL=18]="SERVICE_WEBRTC_SIGNAL",i[i.SERVICE_L3_WEBRTC_SIGNAL=19]="SERVICE_L3_WEBRTC_SIGNAL",i[i.SERVICE_VIDEOCPR=20]="SERVICE_VIDEOCPR",i[i.SERVICE_CDN=21]="SERVICE_CDN",i[i.SERVICE_CLOUDRECORD=22]="SERVICE_CLOUDRECORD",i[i.SERVICE_INNER_ECHO=23]="SERVICE_INNER_ECHO",i[i.SERVICE_OUTER_ECHO=24]="SERVICE_OUTER_ECHO",i[i.SERVICE_LOCALHOST_ECHO=25]="SERVICE_LOCALHOST_ECHO",i[i.SERVICE_ECHO=26]="SERVICE_ECHO",i[i.SERVICE_DOCSERVICE=27]="SERVICE_DOCSERVICE",i[i.SERVICE_AUTHSVR=28]="SERVICE_AUTHSVR",(i=y=y||{}).Logining="LOGINING",i.Logined="LOGINED",i.LoginFailed="LOGIN_FAILED",i.Reconnecting="RECONNECTING",i.Reconnected="RECONNECTED",i.ReconnectFailed="RECONNECT_FAILED",i.Kickout="KICKOUT",i.Logout="LOGOUT",i.LogoutFailed="LOGOUT_FAILED";var C={SERVER:{code:0,msg:"liverooom cmd error"},SUCCESS:{code:0,msg:"success."},INIT:{code:2000000001,msg:"init sdk wrong"},NOT_LOGIN:{code:1000002,msg:"not login"},APPID_INVALID:{code:1001004,msg:"appid invalid"},SDK_NOT_SPECIAL:{code:1001005,msg:"sdk require special"},NETWORK_BROKEN:{code:1000017,msg:"network is broken"},GEO_SET_ERROR:{code:1000018,msg:"geo set error"},INPUT_PARAM:{code:1100001,msg:"input parm error."},TIMEOUT:{code:1100002,msg:"network timeout."},SOCKET_CLOSE:{code:1100003,msg:"socket close"},NET_SOCKET_TIMEOUT:{code:1100004,msg:"net agent timeout"},NET_HB_TIMEOUT:{code:1100005,msg:"net hb timeout"},INIT_SDK_WRONG:{code:1101e3,msg:"init sdk wrong"},ROOM_COUNT_EXCEED:{code:1002001,msg:"login rooms exceeds the upper limit"},USER_ID_NULL:{code:1002005,msg:"user ID is empty"},USER_ID_INVALID_CHARACTER:{code:1002006,msg:"user ID contains illegal characters"},USER_ID_TOO_LONG:{code:1002007,msg:"user ID is too long"},USER_NAME_NULL:{code:1002008,msg:"username is empty"},USER_NAME_TOO_LONG:{code:1002010,msg:"username is too long"},ROOM_ID_NULL:{code:1002011,msg:"room ID is empty"},ROOM_ID_INVALID_CHARACTER:{code:1002012,msg:"room ID contains illegal characters"},ROOM_ID_TOO_LONG:{code:1002013,msg:"room ID is too long"},ROOM_NOT_EXIST:{code:1002014,msg:"room not exist"},ROOM_EXTRA_INFO_KEY_LIMIT:{code:1002017,msg:"room extra info key exceed the limit"},DIFFERENT_USER_ID:{code:1002018,msg:"In multi-room mode, only the same user id can be used."},LOGIN_TIMEOUT:{code:1002031,msg:"login timeout"},ROOM_MAX_USER_COUNT:{code:1002034,msg:"users logging into the room exceeds the maximum number"},MULTI_ROOM_UNABLE:{code:1002036,msg:"multi room unable"},MULTIPLE_LOGIN_KICKOUT:{code:1002050,msg:"kickout may be the same user ID login other"},NETWORK_RECOVERY:{code:1002051,msg:"network recovery"},ROOM_RETRY_TIMEOUT:{code:1002053,msg:"network is broken and login fail."},MANUAL_KICKOUT:{code:1002055,msg:"server has sent a signal to kick out"},REPEATEDLY_LOGIN:{code:1002056,msg:"user repeatedly login"},REPEATEDLY_ENTER_ROOM:{code:1002057,msg:"user repeatedly enter room"},ALREADY_LOGIN:{code:1002058,msg:"user already logged in"},FORBID_BLACK_USER:{code:1002066,msg:"forbid black user"},WHITE_BOARD_VERSION_ERROR:{code:1002098,msg:"Mismatch with RTC SDK version, please upgrade ZegoSuperBoard or ZegoWhiteboardView SDK to the latest version"},ROOM_INNER_ERROR:{code:1002099,msg:"room inner error"},HEARTBEAT_TIMEOUT:{code:1102001,msg:"heartbeat timeout."},PARSE_JSON_ERROR:{code:1102011,msg:"parse json error."},LOGIN_PROCESSING:{code:1102012,msg:"login is processing."},LIVEROMM_REQUEST_ERROR:{code:1102013,msg:"liveroom request error."},ZPUSH_REQUEST_FAIL:{code:1102014,msg:"zpush request fail."},LOGIN_STATE_WRONG:{code:1102015,msg:"user login state is wrong."},TOKEN_ERROR:{code:1102016,msg:"token error"},DIAPATCH_ERROR:{code:1102017,msg:"dispatch error"},TOKEN_EXPIRED:{code:1102018,msg:"token expired"},SUBCMD_ERROR:{code:1102019,msg:"subcmd error."},ZEGO_AUTH_ERROR:{code:1102020,msg:"zego auth error."},BIZ_CHANNEL_ERROR:{code:1102021,msg:"biz channel error."},UPLOAD_LOG_ERROR:{code:1102025,msg:"upload zip logs failed"}},k=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1];function z(t,i){try{wx.setStorageSync(t,i)}catch(t){}}function A(t){try{return wx.getStorageSync(t)}catch(t){}}var D=n(0),M=function(){return(M=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t}).apply(this,arguments)},P="TOKEN_ERROR",x="MULTIPLE_LOGIN_KICKOUT",U="TOKEN_EXPIRED",L="ROOM_INNER_ERROR";function q(t,i){return 0==i?Object(D.d)(t)&&t%1==0&&0<=t:Object(D.d)(t)&&t%1==0&&0<t}function j(t,i,n){i.success&&(n[t+"SuccessCallback"]=i.success),i.error&&(n[t+"ErrorCallback"]=i.error)}function G(t,i){return i[t+"ErrorCallback"]}function H(t,i){return i[t+"SuccessCallback"]}function $(t,i,n,e){j(t,{success:function(t,e){for(var s=[],r=2;r<arguments.length;r++)s[r-2]=arguments[r];var o=i,u=n,h=e,a=s;switch(t){case"eventStart":o.eventStart(u,h);break;case"eventEndWithMsgInfo":o.eventEndWithMsgInfo(u,h,a[0]);break;case"addEventMsg":o.addEventMsg(u,h,a[0],a[1]);break;case"addEvent":o.addEvent(u,h);break;case"eventEnd":o.eventEnd(u,h);break;case"addMsgInfo":o.addMsgInfo(u,a[0])}}},e)}function V(t,i){var n={code:-1,message:"server error"};return n.code=1e9<t?t-1e9+52e6:t+2002e6,i&&(n.message=i),n}function B(t,i,n,e){return{interResolve:function(e){t.uploadReport(i),n(e)},interReject:function(n,s){var r;void 0===s&&(s=""),(r=n.code<2e9&&1e9<n.code?V(n.code,n.msg):{code:n.code,message:n.msg})&&t.addMsgInfo(i,{error:r.code,message:r.message+s}),t.uploadReport(i),e({errorCode:n.code||n.errorCode})}}}function J(t){var i,n,e={1:"parse json error.",1001:"login is processing.",1002:"liveroom request error.",1003:"zpush connect fail.",1004:"zpush handshake fail.",1005:"zpush login fail.",1006:"user login state is wrong.",1007:"got no zpush addr",1008:"token error",1009:"dispatch error",1010:"token expired",1011:"token format error",2002:"biz channel error",1e9:"liveroom cmd error, code:",1000002001:"need relogin",1000002002:"third token auth error",1000002003:"token nonce type should be int64",1000002004:"token appid type  should be uint32",1000002005:"token timeout type should be int64",1000002006:"token user_id type should be string",1000002007:"token room_id type should be string",1000002008:"token format error",1000002009:"token privilege type should be map",1000002010:"token expire_time type should be int64",1000002011:"token user_id type should be string",1000002012:"token not exist",1000002013:"token update error",1000002014:"token not need to check"};return 0===t?C.SUCCESS:((i=M({},C.ROOM_INNER_ERROR)).code=t,i.msg=1e9<t?(n=e[t])?"liveroom cmd error, code: "+t+", message: "+n:e[1e9]+t:e[t]?e[t]+" code:"+t:"unknown error code:"+t,i)}function Y(t,i){delete i[t+"SuccessCallback"],delete i[t+"ErrorCallback"]}function F(t){var i={1016:"MULTI_ROOM_UNABLE",1105:"ROOM_MAX_USER_COUNT",1012:"PUBLISHER_ERROR_REPETITIVE_PUBLISH_STREAM",2002:P,2003:"ROOM_ERROR_LOGIN_TIMEOUT",2010:P,5022:"ROOM_COUNT_EXCEED",5030:"FORBID_BLACK_USER"};return 2e5<t&&t<3e5?i[t-2e5]:t<2e5?{50013:x,50116:P,50117:U,50118:P,50119:P,50120:P,50121:P,50122:P,50123:U,50124:P,50125:P,50126:P,50127:P,50128:P}[t]||i[t]||L:i[t]||L}function W(t){return parseInt(Math.random()*(t+1)+"",10)}function X(t){return!(!t.startsWith("wss")||-1===t.indexOf("test")||!t.endsWith("ws"))}function Z(t){try{var i,n=Uint8Array.from(function(t){for(var i,n,e,s,r=t.length,o=0,u="";o<r;){for(;i=k[255&t.charCodeAt(o++)],o<r&&-1==i;);if(-1==i)break;for(;n=k[255&t.charCodeAt(o++)],o<r&&-1==n;);if(-1==n)break;u+=String.fromCharCode(i<<2|(48&n)>>4);do{if(61==(e=255&t.charCodeAt(o++)))return u}while(e=k[e],o<r&&-1==e);if(-1==e)break;u+=String.fromCharCode((15&n)<<4|(60&e)>>2);do{if(61==(s=255&t.charCodeAt(o++)))return u}while(s=k[s],o<r&&-1==s);if(-1==s)break;u+=String.fromCharCode((3&e)<<6|s)}return u}(t),(function(t){return t.charCodeAt(0)})),e=new DataView(n.buffer);return 0<(i=Object(D.c)(e.getBigInt64)?e.getBigUint64(0):(u=(o=e).getUint32(s=0,r=!1),o=o.getUint32(s+4,r),s=Math.pow(2,32)*u+o,Number.isSafeInteger(s)||console.warn(s,"exceeds MAX_SAFE_INTEGER. Precision may be lost"),s))?Number(i):Number(e.getBigUint64(0,!0))}catch(t){console.error("token error")}var s,r,o,u;return-1}function K(){var t=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(i){var n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==i?n:3&n|8).toString(36)}))}var Q=["accesshub-wss.zego.im","accesshub-wss.coolzcloud.com","accesshub-wss.zegocloud.com"];function tt(t,i){this.ot=t,this.ut=i,this.RETRY_MAX_TIME=300,this.RETRY_START_TIME_INTERVAL=4,this.RETRY_CONTINUE_COUNT=2,this.RETRY_MAX_TIME_INTERVAL=32,this.retryTimer=null,this.maxTimer=null,this.retryActiveCount=1,this.isOverTime=!1}function it(t){return t}function nt(t){return t}function et(t){return t}function st(t){return t}tt.prototype.init=function(t,i,n,e){this.invalid(),this.stopMaxTime(),this.isOverTime=!1,Object(D.d)(t)&&t<3600&&(this.RETRY_MAX_TIME=t),Object(D.d)(i)&&(this.RETRY_START_TIME_INTERVAL=i),Object(D.d)(n)&&(this.RETRY_CONTINUE_COUNT=n),Object(D.d)(e)&&(this.RETRY_MAX_TIME_INTERVAL=e)},tt.prototype.invalid=function(){};var rt="zm.0",ot="zm.slf",ut="zm.lg",ht="zm.lo",at="zm.fac",ct="zm.hlu",lt="zm.cna",ft="zm.on",_t="zm.rntk",dt="zm.rm.lg",mt="zm.rm.tl",vt="zm.rm.lgr",pt="zm.rm.lo",gt="zm.rm.rr",bt="zm.rm.kco",Et="zm.hhl",St="zm.hb.st",Rt="zm.hb.rsp",Ot="zm.rrh.hlf",yt="zm.us.ftu",Tt="zm.us.urp",wt="zm.us.uph",It="zm.us.mg",Nt="ON_LISTENER",Ct="zm.st.ofls",kt="zm.lrh.sm",zt="zm.lrh.hp",At="zm.lrh.hsp",Dt="zm.lrh.gs",Mt="zm.lrh.lgi",Pt="zm.lrh.ful",xt="zm.lrh.lgo",Ut="zm.lrh.sru",Lt="zm.lrh.hd",qt="zm.lrh.hb",jt="zm.nt.od",Gt={event:"/sdk/init",error:{kInvalidParamError:C.INPUT_PARAM},system_info:nt,servers:function(t){return t},is_from_cache:st,project:nt,liveroom_version:nt,biz_type:et,lua_md5:nt,sev_env:nt,use_na:et},Ht="listener",$t="/sdk/set_debug",Vt=nt,Bt={event:"/sdk/set_log_config",error:{kInvalidParamError:C.INPUT_PARAM},log_level:function(t){return t},remote_log_level:nt,log_url:nt},Jt={event:"/sdk/on_listener",listener:nt,error:{INPUT_PARAM:C.INPUT_PARAM}},Yt=nt,Ft={event:"/sdk/login",room_id:nt,room_sid_string:nt,user_state_update:et,max_member_cnt:et,message:nt,token:nt,svr_env:nt,server:nt,try_cnt:et,room_mode:et,role:et,audience_create_room:et,liveroom_sid_string:nt,error:{ROOM_ID_NULL:C.ROOM_ID_NULL,INPUT_PARAM:C.INPUT_PARAM,ROOM_ID_TOO_LONG:C.ROOM_ID_TOO_LONG,ROOM_ID_INVALID_CHARACTER:C.ROOM_ID_INVALID_CHARACTER,USER_ID_NULL:C.USER_ID_NULL,USER_ID_TOO_LONG:C.USER_ID_TOO_LONG,USER_ID_INVALID_CHARACTER:C.USER_ID_INVALID_CHARACTER,USER_NAME_NULL:C.USER_NAME_NULL,USER_NAME_TOO_LONG:C.USER_NAME_TOO_LONG,REPEATEDLY_LOGIN:C.REPEATEDLY_LOGIN,LOGIN_TIMEOUT:C.LOGIN_TIMEOUT,INNER_ERROR:C.ROOM_INNER_ERROR,NETWORK_BROKEN:C.NETWORK_BROKEN,ROOM_COUNT_EXCEED:C.ROOM_COUNT_EXCEED,DIFFERENT_USER_ID:C.DIFFERENT_USER_ID}},Wt="/sdk/sublogin",Xt=nt,Zt={event:"/zpush/login",sdk_zpush_sessionid_string:nt},Kt={event:"/liveroom/enter"},Qt={event:"/sdk/renew_token",error:{INPUT_PARAM:C.INPUT_PARAM,NOT_LOGIN:C.NOT_LOGIN},token:nt},ti={event:"/sdk/logout",error:{INPUT_PARAM:C.INPUT_PARAM,ROOM_NOT_EXIST:C.ROOM_NOT_EXIST},room_id:nt,room_sid_string:nt,is_multi:st,is_send_cmd_net:st,liveroom_sid_string:nt},ii="/liveroom/quit",ni=nt,ei=nt,si="/sdk/relogin",ri={event:"/liveroom/tempbroken"},oi={event:"/sdk/reconnect",room_broken_time:et},ui={event:"/sdk/disconnect",valid_d:et,total_d:et,tempbroken_cnt:et},hi=et,ai=et,ci={event:"/liveroom/hb",room_id:nt,room_sid_string:nt,interval:et,stream_seq:et,server_user_seq:et,error:{NOT_LOGIN:C.NOT_LOGIN,HB_TIMEOUT:C.TIMEOUT}},li="/sdk/listener",fi={event:"/sdk/enable_multi_room",is_multi:st,error:{kInvalidParamError:C.INPUT_PARAM,kAlreadyLoginError:C.ALREADY_LOGIN}},_i={event:"/liveroom/get_current_user_list",user_index:et,is_time_ascend:st,use_na:et},di="/zegoconn/connect",mi=nt,vi=et,pi=it,gi=nt,bi=nt,Ei=et,Si="/zegoconn/request",Ri=it,Oi=it,yi=et,Ti={event:"/zegoconn/proxy_connect",service_no:et,proxy_link_sources:et,recv_time:et,connect_stream:et},wi={event:"/zegoconn/proxy_broken",service_no:et},Ii={event:"/zegoconn/proxy_disconnect",service_no:et},Ni=[50116,50118,50119,50120,50121,50122,50124,50125,50126,50127,50128];Ci=function(t,i){return(Ci=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}))(t,i)};var Ci,ki,zi,Ai=function(t,i,n){if(n||2===arguments.length)for(var e,s=0,r=i.length;s<r;s++)!e&&s in i||((e=e||Array.prototype.slice.call(i,0,s))[s]=i[s]);return t.concat(e||Array.prototype.slice.call(i))},Di=(function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=t}Ci(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}(Mi,ki=tt),Object.defineProperty(Mi.prototype,"ht",{get:function(){return this.ut.reporter},enumerable:!1,configurable:!0}),Object.defineProperty(Mi.prototype,"ct",{get:function(){return this.ut.useNetAgent},enumerable:!1,configurable:!0}),Mi.prototype.renewLocalToken=function(t,i){this.token=t,this._room.token=this.token;var n=(new Date).getTime(),e=void 0;i&&Object(D.d)(i)?e=1e3*i:Object(D.f)(t)&&["03","04"].includes(t.substring(0,2))&&(i=1e3*Z(t.substring(2)),this.ot.info("zm.rm.rlt time "+i+" "+n+" "+this.ut.local_time_deviation),e=i-(n-this.ut.local_time_deviation)),e&&this.roomHandler.resetTokenTimer(e),this.ot.setTokenInfo(t),this.ut.actionListener("_tokenRenewed",t,this._room.roomID)},Mi.prototype.initRoom=function(t,i,n,e,s,r,o){this.roomHandler=t,this.roomID=i,this.renewLocalToken(n),this.user=e,this.server=s,this.serverBak=r||s,this.config=o},Mi.prototype.active=function(t){var i=this,n=(this.ot.info(dt+" retry call "+(null==(n=this._room)?void 0:n.roomID)+" "+(t=void 0!==t&&t)),null!=(n=this.loginRoomCallback)&&n.success?Wt:si);if(this.subLoginSpan||(this.subLoginSpan=this.ht.createSpan(u.H,{key:Ft.event,par:this.roomID},{key:n,par:this.roomID},n,!0),this.spanKey=n),this.roomHandler.setRunState(o.trylogin),this._room.isMulti&&(null==(n=this.ut.roomModulesList.find((function(t){return!t.isMulti})))?void 0:n.runState)!==o.login)this.ot.info(dt+" service is disconnected, multi room stop retry");else if(this.retryTimer)this.ot.info(dt+" has actived, ignore");else{var e=this.ut.networkState==h.offline;if(e){if(this.ot.info(dt+" check if really offline. "+this._retryNetCount),this._retryNetCount>=this._retryNetMaxTimes)return void this.ot.warn(dt+" network is broken, stop retry")}else this._retryNetCount=0;this.isOverTime?this.ot.info(dt+" retry over time, stop retry"):(1==this.retryActiveCount?this.retryActiveInterval=Math.floor(Math.random()*(1-this.RETRY_START_TIME_INTERVAL)+this.RETRY_START_TIME_INTERVAL):(n=Math.pow(2,Math.round(this.retryActiveCount/this.RETRY_CONTINUE_COUNT+1)),this.retryActiveInterval=n>this.RETRY_MAX_TIME_INTERVAL?this.RETRY_MAX_TIME_INTERVAL:n),this.ot.info(dt+" interval "+this.retryActiveInterval),wx.getNetworkType({success:function(t){z("netType",t.networkType.toLowerCase())}}),this.retryTimer=setTimeout((function(){i.roomHandler.login(i.retryActiveCount%2==1?i.server:i.serverBak,i.roomID,i.token,i.user,i.config,(function(t){i.ut.networkState=h.online,i.handleLoginFinish(t)}),(function(t,n){i.handleLoginFinish(!1,t,n)})),i.retryTimer&&clearTimeout(i.retryTimer),i.retryTimer=null,e?i._retryNetCount++:i.retryActiveCount++}),t?0:1e3*this.retryActiveInterval))}},Mi.prototype.startMaxTime=function(){var t=this;this.maxTimer||(this.ot.info(dt+" start max timer"),0===this.activeStartTime&&(this.activeStartTime=(new Date).getTime()),this.maxTimer=setTimeout((function(){var i;t.ot.info(dt+" over max time ".concat(t.RETRY_MAX_TIME,"s, stop retry")),t.isOverTime=!0,t.roomHandler.resetRoom(),0!==t.activeStartTime&&(i=0<(i=(new Date).getTime()-t.activeStartTime)?i:void 0),t._t(!1,C.LOGIN_TIMEOUT),t.subLoginSpan&&(t.ht.spanEnd({key:t.spanKey,par:t.roomID},{error:C.LOGIN_TIMEOUT.code,message:C.LOGIN_TIMEOUT.msg,try_time:i}),t.subLoginSpan=null),t.loginRoomCallback.fail&&(t.loginRoomCallback.fail(C.LOGIN_TIMEOUT),t.roomHandler.disconnectedHandle(C.LOGIN_TIMEOUT),t.resetCallBack())}),1e3*this.RETRY_MAX_TIME))},Mi.prototype.stopMaxTime=function(){this.ot.info(dt+" stop max timer"),0!==this.activeStartTime&&(this.activeStartTime=0),this.maxTimer&&clearTimeout(this.maxTimer),this.maxTimer=null},Mi.prototype.onactive=function(t,i){},Mi.prototype.retryLoginRoom=function(t,i){void 0===t&&(t=!1),void 0===i&&(i=!1),this.maxTimer||this.startMaxTime(),i&&this._room.resetSessionInfo(),this.active(t)},Mi.prototype.handleError=function(t,i){if(this.RETRY_MAX_TIME<3)return!1;if(t=t.code,i){i=[200207,200208];var n=void 0;if(this.ct){if(40001<=t&&t<=40100||50200<=t&&t<=50299||[201002,30019].includes(t))return this._room.resetSessionInfo(),!0;if(n=Ai(Ai([202002,205030,205035],Ni,!0),[50013],!1),10015===t)return this._room.retryConnect(),!0}return!(null!=n&&n.includes(t)||!i.includes(t)&&(this._room.lastRunState!=o.login||(this.ot.warn("zm.rrh.he reset"),this._room.resetUserSession(),this.invalid(),0)))}return!0},Mi.prototype.setLoginRoomCallback=function(t,i){this.loginRoomCallback.success=t,this.loginRoomCallback.fail=i},Mi.prototype.loginFail=function(t){this.roomHandler.resetRoom(),this._t(!1,t),this.loginRoomCallback.fail&&(this.loginRoomCallback.fail(t),this.roomHandler.disconnectedHandle(t),this.resetCallBack())},Mi.prototype.handleLoginFinish=function(t,i,n){var e;this.ot.info(Ot+" "+t+" "+JSON.stringify(i)),i?(this.subLoginSpan&&(e=void 0,0!==this.activeStartTime&&(e=0<(e=(new Date).getTime()-this.activeStartTime)?e:void 0),this.ht.spanEnd({key:this.spanKey,par:this.roomID},{error:i.code,message:i.msg,try_time:e}),this.subLoginSpan=null),this.handleError(i,n)?(this.ot.info(Ot+" retry"),this.retryLoginRoom()):(this.ot.info(Ot+" reset"),this.roomHandler.resetRoom(),this._t(t,i),this.loginRoomCallback.fail&&(this.loginRoomCallback.fail(i),this.roomHandler.disconnectedHandle(i),this.resetCallBack()))):(e=void 0,0!==this.activeStartTime&&(e=0<(e=(new Date).getTime()-this.activeStartTime)?e:void 0),this._t(t,{code:0,msg:""}),this.subLoginSpan&&(this.ht.spanEnd({key:this.spanKey,par:this.roomID},{room_id:this.roomID,room_sid_string:null==(n=this._room)?void 0:n.roomSidString,try_time:e}),this.subLoginSpan=null),this.loginRoomCallback.success&&(this.loginRoomCallback.success(t),this.resetCallBack()))},Mi.prototype.invalid=function(){this.ot.info("zm.rh.ivd end retry"),this.retryTimer&&clearTimeout(this.retryTimer),this.retryTimer=null,this.retryActiveCount=1,this._retryNetCount=0},Mi.prototype._t=function(t,i){this.stopMaxTime(),this.invalid(),this.onactive(t,i)},Mi.prototype.resetCallBack=function(){this.loginRoomCallback.success=void 0,this.loginRoomCallback.fail=void 0},Mi);function Mi(t,i,n){var e=ki.call(this,t,i)||this;return e.ot=t,e.ut=i,e._room=n,e.activeStartTime=0,e._retryNetCount=0,e._retryNetMaxTimes=3,e.spanKey="",e.loginRoomCallback={},e}(i=zi=zi||{}).NOT_EMPTY="NOT_EMPTY",i.ILLEGAL_CHARACTERS="ILLEGAL_CHARACTERS",i.TYPE_STRING="TYPE_STRING",i.TYPE_INTEGER="TYPE_INTEGER",i.TYPE_OBJECT="TYPE_OBJECT",i.MAX_LENGTH_10="MAX_LENGTH_10",i.MAX_LENGTH_64="MAX_LENGTH_64",i.MAX_LENGTH_100="MAX_LENGTH_100",i.MAX_LENGTH_128="MAX_LENGTH_128",i.MAX_LENGTH_256="MAX_LENGTH_256",i.MAX_LENGTH_1024="MAX_LENGTH_1024";var Pi={error:{code:0,msg:"suc"}},xi={NOT_EMPTY:function(t,i,n,e,s){return void 0===i||""===i||null===i?(e.error("".concat(n," ").concat(t," is empty")),s):Pi},ILLEGAL_CHARACTERS:function(t,i,n,e,s){return/^([0-9a-zA-Z#!$%&()`'+-;<=.>@^_~,\\*])+$/.test(i)&&/^[^:/]*$/g.test(i)?Pi:(e.error("".concat(n," ").concat(t," contains illegal characters")),s)},TYPE_STRING:function(t,i,n,e,s){return Object(D.f)(i)?Pi:(e.error("".concat(n," ").concat(t," must be string")),s)},TYPE_INTEGER:function(t,i,n,e,s){return q(i,!1)?Pi:(e.error("".concat(n," ").concat(t,"  must be integer number")),s)},TYPE_OBJECT:function(t,i,n,e,s){return i&&Object(D.e)(i)?Pi:(e.error("".concat(n," ").concat(t,"  must be object")),s)},MAX_LENGTH_10:function(t,i,n,e,s){return 10<i.length?(e.error("".concat(n," ").concat(t," is too long")),s):Pi},MAX_LENGTH_64:function(t,i,n,e,s){return 64<i.length?(e.error("".concat(n," ").concat(t," is too long")),s):Pi},MAX_LENGTH_100:function(t,i,n,e,s){return 100<i.length?(e.error("".concat(n," ").concat(t," is too long")),s):Pi},MAX_LENGTH_128:function(t,i,n,e,s){return 128<i.length?(e.error("".concat(n," ").concat(t," is too long")),s):Pi},MAX_LENGTH_256:function(t,i,n,e,s){return 256<i.length?(e.error("".concat(n," ").concat(t," is too long")),s):Pi},MAX_LENGTH_1024:function(t,i,n,e,s){return 1024<i.length?(e.error("".concat(n," ").concat(t," is too long")),s):Pi}};Object.defineProperty(Li.prototype,"debug",{get:function(){return this._debug},set:function(t){this._debug=t,s.LoggerStateCenter.getInstance().debug=t},enumerable:!1,configurable:!0}),Object.defineProperty(Li.prototype,"testEnvironment",{get:function(){return this._testEnvironment},set:function(t){this._testEnvironment=t,s.LoggerStateCenter.getInstance().testEnvironment=t},enumerable:!1,configurable:!0}),Object.defineProperty(Li.prototype,"ENV",{get:function(){return this._env},set:function(t){this._env=t,s.LoggerStateCenter.getInstance().ENV=t},enumerable:!1,configurable:!0}),Object.defineProperty(Li.prototype,"roomid",{get:function(){return this.roomModulesList[0]?this.roomModulesList[0].roomID:""},enumerable:!1,configurable:!0}),Object.defineProperty(Li.prototype,"serverTimeOffset",{get:function(){return this.roomModulesList[0]?this.roomModulesList[0].messageHandler.serverTimeOffset:0},enumerable:!1,configurable:!0}),Li.prototype.getRequestId=function(){return this.idName+"-"+_()},Li.prototype.actionListener=function(t){for(var i,n=this,e=[],s=1;s<arguments.length;s++)e[s-1]=arguments[s];["getAnchorInfo","HBResponse","roomOnlineUserCountUpdate","roomLoginResponse"].includes(t)||t.startsWith("_")||!this.listenerList[t]||((i=this.reporter.createSpan(u.H,{key:Ht},{key:""},li)).setAttributes({listener:t,listener_params:JSON.stringify(e)}),i.end()),["roomStateChanged","tokenWillExpire"].includes(t)&&this.ot.info("zm.al ".concat(t," ").concat(JSON.stringify(e),". pageID: ").concat(Vn.pageID," , instID: ").concat(this.id)),this.listenerList[t]&&this.listenerList[t].forEach((function(i){try{i.apply(void 0,e)}catch(i){n.ot.error("zm.st.at ",t," ",JSON.stringify(i))}}))},Li.prototype.onListener=function(t,i){return this.listenerList[t]?Object(D.c)(i)?(-1==this.listenerList[t].indexOf(i)&&this.listenerList[t].push(i),!0):(this.ot.error(Nt+" listener callBack must be funciton"),!1):(this.ot.error(Nt+" event "+t+" no found"),!1)},Li.prototype.offListener=function(t,i){return this.listenerList[t]?Object(D.c)(i)?(-1!==this.listenerList[t].indexOf(i)&&(this.listenerList[t]=this.listenerList[t].filter((function(t){return t!==i}))),!0):(this.ot.error(Ct+" listener callBack must be funciton"),!1):(this.ot.error(Ct+" event "+t+" no found"),!1)},Object.defineProperty(Li.prototype,"sdKVersion",{get:function(){return this._sdkVersion},set:function(t){this._sdkVersion=t},enumerable:!1,configurable:!0}),Li.prototype.proxyRes=function(t,i,n){return{interResolve:function(n){i(n),t.end()},interReject:function(i,e){var s;void 0===e&&(e=""),(s=i.code<2e9&&1e9<i.code?V(i.code,i.msg):{code:i.code,message:i.msg})&&t.setAttributes({error:s.code,message:s.message+e}),t.end(),n({errorCode:i.code})}}};var Ui=Li;function Li(t,i){this.ot=t,this._dataReport=i,this.id="",this._debug=!1,this.appConfigEtag=-1,this.appConfigFetched=!1,this.requestList={},this.mode=S.MODE_ONLINE,this.connectState="connected",this.testNetPackageSize=!1,this.netGeoFencing={},this.advanceConfig={},this.svrDomains={},this._testEnvironment=!1,this._env=0,this.type="PUBLIC",this.debugCustom=!1,this.configOK=!1,this.role=2,this.relateService=[],this.maxMemberCount=0,this.roomCreateFlag=1,this.local_time_deviation=0,this.callbackList={},this.listenerList={roomUserUpdate:[],roomOnlineUserCountUpdate:[],getAnchorInfo:[],_getAnchorInfo:[],IMRecvCustomCommand:[],IMRecvBroadcastMessage:[],recvReliableMessage:[],roomExtraInfoUpdate:[],IMRecvBarrageMessage:[],recvJoinLiveRequest:[],recvInviteJoinLiveRequest:[],recvEndJoinLiveCommand:[],roomLoginResponse:[],_roomLogin:[],_appConfigRsp:[],_netAppConfigRsp:[],_connectChanged:[],HBResponse:[],roomStateUpdate:[],_roomStateUpdate:[],_getTotalUserList:[],_userStateUpdate:[],_recvBigRoomMessage:[],_recvRoomMsg:[],_kickout:[],tokenWillExpire:[],_tokenExpired:[],roomStateChanged:[],_userTransUpdate:[],hallStateUpdate:[],_hallStateUpdate:[],roomTokenWillExpire:[],_tokenRenewed:[],_protobufResponse:[],_cloudSettingNotify:[],_settingCanFetch:[]},this.reportList={},this.reportSeqList={login:0,relogin:0},this.networkState=h.online,this.roomRetryTime=300,this.roomModulesList=[],this.isMultiRoom=!1,this.setMultiRoom=!1,this.protoFormat="json",this.settingFetched=!1,this.useNetAgent=!0,this.netHasSet=!1,this.configRoomAuth=!1,this.configCheckToken=!1,this._sdkVersion="unknown"}Object.defineProperty(ji.prototype,"ht",{get:function(){return this.ut.reporter},enumerable:!1,configurable:!0}),ji.prototype._startOverTimeTimer=function(){var t=this;this._stopOverTimeTimer(),this._overtimeTimer=setTimeout((function(){t.ot.warn("zm.hb.to call. "+t._heartbeatTimeout),t.hbLogout(C.HEARTBEAT_TIMEOUT),t.ht.createSpan(u.H,{key:Ft.event,par:t._room.roomID},{key:""},"/zpush/hb_timeout").end()}),this._heartbeatTimeout)},ji.prototype._stopOverTimeTimer=function(){this._overtimeTimer&&clearTimeout(this._overtimeTimer)},ji.prototype.init=function(t){var i=this,n=t.body.hearbeat_interval<3e3?3e3:t.body.hearbeat_interval;this._stopOverTimeTimer(),this._heartbeatTimer&&clearTimeout(this._heartbeatTimer),this._heartbeatTimer=setTimeout((function(){i.start(n)}),n),this.initCount++},ji.prototype.start=function(t){var i,n=this,e=(this.ot.info(St+" call"),this.ht.createSpan(u.H,{key:Ft.event,par:this._room.roomID},{key:""},ci.event));this._room.isLogin()?(this._liveRoomHandler.heartBeat(i=function(t,i){var s=t.body&&t.body.err_code;t.header&&t.body?0!==s&&(s=V(t.body.err_code||t.body.code,t.body.err_message||t.body.message),e.setAttributes({error:s.code,message:s.message+t.body.err_code})):e.setAttributes({error:(0<t.code?t:C.ROOM_INNER_ERROR).code,message:t.msg||C.ROOM_INNER_ERROR}),n._handleHeartbeatRsp(t,i),0===(null==(s=null==t?void 0:t.body)?void 0:s.err_code)&&e.setAttributes({interval:ci.interval(null==(i=null==t?void 0:t.body)?void 0:i.hearbeat_interval),stream_seq:ci.stream_seq(null==(s=null==t?void 0:t.body)?void 0:s.stream_seq),server_user_seq:ci.server_user_seq(null==(i=null==t?void 0:t.body)?void 0:i.server_user_seq)}),e.end()},i,this._room,this._heartbeatInterval),this._heartbeatInterval=t,i=this._heartbeatInterval,2<=this.initCount?(i=Math.round(Math.random()*(this._heartbeatInterval+1)),this.initCount=1):i=this._heartbeatInterval,this._overtimeTimer||this._startOverTimeTimer(),this._heartbeatTimer=setTimeout((function(){n.start(n._heartbeatInterval)}),i),this.ot.info(St+" call success")):(this.ot.error(St+" state error"),this.ht.setError(e,ci.error.NOT_LOGIN))},ji.prototype._handleHeartbeatRsp=function(t,i){if(t.body&&t.body.err_code&&0!==t.body.err_code)return this.ot.error(Rt+" disconnect, server error=",t.body.err_code),1000000152==t.body.err_code?void this.hbLogout(C.HEARTBEAT_TIMEOUT):void this.hbLogout(J(t.body.err_code));t.header&&t.body?(0!==t.body.hearbeat_interval&&(this._heartbeatInterval=t.body.hearbeat_interval,this._heartbeatInterval<3e3)&&(this._heartbeatInterval=3e3),0!==t.body.hearbeat_timeout&&(this._heartbeatTimeout=t.body.hearbeat_timeout),this._startOverTimeTimer(),this.heartbeatRspNotiFy(t,this._room.roomID),this.ot.info(Rt+" call success "+i)):(this.ot.error(Rt+" disconnect, error=",JSON.stringify(t)+", seq = "+i),this.hbLogout(t))},ji.prototype.heartbeatRspNotiFy=function(t,i){},ji.prototype.hbLogout=function(t){},ji.prototype.resetHeartbeat=function(){clearTimeout(this._heartbeatTimer),this._heartbeatTimer=null,this._stopOverTimeTimer(),this.initCount=0,this.ot.info("zm.hb.rst call success")};var qi=ji;function ji(t,i,n,e,s,r){this.ot=t,this.ut=i,this._dataReport=n,this._liveRoomHandler=e,this._room=s,this._service=r,this._heartbeatTimer=null,this._heartbeatTimeout=1e5,this.initCount=0,this._overtimeTimer=null}var Gi={code:1102026,msg:"cancel login"},Hi=function(t){return window=window||globalThis,i=unescape||window.unescape,Uint8Array.from(Array.from(i(encodeURIComponent(t))).map((function(t){return t.charCodeAt(0)})));var i},$i=function(t){return window=window||globalThis,i=escape||window.escape,decodeURIComponent(i(String.fromCharCode.apply(String,Array.from(t))));var i},Vi="DISCONNECTED",Bi="CONNECTED",Ji="CONNECTING",Yi=(Object.defineProperty(Fi.prototype,"ct",{get:function(){return this.ut.useNetAgent},enumerable:!1,configurable:!0}),Object.defineProperty(Fi.prototype,"ht",{get:function(){return this.ut.reporter},enumerable:!1,configurable:!0}),Object.defineProperty(Fi.prototype,"ft",{get:function(){return this.dt.roomID},enumerable:!1,configurable:!0}),Fi.prototype.resetTokenTimer=function(t){var i=this;this.ot.info("zm.rm.rst  call: "+(t=2147483647<(t=(t-=3e4)<0?0:t)?2147483647:t)),this._tokenTimer&&clearTimeout(this._tokenTimer),this._tokenTimer=setTimeout((function(){i.ut.actionListener("tokenWillExpire",i.ft),i.ut.actionListener("roomTokenWillExpire",i.ft)}),t)},Fi.prototype._stopTokenTimer=function(){this._tokenTimer&&clearTimeout(this._tokenTimer),this._tokenTimer=null},Fi.prototype.setRunState=function(t){this.dt.runState!==t&&(this.dt.lastRunState=this.dt.runState,this.dt.runState=t)},Fi.prototype._resetTryLogin=function(){this._tryLoginTimer&&clearTimeout(this._tryLoginTimer),this._tryLoginTimer=null},Fi.prototype._reportLogoutSpan=function(t){var i,n=this.ut.isMultiRoom?ii:"/switch/logout_user";n=this.ht.createSpan(u.H,{key:ti.event,par:this.ft},{key:""},n),t&&this.ct&&"0"===this.vt.roomServicer.zPushSid&&(this.vt.roomServicer.zPushSid=null==(i=null==(i=null==(i=this.vt)?void 0:i.roomServicer)?void 0:i.switchSessionID)?void 0:i.toString()),this.updateTimes(),t=this.ct?t?null==(t=null==(i=this.vt)?void 0:i.roomServicer)?void 0:t.zPushSid:null==(i=null==(t=null==(i=this.vt)?void 0:i.roomServicer)?void 0:t.switchSessionID)?void 0:i.toString():void 0,n.setAttributes({room_id:ti.room_id(null==(i=this.dt)?void 0:i.roomID),room_sid_string:ti.room_sid_string(null==(i=this.dt)?void 0:i.roomSidString),liveroom_sid_string:ni(null==(i=this.dt)?void 0:i.userSidString),sdk_zpush_sessionid_string:ei(t),valid_d:this.validTime,total_d:this.totalTime,tempbroken_cnt:this.brokenCounts}),n.end()},Fi.prototype.resetRoom=function(t){var i,n=this;this.ot.info(gt+" call"),1<this.ut.roomModulesList.length&&!t&&(this.dt.isMulti=!0),this._resetTryLogin(),this.dt.sessionExist&&this.dt.runState!==o.logout&&!this.dt.isDisConnect()&&this.vt.logout(this.dt,i=function(t){n.handleLogoutRsp(t,!n.dt.isMulti)},i),this._reportLogoutSpan(t),this.setRunState(o.logout),this.dt.resetRoomSession(),this.dt.resetUserSession(),this.dt.isMulti||(this.ut.userid="",this.ot.setSessionInfo(this.ut.appid,this.ft,this.dt.userSidString,this.ut.idName,this.ut.nickName,this.ut.sdKVersion),null!=(i=this.vt)&&i.reset()),this.resetRoomCallBack(),this.ut.roomModulesList=this.ut.roomModulesList.filter((function(t){return t!==n.dt})),(t=this.ut.roomModulesList[0])&&(t.isMulti=!1,t.runState!==o.login)&&t&&t.retryRoom(),this.ut.isMultiRoom&&0===this.ut.roomModulesList.length&&(this.ht.createSpan(u.H,{key:ti.event,par:this.ft},{key:""},"/zpush/multi_logout_user").end(),this.vt.roomServicer.zPushSid="0"),this.ot.info(gt+" call success")},Fi.prototype.resetRoomCallBack=function(){},Fi.prototype.loginSuccessCallBack=function(t,i){},Fi.prototype.handlePushKickout=function(t,i,n){var e=this,s=(this.ot.info(bt+"  call "+JSON.stringify(t)),function(t,i){var n={code:t,message:"kickout reason = "+t},e={code:63000005,message:"zpush token expired",name:U};switch(t){case 1:return{code:63000001,message:"zpush multiple login kickout",name:x};case 2:return{code:63000002,message:"zpush manual kickout",name:"MANUAL_KICKOUT"};case 4:return i?e:{code:63000004,message:"zpush multiple login kickout",name:x};case 5:if(!i)return e;default:n.code=t,n.message="kickout reason = "+t}return n}(t.body.reason||(null==(s=t.body)?void 0:s.kickout_reason),this.ct)),r=this.ht.createSpan(u.H,{key:Ft.event,par:this.ft},{key:""},"/sdk/kickout"),h=(this.updateTimes(),r.setAttributes({error:null==(h=C[s.name||"ROOM_INNER_ERROR"])?void 0:h.code,message:s.message,kickout_reason:hi((null==(h=t.body)?void 0:h.reason)||(null==(h=t.body)?void 0:h.kickout_reason)),need_relogin:ai(null==(h=null==t?void 0:t.body)?void 0:h.need_relogin),valid_d:this.validTime,total_d:this.totalTime,tempbroken_cnt:this.brokenCounts}),r.end(),this.dt.roomTryHandler);h?(h.onactive=function(t,i){e.ot.info(bt+" onactive"),e.disconnectedHandle(i),e.ut.actionListener("_kickout",i)},t.body.need_relogin&&1==t.body.need_relogin?this.dt.retryRoom(!1,!0):(this.setRunState(o.logout),this.resetRoom(i),r={},t&&t.body.custom_reason?r.custom_kickout_message=t.body.custom_reason:s.name&&C[s.name]&&(r.custom_kickout_message=C[s.name].msg+"; kickout reason: "+(h=t.body.reason||t.body.kickout_reason)),this.disconnectedHandle(s.name&&C[s.name]?C[s.name]:C.ROOM_INNER_ERROR,{extendedData:JSON.stringify(r),isKickout:!0}),this.ut.actionListener("_kickout",{code:C.MANUAL_KICKOUT.code,msg:C.MANUAL_KICKOUT.msg+t.body.reason||t.body.kickout_reason}))):this.ot.info(bt+" try handler no found")},Fi.prototype.handleHbLogout=function(t){var i=this,n=this.dt.roomTryHandler;n&&(n.onactive=function(t,n){i.ot.warn(Et+" onactive"),i.transError(n),i.disconnectedHandle(n)},[C.HEARTBEAT_TIMEOUT,C.SOCKET_CLOSE].includes(t)||[105,152,2001].includes(null==t?void 0:t.code)||t.msg.endsWith("1000002001")||t.msg.endsWith("1000000152")||t.msg.endsWith("1000000105")?this.dt.retryRoom():[C.TIMEOUT].includes(t)?this.ot.warn(Et+" timeout"):(this.ot.warn(Et+" unexpected error: ".concat(JSON.stringify(t))),this.logoutByError(t)))},Fi.prototype.logoutByError=function(t){var i=this.dt.roomTryHandler;i&&(i.stopMaxTime(),i.invalid(),this.resetRoom(),this.disconnectedHandle(t))},Fi.prototype.onDisconnect=function(t){},Fi.prototype.onConnecting=function(t){this._roomStateHandle(Ji,y.Logining,t)},Fi.prototype.disconnectedHandle=function(t,i){var n;t&&0!==t.code?(this._stopTokenTimer(),n=null!=i&&i.isKickout?y.Kickout:y.ReconnectFailed,this.transError(t),this._roomStateHandle(Vi,n,t,(null==i?void 0:i.extendedData)||t.msg)):this._roomStateHandle(Bi,y.Reconnected,t,null==i?void 0:i.extendedData)},Fi.prototype.updateTimes=function(){this.updateValidTime(),this.updateTotalTime()},Fi.prototype.updateValidTime=function(){this.Et&&(this.validTime=this.validTime+Date.now()-this.Et,this.Et=0)},Fi.prototype.updateTotalTime=function(){this.bt&&(this.totalTime=Date.now()-this.bt)},Fi.prototype._roomStateHandle=function(t,i,n,e,s){var r=this.dt.roomID,o=Date.now();if(!i||i!=y.Reconnecting||(this.St++,1!=this.St)){this.ot.info("zm.rm.scb "+t+" "+JSON.stringify(n)),[Bi,Vi].includes(t)&&(this.St=0,this.Rt)&&this.brokenCounts++,t!==Bi&&this.updateTimes(),(i=i&&[y.LoginFailed,y.ReconnectFailed].includes(i)?null!=(a=this.dt.roomTryHandler)&&a.loginRoomCallback.fail?y.LoginFailed:y.ReconnectFailed:i)&&[y.Logined,y.Reconnected].includes(i)&&(null!=(a=this.dt.roomTryHandler)&&a.loginRoomCallback.success?(i=y.Logined,this.bt=this.bt||o):i=y.Reconnected,this.Rt=!1,this.Et=o),i&&[y.Logining,y.Reconnecting].includes(i)&&(i=null!=(a=this.dt.roomTryHandler)&&a.loginRoomCallback.success?y.Logining:y.Reconnecting,this.bt)&&(this.Rt=!0);var h,a,c=0;switch(i){case y.Reconnecting:h=ri,this.tempBrokenTime=(new Date).getTime();break;case y.ReconnectFailed:h=ui;break;case y.Reconnected:h=oi,c=(new Date).getTime()-this.tempBrokenTime}this.dt.lastRoomState=this.dt.roomState,this.dt.roomState=t,this.dt.roomReasonState=i,this.dt.roomState!==this.dt.lastRoomState&&(this.ut.actionListener("_roomStateUpdate",r,t,n?n.code:0,e,s,i),s||(this.ut.actionListener("roomStateUpdate",r,t,o=(o=(null==n?void 0:n.code)||0)==Gi.code?0:o,e),this.ut.actionListener("roomStateChanged",r,i,o,e)),h)&&((a=this.ht.createSpan(u.H,{key:Ft.event,par:r},{key:""},h.event)).setAttributes(i===y.Reconnected?{room_broken_time:oi.room_broken_time(c)}:{error:(null==n?void 0:n.code)||0,message:e||""}),h==ui&&a.setAttributes({valid_d:this.validTime,total_d:this.totalTime,tempbroken_cnt:this.brokenCounts}),a.end()),t===Vi&&(this.bt=0,this.totalTime=0,this.validTime=0,this.brokenCounts=0)}},Fi.prototype.transError=function(t){var i;this.ot.info("zm.rm.te "+JSON.stringify(t)),0!==t.code&&(t.code<2e9&&1e9<t.code||t.code<1e6)&&(i=F(t.code,this.ut.useNetAgent))&&C[i]&&(t.code=C[i].code,t.msg=C[i].msg)},Fi.prototype.login=function(t,i,n,e,s,r,h){var a;this.ot.info(dt+" call:"+i),this.ot.remoteReport(dt+" call:"+n),this.dt.isMulti||this.ot.setSessionInfo(this.ut.appid,i,"",e.userID,"",this.ut.sdKVersion),s&&(a=s.userUpdate,s=s.maxMemberCount,a&&Object(D.b)(a)&&(this.dt.userStateUpdate=a),s)&&Object(D.d)(s)&&(this.dt.maxMemberCount=s),this.ut.configOK?(this.dt.runState!==o.trylogin&&this.setRunState(o.trylogin),this.dt.isCancelLogin=!1,this.dt.roomID=i,this.dt.token=n,this.dt.thirdToken=n,this.ut.idName=e.userID,this.ut.nickName=e.userName||e.userID,this.loginCallback.success=r,this.loginCallback.fail=h,this.server=t,this.ht.spanSetAttributes({key:Wt,bak_key:si,par:i},{server:this.ct?void 0:Xt(this.server)}),this.liveRoomLoginKey=this.dt.isMulti?Kt:Zt,this.ht.createSpan(u.H,{key:Wt,bak_key:si,par:this.ft},{key:this.liveRoomLoginKey.event,par:this.ft},this.liveRoomLoginKey.event,!0),this._resetTryLogin(),this.onConnecting({code:0,msg:""}),this._tryLogin(t),this.ot.info(dt+" call success")):(this.ot.error(dt+" init sdk wrong"),h(C.INIT))},Fi.prototype._tryLogin=function(t){var i,n=this;if(this.dt.runState!==o.trylogin)this.ot.error("zb.rh.tl state error");else{var e;if(this.ct)return this.dt.isMulti&&this.dt.isDisConnect()?void this.ot.warn(mt+" liveroom is not connected"):(e=function(t,i){n.handleLoginRsp(t,i)},void(null!=(i=this.vt)&&i.isUaConnect?(this.ht.spanSetAttributes({key:this.liveRoomLoginKey.event,par:null==(i=this.dt)?void 0:i.roomID},{sdk_zpush_sessionid_string:null==(i=null==(i=null==(i=this.vt)?void 0:i.roomServicer)?void 0:i.switchSessionID)?void 0:i.toString()}),this.vt.login(this.dt,e,e)):(this._tryLoginTimer=setTimeout((function(){n.ot.info(mt+" over time no response, login timeout"),n.loginCallback.fail&&n.loginCallback.fail(Ft.error.LOGIN_TIMEOUT)}),this._tryLoginInterval),this.ot.warn(mt+" ua is not connected"))));this._tryLoginTimer=setTimeout((function(){n.ot.info(mt+" over time no response, login timeout"),n.loginCallback.fail&&n.loginCallback.fail(Ft.error.LOGIN_TIMEOUT)}),this._tryLoginInterval),this.ot.info(mt+" call success")}},Fi.prototype.handleLoginRsp=function(t,i){this.ot.info(vt+" seq: "+i+" "+JSON.stringify(t)),this.dt.runState!==o.trylogin?this.dt.isCancelLogin?(this.handleLoginFail(Gi),this.dt.isCancelLogin=!1):this.ot.error(vt+" state error"):t.header&&t.body?t.header.seq!==i&&0==this.dt.isMulti?this.ot.error(vt+" in wrong seq, local=",i+"",",recv=",t.header.seq):0!==t.body.err_code?(this.ot.error(vt+" server error=",t.body.err_code),this.handleLoginFail(t)):(this.ot.info(vt+" call success."),this.handleLoginSuccess(t)):(this.ot.error(vt+" "+JSON.stringify(t)),this.handleLoginFail(t))},Fi.prototype.handleLoginFail=function(t){this._resetTryLogin();var i=Ft.error.INNER_ERROR;t.header&&t.body?i=J(t.body.err_code):t.code&&t.msg&&(i=t),this.ht.spanEnd({key:this.liveRoomLoginKey.event,par:this.ft},{error:i.code,message:i.msg}),this.loginCallback.fail&&this.loginCallback.fail(i,!0)},Fi.prototype.handleLoginSuccess=function(t){var i,n,e=this,s=(this.dt.checkRoomSession(t.body.room_session_id)&&(this.dt.loginTime=Date.now()),this.dt.lastRunState),r=(this.setRunState(o.login),this.ut.userid=t.body.user_id,this.dt.longRoomSid=t.body.room_session_id,this.dt.longSid=t.body.session_id,(r={})[this.ft]={room_sid_string:this.dt.roomSidString},this.ht.setPublicPros(r),null==(r=null==t?void 0:t.body)?void 0:r.token_remain_time);this.ut.configRoomAuth=0<r,t.body.ret_timestamp&&["03","04"].includes(this.dt.token.substring(0,2))&&(n=(i=(new Date).getTime())-t.body.ret_timestamp,this.ut.local_time_deviation=n<5e3?0:n,n=0<r?1e3*r:1e3*Z(this.dt.token.substring(2))-(i-this.ut.local_time_deviation),this.resetTokenTimer(n)),this.dt.isMulti||this.ot.setSessionInfo(this.ut.appid,this.ft,this.dt.userSidString,this.ut.idName,this.ut.nickName,this.ut.sdKVersion),this.ht.spanEnd({key:this.liveRoomLoginKey.event,par:this.ft},{server:this.ct?void 0:Xt(this.server),room_id:null==(r=this.dt)?void 0:r.roomID,room_sid_string:null==(i=this.dt)?void 0:i.roomSidString,zpush_sessionid_string:this.ct&&null!=(r=null==(n=null==t?void 0:t.header)?void 0:n.session_id)?r.toString():void 0,liveroom_sid_string:null==(i=this.dt)?void 0:i.userSidString}),this._resetTryLogin(),this.loginSuccessCallBack(s,t),this._roomStateHandle(Bi,y.Logined,{code:0,msg:""}),this.ot.makeZipLogSpaceUpload().catch((function(t){e.ot.error("zm.rm.lgsuc zip log upload error: "+JSON.stringify(t))})),this.loginCallback.success&&this.loginCallback.success(!0)},Fi.prototype.closeHandler=function(t){},Fi.prototype.logout=function(t,i){this.ot.info(pt+" call");var n={code:0,msg:""};this.dt.runState===o.logout?this.ot.warn("zb.rh.lo at logout"):(this.dt.runState===o.trylogin&&(this.dt.isCancelLogin=!0,n=Gi),this.resetRoom(t),this._roomStateHandle(Vi,y.Logout,n,void 0,i),this._stopTokenTimer(),this.ot.info(pt+" call success"))},Fi.prototype.handleLogoutRsp=function(t,i){this.ot.info(pt+" result=",t.body&&t.body.err_code?t.body.err_code:"-1"),this.ct&&i&&null!=(t=this.vt)&&t.closeRequest()},Fi);function Fi(t,i,n,e,s,r){this.ot=t,this.ut=i,this._dataReport=n,this.dt=e,this.vt=s,this.Tt=r,this._tryLoginTimer=null,this._tryLoginCount=0,this._tryLoginInterval=1e4,this._tokenTimer=null,this._beforeExpire=30,this.server="",this.tempBrokenTime=0,this.St=0,this.validTime=0,this.totalTime=0,this.brokenCounts=0,this.Et=0,this.bt=0,this.Rt=!1,this.loginCallback={}}var Wi=function(t,i,n){if(n||2===arguments.length)for(var e,s=0,r=i.length;s<r;s++)!e&&s in i||((e=e||Array.prototype.slice.call(i,0,s))[s]=i[s]);return t.concat(e||Array.prototype.slice.call(i))},Xi=(Zi.prototype.loginRsp=function(t,i){this._anchor_info=t.body.anchor_info||this._anchor_info,this._userListInterval=t.body.userlist_interval||this._userListInterval,this._userListMergeInterval=t.body.userlist_merge_timeout||this._userListMergeInterval,t.body.anchor_info&&(this.ut.actionListener("getAnchorInfo",t.body.anchor_info.anchor_id_name,t.body.anchor_info.anchor_nick_name),this.ut.actionListener("_getAnchorInfo",t.body.anchor_info.anchor_id_name,t.body.anchor_info.anchor_nick_name)),t.body.online_count&&this.ut.actionListener("roomOnlineUserCountUpdate",this._room.roomID,t.body.online_count),this.ot.info("zm.us.lgr  userStateUpdate "+this._room.userStateUpdate),this._room.userStateUpdate&&this.fetchUserList(i)},Zi.prototype.patchUserList=function(t){var i=this;t.body.server_user_seq!==this._userSeq&&this._room.userStateUpdate&&!this._userSeqMergeMap&&(this.ot.info("zm.us.pt call update user "+this._userSeq+" server "+t.body.server_user_seq),this._userSeqMergeMap||(this._userSeqMergeMap={}),this._userSeqMergeTimer&&clearTimeout(this._userSeqMergeTimer),this._userSeqMergeTimer=setTimeout((function(){i.handleMergeTimeout()}),this._userListMergeInterval)),this._minUserSeq=t.body.server_user_seq,null!=t.body.online_count&&0!=t.body.online_count&&this.ut.actionListener("roomOnlineUserCountUpdate",this._room.roomID,t.body.online_count)},Zi.prototype.resetUserHandler=function(){this._userQuerying=!1,this._lastUserQueryTime=0,this._userTempList=[],this._userSeq=0,this._minUserSeq=0,this._userList=void 0,this._userSeqMergeMap={},this._userSeqMergeTimer=void 0,this._userQueryTimer=void 0,this._userListInterval=3e4,this._userListMergeInterval=5e3,this._anchor_info={anchor_id:"",anchor_id_name:"",anchor_nick_name:""}},Zi.prototype.fetchUserList=function(t){this._userQuerying?this.ot.warn(yt+" is already querying"):(this._userQuerying=!0,this._userTempList=[],this.fetchUserListWithPage(0,t||0),this.ot.info(yt+" the first time call"))},Zi.prototype.fetchUserListWithPage=function(t,i){function n(t){e.handleFetchUserListRsp(t,i)}var e=this,s={user_index:t,sort_type:0},r=_i;this.ut.reporter.createSpan(u.H,{key:Ft.event,par:this._room.roomID},{key:r.event,par:this._room.roomID},r.event,!0).setAttribute("user_index",r.user_index(t)),null!=(r=this._liveRoomHandler)&&r.fetchUserList(s,n,n,this._room)},Zi.prototype.handleFetchUserListRsp=function(t,i){var n=this;if(this.ut.reporter.spanEnd({key:_i.event,par:this._room.roomID},{error:(null==(e=null==t?void 0:t.body)?void 0:e.err_code)||(null==t?void 0:t.code),message:(null==(e=null==t?void 0:t.body)?void 0:e.err_message)||(null==t?void 0:t.msg)}),t.body&&0!=t.body.err_code)this._userQuerying=!1,this._lastUserQueryTime=Date.now()+this._userListInterval,this.ot.info(Tt+" fetch error "+t.body.err_code);else if(t.header&&t.body)if(this._room.userStateUpdate){this._userTempList=Wi(Wi([],this._userTempList,!0),t.body.user_baseinfos,!0);var e=t.body.ret_user_index;if(e!=t.body.server_user_index)this.ot.info(Tt+" fetch another page"),this.fetchUserListWithPage(e+1,i);else{this._userSeq=t.body.server_user_seq;for(var s=[],r=[],u=0;u<this._userTempList.length;u++){var h={userID:this._userTempList[u].id_name,userName:this._userTempList[u].nick_name,role:this._userTempList[u].role};4!==h.role&&(s.push(h),r.push({idName:this._userTempList[u].id_name,nickName:this._userTempList[u].nick_name,role:this._userTempList[u].role}))}if(this.ut.actionListener("_getTotalUserList",this._room.roomID,r),i==o.login){if(this._userList){var a=this._userList,c=s;i=function(t,i){0!==t.length&&n.onUserStateUpdate(n._room.roomID,"ADD",t),0!==i.length&&n.onUserStateUpdate(n._room.roomID,"DELETE",i)},(e=this.ot).debug("msl.0 call");var l=[],f=[];c=c||[];for(var _=0;_<c.length;_++){for(var d=!1,m=0;m<a.length;m++)if(c[_].userID===a[m].userID){d=!0;break}d||l.push(c[_])}for(var v=0;v<a.length;v++){d=!1;for(var p=0;p<c.length;p++)if(a[v].userID===c[p].userID){d=!0;break}d||f.push(a[v])}for(a.splice(0),_=0;_<c.length;_++)a.push(a[_]);i(l,f),e.debug("msl.0 call success")}this._userList=s}else 0!==(this._userList=s).length&&this.onUserStateUpdate(this._room.roomID,"ADD",s);this._userQuerying=!1,this._lastUserQueryTime=Date.now()+this._userListInterval,this._userTempList=[],this.ot.info(Tt+" call success user_list "+s+", count: "+s.length+", seq: "+this._userSeq)}}else this.ot.info(Tt+" not update");else this._userQuerying=!1,this._lastUserQueryTime=Date.now()+this._userListInterval,this.ot.info(Tt+" fetch error "+t)},Zi.prototype.handlePushUserStateUpdateMsg=function(t){if(this.ot.info(wt+" call"),this._room.userStateUpdate)if(this._userSeq===t.body.user_list_seq)this.ot.warn(wt+" user_list_seq is the same with local seq");else if(this._userSeq+t.body.user_actions.length!==t.body.user_list_seq)this.mergeUserByUserSeq(t.body.user_list_seq,t.body.user_actions);else{this._userSeq=t.body.user_list_seq;for(var i=[],n=0;n<t.body.user_actions.length;n++){var e={action:t.body.user_actions[n].Action,idName:t.body.user_actions[n].IdName,nickName:t.body.user_actions[n].NickName,role:t.body.user_actions[n].Role,loginTime:t.body.user_actions[n].LoginTime};4!==e.role&&i.push(e)}this.ut.actionListener("_userStateUpdate",t.body.room_id,i);var s=[],r=[];i.forEach((function(t){1==t.action?s.push({userID:t.idName,userName:t.nickName,role:t.role}):2==t.action&&r.push({userID:t.idName,userName:t.nickName,role:t.role})})),this._userList&&(this._userList=this._userList.concat(s).filter((function(t){return!r.some((function(i){return i.userID==t.userID}))}))),0!==s.length&&this.onUserStateUpdate(t.body.room_id,"ADD",s),0!==r.length&&this.onUserStateUpdate(t.body.room_id,"DELETE",r),this.ot.info(wt+" call success")}else this.ot.info(wt+" userStateUpdate is false")},Zi.prototype.onUserStateUpdate=function(t,i,n){var e=this;n=n.filter((function(t){return t.userID!==e.ut.idName})),0!=n.length&&(n=n.map((function(t){return{userID:t.userID,userName:t.userName}})),this.ut.actionListener("roomUserUpdate",t,i,n))},Zi.prototype.mergeUserByUserSeq=function(t,i){var n=this;this._userSeqMergeMap||(this.ot.warn(It+" new merge userlist "+this._userSeq+" server "+t),this._userSeqMergeMap={},this._userSeqMergeTimer&&clearTimeout(this._userSeqMergeTimer),this._userSeqMergeTimer=setTimeout((function(){n.handleMergeTimeout()}),this._userListMergeInterval)),this._userSeqMergeMap[t]=i,this.ot.warn(It+"  merge userlist "+this._userSeq+" server "+t+" userlist "+i.length)},Zi.prototype.mergeUser=function(t){var i=this,n=(this.ot.info("zm.us.mg merge userlist "+this._userSeq+" userSeqList "+t.join(",")),this._userSeq=t[t.length-1],this._lastUserQueryTime=Date.now()+this._userListInterval,{}),e=((t.forEach((function(t){i._userSeqMergeMap&&i._userSeqMergeMap[t].forEach((function(t){n[t.IdName]=t}))})),this._userSeqMergeMap=null,t=Object.values(n).map((function(t){return{action:t.Action,idName:t.IdName,nickName:t.NickName,role:t.Role,loginTime:t.LoginTime?String(t.LoginTime):""}})).filter((function(t){return 4!==t.role}))).sort((function(t,i){return t.loginTime.localeCompare(i.loginTime)})),[]),s=[];t.forEach((function(t){1==t.action?e.push({userID:t.idName,userName:t.nickName,role:t.role}):2==t.action&&s.push({userID:t.idName,userName:t.nickName,role:t.role})})),this._userList=this._userList&&this._userList.concat(e).filter((function(t){return!s.some((function(i){return i.userID==t.userID}))})),0!==e.length&&this.onUserStateUpdate(this._room.roomID,"ADD",e),0!==s.length&&this.onUserStateUpdate(this._room.roomID,"DELETE",s),this.ut.actionListener("_userStateUpdate",this._room.roomID,t)},Zi.prototype.handleMergeTimeout=function(){var t,i=this,n=Object.keys(this._userSeqMergeMap).map((function(t){return+t})).sort((function(t,i){return t-i}));n[n.length-1]-n[0]+1===n.length||n[n.length-1]>=this._minUserSeq?this.mergeUser(n):(this._userSeqMergeMap=null,t=this._lastUserQueryTime-Date.now(),this.ot.info("zm.us.mto  fetch merge userlist "+this._userSeq+" userSeqList "+n.join(",")+" wait "+t),0<t?(this._userQueryTimer&&clearTimeout(this._userQueryTimer),this._userQueryTimer=setTimeout((function(){i.fetchUserList()}),t)):this.fetchUserList())},Zi);function Zi(t,i,n,e,s,r){this.ot=t,this.ut=i,this._dataReport=n,this._liveRoomHandler=e,this._room=s,this._service=r,this._userQuerying=!1,this._userTempList=[],this._userSeq=0,this._minUserSeq=0,this._userList=[],this._userSeqMergeMap=null,this._userListInterval=3e4,this._userListMergeInterval=5e3,this._anchor_info={anchor_id:"",anchor_id_name:"",anchor_nick_name:""}}Object.defineProperty(Qi.prototype,"logger",{get:function(){return this.ot},enumerable:!1,configurable:!0}),Object.defineProperty(Qi.prototype,"stateCenter",{get:function(){return this.ut},enumerable:!1,configurable:!0}),Object.defineProperty(Qi.prototype,"liveRoomHandler",{get:function(){return this._liveRoomHandler},enumerable:!1,configurable:!0}),Object.defineProperty(Qi.prototype,"_isUseNetAgent",{get:function(){return this.ut.useNetAgent},enumerable:!1,configurable:!0}),Object.defineProperty(Qi.prototype,"sessionExist",{get:function(){return null!==this.longSid||"0"!==this.sessionID},enumerable:!1,configurable:!0}),Object.defineProperty(Qi.prototype,"roomSidString",{get:function(){return this.longRoomSid?this.longRoomSid.toString():"0"},enumerable:!1,configurable:!0}),Object.defineProperty(Qi.prototype,"userSidString",{get:function(){return this.longSid?this.longSid.toString():"0"},enumerable:!1,configurable:!0}),Qi.prototype.initMessageHandler=function(){},Qi.prototype.initLiveHandler=function(){},Qi.prototype.init=function(){this.bindHeatBeatHandler(),this.bindRoomHandler(),this.bindMessageHandler(),this.bindLiveHandler()},Qi.prototype.bindHeatBeatHandler=function(){var t=this;this.heartBeatHandler.hbLogout=function(i){t.roomHandler.handleHbLogout(i)},this.heartBeatHandler.heartbeatRspNotiFy=function(i,n){t.messageHandler&&t.messageHandler.loginRsp(i),t.userHandler.patchUserList(i),t._HBResponse(i,n)}},Qi.prototype.bindRoomHandler=function(){var t=this;this.roomHandler.loginSuccessCallBack=function(i,n){t.ot.info("zm.lrm.brh login suc "+i),t.heartBeatHandler.init(n),t._liveRoomHandler.startCheck(),t.userHandler.loginRsp(n,i),t.messageHandler&&t.messageHandler.loginRsp(n),t.isMulti||t.Ot(),t.yt(n)},this.roomHandler.resetRoomCallBack=function(){t.heartBeatHandler.resetHeartbeat(),t.liveHandler&&t.liveHandler.resetLiveHandler(),t.messageHandler&&t.messageHandler.resetMessageInfo(),t._isUseNetAgent&&t._liveRoomHandler&&t._liveRoomHandler.stopCheck(),t.userHandler.resetUserHandler(),t.roomTryHandler&&(t.roomTryHandler.invalid(),t.roomTryHandler.stopMaxTime())}},Qi.prototype.bindUserHandler=function(){},Qi.prototype.bindMessageHandler=function(){},Qi.prototype.bindLiveHandler=function(){},Qi.prototype._HBResponse=function(t,i){this.ut.actionListener("HBResponse",t,i)},Qi.prototype.yt=function(t){this.ut.actionListener("roomLoginResponse",t)},Qi.prototype.checkRoomSession=function(t){return null!==this.longRoomSid&&this.longRoomSid.eq(t)},Qi.prototype.Ot=function(){var t=this;this.ut.roomModulesList.forEach((function(i){var n=i.roomTryHandler;i.runState!==o.login&&n&&1==i.isMulti&&(n.onactive=function(n,e){var s;e&&0!==e.code?((s=F(e.code,t._isUseNetAgent))&&C[s]&&(e=C[s]),i.roomHandler._roomStateHandle("DISCONNECTED",y.ReconnectFailed,e,e.msg)):i.roomHandler._roomStateHandle("CONNECTED",y.Reconnected,e)},n.retryLoginRoom())}))},Qi.prototype.isLogin=function(){return this.runState===o.login},Qi.prototype.isLogout=function(){return this.runState===o.logout},Qi.prototype.isTryLogin=function(){return this.runState===o.trylogin},Qi.prototype.isDisConnect=function(){return this._liveRoomHandler.isDisConnect()},Qi.prototype.retryConnect=function(){this.ot.info("zm.lrm.rc call"),this._isUseNetAgent&&(this.resetSessionInfo(),this._liveRoomHandler.closeRequest())},Qi.prototype.retryRoom=function(t,i){void 0===i&&(i=!1),this.ot.info("zm.lrm.rr.0 call retryNow:".concat(t=void 0!==t&&t,", resetSession:").concat(i));var n=this.roomTryHandler;n&&this.rtm.isUaConnect&&n.retryLoginRoom(t,i)},Qi.prototype.resetSessionInfo=function(){var t;this.ot.info("zm.lrm.rsi call"),this.resetRoomSession(),this.resetUserSession(),null!=(t=this._liveRoomHandler)&&t.reset()},Qi.prototype.resetRoomSession=function(){this.roomSessionID="0",this.longRoomSid=null},Qi.prototype.resetUserSession=function(){this.sessionID="0",this.longSid=null};var Ki=Qi;function Qi(t,i,n,e,s,r,u){this.roomID=t,this.ut=i,this.ot=n,this.dataReport=e,this.rtm=s,this._liveRoomHandler=r,this.service=u,this.runState=o.logout,this.lastRunState=o.logout,this.lastRoomState="DISCONNECTED",this.roomState="DISCONNECTED",this.roomReasonState=y.Logout,this.roomSessionID="0",this.sessionID="0",this.longSid=null,this.longRoomSid=null,this.isMulti=!1,this.token="",this.thirdToken="",this.loginTime=0,this.userStateUpdate=!1,this.maxMemberCount=0,this.roomName="",this.isCancelLogin=!1,this.roomHandler=new Yi(this.ot,this.ut,this.dataReport,this,r,this.service),this.heartBeatHandler=new qi(this.ot,this.ut,this.dataReport,this._liveRoomHandler,this,this.service),this.userHandler=new Xi(this.ot,this.ut,this.dataReport,this._liveRoomHandler,this,this.service),this.initMessageHandler(),this.initLiveHandler(),this.init()}var tn=function(){},nn=(Object.defineProperty(en.prototype,"ht",{get:function(){return this.ut.reporter},enumerable:!1,configurable:!0}),Object.defineProperty(en.prototype,"logger",{get:function(){return this.ot},enumerable:!1,configurable:!0}),Object.defineProperty(en.prototype,"stateCenter",{get:function(){return this.ut},enumerable:!1,configurable:!0}),en.prototype.checkResponse=function(t){return!1},en.prototype.handleSendCommandMsgRsp=function(t){},en.prototype.onPush=function(){},en.prototype.handlePushKickout=function(t){},en.prototype.handlePushCustomMsg=function(t){},en.prototype.handlePushRoomMsg=function(t){},en.prototype.handlePushUserStateUpdateMsg=function(t){},en.prototype.handlePushMergeMsg=function(t){},en.prototype.handlePushTransMsg=function(t){},en.prototype.handleBigImMsgRsp=function(t){},en.prototype.handlePushSignalMsg=function(t){},en.prototype.handlePushTokenExpire=function(t){},en.prototype.closeHandler=function(t){},en.prototype.openHandler=function(t){},en.prototype.errorHandler=function(t){},en.prototype.getHeader=function(t,i,n,e){return{Protocol:"req",cmd:t,appid:this.ut.appid,seq:++this.cmdSeq,user_id:this.ut.userid,session_id:i||"",room_id:n||"",room_session_id:e||"",biz_version:this.ut.bizVersion||""}},en.prototype.startCheck=function(){},en.prototype.stopCheck=function(){},en.prototype.isDisConnect=function(){return!1},en.prototype.createSocket=function(t){},en.prototype.closeSocket=function(){},en.prototype.sendMessage=function(t,i,n,e,s,r,o){return 0},en.prototype.on=function(t,i){},en.prototype.login=function(t,i,n){return-1},en.prototype.logout=function(t,i,n){return-1},en.prototype.heartBeat=function(t,i,n,e){return-1},en.prototype.fetchUserList=function(t,i,n,e){return this.sendMessage("user_list",t,i,n,void 0,e)},en.prototype.fetchUserListV2=function(t,i,n,e){return this.sendMessage("user_list_v2",t,i,n,void 0,e)},en.prototype.fetchReliableMessage=function(t,i,n,e){return this.sendMessage("trans_fetch",t,i,n,void 0,e)},en.prototype.fetchUserTransInfo=function(t,i,n,e){return-1},en.prototype.sendReliableMessage=function(t,i,n,e){return this.sendMessage("trans",t,i,n,void 0,e)},en.prototype.sendRoomMsg=function(t,i,n,e){return this.sendMessage("im_chat",t,i,n,void 0,e)},en.prototype.sendCustomCommand=function(t,i,n,e){return this.sendMessage("custommsg",t,i,n,void 0,e)},en.prototype.sendBigRoomMessage=function(t,i,n,e){return this.sendMessage("bigim_chat",t,i,n,void 0,e)},en.prototype.sendRelayMessage=function(t,i,n,e){return this.sendMessage("relay",t,i,n,void 0,e)},en.prototype.sendSignalCmd=function(t,i,n,e){return this.sendMessage("signal",t,i,n,void 0,e)},en.prototype.sendPB=function(t){return!1},en);function en(t,i,n){this.ut=t,this.ot=i,this.rtm=n,this.cmdSeq=0,this.responseRouters={},this.service=new tn(this.ut.ENV)}for(var sn=n(3),rn=(i=n(1),sn.util.Long=i,sn.util.Long.fromBits=sn.util.Long?sn.util.Long.fromBits:function(){return 0},sn.roots),on=sn.types?sn.types.basic:{double:1,float:5,int32:0,uint32:0,sint32:0,fixed32:5,sfixed32:5,int64:0,uint64:0,sint64:0,fixed64:1,sfixed64:1,bool:0,string:2,bytes:2},un=sn.types?sn.types.packed:{double:1,float:5,int32:0,uint32:0,sint32:0,fixed32:5,sfixed32:5,int64:0,uint64:0,sint64:0,fixed64:1,sfixed64:1,bool:0},hn=Object.keys(on),an={$:function(t){return an[t]?an[t].call(this):rn[t].decode?rn[t].decode(this,this.uint32()):an.$.call(this,"int32")}},cn={$:function(t,i,n){var e=on[t];return void 0===e?rn[t].encode?(this.uint32((n<<3|2)>>0).fork(),rn[t].encode(i,this).ldelim()):cn.$.call(this,"int32",i,n):cn[t].call(this.uint32(n<<3|e),i)}},ln=0;ln<hn.length;ln++)an[hn[ln]]=sn.Reader.prototype[hn[ln]],cn[hn[ln]]=sn.Writer.prototype[hn[ln]];!function t(i,n,e,s){for(var r=0,o=Object.keys(i);r<o.length;r++){var u=o[r];if(i[u].$m&&Object.keys(i[u].$m).every((function(t){return Number(t)}))){if(e[u])throw Error(`nested type ${e}.${u} has already exist`);e[u]=function(i,e){function s(t){for(var n in i)"{"===(n=i[n])[1].charAt(0)?this[n[0]]={}:"["!==n[1].charAt(0)&&"<"!==n[1].charAt(0)||(this[n[0]]=[]);if(t)for(var e=Object.keys(t),s=0;s<e.length;++s)null!=t[e[s]]&&(this[e[s]]=t[e[s]])}var r,o={};for(r in i){var u=i[r],h=u[1];"{"===h.charAt(0)?(s.prototype[u[0]]=sn.util.emptyObject,o[h]={$m:h.substring(1).split(",").map((function(t,i){return["$"+(i+1),t,null]})).reduce((function(t,i,n){return t[n+1]=i,t}),{})}):s.prototype[u[0]]="["===h.charAt(0)||"<"===h.charAt(0)?sn.util.emptyArray:"bytes"===h?sn.util.newBuffer([]):u[2]&&u[2].hasOwnProperty("low")&&u[2].hasOwnProperty("high")?sn.util.Long.fromBits(u[2].low,u[2].high,u[2].unsigned):u[2]}return s.create=function(t){return new s(t)},s.decode=function(t,n){t instanceof sn.Reader||(t=sn.Reader.create(t));for(var e=void 0===n?t.len:t.pos+n,r=new s;t.pos<e;){var o=t.uint32();if(0<(a=o>>>3)&&i[a]){var u=i[a][0];if("{"===(h=i[a][1]).charAt(0))r[u]===sn.util.emptyObject&&(r[u]={}),a=s.$namespace[h].decode(t,t.uint32()),r[u][a.$1]=a.$2;else if("["===h.charAt(0)||"<"===h.charAt(0)){h=h.substring(1),r[u]&&r[u].length||(r[u]=[]);var h,a=!an[h]&&!rn[h].decode;if(void 0!==un[h=a?"int32":h]&&2==(7&o))for(var c=t.uint32()+t.pos;t.pos<c;)r[u].push(an.$.call(t,h));else r[u].push(an.$.call(t,h))}else r[u]=an.$.call(t,h)}else t.skipType(7&o)}return r},s.encode=function(t,n){for(var e in n=n||sn.Writer.create(),i){var r=i[e][0];if("{"===(c=i[e][1]).charAt(0)){if(null!=t[r]&&t.hasOwnProperty(r))for(var o=0,u=Object.keys(t[r]);o<u.length;++o)n.uint32((e<<3|2)>>0).fork(),s.$namespace[c].encode({$1:u[o],$2:t[r][u[o]]},n).ldelim()}else if("["===c.charAt(0)||"<"===c.charAt(0)){var h="<"===c.charAt(0),a=(c=c.substring(1),t[r]);if(null!=a&&a.length){var c=void 0!==on[c]||rn[c].encode?c:"int32";if(h&&void 0!==un[c]){for(n.uint32((e<<3|2)>>0).fork(),o=0;o<a.length;o++)cn[c].call(n,a[o]);n.ldelim()}else for(o=0;o<a.length;o++)cn.$.call(n,c,a[o],e)}}else null!=t[r]&&t.hasOwnProperty(r)&&cn.$.call(n,c,t[r],e)}return n},Object.keys(o).length&&(s.$namespace=t(o,n+"."+e,s.$namespace||{},!0)),s}(i[u].$m,u)}else i[u].$s?e[u]=function(t,i){function e(t,i,n){sn.rpc.Service.call(this,t,i,n)}return((e.prototype=Object.create(sn.rpc.Service.prototype)).constructor=e).create=function(t,i,n){return new e(t,i,n)},Object.keys(t).forEach((function(s){var r=t[s];function o(t,i){return this.rpcCall(o,rn[r[0]],rn[r[1]],t,i)}Object.defineProperty(o,"name",{value:s}),Object.defineProperty(o,"path",{value:n+"."+i}),e.prototype[s]=o})),e}(i[u].$s,u):i[u].$e&&Object.values(i[u].$e).every((function(t){return Number(t)===t}))&&(e[u]=function(t){for(var i=Object.keys(t),n={},e=0;e<i.length;e++)n[n[i[e]]=t[i[e]]]=i[e];return n}(i[u].$e));e[u]&&!s&&(rn[n+"."+u]=e[u]),delete i[u].$m,delete i[u].$s,delete i[u].$e,e[u]=t(i[u],n?n+"."+u:u,e[u]||{})}return e}({liveroom:{liveroom_cs_v3:{AddStreamReq:{$m:{1:["stream_id","bytes",[]],2:["stream_title","bytes",[]],3:["stream_type","uint32",0],4:["stream_attr","bytes",[]],5:["extra_info","bytes",[]],6:["client_req_seq","uint32",0],7:["third_token","bytes",[]],8:["censor_mode","uint32",0],9:["need_gather","uint32",0],10:["sdk_custom_info","bytes",[]],11:["stream_attr_opts","liveroom.liveroom_cs_v3.StreamAttrOptions",null]}},AddStreamRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null],2:["stream_seq","uint32",0],3:["stream_sid","string",""],4:["stream_ver","uint32",0],5:["stream_nid","uint32",0],6:["token_remain_time","uint32",0]}},AnchorInfo:{$m:{1:["id_name","bytes",[]],2:["user_id","uint64",{low:0,high:0,unsigned:!0}],3:["nick_name","bytes",[]]}},BigImData:{$m:{1:["id_name","bytes",[]],2:["nick_name","bytes",[]],3:["role","uint32",0],4:["msg_id","bytes",[]],5:["msg_category","uint32",0],6:["msg_type","uint32",0],7:["msg_content","bytes",[]],8:["msg_timestamp","int64",{low:0,high:0,unsigned:!1}]}},Capabilities:{$m:{1:["video_codec","uint32",0],2:["gop_mode","uint32",0]}},CommonRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null]}},DeleteStreamReq:{$m:{1:["stream_sid","string",""],2:["stream_id","bytes",[]],3:["client_req_seq","uint32",0]}},DeleteStreamRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null],2:["stream_seq","uint32",0],3:["stream_ver","uint32",0]}},EnterRoomReq:{$m:{1:["net_type","uint32",0],2:["conn_type","uint32",0],3:["room_id","bytes",[]],4:["room_name","bytes",[]],5:["role","uint32",0],6:["third_token","bytes",[]],7:["room_create_flag","uint32",0],8:["user_state_flag","uint32",0],9:["user_count_limit","uint32",0],10:["relate_service","string",""],11:["need_gather_stream","uint32",0],12:["callback_data","bytes",[]],13:["service_flags","uint32",0],14:["license_token","bytes",[]],15:["user_session_id","uint64",{low:0,high:0,unsigned:!0}],16:["capabilities","liveroom.liveroom_cs_v3.Capabilities",null]}},EnterRoomRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null],2:["user_session_id","uint64",{low:0,high:0,unsigned:!0}],3:["room_session_id","uint64",{low:0,high:0,unsigned:!0}],4:["user_id","uint64",{low:0,high:0,unsigned:!0}],5:["ret_timestamp","int64",{low:0,high:0,unsigned:!1}],6:["big_im_time_window","uint32",0],7:["liveroom_hb_interval","uint32",0],8:["liveroom_hb_timeout","uint32",0],9:["online_count","uint32",0],10:["anchor_info","liveroom.liveroom_cs_v3.AnchorInfo",null],11:["userlist_merge_timeout","uint32",0],12:["userlist_interval","uint32",0],13:["token_remain_time","uint32",0],14:["trans_list_seq","uint32",0],15:["trans_channel_list","<liveroom.liveroom_cs_v3.TransChannel",null],16:["stream_count","uint32",0],17:["stream_list_seq","uint32",0],18:["stream_info_list","<liveroom.liveroom_cs_v3.StreamInfo",null],19:["stream_fetch_flag","uint32",0],20:["stream_list_push_merge_timeout","uint32",0],21:["stream_list_hb_merge_timeout","uint32",0],22:["relate_result_list","<liveroom.liveroom_cs_v3.RelateResult",null],23:["gather_list_seq","uint32",0],24:["gather_info_list","<liveroom.liveroom_cs_v3.GatherInfo",null]}},EnumSignalTransmitResult:{$e:{ok:0,version_err:1}},EnumSignalTransparentMsgType:{$e:{SignalTransparentMsgTypeSDK:0,SignalTransparentMsgTypeServer:1,SignalTransparentMsgTypeBoth:2}},GatherInfo:{$m:{1:["gather_id","string",""]}},GetCapabilityReq:{$m:{}},GetCapabilityRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null],2:["capability_seq","int64",{low:0,high:0,unsigned:!1}],3:["capabilities","liveroom.liveroom_cs_v3.Capabilities",null]}},GetGatherListReq:{$m:{}},GetGatherListRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null],2:["gather_list_seq","uint32",0],3:["gather_info_list","<liveroom.liveroom_cs_v3.GatherInfo",null]}},GetImReq:{$m:{1:["msg_id","uint64",{low:0,high:0,unsigned:!0}],2:["sort_type","uint32",0],3:["msg_count","uint32",0]}},GetImRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null],2:["server_msg_id","uint64",{low:0,high:0,unsigned:!0}],3:["ret_msg_id","uint64",{low:0,high:0,unsigned:!0}],4:["msg_list","<liveroom.liveroom_cs_v3.GetImRspImData",null]}},GetImRspImData:{$m:{1:["id_name","bytes",[]],2:["nick_name","bytes",[]],3:["role","uint32",0],4:["msg_id","uint64",{low:0,high:0,unsigned:!0}],5:["msg_category","uint32",0],6:["msg_type","uint32",0],7:["msg_content","bytes",[]],8:["send_time","int64",{low:0,high:0,unsigned:!1}]}},GetStreamListReq:{$m:{}},GetStreamListRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null],2:["stream_list_seq","uint32",0],3:["stream_info_list","<liveroom.liveroom_cs_v3.StreamInfo",null],4:["stream_refresh","uint32",0]}},GetTransReq:{$m:{1:["trans_channel","bytes",[]],2:["trans_list","<liveroom.liveroom_cs_v3.GetTransReqTransData",null]}},GetTransReqTransData:{$m:{1:["trans_type","bytes",[]],2:["trans_local_seq","uint32",0]}},GetTransRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null],2:["trans_channel","bytes",[]],3:["trans_list_seq","uint32",0],4:["trans_list","<liveroom.liveroom_cs_v3.GetTransRspTransData",null]}},GetTransRspTransData:{$m:{1:["err_code","uint32",0],2:["trans_type","bytes",[]],3:["trans_data","bytes",[]],4:["trans_send_time","int64",{low:0,high:0,unsigned:!1}],5:["trans_seq","uint32",0],6:["id_name","bytes",[]],7:["nick_name","bytes",[]],8:["role","uint32",0]}},GetUserlistReq:{$m:{1:["sort_type","uint32",0],2:["user_index","uint32",0]}},GetUserlistRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null],2:["server_user_seq","uint64",{low:0,high:0,unsigned:!0}],3:["server_user_index","int64",{low:0,high:0,unsigned:!1}],4:["ret_user_index","int64",{low:0,high:0,unsigned:!1}],5:["user_base_info_list","<liveroom.liveroom_cs_v3.UserBaseInfo",null]}},GetUserTransReq:{$m:{1:["trans_channel","bytes",[]],2:["user_trans_list","<liveroom.liveroom_cs_v3.GetUserTransReqTransData",null]}},GetUserTransReqTransData:{$m:{1:["trans_type","bytes",[]],2:["trans_local_seq","uint32",0]}},GetUserTransRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null],2:["trans_channel","bytes",[]],3:["user_trans_list","<liveroom.liveroom_cs_v3.GetUserTransRspTransData",null]}},GetUserTransRspTransData:{$m:{1:["err_code","uint32",0],2:["trans_type","bytes",[]],3:["trans_data","bytes",[]],4:["trans_send_time","int64",{low:0,high:0,unsigned:!1}],5:["trans_seq","uint32",0],6:["id_name","bytes",[]],7:["nick_name","bytes",[]],8:["role","uint32",0]}},HbReq:{$m:{}},HbRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null],2:["ret_timestamp","int64",{low:0,high:0,unsigned:!1}],3:["hb_interval","uint32",0],4:["hb_timeout","uint32",0],5:["stream_seq","uint32",0],6:["user_seq","int64",{low:0,high:0,unsigned:!1}],7:["online_count","uint32",0],8:["big_im_time_window","uint32",0],9:["trans_channel_list","<liveroom.liveroom_cs_v3.TransChannel",null],10:["user_trans_channel_list","<liveroom.liveroom_cs_v3.TransChannel",null],11:["stream_refresh","uint32",0],12:["trans_list_seq","uint32",0],13:["gather_list_seq","uint32",0],14:["capability_seq","int64",{low:0,high:0,unsigned:!1}]}},ImData:{$m:{1:["id_name","bytes",[]],2:["nick_name","bytes",[]],3:["role","uint32",0],4:["msg_id","uint64",{low:0,high:0,unsigned:!0}],5:["msg_category","uint32",0],6:["msg_type","uint32",0],7:["msg_content","bytes",[]],8:["send_time","int64",{low:0,high:0,unsigned:!1}]}},LiveroomSessionInfo:{$m:{1:["RoomId","bytes",[]],2:["UserSessionId","uint64",{low:0,high:0,unsigned:!0}],3:["RoomSessionId","uint64",{low:0,high:0,unsigned:!0}],4:["Role","uint32",0]}},PushBigIm:{$m:{1:["msg_list","<liveroom.liveroom_cs_v3.BigImData",null]}},PushCapabilityChange:{$m:{1:["capability_seq","int64",{low:0,high:0,unsigned:!1}],2:["capabilities","liveroom.liveroom_cs_v3.Capabilities",null]}},PushIm:{$m:{1:["server_msg_id","uint64",{low:0,high:0,unsigned:!0}],2:["ret_msg_id","uint64",{low:0,high:0,unsigned:!0}],4:["msg_list","<liveroom.liveroom_cs_v3.ImData",null]}},PushStartGather:{$m:{1:["gather_id","string",""],2:["gather_seq","uint32",0]}},PushStopGather:{$m:{1:["gather_id","string",""],2:["gather_seq","uint32",0]}},PushStream:{$m:{1:["stream_seq","uint32",0],2:["stream_info_list","<liveroom.liveroom_cs_v3.PushStreamInfo",null]}},PushStreamInfo:{$m:{1:["stream_id","bytes",[]],2:["stream_sid","string",""],3:["id_name","bytes",[]],4:["nick_name","bytes",[]],5:["stream_title","bytes",[]],6:["stream_ver","uint32",0],7:["stream_attr","bytes",[]],8:["stream_src","uint32",0],9:["stream_state","uint32",0],10:["stream_type","uint32",0],11:["stream_nid","uint32",0],12:["extra_info","bytes",[]],13:["create_time","int64",{low:0,high:0,unsigned:!1}],14:["close_type","uint32",0],15:["need_gather","uint32",0],16:["sdk_custom_info","bytes",[]],17:["stream_attr_opts","liveroom.liveroom_cs_v3.StreamAttrOptions",null]}},PushTrans:{$m:{1:["id_name","bytes",[]],2:["nick_name","bytes",[]],3:["role","uint32",0],4:["trans_type","bytes",[]],5:["trans_data","bytes",[]],6:["trans_seq","uint32",0],7:["trans_send_time","int64",{low:0,high:0,unsigned:!1}],8:["trans_channel","bytes",[]],9:["trans_list_seq","uint32",0]}},PushTransparentMsg:{$m:{1:["msg_data","bytes",[]],2:["client_seq","uint64",{low:0,high:0,unsigned:!0}],3:["sender_idname","bytes",[]],4:["sender_nickname","bytes",[]]}},PushUserInfoUpdated:{$m:{1:["server_user_seq","int64",{low:0,high:0,unsigned:!1}],2:["user_action_list","<liveroom.liveroom_cs_v3.UserAction",null]}},PushUserKickout:{$m:{1:["id_name","bytes",[]],2:["user_session_id","uint64",{low:0,high:0,unsigned:!0}],3:["kickout_reason","int32",0],4:["custom_reason","bytes",[]]}},PushUserLogReport:{$m:{}},PushUserTokenExpire:{$m:{1:["token","string",""],2:["stop_stream_info","liveroom.liveroom_cs_v3.StopStream",null]}},PushUserTrans:{$m:{1:["id_name","bytes",[]],2:["nick_name","bytes",[]],3:["role","uint32",0],4:["trans_send_time","int64",{low:0,high:0,unsigned:!1}],5:["trans_channel","bytes",[]],6:["trans_seq_list","<liveroom.liveroom_cs_v3.PushUserTransInfo",null]}},PushUserTransInfo:{$m:{1:["trans_type","bytes",[]],2:["trans_data","bytes",[]],3:["trans_seq","uint32",0]}},QuitRoomReq:{$m:{}},QuitRoomRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null]}},RelateResult:{$m:{1:["service","string",""],2:["relate_result","uint32",0]}},RenewTokenReq:{$m:{1:["token","string",""]}},RenewTokenRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null],2:["token_remain_time","uint32",0],3:["stop_stream_id_list","<bytes",null]}},RspHead:{$m:{1:["code","uint32",0],2:["message","string",""]}},SendBigImReq:{$m:{1:["msg_list","<liveroom.liveroom_cs_v3.SendBigImReqMsgData",null]}},SendBigImReqMsgData:{$m:{1:["msg_category","uint32",0],2:["msg_type","uint32",0],3:["msg_content","bytes",[]],4:["msg_timestamp","int64",{low:0,high:0,unsigned:!1}],5:["msg_client_id","bytes",[]]}},SendBigImRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null],2:["big_im_time_window","uint32",0],3:["msg_list","<liveroom.liveroom_cs_v3.SendBigImRspMsgData",null]}},SendBigImRspMsgData:{$m:{1:["msg_id","bytes",[]],2:["msg_client_id","bytes",[]]}},SendImReq:{$m:{1:["msg_category","uint32",0],2:["msg_type","uint32",0],3:["msg_content","bytes",[]],4:["to_user_list","<liveroom.liveroom_cs_v3.ToUser",null]}},SendImRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null],2:["msg_id","uint64",{low:0,high:0,unsigned:!0}]}},SetTransReq:{$m:{1:["trans_type","bytes",[]],2:["trans_data","bytes",[]],3:["trans_local_seq","uint32",0],4:["trans_channel","bytes",[]]}},SetTransRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null],2:["trans_type","bytes",[]],3:["trans_seq","uint32",0],4:["trans_list_seq","uint32",0],5:["trans_channel","bytes",[]]}},SetUserAttrReq:{$m:{1:["use_data_channel","uint32",0],2:["is_modify_use_data_channel","bool",!1],3:["user_type","uint32",0],4:["is_modify_user_type","bool",!1]}},SetUserAttrRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null]}},SignalLiveCustomReq:{$m:{1:["push_message","bytes",[]],2:["to_user_list","<liveroom.liveroom_cs_v3.ToUser",null]}},SignalLiveCustomRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null]}},SignalLiveInviteReq:{$m:{1:["push_message","bytes",[]],2:["to_user_list","<liveroom.liveroom_cs_v3.ToUser",null]}},SignalLiveInviteRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null]}},SignalLiveRequestReq:{$m:{1:["push_message","bytes",[]],2:["to_user_list","<liveroom.liveroom_cs_v3.ToUser",null]}},SignalLiveRequestRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null]}},SignalLiveResultReq:{$m:{1:["push_message","bytes",[]],2:["to_user_list","<liveroom.liveroom_cs_v3.ToUser",null]}},SignalLiveResultRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null]}},SignalLiveStopReq:{$m:{1:["push_message","bytes",[]],2:["to_user_list","<liveroom.liveroom_cs_v3.ToUser",null]}},SignalLiveStopRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null]}},SignalTransmitReq:{$m:{1:["to_user_list","<bytes",null],2:["transmit_data","bytes",[]]}},SignalTransmitResult:{$m:{1:["to_user","bytes",[]],2:["result","liveroom.liveroom_cs_v3.EnumSignalTransmitResult",0]}},SignalTransmitRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null],2:["result","<liveroom.liveroom_cs_v3.SignalTransmitResult",null]}},SignalTransparentMsgReq:{$m:{1:["msg_type","liveroom.liveroom_cs_v3.EnumSignalTransparentMsgType",0],2:["msg_data","bytes",[]],3:["to_user_list","<bytes",null],4:["client_seq","uint64",{low:0,high:0,unsigned:!0}]}},SignalTransparentMsgRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null]}},StopStream:{$m:{1:["stream_id_list","<bytes",null]}},StreamAttrOptions:{$m:{1:["stream_resource","sint32",0],2:["stream_codec","sint32",0],3:["play_mode","uint32",0],4:["forbid_play_expire_time","int64",{low:0,high:0,unsigned:!1}],5:["censor_flag","int32",0]}},StreamInfo:{$m:{1:["stream_id","bytes",[]],2:["stream_sid","string",""],3:["id_name","bytes",[]],4:["nick_name","bytes",[]],5:["stream_title","bytes",[]],6:["stream_ver","uint32",0],7:["stream_attr","bytes",[]],8:["create_time","int64",{low:0,high:0,unsigned:!1}],9:["stream_src","uint32",0],10:["stream_state","uint32",0],11:["stream_type","uint32",0],12:["stream_nid","uint32",0],13:["extra_info","bytes",[]],14:["need_gather","uint32",0],15:["sdk_custom_info","bytes",[]],16:["stream_attr_opts","liveroom.liveroom_cs_v3.StreamAttrOptions",null]}},ToUser:{$m:{1:["id_name","bytes",[]],2:["user_id","uint64",{low:0,high:0,unsigned:!0}]}},TransChannel:{$m:{1:["trans_channel","bytes",[]],2:["trans_seq_list","<liveroom.liveroom_cs_v3.TransSeq",null]}},TransSeq:{$m:{1:["trans_type","bytes",[]],2:["trans_seq","uint32",0]}},UpdateStreamAttrReq:{$m:{1:["stream_id","bytes",[]],2:["client_req_seq","uint32",0],3:["update_flag","uint32",0],4:["sdk_custom_info","bytes",[]],5:["stream_attr_opts","liveroom.liveroom_cs_v3.StreamAttrOptions",null]}},UpdateStreamAttrRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null],2:["stream_seq","uint32",0]}},UpdateStreamReq:{$m:{1:["stream_sid","string",""],2:["stream_id","bytes",[]],3:["stream_title","bytes",[]],4:["stream_attr","bytes",[]],5:["extra_info","bytes",[]],6:["client_req_seq","uint32",0],7:["nick_name","bytes",[]]}},UpdateStreamRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null],2:["stream_seq","uint32",0],3:["stream_ver","uint32",0]}},UserAction:{$m:{1:["action","uint32",0],2:["id_name","bytes",[]],3:["nick_name","bytes",[]],4:["role","uint32",0],5:["login_time","int64",{low:0,high:0,unsigned:!1}]}},UserBaseInfo:{$m:{1:["id_name","bytes",[]],2:["nick_name","bytes",[]],3:["role","uint32",0]}}},proto_switch_v3:{AnchorInfo:{$m:{1:["id_name","bytes",[]],2:["user_id","uint64",{low:0,high:0,unsigned:!0}],3:["nick_name","bytes",[]]}},Capabilities:{$m:{1:["video_codec","uint32",0],2:["gop_mode","uint32",0]}},CommonRsp:{$m:{1:["rsp_head","liveroom.proto_switch_v3.RspHead",null]}},GatherInfo:{$m:{1:["gather_id","string",""]}},Header:{$m:{1:["cmd","uint32",0],2:["seq","uint32",0],3:["timestamp","int64",{low:0,high:0,unsigned:!1}],4:["controls","bytes",[]],5:["flags","bytes",[]],6:["context_key","uint32",0],101:["dev_traffic_label","bytes",[]]}},LiveroomProtoVersion:{$e:{PROTO_VERSION_NONE:0,RPOTO_V020000:131072}},LoginRoomReq:{$m:{1:["app_id","uint32",0],2:["biz_type","uint32",0],3:["room_id","bytes",[]],4:["room_name","bytes",[]],5:["role","uint32",0],6:["id_name","bytes",[]],7:["nick_name","bytes",[]],8:["device_id","string",""],9:["term_type","liveroom.proto_switch_v3.TermType",0],10:["net_type","liveroom.proto_switch_v3.NetType",0],11:["sdk_conn_type","liveroom.proto_switch_v3.SdkConnType",0],12:["sdk_version","uint32",0],13:["biz_version","string",""],14:["client_stamp","bytes",[]],15:["login_logic","uint32",0],16:["third_token","bytes",[]],17:["login_token","bytes",[]],18:["relogin_token","bytes",[]],19:["switch_session_id","uint64",{low:0,high:0,unsigned:!0}],20:["user_session_id","uint64",{low:0,high:0,unsigned:!0}],21:["room_create_flag","uint32",0],22:["user_state_flag","uint32",0],23:["user_count_limit","uint32",0],24:["relate_service","string",""],25:["need_gather_stream","uint32",0],26:["callback_data","bytes",[]],27:["service_flags","uint32",0],28:["license_token","bytes",[]],29:["relogin_type","liveroom.proto_switch_v3.ReloginType",0],30:["Capabilities","liveroom.proto_switch_v3.Capabilities",null]}},LoginRoomRsp:{$m:{1:["rsp_head","liveroom.proto_switch_v3.RspHead",null],2:["switch_session_id","uint64",{low:0,high:0,unsigned:!0}],3:["user_session_id","uint64",{low:0,high:0,unsigned:!0}],4:["room_session_id","uint64",{low:0,high:0,unsigned:!0}],5:["user_id","uint64",{low:0,high:0,unsigned:!0}],6:["ret_timestamp","int64",{low:0,high:0,unsigned:!1}],7:["big_im_time_window","uint32",0],8:["liveroom_hb_interval","uint32",0],9:["liveroom_hb_timeout","uint32",0],10:["online_count","uint32",0],11:["anchor_info","liveroom.proto_switch_v3.AnchorInfo",null],12:["relogin_token","bytes",[]],13:["userlist_merge_timeout","uint32",0],14:["userlist_interval","uint32",0],15:["token_remain_time","uint32",0],16:["trans_list_seq","uint32",0],17:["trans_channel_list","<liveroom.proto_switch_v3.TransChannel",null],18:["stream_count","uint32",0],19:["stream_list_seq","uint32",0],20:["stream_info_list","<liveroom.proto_switch_v3.StreamInfo",null],21:["stream_fetch_flag","uint32",0],22:["stream_list_push_merge_timeout","uint32",0],23:["stream_list_hb_merge_timeout","uint32",0],24:["relate_result_list","<liveroom.proto_switch_v3.RelateResult",null],25:["gather_list_seq","uint32",0],26:["gather_info_list","<liveroom.proto_switch_v3.GatherInfo",null]}},LogoutRoomReq:{$m:{2:["logout_check","bytes",[]]}},LogoutRoomRsp:{$m:{1:["rsp_head","liveroom.proto_switch_v3.RspHead",null]}},MergePushHead:{$m:{1:["qos_flag","uint32",0],2:["send_time","int64",{low:0,high:0,unsigned:!1}]}},MergePushInfo:{$m:{1:["sub_cmd","uint32",0],2:["sub_seq","uint32",0],3:["msg_body","bytes",[]]}},MergePushReq:{$m:{1:["head","liveroom.proto_switch_v3.MergePushHead",null],2:["message_list","<liveroom.proto_switch_v3.MergePushInfo",null]}},MergePushRsp:{$m:{1:["message_list","<liveroom.proto_switch_v3.MergePushRspInfo",null],2:["server_send_time","int64",{low:0,high:0,unsigned:!1}]}},MergePushRspInfo:{$m:{1:["sub_cmd","uint32",0],2:["sub_seq","uint32",0]}},NetType:{$e:{NT_NONE:0,NT_LINE:1,NT_WIFI:2,NT_2G:3,NT_3G:4,NT_4G:5,NT_UNKNOWN:32}},PushKickout:{$m:{1:["reason","uint32",0],2:["message","string",""],3:["is_need_relogin","uint32",0]}},PushReq:{$m:{1:["head","liveroom.proto_switch_v3.PushReqHead",null],2:["msg_body","bytes",[]]}},PushReqHead:{$m:{1:["sub_cmd","uint32",0],2:["qos_flag","uint32",0],3:["send_time","int64",{low:0,high:0,unsigned:!1}]}},PushRsp:{$m:{1:["code","uint32",0],2:["message","string",""],3:["sub_cmd","uint32",0],4:["server_send_time","int64",{low:0,high:0,unsigned:!1}]}},RelateResult:{$m:{1:["service","string",""],2:["relate_result","uint32",0]}},ReloginType:{$e:{ReloginType_None:0,ReloginType_SdkAuto:1}},RspHead:{$m:{1:["code","uint32",0],2:["message","string",""]}},SdkConnType:{$e:{SdkConnType_None:0,SdkConnType_Tcp:1,SdkConnType_Websocket:2}},StreamAttrOptions:{$m:{1:["stream_resource","sint32",0],2:["stream_codec","sint32",0],3:["play_mode","uint32",0],4:["forbid_play_expire_time","int64",{low:0,high:0,unsigned:!1}],5:["censor_flag","int32",0]}},StreamInfo:{$m:{1:["stream_id","bytes",[]],2:["stream_sid","string",""],3:["id_name","bytes",[]],4:["nick_name","bytes",[]],5:["create_time","int64",{low:0,high:0,unsigned:!1}],6:["extra_info","bytes",[]],7:["title","bytes",[]],8:["stream_ver","uint32",0],9:["stream_attr","bytes",[]],10:["stream_src","uint32",0],11:["stream_state","uint32",0],12:["stream_type","uint32",0],13:["stream_nid","uint32",0],14:["need_gather","uint32",0],15:["sdk_custom_info","bytes",[]],16:["stream_attr_opts","liveroom.proto_switch_v3.StreamAttrOptions",null]}},TermType:{$e:{TT_NONE:0,TT_PC:1,TT_IOS:2,TT_ANDROID:3,TT_MAC:4,TT_LINUX:5,TT_WEB:6,TT_MINI_PROGRAM:7,TT_UNKNOWN:32}},TransChannel:{$m:{1:["trans_channel","bytes",[]],2:["trans_seq_list","<liveroom.proto_switch_v3.TransSeq",null]}},TransSeq:{$m:{1:["trans_type","bytes",[]],2:["trans_seq","uint32",0]}}}}},"",rn,!1),i=rn.liveroom;var fn,_n={1002:"LoginRoomRsp",1004:"LogoutRoomRsp",1101:"PushReq",1103:"MergePushReq",1105:"PushKickout",10001:"PushUserInfoUpdated",10002:"PushUserKickout",10003:"PushUserLogReport",10004:"PushUserTokenExpire",12001:"PushStream",12002:"PushStream",12003:"PushStream",13001:"PushIm",14001:"PushBigIm",15001:"PushTrans",15002:"PushUserTrans",301002:"EnterRoomRsp",301004:"QuitRoomRsp",301006:"HbRsp",301008:"RenewTokenRsp",301012:"SetTransRsp",301014:"GetTransRsp",301016:"GetUserTransRsp",302002:"AddStreamRsp",302004:"DeleteStreamRsp",302006:"UpdateStreamRsp",302008:"GetStreamListRsp",303002:"SendImRsp",303006:"SendBigImRsp",303010:"SignalLiveRequestRsp",303012:"SignalLiveResultRsp",303014:"SignalLiveInviteRsp",303016:"SignalLiveStopRsp",303018:"SignalLiveCustomRsp",304002:"GetUserlistRsp"},dn=((dn=fn=fn||{})[dn.LoginRoomReq=1001]="LoginRoomReq",dn[dn.LoginRoomRsp=1002]="LoginRoomRsp",dn[dn.LogoutRoomReq=1003]="LogoutRoomReq",dn[dn.LogoutRoomRsp=1004]="LogoutRoomRsp",dn[dn.PushReq=1101]="PushReq",dn[dn.PushRsp=1102]="PushRsp",dn[dn.MergePushReq=1103]="MergePushReq",dn[dn.MergePushRsp=1104]="MergePushRsp",dn[dn.PushKickout=1105]="PushKickout",dn[dn.PushUserInfoUpdated=10001]="PushUserInfoUpdated",dn[dn.PushUserKickout=10002]="PushUserKickout",dn[dn.PushUserLogReport=10003]="PushUserLogReport",dn[dn.PushUserTokenExpire=10004]="PushUserTokenExpire",dn[dn.PushSignalCustom=11005]="PushSignalCustom",dn[dn.PushJoinliveRequest=11001]="PushJoinliveRequest",dn[dn.PushJoinliveResult=11002]="PushJoinliveResult",dn[dn.PushJoinliveInvite=11003]="PushJoinliveInvite",dn[dn.PushJoinliveStop=11004]="PushJoinliveStop",dn[dn.PushStreamAdd=12001]="PushStreamAdd",dn[dn.PushStreamDelete=12002]="PushStreamDelete",dn[dn.PushStreamUpdate=12003]="PushStreamUpdate",dn[dn.PushIm=13001]="PushIm",dn[dn.PushBigIm=14001]="PushBigIm",dn[dn.PushTrans=15001]="PushTrans",dn[dn.PushUserTrans=15002]="PushUserTrans",dn[dn.EnterRoomReq=301001]="EnterRoomReq",dn[dn.EnterRoomRsp=301002]="EnterRoomRsp",dn[dn.QuitRoomReq=301003]="QuitRoomReq",dn[dn.QuitRoomRsp=301004]="QuitRoomRsp",dn[dn.HbReq=301005]="HbReq",dn[dn.HbRsp=301006]="HbRsp",dn[dn.RenewTokenReq=301007]="RenewTokenReq",dn[dn.RenewTokenRsp=301008]="RenewTokenRsp",dn[dn.SetUserAttrReq=301009]="SetUserAttrReq",dn[dn.SetUserAttrRsp=301010]="SetUserAttrRsp",dn[dn.SetTransReq=301011]="SetTransReq",dn[dn.SetTransRsp=301012]="SetTransRsp",dn[dn.GetTransReq=301013]="GetTransReq",dn[dn.GetTransRsp=301014]="GetTransRsp",dn[dn.GetUserTransReq=301015]="GetUserTransReq",dn[dn.GetUserTransRsp=301016]="GetUserTransRsp",dn[dn.AddStreamReq=302001]="AddStreamReq",dn[dn.AddStreamRsp=302002]="AddStreamRsp",dn[dn.DeleteStreamReq=302003]="DeleteStreamReq",dn[dn.DeleteStreamRsp=302004]="DeleteStreamRsp",dn[dn.UpdateStreamReq=302005]="UpdateStreamReq",dn[dn.UpdateStreamRsp=302006]="UpdateStreamRsp",dn[dn.GetStreamListReq=302007]="GetStreamListReq",dn[dn.GetStreamListRsp=302008]="GetStreamListRsp",dn[dn.SendImReq=303001]="SendImReq",dn[dn.SendImRsp=303002]="SendImRsp",dn[dn.GetImReq=303003]="GetImReq",dn[dn.GetImRsp=303004]="GetImRsp",dn[dn.SendBigImReq=303005]="SendBigImReq",dn[dn.SendBigImRsp=303006]="SendBigImRsp",dn[dn.SignalLiveRequestReq=303009]="SignalLiveRequestReq",dn[dn.SignalLiveRequestRsp=303010]="SignalLiveRequestRsp",dn[dn.SignalLiveResultReq=303011]="SignalLiveResultReq",dn[dn.SignalLiveResultRsp=303012]="SignalLiveResultRsp",dn[dn.SignalLiveInviteReq=303013]="SignalLiveInviteReq",dn[dn.SignalLiveInviteRsp=303014]="SignalLiveInviteRsp",dn[dn.SignalLiveStopReq=303015]="SignalLiveStopReq",dn[dn.SignalLiveStopRsp=303016]="SignalLiveStopRsp",dn[dn.SignalLiveCustomReq=303017]="SignalLiveCustomReq",dn[dn.SignalLiveCustomRsp=303018]="SignalLiveCustomRsp",dn[dn.SignalTransmitReq=303019]="SignalTransmitReq",dn[dn.SignalTransmitRsp=303020]="SignalTransmitRsp",dn[dn.GetUserlistReq=304001]="GetUserlistReq",dn[dn.GetUserlistRsp=304002]="GetUserlistRsp",n(3)),mn=n(6),vn=n.n(mn),pn=(mn=n(7),n.n(mn)),gn=(bn.prototype.md5Bytes=function(t){return this.wordArray2Uint8Array(pn()(this.uint8Array2WordArray(t)))},bn.prototype.wordArray2Uint8Array=function(t){for(var i=t.words,n=t.sigBytes,e=new Uint8Array(n),s=0;s<n;s++)e[s]=i[s>>>2]>>>24-s%4*8&255;return e},bn.prototype.uint8Array2WordArray=function(t){for(var i=t.length,n=[],e=0;e<i;e++)n[e>>>2]|=(255&t[e])<<24-e%4*8;return vn.a.create(n,i)},bn);function bn(){}mn=n(1);var En=n.n(mn);function Sn(){return""}function Rn(){return!1}function On(){return!1}function yn(){return!1}function Tn(){return!1}function wn(){return!1}function In(){return!1}function Nn(){return!1}function Cn(){return c.UNKNOWN}function kn(){var t=a.NT_UNKNOWN,i="";return-1<(i=(i=A("netType")||"").toLocaleUpperCase()).indexOf("4G")?t=a.NT_4G:-1<i.indexOf("2G")?t=a.NT_2G:-1<i.indexOf("3G")?t=a.NT_3G:-1<i.indexOf("WIFI")?t=a.NT_WIFI:-1<i.indexOf("LINE")?t=a.NT_LINE:-1<i.indexOf("NONE")&&(t=a.NT_NONE),t}var zn,An=function(){return(An=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t}).apply(this,arguments)},Dn=(dn.util.Long=En.a,dn.configure(),i),Mn=i.liveroom_cs_v3,Pn=i.proto_switch_v3,xn=((n=zn=zn||{})[n.disconnected=0]="disconnected",n[n.broken=1]="broken",n[n.connected=2]="connected",Object.defineProperty(Un.prototype,"nickName",{get:function(){return Hi(this.ut.nickName)},enumerable:!1,configurable:!0}),Object.defineProperty(Un.prototype,"TermType",{get:function(){return this.ut.ENV%2==0?r.TT_WEB:r.TT_MINIPROGRAM},enumerable:!1,configurable:!0}),Object.defineProperty(Un.prototype,"ht",{get:function(){return this.ut.reporter},enumerable:!1,configurable:!0}),Un.prototype.isDisConnect=function(){return this._state!==zn.connected},Un.prototype.getHeader=function(t,i){return t={cmd:t,seq:++this.seq,timestamp:(new Date).getTime()},this.controls&&(t.controls=this.controls),null!=i&&i.contextKey&&(t.context_key=null==i?void 0:i.contextKey),i=Pn.Header.create(t),i=Pn.Header.encode(i).finish(),[t.seq,i]},Object.defineProperty(Un.prototype,"isUaConnect",{get:function(){return this._ua.isConnect()},enumerable:!1,configurable:!0}),Un.prototype.sendMessage=function(t,i,n,e,s,r,o){var u=this;if(void 0===r&&(r={timeout:6e3}),void 0===o&&(o=!0),this.ot.info(kt+" call"),"LoginRoomReq"!==t&&this._state!==zn.connected)return this.ot.warn(kt+" state "+this._state),e&&e(C.SOCKET_CLOSE),-1;if(Object(D.d)(t))c=t;else if(c=fn[t],Object(D.g)(c))return this.ot.warn(kt+" cmd not found "+t),-1;var h=0,a=Object(D.g)(null==s?void 0:s.roomID)?null==(a=this.ut.roomModulesList[0])?void 0:a.roomID:null==s?void 0:s.roomID,c=("LoginRoomReq"!==t&&a&&(h=this._roomIDKeys[a]),a=this.getHeader(c,{contextKey:h}))[1];return i=this.getHead(c.length,(h=i).length),i=new Uint8Array(Array.from(i).concat(Array.from(c)).concat(Array.from(h))),o&&(c={seq:this.seq,deleted:!1,sendTime:Date.parse(new Date+""),timeout:r.timeout,success:n,error:function(t,i,n){u.ot.info(kt+" error "+i+" "+JSON.stringify(t)+" "+JSON.stringify(n));var s=null==t?void 0:t.body,r=null==s?void 0:s.err_code,o=null==(o=null==t?void 0:t.header)?void 0:o.cmd,h=null==n?void 0:n.roomID;if(o!==fn.LoginRoomRsp){if(n=u.ut.roomModulesList.find((function(t){return t.roomID==h})),-1<[1002,105].indexOf(r))return o===fn.EnterRoomRsp&&n?n?void n.retryRoom(!1,!0):void u.ot.error(kt+" room no found ignore "):void u.rtm.retryRoom(!1,void 0,!0);if([141].includes(r)&&n)return void n.roomHandler.logoutByError({code:r,msg:null==s?void 0:s.err_message})}e&&e(t,i)},params:s},h=this.sendCommandList.push(c),this.sendCommandMap[c.seq]=h),this.ot.info(kt+" seq: "+a[0]+" cmd: "+t),null!=(o=this.liveroomRequest)&&o.sendRequest({payload:i,ack:"LoginRoomReq"===t},(function(t){u.ot.info(kt+" fail")}),(function(){u.ot.info(kt+" ack")}),{}),a[0]},Un.prototype.getHead=function(t,i){var n=new Uint8Array(7);return n[0]=49,n[1]=t>>8,n[2]=t-(n[1]<<8),n.set(new Uint8Array(Int32Array.from([i]).buffer).reverse(),3),n},Un.prototype.handlePush=function(t,i){var n,e,s;49!==t[0]||t.length<7||(n=Pn.Header.decode(t.slice(7,7+(s=(t[1]<<8)+t[2]))),s=t.slice(7+s),(t=(t[3]<<24)+(t[4]<<16)+(t[5]<<8)+t[6])!=(e=s).length&&this.ot.warn(At+" body len ".concat(t," != ").concat(s.length)),_n[n.cmd]?(t=this.decodeResponseBody(n,e),this.swPushCmdList.includes(n.cmd)?this.handleSwitchPush(n,t):(this.ot.info(zt+" down "+(s=_n[n.cmd]||n.cmd)+" "+JSON.stringify(this.transBuf(t))),s={header:this.transHeader(n),body:this.transRsp(t)},t=this._roomKeyIDs[n.context_key],Object(D.g)(t)||(s.header.room_id=t),this.handleSendCommandMsgRsp(s))):(this.ot.info(zt+" cmd is not rtc"),this.onSwitchMessage(n,e)))},Un.prototype.handleSwitchPush=function(t,i){var n,e,s=t.context_key,r=this._roomKeyIDs[s];if(r||this.noContextKeyCmdList.includes(t.cmd))if(t.cmd===fn.PushReq)if((e=this.transRsp(i.head)).room_id=r,this.ut.roomModulesList.find((function(t){return t.roomID==r}))){var o,u,h={header:e,body:this.unStructCmdList.includes(i.head.sub_cmd)?{signal_msg:$i(i.msg_body),sub_cmd:i.head.sub_cmd}:i.head.sub_cmd===fn.PushSignalCustom?{custommsg:$i(i.msg_body)}:_n[i.head.sub_cmd]?this.transRsp(this._decode(Mn[_n[i.head.sub_cmd]],i.msg_body)):{}};switch(this.ot.info(At+" push "+JSON.stringify(this.transBuf(h))),i.head.sub_cmd){case fn.PushUserInfoUpdated:this.handlePushUserStateUpdateMsg(h);break;case fn.PushUserKickout:this.transKeysName(h.body,this.loginKeyTransMap),this.handlePushKickout(h,!1);break;case fn.PushTrans:this.handlePushTransMsg(h);break;case fn.PushUserTrans:this.handlePushUserTransMsg(h);break;case fn.PushIm:this.handlePushRoomMsg(h);break;case fn.PushSignalCustom:this.handlePushCustomMsg(h);break;case fn.PushStreamAdd:case fn.PushStreamDelete:case fn.PushStreamUpdate:this.handlePushStreamMsg(h);break;case fn.PushJoinliveRequest:case fn.PushJoinliveResult:case fn.PushJoinliveInvite:case fn.PushJoinliveStop:this.handlePushSignalMsg(h);break;case fn.PushUserTokenExpire:this.handlePushTokenExpire(h);break;default:this.ot.info(At+" white "),this.onSwitchMessage(t,i)}1==i.head.qos_flag&&(o=Pn.PushRsp.create({code:0,message:"",sub_cmd:i.head.sub_cmd,server_send_time:i.head.send_time}),u=Pn.PushRsp.encode(o).finish(),this.sendMessage("PushRsp",u,void 0,void 0))}else this.ot.warn(At+" room no found ignore ");else t.cmd===fn.MergePushReq?((e=this.transRsp(i.head)).room_id=r,this.ut.roomModulesList.find((function(t){return t.roomID==r}))?(n=[],i.message_list.forEach((function(t){var i;n.push({sub_cmd:t.sub_cmd,sub_seq:t.sub_seq}),t.sub_cmd===fn.PushBigIm&&(i=Mn.PushBigIm.decode(t.msg_body),t.msg_body=i)})),delete(e={header:e,body:this.transRsp(i)}).body.head,this.handlePushMergeMsg(e),1==i.head.qos_flag&&(o=Pn.MergePushRsp.create({messages:n,server_send_time:i.head.send_time}),u=Pn.MergePushRsp.encode(o).finish(),this.sendMessage("MergePushRsp",u,void 0,void 0))):this.ot.warn(At+" room no found ignore ")):t.cmd===fn.PushKickout&&this.handlePushKickout({header:t,body:{reason:900<i.reason?i.reason-900:i.reason,msg:i.message,need_relogin:void 0!==i.is_need_relogin?i.is_need_relogin:0}},!0);else this.ot.warn(At+" ctx key ".concat(s," not found")),e={header:t,body:i},this._pushMsgCacheMap[s]?this._pushMsgCacheMap[s].push(e):this._pushMsgCacheMap[s]=[e]},Un.prototype.handlePushTokenExpire=function(t){},Un.prototype.handlePushKickout=function(t,i){},Un.prototype.handlePushStreamMsg=function(t){},Un.prototype.handlePushSignalMsg=function(t){},Un.prototype.handlePushMergeMsg=function(t){},Un.prototype.handlePushCustomMsg=function(t){},Un.prototype.handlePushRoomMsg=function(t){},Un.prototype.handlePushTransMsg=function(t){},Un.prototype.handlePushUserTransMsg=function(t){},Un.prototype.onSwitchMessage=function(t,i){},Un.prototype.decodeResponseBody=function(t,i){var n=this.onSwitchCmdList.includes(t.cmd)?"proto_switch_v3":"liveroom_cs_v3";return this._decode(this._protoInstance[n][_n[t.cmd]],i)},Un.prototype.handlePushUserStateUpdateMsg=function(t){},Un.prototype.login=function(t,i,n){var e,s,r,o=this,u=(this._state==zn.disconnected&&(this.ot.info(Mt+" state disconnect"),this.closeRequest()),(new Date).getTime()+""),h={user_session_id:null!=(h=t.longSid)?h:En.a.fromInt(0),net_type:kn(),room_id:Hi(t.roomID),room_name:Hi(t.roomName),nick_name:this.nickName,role:this.ut.role,third_token:Hi(t.token),room_create_flag:this.ut.roomCreateFlag,user_state_flag:t.userStateUpdate?1:0,user_count_limit:t.maxMemberCount,relate_service:this.ut.relateService.join()||""};t.isMulti?(s=An(An({},h),{conn_type:2}),delete(e=An(An({},s),{room_id:t.roomID,room_name:t.roomName})).third_token,this.ot.info(Mt+" enter "+JSON.stringify(e)),s=Mn.EnterRoomReq.create(s),r=Mn.EnterRoomReq.encode(s).finish(),this.sendMessage("EnterRoomReq",r,(function(n,e){o._transLoginRspKeys(n,t),i&&i(n,e),null!=(e=n.header)&&e.context_key&&o.processPushMsgCache(n.header.context_key)}),(function(t,i){o.clearAllPushMsgCache(),n&&n(t,i)}),{roomID:t.roomID})):(h=An(An({},h),{app_id:this.ut.appid,id_name:Hi(this.ut.idName),device_id:this.ut.deviceID,term_type:this.TermType,sdk_version:this._getNumSDKVersion(),client_stamp:Hi(u),relogin_token:this.switchSessionID.notEquals(En.a.fromInt(0))?Hi(this.reloginToken):"",switch_session_id:this.switchSessionID,user_session_id:null!=(h=t.longSid)?h:En.a.fromInt(0),biz_type:0,biz_version:this.ut.bizVersion||"",login_logic:this.ut.isMultiRoom?3:1,sdk_conn_type:2}),t.roomReasonState===y.Reconnecting&&(h.relogin_type=1),delete(e=An(An({},h),{id_name:this.ut.idName,nick_name:this.ut.nickName,client_stamp:u,k1_sign:void 0,relogin_token:this.reloginToken,room_id:t.roomID,room_name:t.roomName,user_session_id:t.longSid})).third_token,this.logoutCheckToken=t.token,this.ot.info(Mt+" login "+JSON.stringify(e)),this.ot.remoteReport(Mt+" token "+t.token),s=Pn.LoginRoomReq.create(h),r=Pn.LoginRoomReq.encode(s).finish(),this.sendMessage("LoginRoomReq",r,(function(n,e){var s;o.ot.info(Mt+" login rsp"),o.switchSessionID=n.body.switch_session_id,o.reloginToken=n.body.relogin_token,null!=(s=null==n?void 0:n.header)&&s.controls&&(o.controls=null==(s=null==n?void 0:n.header)?void 0:s.controls),o._transLoginRspKeys(n,t),i&&i(n,e),null!=(s=n.header)&&s.context_key&&o.processPushMsgCache(n.header.context_key)}),(function(t,i){o.clearAllPushMsgCache(),n&&n(t,i)})))},Un.prototype._transLoginRspKeys=function(t,i){null!=(n=t.header)&&n.context_key&&(this._roomIDKeys[i.roomID]=t.header.context_key,this._roomKeyIDs[t.header.context_key]=i.roomID,t.header.room_id=i.roomID),this.longToStringNumber(t.body,["ret_timestamp"],"toString"),this.transKeysName(t.body,this.loginKeyTransMap),this.keysExist(t.body,["token_remain_time","stream_seq"]);var n={anchor_id_name:t.body.anchor_info.id_name,anchor_id:t.body.anchor_info.user_id,anchor_nick_name:t.body.anchor_info.nick_name};t.body.anchor_info=n},Un.prototype.transKeysName=function(t,i){i.forEach((function(i){Object(D.g)(t[i[0]])||(t[i[1]]=t[i[0]],delete t[i[0]])}))},Un.prototype.keysExist=function(t,i){i.forEach((function(i){void 0===t[i]&&(t[i]=0)}))},Un.prototype.longToStringNumber=function(t,i,n){i.forEach((function(i){En.a.isLong(t[i])&&(t[i]=t[i][n]())}))},Un.prototype.logout=function(t,i,n){var e,s,r,o,u=this;return t.isMulti?(this.ot.info(xt+" quit "+t.roomID),this.clearPushMsgCacheByRoomID(t.roomID),r=Mn.QuitRoomReq.create(e={}),o=Mn.QuitRoomReq.encode(r).finish(),this.sendMessage("QuitRoomReq",o,(function(n,e){u.handleLogoutRsp(t.roomID),i&&i(n,e)}),(function(i,e){u.handleLogoutRsp(t.roomID),n&&n(i,e)}),{roomID:t.roomID})):(this.clearAllPushMsgCache(),e={logout_code:0,logout_check:this.crypto.md5Bytes(Hi(this.logoutCheckToken)),user_session_id:t.longSid,logout_logic:this.ut.isMultiRoom?3:1},s=this.transBuf(e),this.ot.info(xt+" logout "+JSON.stringify(s)),r=Pn.LogoutRoomReq.create(e),o=Pn.LogoutRoomReq.encode(r).finish(),this.sendMessage("LogoutRoomReq",o,(function(n,e){u.handleLogoutRsp(t.roomID),i&&i(n,e)}),(function(i,e){u.handleLogoutRsp(t.roomID),n&&n(i,e)}),{roomID:t.roomID}))},Un.prototype._checkSendMessageList=function(t){for(var i=t.getFirst();null!=i;)t.remove(i),i._data&&i._data.error&&setTimeout((function(){i&&i._data&&i._data.error&&i._data.error(C.TIMEOUT,i._data.seq)}),0),i=t.getFirst()},Un.prototype._checkMessageListTimeout=function(t,i){for(var n=t.getFirst(),e=Date.parse(new Date+""),s=0,r=this;null!=n&&"break"!==function(){var o,u;return n._data&&n._data.sendTime+n._data.timeout>e||(n._data&&delete i[n._data.seq],t.remove(n),n._data&&null==n._data.error||n._data&&n._data.sendTime+r._sendDataDropTimeout<e||(o=n&&n._data&&n._data.error,u=n&&n._data&&n._data.seq,setTimeout((function(){o&&o(C.TIMEOUT,u)}),0)),++s>=r._sendDataCheckOnceCount)?"break":void(n=t.getFirst())}(););},Un.prototype.startCheck=function(){var t=this;this._checkMessageListTimeout(this.sendCommandList,this.sendCommandMap),this._sendDataCheckTimer=setTimeout((function(){t.startCheck()}),this._sendDataCheckInterval)},Un.prototype.stopCheck=function(){this._checkSendMessageList(this.sendCommandList),clearTimeout(this._sendDataCheckTimer)},Un.prototype.handleSendCommandMsgRsp=function(t){var i,n,e=this.sendCommandMap[t.header.seq];null!=e&&(n=null==(i=e._data)?void 0:i.params,delete this.sendCommandMap[t.header.seq],this.sendCommandList.remove(e),0===t.body.err_code?setTimeout((function(){i&&null!=i.success&&i.success(t,t.header.seq)}),0):setTimeout((function(){i&&null!=i.error&&i.error(t,t.header.seq,n)}),0))},Un.prototype.getReqHead=function(t){return{}},Un.prototype.heartBeat=function(t,i,n,e){var s=this,r=Mn.HbReq.create({});r=Mn.HbReq.encode(r).finish(),this.sendMessage("HbReq",r,(function(i,n){s.transKeysName(i.body,[["hb_interval","hearbeat_interval"],["hb_timeout","hearbeat_timeout"],["big_im_time_window","bigim_time_window"],["trans_channel_list","trans_seqs"]]),i.body.server_user_seq=i.body.user_seq.toNumber(),s.longToStringNumber(i.body,["ret_timestamp"],"toNumber"),t&&t(i,n)}),i,{roomID:null==n?void 0:n.roomID},{timeout:e})},Un.prototype.fetchUserList=function(t,i,n,e){var s=this,r=(t=An({},t),this.transBuf(t));return this.ot.info(Pt+" "+JSON.stringify(r)),r=Mn.GetUserlistReq.create(t),t=Mn.GetUserlistReq.encode(r).finish(),this.sendMessage("GetUserlistReq",t,(function(t,n){s.ot.info(Pt+" suc "+n),s.transKeysName(t.body,[["user_base_info_list","user_baseinfos"]]),s.longToStringNumber(t.body,["server_user_seq","server_user_index","ret_user_index"],"toNumber"),i&&i(t,n)}),n,{roomID:null==e?void 0:e.roomID})},Un.prototype.sendRoomMsg=function(t,i,n,e){var s=this,r=(t={msg_category:t.msg_category,msg_type:t.msg_type,msg_content:Hi(t.msg_content)},this.transBuf(t));return this.ot.info("zm.lrh.srm.1 "+JSON.stringify(r)),r=Mn.SendImReq.create(t),t=Mn.SendImReq.encode(r).finish(),this.sendMessage("SendImReq",t,(function(t,n){s.longToStringNumber(t.body,["msg_id"],"toNumber"),i&&i(t,n)}),n,{roomID:null==e?void 0:e.roomID})},Un.prototype.sendReliableMessage=function(t,i,n,e){t={trans_type:Hi(t.trans_type),trans_data:Hi(t.trans_data),trans_local_seq:t.trans_local_seq,trans_channel:Hi(t.trans_channel)};var s=this.transBuf(t);return this.ot.info("zm.lrh.srm.0 "+JSON.stringify(s)),s=Mn.SetTransReq.create(t),t=Mn.SetTransReq.encode(s).finish(),this.sendMessage("SetTransReq",t,i,n,{roomID:null==e?void 0:e.roomID})},Un.prototype.fetchReliableMessage=function(t,i,n,e){var s=t.fetch_array.map((function(t){return{trans_type:Hi(t.trans_type),trans_local_seq:t.trans_seq}}));return t={trans_channel:Hi(t.trans_channel),trans_list:s},s=this.transBuf(t),this.ot.info("zm.lrh.frm "+JSON.stringify(s)),s=Mn.GetTransReq.create(t),t=Mn.GetTransReq.encode(s).finish(),this.sendMessage("GetTransReq",t,i,n,{roomID:null==e?void 0:e.roomID})},Un.prototype.fetchUserTransInfo=function(t,i,n,e){var s=t.fetch_array.map((function(t){return{trans_type:Hi(t.trans_type),trans_local_seq:t.trans_seq}}));return t={trans_channel:Hi(t.trans_channel),user_trans_list:s},s=this.transBuf(t),this.ot.info("zm.lrh.futi "+JSON.stringify(s)),s=Mn.GetUserTransReq.create(t),t=Mn.GetUserTransReq.encode(s).finish(),this.sendMessage("GetUserTransReq",t,i,n,{roomID:null==e?void 0:e.roomID})},Un.prototype.sendCustomCommand=function(t,i,n,e){var s=this,r=t.dest_id_name.map((function(t){return{id_name:Hi(t)}}));return r=An({to_user_list:r,push_message:Hi(t.custom_msg)},t),t=this.transBuf(r),this.ot.info("zm.lrh.scc "+JSON.stringify(t)),t=Mn.SignalLiveCustomReq.create(r),r=Mn.SignalLiveCustomReq.encode(t).finish(),this.sendMessage("SignalLiveCustomReq",r,(function(t,n){i&&i(s.transRsp(t),n)}),(function(t,i){n&&n(t,i)}),{roomID:null==e?void 0:e.roomID})},Un.prototype.sendBigRoomMessage=function(t,i,n,e){t={msg_list:t.msgs.map((function(t){return{msg_category:t.msg_category,msg_type:t.msg_type,msg_timestamp:En.a.fromNumber(Date.now()),msg_content:Hi(t.msg_content),msg_client_id:Hi(t.bigmsg_client_id)}}))};var s=this.transBuf(t);return this.ot.info("zm.lrh.sbrm "+JSON.stringify(s)),s=Mn.SendBigImReq.create(t),t=Mn.SendBigImReq.encode(s).finish(),this.sendMessage("SendBigImReq",t,i,n,{roomID:null==e?void 0:e.roomID})},Un.prototype.sendSignalCmd=function(t,i,n,e){var s="";switch(t.sub_cmd){case 1003:s="SignalLiveInviteReq";break;case 1001:s="SignalLiveRequestReq";break;case 1002:s="SignalLiveResultReq";break;case 1004:s="SignalLiveStopReq"}var r=t.dest_id_name.map((function(t){return{id_name:Hi(t)}}));return t={push_message:Hi(t.signal_msg),to_user_list:r},r=this.transBuf(t),this.ot.info("zm.lrh.ssc "+JSON.stringify(r)),r=Mn[s].create(t),t=Mn[s].encode(r).finish(),this.sendMessage(s,t,i,n,{roomID:null==e?void 0:e.roomID})},Un.prototype.sendStreamUpdate=function(t,i,n,e){var s,r=this;try{s=JSON.parse(t.stream_msg)}catch(t){}var o,u="",h=(this.ot.info(Ut+" "+JSON.stringify(An(An({},t),{third_token:void 0}))),this.ot.remoteReport(Ut+" token "+t.third_token),this.ut.roomModulesList.find((function(t){return t.roomID==e.roomID})));if(!h)return this.ot.error(Ut+" room no found ignore "),-1;switch(t.sub_cmd){case 2001:u="AddStreamReq",o={stream_id:Hi(s.stream_id),extra_info:Hi(s.extra_info),client_req_seq:this.seq+1,third_token:Hi(t.third_token||""),stream_attr_opts:{censor_flag:s.inspect_flag||0}};break;case 2002:u="DeleteStreamReq",o={stream_id:Hi(s.stream_id),stream_sid:s.stream_sid,client_req_seq:this.seq+1};break;case 2003:u="UpdateStreamReq",o={stream_id:Hi(s.stream_id),stream_sid:s.stream_sid,client_req_seq:this.seq+1,extra_info:Hi(s.extra_info)}}var a=this.transBuf(o);return this.ot.info(Ut+" "+JSON.stringify(a)),a=Mn[u].create(o),a=Mn[u].encode(a).finish(),this.sendMessage(u,a,(function(t,n){r.ot.info(Ut+" suc "+u+" "+JSON.stringify(t)),t.header.room_id=h.roomID,i&&i(t,n)}),(function(t,i){r.ot.info(Ut+" fail "+u+" "+JSON.stringify(t)),n&&n(t,i)}),{roomID:null==e?void 0:e.roomID})},Un.prototype.getStreamList=function(t,i,n,e){var s,r,o=this;this.ut.roomModulesList.find((function(t){return t.roomID==e.roomID}))?(s=this.transBuf(r={}),this.ot.info(Dt+" "+JSON.stringify(s)),s=Mn.GetStreamListReq.create(r),r=Mn.GetStreamListReq.encode(s).finish(),this.sendMessage("GetStreamListReq",r,(function(t,n){var e;null!=(e=t.body)&&e.stream_info_list.forEach((function(t){t.create_time=t.create_time.toNumber()})),o.transKeysName(t.body,[["stream_list_seq","stream_seq"],["stream_info_list","stream_info"]]),i&&i(t,n)}),(function(t,i){n&&n(t,i)}),{roomID:null==e?void 0:e.roomID})):this.ot.error(Dt+" room no found ignore "+e.roomID)},Un.prototype.transBuf=function(t){var i=this,n={};return Object.keys(t).forEach((function(e){["logout_check","k2_sign","k1_sign"].includes(e)?n[e]=t[e]:i.transReqBytes(n,t,e)})),n},Un.prototype.transReqBytes=function(t,i,n){var e=this;if(En.a.isLong(i[n]))t[n]=i[n].toString();else if("[object Object]"===Object.prototype.toString.call(i[n]))t[n]={},Object.keys(i[n]).forEach((function(s){return e.transReqBytes(t[n],i[n],s)}));else if("[object Array]"===Object.prototype.toString.call(i[n])&&"[object Object]"===Object.prototype.toString.call(i[n][0])){t[n]=[];for(var s=0;s<i[n].length;s++)!function(s){var r={};Object.keys(i[n][s]).forEach((function(t){e.transReqBytes(r,i[n][s],t)})),t[n].push(r)}(s)}else t[n]="[object Uint8Array]"===Object.prototype.toString.call(i[n])?$i(i[n]):i[n]},Un.prototype.transHeader=function(t){return t.timestamp=En.a.isLong(t.timestamp)?t.timestamp.toString():t.timestamp,t},Un.prototype.transRsp=function(t){var i=this,n=t&&t.rsp_head?this.transRspHead(t.rsp_head):{},e=An(An({},t),n),s=(delete e.rsp_head,{});return Object.keys(e).forEach((function(t){"k2_sign"===t?s[t]=e[t]:i.transBytes(s,e,t)})),s},Un.prototype.transBytes=function(t,i,n){var e=this;if(En.a.isLong(i[n]))t[n]=i[n];else if("[object Object]"===Object.prototype.toString.call(i[n]))t[n]={},Object.keys(i[n]).forEach((function(s){return e.transBytes(t[n],i[n],s)}));else if("[object Array]"===Object.prototype.toString.call(i[n])&&"[object Object]"===Object.prototype.toString.call(i[n][0])){t[n]=[];for(var s=0;s<i[n].length;s++)!function(s){var r={};Object.keys(i[n][s]).forEach((function(t){e.transBytes(r,i[n][s],t)})),t[n].push(r)}(s)}else t[n]="[object Uint8Array]"===Object.prototype.toString.call(i[n])?$i(i[n]):i[n]},Un.prototype.transRspHead=function(t){return t?{err_code:t.code||0,err_message:t.message}:{}},Un.prototype._decode=function(t,i){return An({},t.decode(i))},Un.prototype.Ct=function(t,i){var n=this;this.ot.info(Lt+" call"),this._state=zn.disconnected,this.ut.useNetAgent&&t===R.TIMEOUT&&this.ut.roomModulesList.forEach((function(t){(t=t.roomTryHandler)&&(n.isUaConnect?(n.ot.info(Lt+" ua is connect"),t.retryLoginRoom()):(n.ot.info(Lt+" ua is disconnect"),n._ua.connectUa()))}))},Un.prototype._handleBroken=function(){this.ot.info(qt+" call"),this._state=zn.broken,this.clearAllPushMsgCache(),this.ut.useNetAgent&&this.handleReconnecting(qt)},Un.prototype.handleReconnecting=function(t){var i=this;this.ut.roomModulesList.forEach((function(n){var e=n.roomTryHandler,s=n.roomHandler;e&&(e.invalid(),e.onactive=function(n,e){i.ot.info(t+" onactive"),s.transError(e),s.disconnectedHandle(e)},e.startMaxTime(),s._roomStateHandle("CONNECTING",y.Reconnecting,C.NETWORK_BROKEN))}))},Un.prototype.It=function(t){this.ot.info("zm.lrh.hc call "+t),this._state=zn.connected,this.ut.useNetAgent&&t===b.AUTO&&this.rtm.retryRoom()},Un.prototype.renewToken=function(t,i,n,e){var s=this,r=Mn.RenewTokenReq.create(t={token:t.token});r=Mn.RenewTokenReq.encode(r).finish(),t=this.transBuf(t),this.ot.info("zm.lrh.rt "+JSON.stringify(t)),this.sendMessage("RenewTokenReq",r,(function(t,n){s.keysExist(t.body,["token_remain_time"]),i&&i(t,n)}),n,{roomID:null==e?void 0:e.roomID})},Un.prototype.reset=function(){this.ot.info("zm.lrh.r.0 call "),this._state=zn.disconnected,this.switchSessionID=En.a.fromInt(0),this._sendDataCheckTimer&&clearTimeout(this._sendDataCheckTimer)},Un.prototype.closeRequest=function(){var t;null!=(t=this.liveroomRequest)&&t.closeRequest()},Un.prototype.resetSessionInfo=function(){this.switchSessionID=En.a.fromInt(0)},Un.prototype._getNumSDKVersion=function(){var t=0===this.ut.ENV?6:7,i=this.rtm.version.split(".").map((function(t){return parseInt(t)}));return t<<28|i[0]<<20|i[1]<<8|i[2]},Un.prototype.processPushMsgCache=function(t){var i=this._pushMsgCacheMap[t];if(i){this.ot.info(zt+" processPushMsgCache ".concat(t,", msg len: ").concat(i.length));for(var n=0;n<i.length;n++){var e=i[n];this.handleSwitchPush(e.header,e.body)}delete this._pushMsgCacheMap[t]}},Un.prototype.clearAllPushMsgCache=function(){var t=this;Object.keys(this._pushMsgCacheMap).forEach((function(i){i=parseInt(i),delete t._pushMsgCacheMap[i]}))},Un.prototype.clearPushMsgCacheByRoomID=function(t){(t=this._roomIDKeys[t])&&this._pushMsgCacheMap[t]&&delete this._pushMsgCacheMap[t]},Un.prototype.handleLogoutRsp=function(t){var i=this._roomIDKeys[t];i&&(delete this._roomKeyIDs[i],delete this._roomIDKeys[t],this._pushMsgCacheMap[i])&&delete this._pushMsgCacheMap[i]},Un);function Un(t,i,n,e,s){var r=this;this.ot=t,this.ut=i,this._ua=n,this._dataReport=e,this.rtm=s,this.seq=0,this.sendCommandList=new p,this.sendCommandMap={},this.logoutCheckToken="",this.zPushSid="0",this.loginKeyTransMap=[["user_session_id","session_id"],["liveroom_hb_interval","hearbeat_interval"],["liveroom_hb_timeout","hearbeat_timeout"],["big_im_time_window","bigim_time_window"],["trans_channel_list","trans_seqs"],["stream_list_seq","stream_seq"],["stream_info_list","stream_info"]],this._sendDataCheckOnceCount=100,this._sendDataDropTimeout=1e4,this._sendDataCheckInterval=2e3,this._protoInstance=Dn,this._roomKeyIDs={},this._roomIDKeys={},this._pushMsgCacheMap={},this.swPushCmdList=[fn.PushReq,fn.MergePushReq,fn.PushKickout],this.onSwitchCmdList=[fn.LoginRoomRsp,fn.LogoutRoomRsp,fn.PushKickout,fn.PushReq,fn.MergePushReq],this.noContextKeyCmdList=[1105],this.rtcPushCmdList=[10001,10002,10004,11001,11002,11003,11004,11005,12001,12002,12003,13001,15001,15002],this._state=zn.disconnected,this.unStructCmdList=[11001,11002,11003,11004],this.reloginToken="",this.crypto=new gn,this.liveroomRequest=this._ua.getPCRequest(O.SERVICE_SWITCH4LIVEROOM),this.switchSessionID=En.a.fromInt(0),null!=(t=this.liveroomRequest)&&t.on("connected",(function(t){r.It(t)})),null!=(i=this.liveroomRequest)&&i.on("broken",(function(t){r._handleBroken()})),null!=(n=this.liveroomRequest)&&n.on("disconnected",(function(t,i){r.Ct(t,i)})),null!=(e=this.liveroomRequest)&&e.on("downLoadMessage",(function(t,i){r.handlePush(t,i)})),null!=(s=this.liveroomRequest)&&s.on("exception",(function(t,i){r.ot.info("zm.lrh.o.0 except "+JSON.stringify(t))})),null!=(t=this.liveroomRequest)&&t.on("pcBrokenEvent",(function(t){var i=wi,n=r.ht.createSpan(u.H,{key:di},{key:""},i.event);n.setAttributes({service_no:i.service_no(null==t?void 0:t.service_no)}),n.end()})),null!=(i=this.liveroomRequest)&&i.on("pcDisconnectedEvent",(function(t){var i=Ii,n=r.ht.createSpan(u.H,{key:di},{key:""},i.event);n.setAttributes({service_no:i.service_no(null==t?void 0:t.service_no)}),n.end()})),null!=(n=this.liveroomRequest)&&n.on("pcConnectedEvent",(function(t){var i=Ti,n=r.ht.createSpan(u.H,{key:di},{key:""},i.event);n.setAttributes({service_no:i.service_no(t.service_no),recv_time:i.recv_time((new Date).getTime()),proxy_link_sources:i.proxy_link_sources(t.proxy_link_sources),connect_stream:i.connect_stream(t.connect_stream)}),n.end()}))}var Ln=(Object.defineProperty(qn.prototype,"logger",{get:function(){return this.ot},enumerable:!1,configurable:!0}),Object.defineProperty(qn.prototype,"stateCenter",{get:function(){return this.ut},enumerable:!1,configurable:!0}),qn.prototype.listenCallBack=function(){var t=this;this.roomServicer.handlePushCustomMsg=function(i){t.handlePushCustomMsg(i)},this.roomServicer.handlePushTokenExpire=function(i){var n,e=null==(e=null==(e=null==i?void 0:i.body)?void 0:e.stop_stream)?void 0:e.stream_id_list.map((function(t){return $i(t)}));null!=(n=null==(n=null==i?void 0:i.body)?void 0:n.stop_stream)&&(n.stream_id_list=e),t.ut.actionListener("_tokenExpired",i)},this.roomServicer.handlePushKickout=function(i,n){var e;n?function(t,i,n){if(n||2===arguments.length)for(var e,s=0,r=i.length;s<r;s++)!e&&s in i||((e=e||Array.prototype.slice.call(i,0,s))[s]=i[s]);return t.concat(e||Array.prototype.slice.call(i))}([],t.ut.roomModulesList,!0).forEach((function(t){t.roomHandler.handlePushKickout(i,!0,!0)})):(e=null==(n=null==i?void 0:i.header)?void 0:n.room_id,n=t.ut.roomModulesList.find((function(t){return t.roomID==e})),t.roomServicer.longToStringNumber(i.body,["session_id"],"toString"),n?n.roomHandler.handlePushKickout(i):t.ot.error("zm.lrh.pk room no found ignore "+JSON.stringify(null==(n=i.header)?void 0:n.room_id)))},this.roomServicer.handlePushStreamMsg=function(i){t.handlePushStreamMsg(i)},this.roomServicer.handlePushSignalMsg=function(i){t.handlePushSignalMsg(i)},this.roomServicer.handlePushMergeMsg=function(i){t.handlePushMergeMsg(i)},this.roomServicer.handlePushRoomMsg=function(i){t.handlePushRoomMsg(i)},this.roomServicer.handlePushTransMsg=function(i){t.handlePushTransMsg(i)},this.roomServicer.handlePushUserTransMsg=function(i){t.handlePushUserTransMsg(i)},this.roomServicer.onSwitchMessage=function(i,n){t.onSwitchMessage(i,n)},this.roomServicer.handlePushUserStateUpdateMsg=function(i){var n,e,s,r=null==(o=null==i?void 0:i.header)?void 0:o.room_id,o=t.ut.roomModulesList.find((function(t){return t.roomID==r}));o?(s=i.body.user_action_list.map((function(t){return{Action:t.action,IdName:t.id_name,NickName:t.nick_name,Role:t.role,LoginTime:t.login_time.toString()}})),e=t.ut.reporter.createSpan(u.H,{key:Ft.event,par:r},{key:""},"/liveroom/recv_user_update_info"),s={body:{user_actions:s,user_list_seq:i.body.server_user_seq.toNumber(),room_id:r}},e.setAttributes({user_list_seq:null==(n=null===s?void 0:s.body)?void 0:n.user_list_seq,update_user:null==(n=null===s?void 0:s.body)?void 0:n.user_actions}),e.end(),o.userHandler.handlePushUserStateUpdateMsg(s)):t.ot.error("zm.lrh.puu room no found ignore "+JSON.stringify(i))}},qn.prototype.isDisConnect=function(){return!!this.roomServicer&&this.roomServicer.isDisConnect()},Object.defineProperty(qn.prototype,"isUaConnect",{get:function(){return!!this.roomServicer&&this.roomServicer.isUaConnect},enumerable:!1,configurable:!0}),qn.prototype.sendMessage=function(t,i,n,e,s,r,o){var u;return null==(u=this.roomServicer)?void 0:u.sendMessage(t,i,n,e,s,r)},qn.prototype.handlePushTokenExpire=function(t){},qn.prototype.handlePushKickout=function(t,i){},qn.prototype.handlePushStreamMsg=function(t){},qn.prototype.handlePushSignalMsg=function(t){},qn.prototype.handlePushMergeMsg=function(t){},qn.prototype.handlePushCustomMsg=function(t){},qn.prototype.handlePushRoomMsg=function(t){},qn.prototype.handlePushTransMsg=function(t){},qn.prototype.handlePushUserTransMsg=function(t){},qn.prototype.onSwitchMessage=function(t,i){},qn.prototype.handlePushUserStateUpdateMsg=function(t){},qn.prototype.login=function(t,i,n){var e;null!=(e=this.roomServicer)&&e.login(t,i,n)},qn.prototype.logout=function(t,i,n){var e;return null==(e=this.roomServicer)?void 0:e.logout(t,i,n)},qn.prototype.startCheck=function(){var t;null!=(t=this.roomServicer)&&t.startCheck()},qn.prototype.stopCheck=function(){var t;null!=(t=this.roomServicer)&&t.stopCheck()},qn.prototype.getReqHead=function(t){var i;return null==(i=this.roomServicer)?void 0:i.getReqHead(t)},qn.prototype.heartBeat=function(t,i,n,e){var s;null!=(s=this.roomServicer)&&s.heartBeat(t,i,n,e)},qn.prototype.fetchUserList=function(t,i,n,e){var s;return null==(s=this.roomServicer)?void 0:s.fetchUserList(t,i,n,e)},qn.prototype.sendRoomMsg=function(t,i,n,e){var s;return null==(s=this.roomServicer)?void 0:s.sendRoomMsg(t,i,n,e)},qn.prototype.sendReliableMessage=function(t,i,n,e){var s;return null==(s=this.roomServicer)?void 0:s.sendReliableMessage(t,i,n,e)},qn.prototype.fetchReliableMessage=function(t,i,n,e){var s;return null==(s=this.roomServicer)?void 0:s.fetchReliableMessage(t,i,n,e)},qn.prototype.fetchUserTransInfo=function(t,i,n,e){var s;return null==(s=this.roomServicer)?void 0:s.fetchUserTransInfo(t,i,n,e)},qn.prototype.sendCustomCommand=function(t,i,n,e){var s;return null==(s=this.roomServicer)?void 0:s.sendCustomCommand(t,i,n,e)},qn.prototype.sendBigRoomMessage=function(t,i,n,e){var s;return null==(s=this.roomServicer)?void 0:s.sendBigRoomMessage(t,i,n,e)},qn.prototype.sendSignalCmd=function(t,i,n,e){var s;return null==(s=this.roomServicer)?void 0:s.sendSignalCmd(t,i,n,e)},qn.prototype.sendStreamUpdate=function(t,i,n,e){var s;return null==(s=this.roomServicer)?void 0:s.sendStreamUpdate(t,i,n,e)},qn.prototype.getStreamList=function(t,i,n,e){var s;return null==(s=this.roomServicer)?void 0:s.getStreamList(t,i,n,e)},qn.prototype.renewToken=function(t,i,n,e){var s;null!=(s=this.roomServicer)&&s.renewToken(t,i,n,e)},qn.prototype.reset=function(){var t;null!=(t=this.roomServicer)&&t.reset()},qn.prototype.closeRequest=function(){var t;null!=(t=this.roomServicer)&&t.closeRequest()},qn);function qn(t,i,n,e,s){this.ot=t,this.ut=i,this.ua=n,this._dataReport=e,this.rtm=s,this.roomServicer=new xn(t,i,n,e,s),this.listenCallBack()}var jn=function(){return(jn=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t}).apply(this,arguments)},Gn=function(t,i,n,e){return new(n=n||Promise)((function(s,r){function o(t){try{h(e.next(t))}catch(t){r(t)}}function u(t){try{h(e.throw(t))}catch(t){r(t)}}function h(t){var i;t.done?s(t.value):((i=t.value)instanceof n?i:new n((function(t){t(i)}))).then(o,u)}h((e=e.apply(t,i||[])).next())}))},Hn=function(t,i){var n,e,s,r={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},o={next:u(0),throw:u(1),return:u(2)};return"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(u){return function(h){var a=[u,h];if(n)throw new TypeError("Generator is already executing.");for(;r=o&&a[o=0]?0:r;)try{if(n=1,e&&(s=2&a[0]?e.return:a[0]?e.throw||((s=e.return)&&s.call(e),0):e.next)&&!(s=s.call(e,a[1])).done)return s;switch(e=0,(a=s?[2&a[0],s.value]:a)[0]){case 0:case 1:s=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,e=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(!(s=0<(s=r.trys).length&&s[s.length-1])&&(6===a[0]||2===a[0])){r=0;continue}if(3===a[0]&&(!s||a[1]>s[0]&&a[1]<s[3]))r.label=a[1];else if(6===a[0]&&r.label<s[1])r.label=s[1],s=a;else{if(!(s&&r.label<s[2])){s[2]&&r.ops.pop(),r.trys.pop();continue}r.label=s[2],r.ops.push(a)}}a=i.call(t,r)}catch(h){a=[6,h],e=0}finally{n=s=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}}},$n=function(t,i,n){if(n||2===arguments.length)for(var e,s=0,r=i.length;s<r;s++)!e&&s in i||((e=e||Array.prototype.slice.call(i,0,s))[s]=i[s]);return t.concat(e||Array.prototype.slice.call(i))},Vn=(Object.defineProperty(Bn.prototype,"logger",{get:function(){return this.ot},enumerable:!1,configurable:!0}),Object.defineProperty(Bn.prototype,"stateCenter",{get:function(){return this.ut},enumerable:!1,configurable:!0}),Object.defineProperty(Bn.prototype,"modules",{get:function(){return{service:this.service}},enumerable:!1,configurable:!0}),Object.defineProperty(Bn.prototype,"isUseNetAgent",{get:function(){return this.ut.useNetAgent},enumerable:!1,configurable:!0}),Object.defineProperty(Bn.prototype,"isUaConnect",{get:function(){return this.netAgent.isConnect()},enumerable:!1,configurable:!0}),Object.defineProperty(Bn.prototype,"reporter",{get:function(){return this.ht},enumerable:!1,configurable:!0}),Bn.prototype.destroyRTM=function(){this.ut.roomModulesList.some((function(t){return!(null!=t&&t.isLogout()||t.roomState===Vi)}))&&this.logoutRoom(),this.ht.setUnloadState(u.I),this.ht.destroy(),this.Nt()},Bn.prototype._initCallback=function(){this.proxyRes=B,this.actionSuccessCallback=H,this.actionErrorCallback=G,this.getServerError=J,this.generateRandumNumber=W,this.unregisterCallback=Y,this.logReportCallback=$,this.registerCallback=j},Bn.prototype.wt=function(){var t=this,i=(this.ot.info(lt+" call"),this.netAgent.on("disconnected",(function(i){t.ot.info("".concat(lt," netAgent disconnect"))})),this.netAgent.on("connected",(function(){t.ot.info("".concat(lt," netAgent connect")),t.ht.setNetStateCheck(),t.isUseNetAgent&&(t.fetchAppConfig(),t.retryRoom(!0))})),this.netAgent.on("broken",(function(i){t.ot.info("".concat(lt," netAgent broken")),i===E.CLOSE&&t.ut.roomModulesList.forEach((function(t){t.resetSessionInfo()}))})),this.netAgent.on("dispatchEvent",(function(i,n,e){var s;t.ot.info("".concat(lt," dispatch")),"start"===n?(s=t.ht.createSpan(u.H,{key:di},{key:""},"/zegoconn/auto_dispatch"),t.ut.requestList[i]=s):"end"===n&&(s=t.ut.requestList[i])&&(s.setAttributes({domain_list:e.domains}),s.end())})),this.netAgent.on("connectedEvent",(function(i,n,e){var s;t.ot.info("".concat(lt," connect")),"start"===n?(s=t.ht.createSpan(u.H,{key:Gt.event},{key:di},di,!0),t.ut.requestList[i]=s):"end"===n&&(s=t.ut.requestList[i])&&(n=e.connectEvents||[],s.setAttributes({request_count:vi(e.count),connect_id:mi(e.connectid),events:pi(n),error:(null==(i=n[0])?void 0:i.error)||0}),s.end())})),this.netAgent.on("requestEvent",(function(i,n,e){var s;t.ot.info("".concat(lt," request")),"start"===n?(s=t.ht.createSpan(u.H,{key:Gt.event},{key:Si},Si,!0),t.ut.requestList[i]=s):"end"===n&&(s=t.ut.requestList[i])&&(s.setAttributes({req_location:Ri(e.na_req_location),http_code:e.status_code,error:e.err_code}),s.end())})),this.netAgent.on("disConnectedEvent",(function(i){var n=i.duration,e=i.server,s=(i=i.connectid,t.ot.info("".concat(lt," disconnect")),t.ht.createSpan(u.H,{key:Gt.event},{key:""},"/zegoconn/disconnect"));s.setAttributes({url:bi(e),connect_duration:Ei(n),connect_id:gi(i)}),s.end()})),null!=(i=this.netAgent)&&i.on("clientInfo",(function(i){var n=i.timeOffset;Object(D.d)(n)&&t.ht.setTimeOffset(n),t._updateTimeOffsetInterval()})),[]),n=(i=Q,(n=this.At()).accesshub&&""!==n.accesshub&&(i=[n.accesshub],this.stateCenter.svrDomains.accesshub=n.accesshub),n.logreport&&""!==n.logreport&&(this.stateCenter.svrDomains.logreport=n.logreport),n.detaillog&&""!==n.detaillog&&(this.stateCenter.svrDomains.detaillog=n.detaillog),this.ot.info("".concat(lt," advance config domains: ").concat(JSON.stringify(n),", set domains ").concat(JSON.stringify(i),", ")),this.ot.info("".concat(lt," domains ").concat(JSON.stringify(i))),i.map((function(t){return"wss://".concat(t,"/accesshub")})));this.netAgent.setNetAgentDefaultServers(n),this.dispatchServers=[],this.netAgent.setDispatchConnectServers(this.dispatchServers)},Bn.prototype._getMainDomain=function(t){return(t=t.split("."))[t.length-2]+"."+t[t.length-1]},Bn.prototype.At=function(){var t={};return this.stateCenter.advanceConfig.customDomain&&(this.stateCenter.advanceConfig.customDomain.accesshub&&(t.accesshub=this.stateCenter.advanceConfig.customDomain.accesshub),this.stateCenter.advanceConfig.customDomain.logreport&&(t.logreport=this.stateCenter.advanceConfig.customDomain.logreport),this.stateCenter.advanceConfig.customDomain.detaillog)&&(t.detaillog=this.stateCenter.advanceConfig.customDomain.detaillog),t},Bn.prototype._bindWxListener=function(){var t=this;wx.onNetworkStatusChange.bind(this)((function(i){i.isConnected?t.kt():t.Pt()}))},Bn.prototype.retryRoom=function(t,i,n){var e;void 0===t&&(t=!1),void 0===n&&(n=!1),this.logger.info("".concat("zm.rr"," retryNow:").concat(t," roomid:").concat(i,", resetSession:").concat(n)),i?(e=this.ut.roomModulesList.find((function(t){return t.roomID==i})))&&e.retryRoom(t,n):this.ut.roomModulesList.forEach((function(i){null!=i&&i.retryRoom(t,n)}))},Bn.prototype.kt=function(){this.ot.info("zm.wl network is online"),this.ut.networkState!==h.online&&(this.ut.networkState=h.online,this.Nt())},Bn.prototype.Nt=function(){this.Dt&&(clearInterval(this.Dt),this.Dt=null)},Bn.prototype.Ut=function(){var t=this;this.Nt(),this.ot.info(jt+" start network online detection.."),this.Dt=setInterval((function(){t.ut.networkState!==h.offline&&t.Nt(),t.ut.useNetAgent&&t.isUaConnect&&(t.ot.info(jt+" detected network online"),t.kt(),t.Nt())}),this.zt)},Bn.prototype.Pt=function(){this.ot.info("zm.wl network is broken"),this.ut.networkState!==h.offline&&(this.ut.networkState=h.offline,this.Ut())},Bn.prototype.setLogConfig=function(t){this.ot.info(ot+" call");var i,n=this.ht.createSpan(u.H,{key:Gt.event},{key:Bt.event},Bt.event);if(t.logLevel&&["debug","info","warn","error","report","disable"].includes(t.logLevel)&&(this.ot.setLogLevel(t.logLevel),n.setAttributes({log_level:Bt.log_level(t.logLevel)})),t.remoteLogLevel&&["debug","info","warn","error","report","disable"].includes(t.remoteLogLevel)&&n.setAttributes({remote_log_level:Bt.remote_log_level(t.remoteLogLevel)}),Object(D.f)(t.logURL)&&(t.logURL.startsWith("wss://")||t.logURL.startsWith("https://")))null!=(i=this.ut.geoFencing)&&i.logreport?this.ot.info(ot+" geo exist"):(this.ot.setLogServer(t.logURL),0===this.ut.ENV&&(this.ut.logDomain=null==(i=this.ot.url)?void 0:i.split("/")[2],this.ht.setConfig({serverUrl:"wss://"+this.ut.logDomain+"/zglog/tlog"}))),n.setAttributes({log_url:Bt.log_url(t.logURL)}),n.end();else if(t.logURL)return this.ot.error(ot+"log url must be a wss or https url"),this.ht.setError(n,Bt.error.kInvalidParamError),!1;return this.ot.info(ot+" call success"),n.end(),!0},Bn.prototype.setDebugVerbose=function(t){var i=this.ht.createSpan(u.H,{key:Gt.event},{key:$t},$t);Object(D.b)(t)&&(this.ut.debug=t,this.ut.debugCustom=!0,i.setAttributes({debug:Vt(t?"true":"false")})),i.end(),this.ot.info("zm.sdv call success")},Bn.prototype._setDebug=function(t){Object(D.f)(t)&&-1<t.indexOf("wss")?this.ut.debug=X(t):Array.isArray(t)&&0<t.length&&t.every((function(t){return Object(D.f)(t)&&-1<t.indexOf("wss")}))?this.ut.debug=X(t[0]):this.ot.info(rt+" server wrong"),this.ut.testEnvironment=this.ut.debug},Bn.prototype.renewToken=function(t,i){var n,e=this,s=this.ht.createSpan(u.H,{key:Ft.event,par:i},{key:""},Qt.event);return Object(D.g)(i)||Object(D.f)(i)&&""!=i?(n=this.getRoomModules(i)||this.ut.roomModulesList[0])?Object(D.f)(t)&&n.roomTryHandler?(t===n.roomTryHandler.token?(this.ot.info(_t+" token has not changed"),s.setAttributes({error:Qt.error.INPUT_PARAM.code,message:"token has not changed"}),s.end()):(s.setAttributes({token:Qt.token(t)}),this.ut.configRoomAuth?null!=(i=this.liveRoomHandler)&&i.renewToken({token:t},(function(i){var r;null!=(r=n.roomTryHandler)&&r.renewLocalToken(t,null==(r=null==i?void 0:i.body)?void 0:r.token_remain_time),e.ht.setReporterInfo(e.ut.idName||"",t),e.ut.configCheckToken=!0,s.end(),e.ot.info(_t+" "+JSON.stringify(i))}),(function(i){var r=null==(r=null==i?void 0:i.body)?void 0:r.err_code;e.ht.setError(s,i),!r||1000002014!==r&&2014!==r?e.ot.error(_t+" "+JSON.stringify(i)):(e.ut.configCheckToken=!1,null!=(r=n.roomTryHandler)&&r.renewLocalToken(t),e.ot.warn(_t+" "+JSON.stringify(i)))}),n):(null!=(i=n.roomTryHandler)&&i.renewLocalToken(t),this.ht.setReporterInfo(this.ut.idName||"",t),s.end())),!0):(Object(D.f)(t)&&!n.roomTryHandler?(this.ot.error(_t+" calling must after loginRoom"),this.ht.setError(s,Qt.error.NOT_LOGIN)):(this.ot.error(_t+" token must be string and not empty"),this.ht.setError(s,Qt.error.INPUT_PARAM)),!1):(this.ot.error(_t+" calling must after loginRoom"),this.ht.setError(s,Qt.error.NOT_LOGIN),!1):(this.ot.error(_t+" roomID must be string and no empty"),!1)},Bn.prototype.loginRoom=function(t,i,n,e){var s=this;return this.ot.info(ut+" call by user "+(null==n?void 0:n.userID)+" "+t+" "+this.version),new Promise((function(r,u){return Gn(s,void 0,void 0,(function(){var s,a,c,l,f,_,d,m,v,p,g=this;return Hn(this,(function(b){switch(b.label){case 0:return 1!==this.ut.ENV?[3,2]:[4,new Promise((function(t){wx.getNetworkType({success:function(i){g.ut.networkState="none"===i.networkType?h.offline:h.online,t()},fail:function(i){g.ot.error(rt+" network "+JSON.stringify(i)),g.ut.networkState=h.online,t()}})}))];case 1:b.sent(),b.label=2;case 2:if(a=this._loginReport(r,u,t,i,e),p=a.interResolve,s=a.interReject,a=a.loginSpan,(e=e||{}).maxMemberCount||(e.maxMemberCount=0),l=(m=this.ut).roomModulesList,f=Ft.error,!(c=m.isMultiRoom)&&0<l.length)s(f.ROOM_COUNT_EXCEED);else{for(_=0;_<l.length;_++){if((d=l[_]).roomID===t)return s(f.REPEATEDLY_LOGIN),[2];if(d=d.roomTryHandler,c&&d&&d.user.userID!==n.userID)return s(f.DIFFERENT_USER_ID),[2]}if(m=new Ki(t,this.ut,this.ot,this._dataReport,this,this.liveRoomHandler,this.service),(v=m.roomTryHandler)||(v=new Di(this.ot,this.ut,m),m.roomTryHandler=v),v.init(this.ut.roomRetryTime),v.initRoom(m.roomHandler,t,i,n,this.ut.server,this.ut.serverBak,e),v.setLoginRoomCallback(p,s),m.roomHandler._roomStateHandle(Ji,y.Logining,{code:0,msg:""}),(p=function(t,i){var n,e,s=[],r={};for(n in t)r[t[n].order]=t[n],t[n].key=n;for(e in r)s.push(r[e]);for(var o=0;o<s.length;o++)for(var u=s[o].rules,h=0;h<u.length;h++){var a={key:s[o].key,value:s[o].value,action:i.action,logger:i.logger},c=a.value,l=u[h].name?""+u[h].name:"";if((void 0===c&&l===zi.NOT_EMPTY||void 0!==c)&&xi[l]&&(l=xi[l](a.key,c,a.action,a.logger,u[h]))!=Pi)return l}return Pi}({roomID:{order:0,value:t,rules:[{name:zi.NOT_EMPTY,error:f.ROOM_ID_NULL},{name:zi.TYPE_STRING,error:f.INPUT_PARAM,extMsg:"roomID must be string"},{name:zi.MAX_LENGTH_128,error:f.ROOM_ID_TOO_LONG},{name:zi.ILLEGAL_CHARACTERS,error:f.ROOM_ID_INVALID_CHARACTER}]},token:{order:1,value:i,rules:[{name:zi.NOT_EMPTY,error:f.INPUT_PARAM},{name:zi.TYPE_STRING,error:f.INPUT_PARAM}]},user:{order:2,value:n,rules:[{name:zi.NOT_EMPTY,error:f.INPUT_PARAM,extMsg:" param user error."},{name:zi.TYPE_OBJECT,error:f.INPUT_PARAM,extMsg:" param user error."}]},"user.userID":{order:3,value:n.userID,rules:[{name:zi.NOT_EMPTY,error:f.USER_ID_NULL,extMsg:" param user error."},{name:zi.TYPE_STRING,error:f.INPUT_PARAM,extMsg:" param userID error."},{name:zi.MAX_LENGTH_64,error:f.USER_ID_TOO_LONG},{name:zi.ILLEGAL_CHARACTERS,error:f.USER_ID_INVALID_CHARACTER}]},"user.userName":{order:4,value:n.userName,rules:[{name:zi.TYPE_STRING,error:f.INPUT_PARAM,extMsg:" userName must be string."},{name:zi.MAX_LENGTH_256,error:f.USER_NAME_TOO_LONG}]},config:{order:5,value:e,rules:[]},"config.maxMemberCount":{order:6,value:e.maxMemberCount,rules:[{name:zi.TYPE_INTEGER,error:f.INPUT_PARAM,extMsg:" maxMemberCount must be integer number."}]}},{action:ut,logger:this.ot}))!==Pi)m.roomHandler._roomStateHandle(Vi,y.LoginFailed,p.error,p.extMsg),s(p.error,p.extMsg);else{if(this.ot.setSessionInfo(this.ut.appid,"","",n.userID,"",this.version),0<this.ut.roomModulesList.length&&1==this.ut.isMultiRoom?m.isMulti=!0:$n([],this.ut.roomModulesList,!0).forEach((function(t){return t.roomHandler.logout()})),e&&(m.config=e),this.ut.roomModulesList.push(m),this.netAgent&&(this.ut.idName=n.userID,this.netAgent.setUserInfo(n.userID),this.ut.actionListener("_roomLogin",t,i),this.isUaConnect)&&this.fetchAppConfig(i),a.setAttributes({id_name:n.userID}),this.ht.setCommonAttributes({id_name:n.userID}),this.ht.setReporterInfo(n.userID,i),this.ot.setTokenInfo(i,n.userID),this.ht.setSpanInMap(a,{key:Ft.event,par:t}),this.ut.setMultiRoom=!0,this.isUseNetAgent){if(!this.isUaConnect)return this.ot.info(ut," us is not connected"),m.roomHandler.setRunState(o.trylogin),this.netAgent.connectUa(),[2];this.ut.networkState=h.online}v.retryLoginRoom(!0)}}return[2]}}))}))}))},Bn.prototype.handleLogUpload=function(t){var i="";t&&t.app_config?i=t.app_config.domain:this.ut.appConfig&&this.ut.appConfig.app_config&&(i=this.ut.appConfig.app_config.domain),this.ot.info(ct+" call"),this.ot.url?this.ot.info(ct+" log is connected"):(this.ut.advanceConfig.customDomain&&this.ut.advanceConfig.customDomain.logreport?(this.ut.logDomain=this.ut.advanceConfig.customDomain.logreport,i=this._getMainDomain(this.ut.advanceConfig.customDomain.logreport)):null!=(t=this.ut.geoFencing)&&t.logreport?(this.ut.logDomain=null==(t=this.ut.geoFencing)?void 0:t.logreport,i=this._getMainDomain(null==(t=this.ut.geoFencing)?void 0:t.logreport)):this.ut.testEnvironment?(this.ut.logDomain="weblogger-hk-test.zegocloud.com",i="zegocloud.com"):0===this.stateCenter.ENV&&this.ut.svrDomains.logreport?(this.ut.logDomain=this.ut.svrDomains.logreport,i=this._getMainDomain(this.ut.svrDomains.logreport)):i&&(this.ut.logDomain="weblogger".concat(this.ut.appid,"-api.").concat(i)),i?(t="",0===this.ut.ENV?(t="wss://".concat(this.ut.logDomain,"/log"),this.ht.setConfig({serverUrl:"wss://".concat(this.ut.logDomain,"/zglog/tlog")})):t="https://".concat(this.ut.logDomain,"/httplog"),this.ot.setLogServer(t)):this.ot.warn(ct+" appconfig no domain"))},Bn.prototype.fetchAppConfigByTargetToken=function(t,i){return Gn(this,void 0,void 0,(function(){return Hn(this,(function(t){return[2,null]}))}))},Bn.prototype.fetchAppConfig=function(t){return Gn(this,void 0,void 0,(function(){var i,n,e,s,r,o,h,a;return Hn(this,(function(c){switch(c.label){case 0:if(this.ut.appConfigFetched)return this.ot.warn(at+" config fetched"),[2];if(!this.getUserID())return this.ot.warn(at+" user not exist"),[2];if(i="",t)i=t;else{if(!(0<this.ut.roomModulesList.length))return this.ot.warn(at+" token not exist"),[2];i=this.getToken()}n=this.ht.createSpan(u.H,{key:Gt.event},{key:""},"/sdk_config/init"),this.ot.info(ut+" initConfig etag: "+this.ut.appConfigEtag),-1!==this.ut.appConfigEtag&&this.ut.appConfig.speedlog_config&&void 0===this.ut.appConfig.speedlog_config.charge_info_report_cycle&&(this.ut.appConfigEtag=-1,this.ot.warn(ut+" reset etag")),e=!!this.ut.appConfig,c.label=1;case 1:return c.trys.push([1,3,,4]),[4,this.netAgent.getAppConfigByAgent("init",i,5e3,this.ut.appConfigEtag,{isSpecial:!1})];case 2:if(h=c.sent(),r=h.code,o=h.data,s=h.etag,h=h.retryCount,n.setAttributes({trigger_reason:Oi(this.ut.appConfig?"refresh":"normal"),try_count:yi(h||0)}),n.end(),this.ut.appConfigFetched=!0,this.ot.info(ut+" initConfig code:"+r+" data: "+JSON.stringify(o)+" etag: "+s),this.ut.appConfigEtag!==s){if(0==Object.keys(o).length)return this.ot.info(ut+" initConfig data null"),[2];this.ut.appConfig={app_config:h=o.app_config,media_config:{publish_config:(r=o.media_config).publish_config,play_config:r=r.play_config},speedlog_config:jn(jn({},o=o.speedlog_config),{charge_info_report_no_playing:o.charge_info_report_no_playing||0})},this.ut.appConfigEtag=s}return this.handleLogUpload(),!e&&this.ut.appConfig&&this.ut.actionListener("_appConfigRsp"),!this.ut.netAppConfig&&this.ut.appConfig&&(this.ut.netAppConfig=Object.assign(this.ut.appConfig),this.ut.actionListener("_netAppConfigRsp",this.ut.netAppConfig),this._onAppConfigUpdate)&&this._onAppConfigUpdate(this.ut.netAppConfig),[3,4];case 3:return h=c.sent(),this.ot.error(ut+" fail "+JSON.stringify(h)),n.setAttributes({error:null==h?void 0:h.code}),n.end(),[20012,20008,20019].includes(null==h?void 0:h.code)&&(a=20019===(null==h?void 0:h.code)?JSON.parse(JSON.stringify(C.SDK_NOT_SPECIAL)):JSON.parse(JSON.stringify(C.APPID_INVALID)),this.ut.roomModulesList.forEach((function(t){t.roomTryHandler&&t.roomTryHandler.loginFail(a)}))),[3,4];case 4:return[2]}}))}))},Bn.prototype._cloudReportNotify=function(t,i,n){},Bn.prototype._loginReport=function(t,i,n,e,s){var r=this,o=Ft,h=this.ht.createSpan(u.I,{key:Gt.event},{key:""},o.event);return h.setAttributes({svr_env:o.svr_env(this.ut.testEnvironment?"test":"online"),token:o.token(e)}),s&&(Object(D.b)(s.userUpdate)&&h.setAttribute("user_state_update",o.user_state_update(s.userUpdate?1:0)),Object(D.d)(s.maxMemberCount))&&h.setAttributes({max_member_cnt:o.max_member_cnt(s.maxMemberCount)}),{interResolve:function(i){var e=r.getRoomSessionID(n),s=r.getRoomModules(n),u=r.getSessionId(n);h.setAttributes({room_id:o.room_id(n),room_sid_string:o.room_sid_string(e),liveroom_sid_string:o.liveroom_sid_string(u),try_cnt:o.try_cnt(null==(e=null==s?void 0:s.roomTryHandler)?void 0:e.retryActiveCount),server:o.server(null==(u=null==s?void 0:s.roomHandler)?void 0:u.server),room_mode:o.room_mode(r.ut.isMultiRoom?1:0),role:o.role(r.ut.role),audience_create_room:o.audience_create_room(r.ut.roomCreateFlag?1:0),max_member_cnt:o.max_member_cnt((null==s?void 0:s.maxMemberCount)||0)}),h.end(),t(i)},interReject:function(t,e){var s,u;void 0===e&&(e=""),h.setAttributes({room_id:o.room_id(n)}),t.code<2e9&&1e9<t.code||t.code<1e6?(s=V(t.code,t.msg),u=F(t.code,r.isUseNetAgent)):s={code:t.code,message:t.msg},s&&r.ht.setError(h,{code:s.code,msg:s.message+e}),u&&C[u]&&(t.code=C[u].code,t.msg.includes("unknown"))&&(t.msg=C[u].msg),i(t.code&&t.msg&&""!==e?{code:t.code,msg:t.msg+e}:t)},loginSpan:h}},Bn.prototype.logoutRoom=function(t){var i=this,n=(this.ot.info(ht+" call by user "+t),[]);if(this.ut.roomModulesList.length){if(void 0===t)$n([],this.ut.roomModulesList,!0).forEach((function(t){i._logoutSpan(t),n.push(t.roomID),t.roomHandler.logout(!0)}));else{if(!Object(D.f)(t)||""==t)return this.ot.error(ht+" roomID must be string and not empty"),void this._logoutSpan(void 0,ti.error.INPUT_PARAM);var e=this.getRoomModules(t);e?(this._logoutSpan(e),n.push(t),e.roomHandler.logout()):(this.ot.error(ht+" room not exist"),this._logoutSpan(void 0,ti.error.ROOM_NOT_EXIST,t))}this.ht.deleteCommonAttributes(["id_name"]),this.ht.clearRoomSpans(n)}else this.ot.warn(ht+" no room")},Bn.prototype.uploadLog=function(){var t=this;return new Promise((function(i,n){t.ot.info("zm.zip.udlg call"),t.ot.uploadStorageLog().then((function(){t.ot.info("zm.zip.udlg call success"),i({errorCode:0,extendedData:"upload logs success!"})})).catch((function(i){t.ot.error("zm.zip.udlg upload zip log failed, result: "+((null==i?void 0:i.message)||"unknown")),n({errorCode:C.UPLOAD_LOG_ERROR.code,extendedData:C.UPLOAD_LOG_ERROR.msg+", result: "+((null==i?void 0:i.message)||"unknown")})}))}))},Bn.prototype.sendCustomCommand=function(t,i,n){return new Promise((function(t,i){console.error(T),i()}))},Bn.prototype._sendCustomCommand=function(t,i,n){return new Promise((function(t,i){console.error(T),i()}))},Bn.prototype.sendBroadcastMessage=function(t,i){return new Promise((function(t,i){console.error(T),i()}))},Bn.prototype._sendBroadcastMessage=function(t,i,n,e){return void 0===n&&(n=1),void 0===e&&(e=1),new Promise((function(t,i){console.error(T),i()}))},Bn.prototype.setRoomExtraInfo=function(t,i,n){return new Promise((function(t,i){console.error(T),i()}))},Bn.prototype._setRoomExtraInfo=function(t,i,n){return new Promise((function(t,i){console.error(T),i()}))},Bn.prototype.sendBarrageMessage=function(t,i){return new Promise((function(t,i){console.error(T),i()}))},Bn.prototype._sendBarrageMessage=function(t,i,n,e){return void 0===n&&(n=1),void 0===e&&(e=1),new Promise((function(t,i){console.error(T),i()}))},Bn.prototype.sendRelayMessage=function(t,i,n,e,s){console.error(T)},Bn.prototype.requestJoinLive=function(t,i,n,e,s){return console.error(T),!1},Bn.prototype.inviteJoinLive=function(t,i,n,e,s){return console.error(T),!1},Bn.prototype.endJoinLive=function(t,i,n,e){return console.error(T),!1},Bn.prototype.respondJoinLive=function(t,i,n,e,s){return console.error(T),!1},Bn.prototype.getVersion=function(){return this.version},Bn.prototype.setSdkBizVersion=function(t){Object(D.f)(t)&&""!==t&&(this.ut.bizVersion=t)},Bn.prototype.on=function(t,i){var n=this.ht.createSpan(u.H,{key:Ht},{key:""},Jt.event);return n.setAttributes({listener:Jt.listener(t)}),this.ut.listenerList[t]?Object(D.c)(i)?(-1==this.ut.listenerList[t].indexOf(i)&&this.ut.listenerList[t].push(i),n.end(),!0):(this.ot.error(ft+" listener callBack must be funciton"),this.ht.setError(n,Jt.error.INPUT_PARAM," listener callBack must be function"),!1):(this.ot.error(ft+" event "+t+" no found"),this.ht.setError(n,Jt.error.INPUT_PARAM," event "+t+" no found"),!1)},Bn.prototype.off=function(t,i){var n,e=this.ht.createSpan(u.H,{key:Ht},{key:""},"/sdk/off_listener");return e.setAttributes({listener:Yt(t)}),this.ut.listenerList[t]?(n=this.ut.listenerList[t],i?0<=(i=n.indexOf(i))&&n.splice(i,1):this.ut.listenerList[t]=[],e.end(),!0):(this.ot.error("zm.off listener no found"),this.ht.setError(e,Jt.error.INPUT_PARAM," event "+t+" no found"),!1)},Bn.prototype._on=function(t,i){return this.ut.listenerList[t]?Object(D.c)(i)?(-1==this.ut.listenerList[t].indexOf(i)&&this.ut.listenerList[t].push(i),!0):(this.ot.error(ft+" listener callBack must be funciton"),!1):(this.ot.error(ft+" event "+t+" no found"),!1)},Bn.prototype._off=function(t,i){var n;return this.ut.listenerList[t]?(n=this.ut.listenerList[t],i?n.splice(n.indexOf(i),1):this.ut.listenerList[t]=[],!0):(this.ot.error("zm.off listener no found"),!1)},Bn.prototype.isTestEnvironment=function(){return this.ut.testEnvironment},Bn.prototype.isLogin=function(t){return!!(t=this.getRoomModules(t)||this.ut.roomModulesList[0])&&t.isLogin()},Bn.prototype.getMultiRoom=function(){return this.ut.isMultiRoom},Bn.prototype.getAppID=function(){return this.ut.appid},Bn.prototype.getUserID=function(){return this.ut.idName},Bn.prototype.getUserName=function(){return this.ut.nickName},Bn.prototype.getToken=function(t){return(this.getRoomModules(t)||this.ut.roomModulesList[0]).token},Bn.prototype.setRoomCreateFlag=function(t){this.ut.roomCreateFlag=t},Bn.prototype.setRole=function(t){this.ut.role=t},Bn.prototype.getSessionId=function(t){return(t=this.getRoomModules(t)||this.ut.roomModulesList[0])?t.userSidString:"0"},Bn.prototype.getRoomSessionID=function(t){return(t=this.getRoomModules(t)||this.ut.roomModulesList[0])?t.roomSidString:"0"},Bn.prototype.getAppConfig=function(){return this.ut.appConfig},Bn.prototype.setTestPackageSize=function(t){this.stateCenter.configOK&&(this.ut.testNetPackageSize=t)},Bn.prototype.setCloudEnv=function(t){this.cloudSetting&&(this.cloudSetting.zegoSetting.options.online="online"===t)},Bn.prototype.setAccess=function(t){},Bn.prototype.enableMultiRoom=function(t){var i=this.ht.createSpan(u.H,{key:Gt.event},{key:""},fi.event);return Object(D.b)(t)?(i.setAttribute("is_multi",fi.is_multi(t)),0<this.ut.roomModulesList.length||this.ut.setMultiRoom?(this.ot.error("zm.emr multi room can only be set once before first login"),this.ht.setError(i,fi.error.kInvalidParamError),!1):(i.end(),this.ut.isMultiRoom=t,this.ut.setMultiRoom=!0)):(this.ot.error("zm.emr param must be boolean"),this.ht.setError(i,fi.error.kAlreadyLoginError),!1)},Bn.prototype.getRoomModules=function(t){return this.ut.roomModulesList.find((function(i){return i.roomID==t}))},Bn.prototype._onAppConfigUpdate=function(t){},Bn.prototype._onBeforePageUnload=function(){},Bn.use=function(t){switch(t.type){case"message":case"live":t.install(Bn,Ki,nn,Ln)}},Bn.setEngineOptions=function(t){if(t.customDomain&&t.customDomain&&"object"==typeof t.customDomain){if(t.customDomain.accesshub&&"string"!=typeof t.customDomain.accesshub)throw new Error("config of customDomain.accesshub should be a string.");if(t.customDomain.logreport&&"string"!=typeof t.customDomain.logreport)throw new Error("config of customDomain.logreport should be a string.");if(t.customDomain.detaillog&&"string"!=typeof t.customDomain.detaillog)throw new Error("config of customDomain.detaillog should be a string.");Bn.customDomain=t.customDomain}Bn.engineOptions=t},Bn.prototype.resetRoomTokenTimer=function(t,i){(t=this.getRoomModules(t)||this.ut.roomModulesList[0])&&i&&0<i&&t.roomHandler.resetTokenTimer(1e3*i)},Bn.prototype.isDisConnect=function(){return this.liveRoomHandler.isDisConnect()},Bn.prototype.sendMessage=function(t,i,n,e){this.liveRoomHandler.sendMessage(t,i,n,e)},Bn.prototype.getNetworkInfo=function(){return this.netAgent.getNTP()},Bn.prototype.setProtoFormat=function(t){if(!["json","pb"].includes(t=void 0===t?"json":t))throw new Error("Failed to execute 'setProtoFormat': Arguments 'format' must be 'json' or 'pb'.");this.ut.protoFormat=t},Bn.prototype.setSdkLoginRelateService=function(t){Array.isArray(t)&&t.every((function(t){return Object(D.f)(t)}))&&(this.ut.relateService=t)},Bn.prototype.getRoomID=function(){return this.ut.roomid},Bn.prototype.getServerTimeOffset=function(){return this.ut.serverTimeOffset},Bn.prototype.getReqHead=function(t){return t=Object(D.f)(t)&&""!==t&&this.getRoomModules(t)||this.ut.roomModulesList[0],this.liveRoomHandler.getReqHead(t)},Bn.prototype.sendSwitchMessage=function(t,i){throw this.ot.error("".concat("zm.ssm"," ").concat(C.WHITE_BOARD_VERSION_ERROR.msg)),C.WHITE_BOARD_VERSION_ERROR},Bn.prototype.onSwitchMessage=function(t){t&&this.liveRoomHandler&&(this.liveRoomHandler.onSwitchMessage=t)},Bn.prototype.onAppConfigUpdate=function(t){t&&(this._onAppConfigUpdate=t)},Bn.prototype.onBeforePageUnload=function(t){t&&(this._onBeforePageUnload=t)},Bn.prototype.getProtoVer=function(){return e.SWITCH_TWO},Bn.prototype.sendBusinessMessage=function(t,i,n){return Object(D.d)(t)&&i?this.liveRoomHandler.sendMessage(t,i,void 0,void 0,n,void 0,!1):-1},Bn.prototype._logoutSpan=function(t,i,n){var e,s=this,r=this.ht.createSpan(u.I,{key:Gt.event},{key:ti.event,par:null==t?void 0:t.roomID},ti.event,!0);r.setAttributes({is_multi:ti.is_multi(this.ut.isMultiRoom),is_send_cmd_net:ti.is_send_cmd_net(!0)}),t?((e=t.roomHandler).updateTimes(),r.setAttributes({room_id:ti.room_id(null==t?void 0:t.roomID),room_sid_string:ti.room_sid_string(null==t?void 0:t.roomSidString),liveroom_sid_string:ti.liveroom_sid_string(null==t?void 0:t.userSidString),valid_d:e.validTime,total_d:e.totalTime,tempbroken_cnt:e.brokenCounts})):Object(D.f)(n)&&r.setAttributes({room_id:ti.room_id(n),valid_d:0,total_d:0,tempbroken_cnt:0}),i?this.ht.setError(r,i):r.end(),setTimeout((function(){s.ht.flush()}),200)},Bn.prototype.getMsgSpan=function(t,i,n){return this.ht.createSpan(u.H,{key:Ft.event,par:i},{key:t,par:i},t,n=void 0!==n&&n)},Bn.prototype._updateTimeOffsetInterval=function(){var t=this;Object(D.d)(this.netAgent.timeOffset)&&this.ht.setTimeOffset(this.netAgent.timeOffset),this.timeOffsetUpdateTimer=setTimeout((function(){t._updateTimeOffsetInterval()}),9e5)},Bn.prototype.setNetAgentHBMode=function(t){this.netAgent.setHeartBeatMode(t)},Bn.rtmVersion="2.5.0",Bn.customDomain={},Bn.proxyCtrl=null,Bn.pageID="",Bn);function Bn(t,i,n,e,r,o,h,a){var c;if(this.ot=n,this._dataReport=e,this.ht=r,this.version=o,this._options=a,this.service={},this.Dt=null,this.zt=1e3,this.id="",this._roomLoginResponseListener=function(){},this.ut=new Ui(this.ot,this._dataReport),this.ut.ENV=h,this.ut.product="rtc_web",this.ut.advanceConfig=jn(jn({},this.ut.advanceConfig),{customDomain:Bn.customDomain}),this.getReportSeq=d,this.getSeq=_,this._initCallback(),this.ut.deviceID=(void 0===(n=h)&&(n=0),(n=A("z_deviceID"))||((new Date).getTime(),z("z_deviceID",n=K()),n)),Bn.pageID||(Bn.pageID=K()),e=this.ut.id=K(),this.logger.info("".concat(rt," deviceID: ").concat(this.ut.deviceID,", pageID: ").concat(Bn.pageID,", instID: ").concat(e)),this.ht.init(t,h,this.ut.deviceID),this.ht.setLogger(this.ot),this.ut.reporter=this.ht,o=this.ht.createSpan(u.H,{key:""},{key:(r=Gt).event},r.event,!0),0!=h&&1!=h||this._setDebug(i),a="Express",null!=(n=this._options)&&n.reportData&&(c=null==(n=null==(e=this._options)?void 0:e.reportData)?void 0:n.version,a=(null==(n=null==(e=this._options)?void 0:e.reportData)?void 0:n.project)||a),o.setAttributes({biz_type:r.biz_type(0),project:r.project(a),servers:r.servers(Object(D.f)(i)?[i]:i),liveroom_version:r.liveroom_version(c),is_from_cache:r.is_from_cache(!1),sev_env:r.sev_env(this.ut.testEnvironment?"test":"online")}),function(t,i,n){if(t&&Object(D.d)(t)&&q(t)){if(i&&(Object(D.f)(i)||Array.isArray(i))&&""!=i)return 1;n.error("ccp.0 server must be string or string array and not empty")}else n.error("ccp.0 appid must be positive integer number and not empty")}(t,i,this.ot)){this.ut.appid=t,this.ut.configOK=!0,this.ut.sdKVersion=this.version,this.netAgent=new I,this.ot.setSessionInfo(this.ut.appid,"","","","",this.version),this.netAgent.init(),this.netAgent.setLogger(this.ot),e={appID:this.ut.appid,env:this.ut.ENV,mode:this.ut.mode},Bn.engineOptions&&Bn.engineOptions.pri&&(e.model=1),this.netAgent.setAppInfo(e),this.liveRoomHandler=new Ln(this.ot,this.ut,this.netAgent,this._dataReport,this),this.wt(),o.setAttributes({use_na:r.use_na(1)}),o.end(),Object(D.f)(i)?(this.ut.server=i,this.ut.serverBak=i):Array.isArray(i)&&0<i.length&&(this.ut.server=i[0],this.ut.serverBak=i[1]||i[0]),this.ot.info("".concat(rt," ").concat(null!=(n=null===navigator||void 0===navigator?void 0:navigator.appVersion)?n:""," ").concat(this.version," rtmVersion: ").concat(Bn.rtmVersion," logVersion:").concat(s.ZegoLogger.logVersion)),this._bindWxListener();try{var l,f={brand:(l=wx.getSystemInfoSync()).brand,model:l.model,system:l.system,platform:l.platform,version:l.version,SDKVersion:l.SDKVersion};this.ot.info(rt+" "+JSON.stringify(f)),o.setAttribute("mini_sys_infos",f),o.end()}catch(t){this.ot.warn(rt+" get system info error")}this.ot.setSessionInfo(this.ut.appid,"","","","",this.version)}else this.ot.error("".concat(rt," init sdk error")),this.ht.setError(o,r.error.kInvalidParamError);this.ut.onListener("roomLoginResponse",this._roomLoginResponseListener)}Yn.prototype.setAttributes=function(t){this._dataReport.addMsgInfo(this._seq,t)},Yn.prototype.setAttribute=function(t,i){this._dataReport.addMsgInfo(this._seq,{key:i})},Yn.prototype.end=function(t){this._dataReport.uploadReport(this._seq)};var Jn=Yn;function Yn(t,i){this._dataReport=t,this._seq=i}Wn.setReportCustomerContext=function(t){},Wn.prototype.init=function(t,i,n){},Wn.prototype.setConfig=function(t){},Wn.prototype.loadScript=function(t,i,n,e){return Promise.resolve()},Wn.prototype.setReporterInfo=function(t,i){},Wn.prototype.flush=function(t){},Wn.prototype.destroy=function(){},Wn.prototype.setCommonStates=function(t){},Wn.prototype.setResource=function(t){},Wn.prototype.setCommonAttributes=function(t){},Wn.prototype.deleteCommonAttributes=function(t){},Wn.prototype.clearRoomSpans=function(t){},Wn.prototype.setPublicPros=function(t){},Wn.prototype.createSpan=function(t,i,n,e,s){i&&i.key&&i.par?(o=i.par1?"_"+i.par1:"",!(r=null==(r=this._reportList[i.key])?void 0:r[i.par+o])&&i.bak_key&&(r=null==(u=this._reportList[i.bak_key])?void 0:u[i.par+o])):i&&!(r=this._reportList[i.key])&&i.bak_key&&(r=this._reportList[i.bak_key]),r=r||this._reportList[Gt.event];var r,o,u=d();return this.dataReport.newReport(u,e),i=new Jn(this.dataReport,u),s&&(n.par?(this._reportList[n.key]||(this._reportList[n.key]={}),this._reportList[n.key][n.par+(o=n.par1?"_"+n.par1:"")]=i):this._reportList[n.key]=i),i},Wn.prototype.setSpanInMap=function(t,i){i.par?(this._reportList[i.key]||(this._reportList[i.key]={}),this._reportList[i.key][i.par+(i.par2?"_"+i.par2:"")]=t):this._reportList[i.key]=t},Wn.prototype.spanEnd=function(t,i,n){var e;t.par?(e=t.par1?"_"+t.par1:"",e=this._reportList[t.key]&&this._reportList[t.key][t.par+e],this._reportList[t.key]&&!n&&delete this._reportList[t.key][t.par]):(e=this._reportList[t.key],n||delete this._reportList[t.key]),e&&(this.dataReport.addMsgInfo(e.seq,i),this.dataReport.uploadReport(e.seq))},Wn.prototype.spanSetAttributes=function(t,i){var n,e;t.par?(n=t.par1?"_"+t.par1:"",!(e=this._reportList[t.key]&&this._reportList[t.key][t.par+n])&&t.bak_key&&(e=this._reportList[t.bak_key]&&this._reportList[t.bak_key][t.par+n])):!(e=this._reportList[t.key])&&t.bak_key&&(e=this._reportList[t.key]),e&&(this.dataReport.addMsgInfo(e.seq,i),this.dataReport.uploadReport(e.seq))},Wn.prototype.spanAppendAttribute=function(t,i,n){this.ot.warn("zm.zr.saa not support this func "+(null==t?void 0:t.key))},Wn.prototype.setError=function(t,i,n){this.dataReport.uploadReport(t.seq,void 0,i,n)},Wn.prototype.setLogger=function(t){},Wn.prototype.setTimeOffset=function(t){},Wn.prototype.setUnloadState=function(t){},Wn.prototype.setNetStateCheck=function(){};var Fn=Wn;function Wn(t){this.ot=t,this._reportList={},this._publicPros={},this.dataReport=new s.ZegoDataReport(t)}Zn.prototype.enableMultiRoom=function(t){return this.zegoWebRTM.enableMultiRoom(t)},Zn.prototype.loginRoom=function(t,i,n,e){return this.zegoWebRTM.loginRoom(t,i,n,e)},Zn.prototype.logoutRoom=function(t){return this.zegoWebRTM.logoutRoom(t)},Zn.prototype.renewToken=function(t,i){return this.zegoWebRTM.renewToken(t,i)},Zn.prototype.sendBarrageMessage=function(t,i){return this.zegoWebRTM.sendBarrageMessage(t,i)},Zn.prototype.sendBroadcastMessage=function(t,i){return this.zegoWebRTM.sendBroadcastMessage(t,i)},Zn.prototype.sendCustomCommand=function(t,i,n){return this.zegoWebRTM.sendCustomCommand(t,i,n)},Zn.prototype.setRoomExtraInfo=function(t,i,n){return this.zegoWebRTM.setRoomExtraInfo(t,i,n)},Zn.prototype.setLogConfig=function(t){return this.zegoWebRTM.setLogConfig(t)},Zn.prototype.setDebugVerbose=function(t){return this.zegoWebRTM.setDebugVerbose(t)},Zn.prototype.on=function(t,i){return this.zegoWebRTM.on(t,i)},Zn.prototype.getVersion=function(){return this.zegoWebRTM.getVersion()},Zn.prototype.off=function(t,i){return this.zegoWebRTM.off(t,i)},Zn.use=function(t){Vn.use(t)},Zn.setGeoFence=function(t,i){},Zn.setEngineOptions=function(t){Vn.setEngineOptions(t)},Zn.setCloudProxyConfig=function(t,i,n){},Zn.setLocalProxyConfig=function(t,i){},Zn.version="2.5.0";var Xn=Zn;function Zn(t,i,n,e){this.logger=new s.ZegoLogger(n=void 0===n?0:n),this.dataReport=new s.ZegoDataReport(this.logger),this.reporter=new Fn(this.logger),this.zegoWebRTM=new Vn(t,i,this.logger,this.dataReport,this.reporter,Zn.version,n,e)}}],e={},i.m=n,i.c=e,i.d=function(t,n,e){i.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:e})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,n){if(1&n&&(t=i(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(i.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var s in t)i.d(e,s,function(i){return t[i]}.bind(null,s));return e},i.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(n,"a",n),n},i.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},i.p="",i(i.s=10);function i(t){var s;return(e[t]||(s=e[t]={i:t,l:!1,exports:{}},n[t].call(s.exports,s,s.exports,i),s.l=!0,s)).exports}var n,e}(n(100))},533:function(t){"undefined"!=typeof self&&self,t.exports=function(){return i={0:function(t,i,n){"use strict";function e(t){return"number"==typeof t}function s(t){return"string"==typeof t}function r(t){return"boolean"==typeof t}function o(t){return void 0===t}function u(t){return null!==t&&t instanceof Object}function h(t){return"function"==typeof t}function a(t){return t instanceof Array}n.d(i,"d",(function(){return e})),n.d(i,"f",(function(){return s})),n.d(i,"b",(function(){return r})),n.d(i,"g",(function(){return o})),n.d(i,"e",(function(){return u})),n.d(i,"c",(function(){return h})),n.d(i,"a",(function(){return a}))},1:function(t,i,n){var e=function(t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=null;try{i=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(t){}function n(t,i,n){this.low=0|t,this.high=0|i,this.unsigned=!!n}function e(t){return!0===(t&&t.__isLong__)}function s(t){var i=Math.clz32(t&-t);return t?31-i:i}Object.defineProperty(n.prototype,"__isLong__",{value:!0}),n.isLong=e;var r={},o={};function u(t,i){var n,e,s;return i?(s=0<=(t>>>=0)&&t<256)&&(e=o[t])?e:(n=a(t,0,!0),s&&(o[t]=n),n):(s=-128<=(t|=0)&&t<128)&&(e=r[t])?e:(n=a(t,t<0?-1:0,!1),s&&(r[t]=n),n)}function h(t,i){if(isNaN(t))return i?g:p;if(i){if(t<0)return g;if(d<=t)return O}else{if(t<=-m)return y;if(m<=t+1)return R}return t<0?h(-t,i).neg():a(t%_|0,t/_|0,i)}function a(t,i,e){return new n(t,i,e)}n.fromInt=u,n.fromNumber=h,n.fromBits=a;var c=Math.pow;function l(t,i,n){if(0===t.length)throw Error("empty string");if(i="number"==typeof i?(n=i,!1):!!i,"NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return i?g:p;if((n=n||10)<2||36<n)throw RangeError("radix");var e;if(0<(e=t.indexOf("-")))throw Error("interior hyphen");if(0===e)return l(t.substring(1),i,n).neg();for(var s=h(c(n,8)),r=p,o=0;o<t.length;o+=8){var u=Math.min(8,t.length-o),a=parseInt(t.substring(o,o+u),n);r=(u<8?(u=h(c(n,u)),r.mul(u)):r=r.mul(s)).add(h(a))}return r.unsigned=i,r}function f(t,i){return"number"==typeof t?h(t,i):"string"==typeof t?l(t,i):a(t.low,t.high,"boolean"==typeof i?i:t.unsigned)}n.fromString=l,n.fromValue=f;var _=4294967296,d=_*_,m=d/2,v=u(1<<24),p=u(0),g=(n.ZERO=p,u(0,!0)),b=(n.UZERO=g,u(1)),E=(n.ONE=b,u(1,!0)),S=(n.UONE=E,u(-1)),R=(n.NEG_ONE=S,a(-1,2147483647,!1)),O=(n.MAX_VALUE=R,a(-1,-1,!0)),y=(n.MAX_UNSIGNED_VALUE=O,a(0,-2147483648,!1)),T=(n.MIN_VALUE=y,n.prototype);return T.toInt=function(){return this.unsigned?this.low>>>0:this.low},T.toNumber=function(){return this.unsigned?(this.high>>>0)*_+(this.low>>>0):this.high*_+(this.low>>>0)},T.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";var i,n;if(this.isNegative())return this.eq(y)?(n=h(t),n=(i=this.div(n)).mul(n).sub(this),i.toString(t)+n.toInt().toString(t)):"-"+this.neg().toString(t);for(var e=h(c(t,6),this.unsigned),s=this,r="";;){var o=s.div(e),u=(s.sub(o.mul(e)).toInt()>>>0).toString(t);if((s=o).isZero())return u+r;for(;u.length<6;)u="0"+u;r=""+u+r}},T.getHighBits=function(){return this.high},T.getHighBitsUnsigned=function(){return this.high>>>0},T.getLowBits=function(){return this.low},T.getLowBitsUnsigned=function(){return this.low>>>0},T.getNumBitsAbs=function(){if(this.isNegative())return this.eq(y)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,i=31;0<i&&0==(t&1<<i);i--);return 0!=this.high?i+33:i+1},T.isZero=function(){return 0===this.high&&0===this.low},T.eqz=T.isZero,T.isNegative=function(){return!this.unsigned&&this.high<0},T.isPositive=function(){return this.unsigned||0<=this.high},T.isOdd=function(){return 1==(1&this.low)},T.isEven=function(){return 0==(1&this.low)},T.equals=function(t){return e(t)||(t=f(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&this.high===t.high&&this.low===t.low},T.eq=T.equals,T.notEquals=function(t){return!this.eq(t)},T.neq=T.notEquals,T.ne=T.notEquals,T.lessThan=function(t){return this.comp(t)<0},T.lt=T.lessThan,T.lessThanOrEqual=function(t){return this.comp(t)<=0},T.lte=T.lessThanOrEqual,T.le=T.lessThanOrEqual,T.greaterThan=function(t){return 0<this.comp(t)},T.gt=T.greaterThan,T.greaterThanOrEqual=function(t){return 0<=this.comp(t)},T.gte=T.greaterThanOrEqual,T.ge=T.greaterThanOrEqual,T.compare=function(t){var i,n;return e(t)||(t=f(t)),this.eq(t)?0:(i=this.isNegative(),n=t.isNegative(),i&&!n?-1:!i&&n?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1)},T.comp=T.compare,T.negate=function(){return!this.unsigned&&this.eq(y)?y:this.not().add(b)},T.neg=T.negate,T.add=function(t){e(t)||(t=f(t));var i=0,n=0,s=0,r=0;return n+=(s=s+((r+=(65535&this.low)+(65535&t.low))>>>16)+((this.low>>>16)+(t.low>>>16)))>>>16,a((s&=65535)<<16|(r&=65535),((i+=(n+=(65535&this.high)+(65535&t.high))>>>16)+((this.high>>>16)+(t.high>>>16))&65535)<<16|(n&=65535),this.unsigned)},T.subtract=function(t){return e(t)||(t=f(t)),this.add(t.neg())},T.sub=T.subtract,T.multiply=function(t){var n,s,r,o,u,c,l,_,d,m;return this.isZero()?this:(e(t)||(t=f(t)),i?a(i.mul(this.low,this.high,t.low,t.high),i.get_high(),this.unsigned):t.isZero()?this.unsigned?g:p:this.eq(y)?t.isOdd()?y:p:t.eq(y)?this.isOdd()?y:p:this.isNegative()?t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg():t.isNegative()?this.mul(t.neg()).neg():this.lt(v)&&t.lt(v)?h(this.toNumber()*t.toNumber(),this.unsigned):(o=t.high>>>16,u=65535&t.high,c=t.low>>>16,m=(m=d=_=l=0)+((_=_+((d+=(r=65535&this.low)*(t=65535&t.low))>>>16)+(s=this.low>>>16)*t)>>>16)+((_=(65535&_)+r*c)>>>16),a((_&=65535)<<16|(d&=65535),(l=(l=(l+=(m+=(n=65535&this.high)*t)>>>16)+((m=(65535&m)+s*c)>>>16)+((m=(65535&m)+r*u)>>>16))+((this.high>>>16)*t+n*c+s*u+r*o)&65535)<<16|(m&=65535),this.unsigned)))},T.mul=T.multiply,T.divide=function(t){if((t=e(t)?t:f(t)).isZero())throw Error("division by zero");var n,s,r;if(i)return this.unsigned||-2147483648!==this.high||-1!==t.low||-1!==t.high?a((this.unsigned?i.div_u:i.div_s)(this.low,this.high,t.low,t.high),i.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?g:p;if(this.unsigned){if((t=t.unsigned?t:t.toUnsigned()).gt(this))return g;if(t.gt(this.shru(1)))return E;s=g}else{if(this.eq(y))return t.eq(b)||t.eq(S)?y:t.eq(y)?b:(r=this.shr(1).div(t).shl(1)).eq(p)?t.isNegative()?b:S:(n=this.sub(t.mul(r)),r.add(n.div(t)));if(t.eq(y))return this.unsigned?g:p;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();s=p}for(n=this;n.gte(t);){r=Math.max(1,Math.floor(n.toNumber()/t.toNumber()));for(var o=Math.ceil(Math.log(r)/Math.LN2),u=o<=48?1:c(2,o-48),l=h(r),_=l.mul(t);_.isNegative()||_.gt(n);)_=(l=h(r-=u,this.unsigned)).mul(t);l.isZero()&&(l=b),s=s.add(l),n=n.sub(_)}return s},T.div=T.divide,T.modulo=function(t){return e(t)||(t=f(t)),i?a((this.unsigned?i.rem_u:i.rem_s)(this.low,this.high,t.low,t.high),i.get_high(),this.unsigned):this.sub(this.div(t).mul(t))},T.mod=T.modulo,T.rem=T.modulo,T.not=function(){return a(~this.low,~this.high,this.unsigned)},T.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},T.clz=T.countLeadingZeros,T.countTrailingZeros=function(){return this.low?s(this.low):s(this.high)+32},T.ctz=T.countTrailingZeros,T.and=function(t){return e(t)||(t=f(t)),a(this.low&t.low,this.high&t.high,this.unsigned)},T.or=function(t){return e(t)||(t=f(t)),a(this.low|t.low,this.high|t.high,this.unsigned)},T.xor=function(t){return e(t)||(t=f(t)),a(this.low^t.low,this.high^t.high,this.unsigned)},T.shiftLeft=function(t){return e(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?a(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):a(0,this.low<<t-32,this.unsigned)},T.shl=T.shiftLeft,T.shiftRight=function(t){return e(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?a(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):a(this.high>>t-32,0<=this.high?0:-1,this.unsigned)},T.shr=T.shiftRight,T.shiftRightUnsigned=function(t){return e(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?a(this.low>>>t|this.high<<32-t,this.high>>>t,this.unsigned):a(32===t?this.high:this.high>>>t-32,0,this.unsigned)},T.shru=T.shiftRightUnsigned,T.shr_u=T.shiftRightUnsigned,T.rotateLeft=function(t){var i;return e(t)&&(t=t.toInt()),0==(t&=63)?this:32===t?a(this.high,this.low,this.unsigned):t<32?a(this.low<<t|this.high>>>(i=32-t),this.high<<t|this.low>>>i,this.unsigned):a(this.high<<(t-=32)|this.low>>>(i=32-t),this.low<<t|this.high>>>i,this.unsigned)},T.rotl=T.rotateLeft,T.rotateRight=function(t){var i;return e(t)&&(t=t.toInt()),0==(t&=63)?this:32===t?a(this.high,this.low,this.unsigned):t<32?a(this.high<<(i=32-t)|this.low>>>t,this.low<<i|this.high>>>t,this.unsigned):a(this.low<<(i=32-(t-=32))|this.high>>>t,this.high<<i|this.low>>>t,this.unsigned)},T.rotr=T.rotateRight,T.toSigned=function(){return this.unsigned?a(this.low,this.high,!1):this},T.toUnsigned=function(){return this.unsigned?this:a(this.low,this.high,!0)},T.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},T.toBytesLE=function(){var t=this.high,i=this.low;return[255&i,i>>>8&255,i>>>16&255,i>>>24,255&t,t>>>8&255,t>>>16&255,t>>>24]},T.toBytesBE=function(){var t=this.high,i=this.low;return[t>>>24,t>>>16&255,t>>>8&255,255&t,i>>>24,i>>>16&255,i>>>8&255,255&i]},n.fromBytes=function(t,i,e){return e?n.fromBytesLE(t,i):n.fromBytesBE(t,i)},n.fromBytesLE=function(t,i){return new n(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,i)},n.fromBytesBE=function(t,i){return new n(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],i)},t.default=n,"default"in t?t.default:t}({});void 0!==(i=function(){return e}.apply(i,[]))&&(t.exports=i)},11:function(t,i,n){"use strict";function e(t){return t}function s(t){return t}function r(t){return t}n.r(i);var o,u="zm.scc",h="zm.sbcm",a="zm.srlm",c="zm.sbrm",l="zm.msg.sdr",f="zm.msg.rlr",_="zm.msg.rps",d="zm.msg.srm",m="zm.msg.scm",v="zm.msg.sbm",p="zm.msg.bps",g="zm.msg.slm",b="zm.sv.ps",E={code:1100001,msg:"input parm error."},S={code:1100002,msg:"network timeout."},R={code:1000002,msg:"not login"},O={code:1009001,msg:"message content is empty"},y={code:1009010,msg:"failed to send message"},T={code:1002014,msg:"room not exist"},w={code:1002099,msg:"room inner error"},I={code:1109001,msg:"frequency limited."},N={INPUT_PARAM:E,IM_CONTENT_NULL:O,IM_CONTENT_TOO_LONG:B={code:1009002,msg:"message content is too long"},ROOM_NOT_EXIST:T},C="/liveroom/send_custom_command",k=s,z={INPUT_PARAM:E,IM_CONTENT_NULL:O,IM_CONTENT_TOO_LONG:B,ROOM_NOT_EXIST:T},A="/liveroom/send_room_message",D=r,M=r,P={INPUT_PARAM:E,IM_CONTENT_NULL:O,IM_CONTENT_TOO_LONG:B,ROOM_NOT_EXIST:T},x=s,U=s,L=E,q={code:1102022,msg:"trans send frequently"},j=T,G=e,H=e,$=s,V=r,B=((O=o=o||{})[O.I=0]="I",O[O.H=10]="H",O[O.M=100]="M",O[O.L=1e3]="L",n(1)),J=n.n(B),Y=n(0),F=(Object.defineProperty(W.prototype,"_isUseNetAgent",{get:function(){return this.h.useNetAgent},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"u",{get:function(){return this.h.reporter},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"_serviceHandler",{get:function(){return this._liveRoomHandler},enumerable:!1,configurable:!0}),W.prototype.loginRsp=function(t){var i=this,n=t.body,e=n.ret_timestamp,s=n.bigim_time_window,r=n.dati_time_window,o=n.trans_seqs;if(null!=e&&Object(Y.f)(e)&&(n=parseFloat(e),this._serverTimeOffset=0==n?0:+e-(new Date).getTime()),s&&Object(Y.d)(s)&&(this._bigimTimeWindow=s),r&&Object(Y.d)(r)&&(this._datiTimeWindow=r),o)for(var u=0;u<o.length;u++){var h=o[u].trans_channel,a=o[u].trans_seq_list||o[u].trans_seq_array;0<(a=(a=a.filter((function(t){var n=t.trans_type;return t=t.trans_seq,!i.transSeqMap[n]||i.transSeqMap[n].seq<t}))).map((function(t){return{trans_type:t.trans_type,trans_local_seq:t.trans_seq}}))).length&&this.fetchReliableMessage(h,a)}null!=(n=t.body)&&n.user_trans_channel_list&&this.userTransMessageHandler(null==(e=t.body)?void 0:e.user_trans_channel_list)},W.prototype.fetchUserTransMessage=function(t,i){function n(t){e.handleFetchUserTransRsp(t)}var e=this;this.v.info("zb.mh.futm.0 call"),this._serviceHandler.fetchUserTransInfo(t={trans_channel:t,fetch_array:i},n,n,this._room),this.v.info("zb.mh.futm.0 call success")},W.prototype.userTransMessageHandler=function(t){var i=this;if(t)for(var n=this,e=0;e<t.length;e++)!function(e){var s=t[e].trans_channel;0<(e=(e=t[e].trans_seq_list).filter((function(t){var n=t.trans_type;return t=t.trans_seq,i.userTransSeqMap[s]||(i.userTransSeqMap[s]={}),!i.userTransSeqMap[s][n]||i.userTransSeqMap[s][n].seq<t}))).length&&n.fetchUserTransMessage(s,e)}(e)},W.prototype.handleFetchUserTransRsp=function(t){if(t.body&&0!=t.body.err_code)this.v.error("zb.mh.hfutr user trans send error "+t.body.err_code);else if(t.header&&t.body){var i=t.body.user_trans_list,n=t.body.trans_channel,e=[];if(Array.isArray(i)&&0<i.length){for(var s=0;s<i.length;s++){var r=i[s],o=r.trans_type,u=r.trans_seq;this.userTransSeqMap[n]||(this.userTransSeqMap[n]={}),!this.userTransSeqMap[n][o]||this.userTransSeqMap[n][o].seq<u?(this.userTransSeqMap[n][o]={seq:u},e.push(r)):this.v.warn("zb.mh.hfutr fetch trans seq wrong"),this.v.info("zb.mh.hfutr trans "+o+" seq "+u)}0<e.length&&this.h.actionListener("_userTransUpdate",this._room.roomID,n,e),this.v.info("zb.mh.hfutr call success")}}else this.v.error("zb.mh.hfutr user trans send error "+JSON.stringify(t))},W.prototype.sendReliableMessage=function(t,i,n,e){var s,r=this;this.v.info(l+" call"),this._room.isLogin()?this._isReliable?(this.v.error(l+" send too often"),e(q)):(this.transSeqMap[t]||(this.transSeqMap[t]={seq:0}),s={trans_type:t,trans_data:i,trans_local_seq:this.transSeqMap[t].seq,trans_channel:"clt"},this._isReliable=!0,this._serviceHandler.sendReliableMessage(s,(function(e){r.transSeqMap[t].seq=e.body.trans_seq,r.v.info(l+" trans "+t+" seq "+e.body.trans_seq),r._isReliable=!1,r.roomExtraInfo[t]={key:t,value:i,updateUser:{userID:r._room.userID,userName:r._room.userName},updateTime:Date.now()},n({seq:e.header.seq,errorCode:0})}),(function(t){var i=w;t.body&&t.body.err_code?(i=r._rtm.getServerError(t.body.err_code),r.v.error(d+"  "+i.msg)):i=t,r._isReliable=!1,e(i)}),this._room)):(this.v.error(l+" state error"),e&&e(R))},W.prototype.fetchReliableMessage=function(t,i){function n(t){e.handleFetchTransRsp(t,s)}var e=this,s=(t={trans_channel:t,fetch_array:i},this.u.createSpan(o.H,{key:"/sdk/login",par:this._room.roomID},{key:""},"/liveroom/get_room_extrainfo"));s.setAttributes({fetch_array:G(i)}),this._serviceHandler.fetchReliableMessage(t,n,n,this._room),this.v.info("zm.msg.frm call success")},W.prototype.handleFetchTransRsp=function(t,i){if(t.body&&0!=t.body.err_code)this.v.error(f+" trans send error "+t.body.err_code),this.h.tracer.setError(i,{code:t.body.err_code});else if(t.header&&t.body){var n=t.body.trans_list||t.body.trans_fetch_results,e=[],s=[];if(Array.isArray(n)&&0<n.length){for(var r=0;r<n.length;r++){var o,u,h=n[r];1000001109===h.err_code?this.v.warn(f+" fetch trans unknown type "+h.err_code):(s.push({trans_type:o=h.trans_type,trans_seq:u=h.trans_seq}),1000001110===h.err_code?(this.v.warn(f+" fetch trans seq is wrong "+h.err_code),this.transSeqMap[o]={seq:u}):!this.transSeqMap[o]||this.transSeqMap[o].seq<u?(this.transSeqMap[o]={seq:u},e.push(h)):this.v.warn(f+" fetch trans seq wrong"))}this.roomExtraInfo={},0<e.length&&this.onRecvReliableMessage(e)}i.setAttributes({result_array:H(s)}),i.end()}else this.v.error(f+" trans send error "+t),this.h.tracer.setError(i,S)},W.prototype.handlePushTransMsg=function(t){var i,n=t.body.trans_type,e=t.body.trans_seq;!this.transSeqMap[n]||this.transSeqMap[n].seq<e?(this.transSeqMap[n]={seq:e},this.onRecvReliableMessage([t.body],(null==(i=null==t?void 0:t.body)?void 0:i.trans_idname)===this.h.idName||(null==(i=null==t?void 0:t.body)?void 0:i.id_name)===this.h.idName)):this.v.warn(_+" trans seq wrong"),this.v.info(_+" trans "+n+" seq "+e)},W.prototype.handlePushUserTransMsg=function(t){this.v.info("zb.mh.hputr.0 call");var i=t.body.trans_seq_list,n=t.body.trans_channel,e=[];if(n&&Array.isArray(i)&&0<i.length){for(var s=0;s<i.length;s++){var r=i[s].trans_type,o=i[s].trans_seq;this.userTransSeqMap[n]||(this.userTransSeqMap[n]={}),(!this.userTransSeqMap[n][r]||this.userTransSeqMap[n][r].seq<o)&&(this.userTransSeqMap[n][r]={seq:o},e.push(i[s]))}0<e.length?this.h.actionListener("_userTransUpdate",this._room.roomID,n,e):this.v.warn("zb.mh.hputr.0 no fetch user trans")}else this.v.warn("zb.mh.hputr.0 no push user trans")},W.prototype.sendRoomMsg=function(t,i,n,e,s,r){var o=this;if(!this._room.isLogin())return this.v.error(d+" state error"),r(R),!1;var u=Date.parse(new Date+"");return 0<this._sendRoomMsgTime&&this._sendRoomMsgTime+this._sendRoomMsgInterval>u?(this.v.info(d+" freq error"),r&&r(I,0,t,e),!1):(this._sendRoomMsgTime=u,u=this._serviceHandler.sendRoomMsg({msg_category:t,msg_type:1,msg_priority:1,msg_content:e},(function(t){s({seq:t.header.seq,errorCode:0,messageID:t.body.msg_id})}),(function(t){var i,n,e=w;t.header&&t.body?(n=(i=[o._rtm.getServerError(t.body.err_code),t.body.msg_id])[1],o.v.error(d+"  "+(e=i[0]).msg),r({seq:t.header.seq,errorCode:(e=e==S?y:e).code,messageID:n})):(t.code&&t.msg&&(e=t),r({seq:0,errorCode:e.code,messageID:0}))}),this._room),this.u.spanSetAttributes({key:A,par:null==(t=this._room)?void 0:t.roomID},{send_seq:D(u)}),this.v.info(d+"  call success"),!0)},W.prototype.handlePushRoomMsg=function(t){var i,n=[];this._isUseNetAgent&&(i=t.body.msg_list,t.body.msg_list.forEach((function(t){t={fromUser:{userID:t.id_name,userName:t.nick_name},message:t.msg_content,sendTime:t.send_time.toNumber(),messageID:t.msg_id.toNumber()},n.push(t)})),t.body.server_msg_id=t.body.server_msg_id.toNumber(),t.body.ret_msg_id=t.body.ret_msg_id.toNumber()),this.h.actionListener("IMRecvBroadcastMessage",this._room.roomID,n),this.h.actionListener("_recvRoomMsg",i,t.body.server_msg_id,t.body.ret_msg_id)},W.prototype.sendCustomCommand=function(t,i,n,e){var s,r=this;return this._room.isLogin()?(i={from_userid:this.h.idName,from_username:this.h.nickName,request_id:this.h.getRequestId(),custom_content:i||"",room_id:this._room.roomID},this.u.spanSetAttributes({key:C,par:null==(s=this._room)?void 0:s.roomID},{request_id:k(i.request_id)}),s={dest_id_name:t,custom_msg:JSON.stringify(i)},this._serviceHandler.sendCustomCommand(s,(function(t){n({seq:t.header.seq,errorCode:0})}),(function(t){var i,n=r._rtm.getServerError(t.body.err_code);r.v.error(m+" "+n.msg),i=2===(null==(i=t.body)?void 0:i.err_code)||1000000002===(null==(i=t.body)?void 0:i.err_code)?E:n==S?y:n,e({seq:t.header.seq,errorCode:i.code,code:i.code})}),this._room),this.v.info(m+" call success"),!0):(this.v.error(m+" state error"),e(R),!1)},W.prototype.handlePushCustomMsg=function(t){t=[(t=JSON.parse(t.body.custommsg)).from_userid,t.from_username,t.room_id,t.custom_content],this.h.actionListener("IMRecvCustomCommand",t[2],{userID:t[0],userName:t[1]},t[3])},W.prototype.sendBigRoomMessage=function(t,i,n,e,s,r){var o,u,h,a,c=this;this._room.isLogin()?(o=this._bigimTimeWindow,u=this._serverTimeOffset,h=(new Date).getTime()+u,a=this._rtm.getSeq().toString(),this._bigImCallbackMap[a]={success:s,error:r},0==o?this.sendBigRoomMessageInternal([{msg_category:t,msg_type:1,msg_content:e,bigmsg_client_id:a}],(function(t){c.handleBigImMsgRsp(t)}),(function(t){r&&r(t)})):(s=Math.floor(h/o),this._bigImLastTimeIndex<s&&0==this._bigIMmessageList.length?(this._bigImLastTimeIndex=s,this.sendBigRoomMessageInternal([{msg_category:t,msg_type:1,msg_content:e,bigmsg_client_id:a}],(function(t){c.handleBigImMsgRsp(t)}),(function(t){r&&r(t)}))):(this._bigIMmessageList.push({msg_category:t,msg_type:1,msg_content:e,bigmsg_client_id:a}),1==this._bigIMmessageList.length&&this.setBigImTimer(u,o)))):(this.v.error(v+" state error"),r&&r(R))},W.prototype.sendBigRoomMessageInternal=function(t,i,n){this._serviceHandler.sendBigRoomMessage({msgs:t},(function(t){i(t)}),(function(t){var i=w;t.header&&t.body||(t.code&&t.msg&&(i=t),n(i)),n(i)}),this._room),this.v.info(v+" sendBigRoomMessage called")},W.prototype.handleBigImMsgRsp=function(t){this._bigimTimeWindow=t.body.bigim_time_window;for(var i=t.body.msg_list||t.body.msgs,n=0;n<i.length;n++){var e,s=i[n].msg_client_id||i[n].bigmsg_client_id;this._bigImCallbackMap[s]&&(null!=(e=this._bigImCallbackMap[s].success)&&e({seq:t.header.seq,errorCode:0,messageID:i[n].msg_id||i[n].bigmsg_id}),delete this._bigImCallbackMap[s])}},W.prototype.setBigImTimer=function(t,i){var n=this;t=i-((new Date).getTime()+t)%i,i=this._rtm.generateRandumNumber(i)+t,this._bigImTimer=setTimeout((function(){n.onBigImTimer()}),i)},W.prototype.onBigImTimer=function(){for(var t=this,i=(new Date).getTime()+this._serverTimeOffset,n=(this._bigImLastTimeIndex=Math.floor(i/this._bigimTimeWindow),[]),e=[],s=0;s<this._bigIMmessageList.length&&!(20<=s);s++){var r=this._bigIMmessageList[s];n.push({msg_category:r.msg_category,msg_type:r.msg_type,msg_content:r.msg_content,bigmsg_client_id:r.bigmsg_client_id}),e.push(r.bigmsg_client_id)}20<this._bigIMmessageList.length?this._bigIMmessageList.splice(0,20):this._bigIMmessageList=[],this.sendBigRoomMessageInternal(n,(function(i){t.handleBigImMsgRsp(i)}),(function(i,n){for(var s=0;s<e.length;s++){var r=e[s],o=t._bigImCallbackMap[r];o&&(null!=o.error&&o.error(i,n),delete t._bigImCallbackMap[r])}})),this._bigImTimer&&clearTimeout(this._bigImTimer),this._bigImTimer=null,0<this._bigIMmessageList.length&&this.setBigImTimer(this._serverTimeOffset,this._bigimTimeWindow)},W.prototype.handlePushMergeMsg=function(t){for(var i=t.body.message_list||t.body.messages,n=0;n<i.length;n++)14001===i[n].sub_cmd&&this.handlePushBigRooMsg(i[n].msg_body)},W.prototype.handlePushBigRooMsg=function(t){var i;if(Object(Y.f)(t))try{i=JSON.parse(t)}catch(t){return void this.v.warn(p+"parse json error")}else i=t;if(i){t=i.room_id||this._room.roomID;for(var n=[],e=i.msg_list||i.msg_data,s=0;s<e.length;s++){var r=e[s];r.id_name==this.h.idName?this.v.info(p+" self message"):n.push({idName:r.id_name,nickName:r.nick_name,messageId:r.msg_id||r.bigmsg_id,category:r.msg_category,type:r.msg_type,content:r.msg_content,time:r.send_time||J.a.isLong(r.msg_timestamp)&&r.msg_timestamp.toNumber()})}0==n.length?this.v.info(p+" no other pushData except self"):this.onRecvBigRoomMessage(n,t),this.v.info(p+"call success")}else this.v.warn(p+" cann't find message body")},W.prototype.onRecvBigRoomMessage=function(t,i){var n=[];t.forEach((function(t){n.push(t={fromUser:{userID:t.idName,userName:t.nickName},message:t.content,sendTime:t.time,messageID:t.messageId})})),this.h.actionListener("IMRecvBarrageMessage",i,n),this.h.actionListener("_recvBigRoomMessage",t,i)},W.prototype.resetMessageInfo=function(){this.transSeqMap={},this.realyMessageList=[],this._relayTimer&&(clearTimeout(this._relayTimer),this._relayTimer=null),this._bigImLastTimeIndex=0,this._bigIMmessageList=[],this._bigImCallbackMap={},this._bigImTimer&&(clearTimeout(this._bigImTimer),this._bigImTimer=null),this._serverTimeOffset=0,this._datiTimeWindow=0,this._bigimTimeWindow=0},W.prototype.sendRelayMessage=function(t,i,n,e){var s=this._datiTimeWindow,r=this._serverTimeOffset;0<s?(this.realyMessageList.push({type:t,data:i,success:n,error:e}),1==this.realyMessageList.length&&this.setRelayTimer(r,s)):this.sendRelayMessageInternal(t,i,n,e)},W.prototype.sendRelayMessageInternal=function(t,i,n,e){var s=this;this.v.info(g+" call"),this._serviceHandler.sendRelayMessage(t={relay_type:t,relay_data:i},(function(t){n&&n(t.header.seq,t.body.relay_result)}),(function(t){var i=w;t.header&&t.body?e&&e(s._rtm.getServerError(t.body.err_code),t.header.seq):(t.code&&t.msg&&(i=t),e&&e(i,0))}),i=this._room)},W.prototype.setRelayTimer=function(t,i){var n=this;t=(new Date).getTime()+t,t=this._rtm.generateRandumNumber(2*i-t%i),this.v.info(g+" setTimer "+t),this._relayTimer=setTimeout((function(){n.onRelayTimer()}),t)},W.prototype.onRelayTimer=function(){var t;0==this.realyMessageList.length?this.v.info(g+"  no relay data"):(this.sendRelayMessageInternal((t=this.realyMessageList[0]).type,t.data,t.success,t.error),this._relayTimer&&clearTimeout(this._relayTimer),this._relayTimer=null,this.realyMessageList.splice(0,1),0<this.realyMessageList.length&&this.setRelayTimer(this._serverTimeOffset,this._datiTimeWindow))},W);function W(t,i,n,e,s,r,o){var u=this;this.v=t,this.h=i,this._dataReport=n,this._service=e,this._liveRoomHandler=s,this._rtm=r,this._room=o,this._sendRoomMsgTime=0,this._sendRoomMsgInterval=500,this._bigImCallbackMap={},this._bigImLastTimeIndex=0,this._bigIMmessageList=[],this._bigImTimer=null,this._relayTimer=null,this._serverTimeOffset=0,this._datiTimeWindow=0,this._bigimTimeWindow=0,this._isReliable=!1,this.transSeqMap={},this.userTransSeqMap={},this.roomExtraInfo={},this.onRecvReliableMessage=function(t,i){void 0===i&&(i=!1);var n=t.map((function(t){var i={key:t.trans_type,value:t.trans_data,updateUser:{userID:t.id_name||t.trans_idname,userName:t.nick_name||t.trans_nickname},updateTime:J.a.isLong(t.trans_send_time)?t.trans_send_time.toNumber():t.trans_send_time};return u.roomExtraInfo[t.trans_type]=i}));i?u.v.warn(_+" id name same"):(0<n.length&&u.h.actionListener("roomExtraInfoUpdate",u._room.roomID,Object.values(u.roomExtraInfo)),t.forEach((function(t){u.h.actionListener("recvReliableMessage",t.trans_type,t.trans_seq,t.trans_data)})))},this.realyMessageList=[]}function X(t,i,n,e){var s=this;return void 0===n&&(n=1),void 0===e&&(e=1),new Promise((function(r,o){var u,a=s.getMsgSpan(A,t,!0),c=(o=s.stateCenter.proxyRes(a,(function(t){a.setAttributes({msg_id:M(t.messageID)}),r(t)}),o)).interResolve;o=o.interReject,Object(Y.f)(t)&&""!=t?void 0===i||""==i?(s.logger.error(h+" message is empty"),o(P.IM_CONTENT_NULL)):Object(Y.f)(i)?1024<i.length?(s.logger.error(h+" message too long"),o(P.IM_CONTENT_TOO_LONG)):(u=s.getRoomModules(t),a.setAttributes({send_seq:D(),msg_content:i}),u?u.messageHandler.sendRoomMsg(n,e,t,i,(function(t){t.messageID&&a.setAttributes({msg_id:t.messageID}),c(t)}),o):o(P.ROOM_NOT_EXIST)):(s.logger.error(h+" message must be string"),o(P.INPUT_PARAM," param message error")):(s.logger.error(h+" roomid must be string and not empty"),o(P.INPUT_PARAM," param roomID error"))}))}function Z(t,i,n){var e=this;return new Promise((function(s,r){var o,h,a=e.getMsgSpan(C,t,!0);r=(s=e.stateCenter.proxyRes(a,s,r)).interResolve,s=s.interReject,Object(Y.f)(t)&&""!=t?!Object(Y.a)(n)||n.find((function(t){return!Object(Y.f)(t)}))?(e.logger.error(u+" dstMembers must be string array"),s(z.INPUT_PARAM," param toUserList error")):Object(Y.f)(i)||Object(Y.e)(i)?Object(Y.f)(i)&&1024<i.length?(e.logger.error(u+" command too long"),s(z.IM_CONTENT_TOO_LONG)):(o=e.getRoomModules(t),h=Object(Y.f)(i)?i:JSON.stringify(i),a.setAttributes({msg_content:h}),o?o.messageHandler.sendCustomCommand(n,i,r,s):s(z.ROOM_NOT_EXIST)):(e.logger.error(u+" custom content must be a non empty string or object"),s(z.INPUT_PARAM," param command error")):(e.logger.error(u+" roomid must be string and not empty"),s(E," param roomID error"))}))}function K(t,i,n,e){var s=this;return void 0===n&&(n=1),void 0===e&&(e=1),new Promise((function(r,o){var u=s.getMsgSpan("/liveroom/send_big_room_message",t);o=(r=s.stateCenter.proxyRes(u,r,o)).interResolve,r=r.interReject,Object(Y.f)(t)&&""!=t?void 0===i||""==i?(s.logger.error(c+" message is empty"),r(N.IM_CONTENT_NULL)):Object(Y.f)(i)?1024<i.length?(s.logger.error(c+" message too long"),r(N.IM_CONTENT_TOO_LONG)):(u.setAttributes({msg_content:i}),(u=s.getRoomModules(t))?u.messageHandler.sendBigRoomMessage(n,e,t,i,o,r):r(N.ROOM_NOT_EXIST)):(s.logger.error(c+" message must be string"),r(N.INPUT_PARAM," param message error")):(s.logger.error(c+" roomid must be string and not empty"),r(N.INPUT_PARAM," param roomID error"))}))}function Q(t,i,n){var e=this;return new Promise((function(s,r){var o=e.getMsgSpan("/liveroom/set_room_extrainfo",t),u=(s=e.stateCenter.proxyRes(o,s,(function(t){e.stateCenter.useNetAgent&&1015===t.errorCode&&(t.errorCode=1002017),r(t)}))).interResolve;s=s.interReject,Object(Y.f)(t)&&""!=t?i&&Object(Y.f)(i)?128<i.length?(e.logger.error(a+" type is too long"),s({errorCode:L.code})):n&&Object(Y.f)(n)?4096<n.length?(e.logger.error(a+" type is too long"),s({errorCode:L.code})):(o.setAttributes({key:x(i),value:U(n)}),(o=e.getRoomModules(t))?o.messageHandler.sendReliableMessage(i,n,u,s):s(j)):(e.logger.error(a+" data must be string"),s({errorCode:L.code})):(e.logger.error(a+" type must be string"),s({errorCode:L.code})):(e.logger.error(h+" roomid must be string and not empty"),s(P.INPUT_PARAM," param roomID error"))}))}var tt={_sendBroadcastMessage:X,sendBroadcastMessage:function(t,i){var n=this;return new Promise((function(e,s){X.call(n,t,i).then((function(t){e({errorCode:t.errorCode,messageID:t.messageID,extendedData:t.extendedData})})).catch((function(t){s(t)}))}))},_sendCustomCommand:Z,sendCustomCommand:function(t,i,n){var e=this;return new Promise((function(s,r){Z.call(e,t,i,n).then((function(t){s({errorCode:t.errorCode,extendedData:t.extendedData})})).catch((function(t){r(t)}))}))},_sendBarrageMessage:K,sendBarrageMessage:function(t,i){var n=this;return new Promise((function(e,s){K.call(n,t,i).then((function(t){e({errorCode:t.errorCode,messageID:t.messageID,extendedData:t.extendedData})})).catch((function(t){s(t)}))}))},_setRoomExtraInfo:Q,setRoomExtraInfo:function(t,i,n){return Q.call(this,t,i,n)},sendRelayMessage:function(t,i,n,e,s){(s=this.getRoomModules(s)||this.stateCenter.roomModulesList[0])?s.messageHandler.sendRelayMessage(t,i,n,e):e&&e(T,0)}},it={handlePushRoomMsg:function(t){(t=this.handlePushMsg(t))[0].messageHandler.handlePushRoomMsg(t=t[1])},handlePushCustomMsg:function(t){(t=this.handlePushMsg(t))[0].messageHandler.handlePushCustomMsg(t=t[1])},handlePushMergeMsg:function(t){var i=null==(i=null==t?void 0:t.header)?void 0:i.room_id;(i=this.rtm.getRoomModules(i))?i.messageHandler.handlePushMergeMsg(t):this.logger.error(b+" room no found ignore "+JSON.stringify(t))},handlePushTransMsg:function(t){var i,n=(e=this.handlePushMsg(t))[0],e=e[1],s=null==(s=null==t?void 0:t.header)?void 0:s.room_id;(s=this.rtm.getMsgSpan("/liveroom/recv_room_extrainfo",s)).setAttributes({trans_type:$(null==(i=null==t?void 0:t.body)?void 0:i.trans_type),trans_seq:V(null==(i=null==t?void 0:t.body)?void 0:i.trans_seq)}),s.end(),n.messageHandler.handlePushTransMsg(e)},handlePushUserTransMsg:function(t){(t=this.handlePushMsg(t))[0].messageHandler.handlePushUserTransMsg(t=t[1])},handleBigImMsgRsp:function(t){var i=null==(i=null==t?void 0:t.header)?void 0:i.room_id;(i=this.rtm.getRoomModules(i))?i.messageHandler.handleBigImMsgRsp(t):this.logger.error(b+" room no found ignore "+JSON.stringify(t))},handlePushMsg:function(t){var i=null==(i=null==t?void 0:t.header)?void 0:i.room_id;if(i=this.rtm.getRoomModules(i))return[i,t];this.logger.error(b+" room no found ignore "+JSON.stringify(t))}},nt={initMessageHandler:function(){this.messageHandler=new F(this.logger,this.stateCenter,this.dataReport,this.service,this.liveRoomHandler,this.rtm,this)}};i.default={type:"message",install:function(t,i,n,e){for(var s in tt)Object.defineProperty(t.prototype,s,{value:tt[s],writable:!1});for(var s in it)Object.defineProperty(n.prototype,s,{value:it[s],writable:!1}),Object.defineProperty(e.prototype,s,{value:it[s],writable:!1});for(var s in nt)Object.defineProperty(i.prototype,s,{value:nt[s],writable:!1})}}}},n={},t.m=i,t.c=n,t.d=function(i,n,e){t.o(i,n)||Object.defineProperty(i,n,{enumerable:!0,get:e})},t.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},t.t=function(i,n){if(1&n&&(i=t(i)),8&n)return i;if(4&n&&"object"==typeof i&&i&&i.__esModule)return i;var e=Object.create(null);if(t.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:i}),2&n&&"string"!=typeof i)for(var s in i)t.d(e,s,function(t){return i[t]}.bind(null,s));return e},t.n=function(i){var n=i&&i.__esModule?function(){return i.default}:function(){return i};return t.d(n,"a",n),n},t.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},t.p="",t(t.s=11);function t(e){var s;return(n[e]||(s=n[e]={i:e,l:!1,exports:{}},i[e].call(s.exports,s,s.exports,t),s.l=!0,s)).exports}var i,n}()},413:(t,i,n)=>{"use strict";n.d(i,{Z:()=>f});var e=n(100);const s=n(720);e.util.Long=s,e.util.Long.fromBits=e.util.Long?e.util.Long.fromBits:function(){return 0};for(var r=e.roots,o=e.types?e.types.basic:{double:1,float:5,int32:0,uint32:0,sint32:0,fixed32:5,sfixed32:5,int64:0,uint64:0,sint64:0,fixed64:1,sfixed64:1,bool:0,string:2,bytes:2},u=e.types?e.types.packed:{double:1,float:5,int32:0,uint32:0,sint32:0,fixed32:5,sfixed32:5,int64:0,uint64:0,sint64:0,fixed64:1,sfixed64:1,bool:0},h=Object.keys(o),a={$:function(t){return a[t]?a[t].call(this):r[t].decode?r[t].decode(this,this.uint32()):a.$.call(this,"int32")}},c={$:function(t,i,n){var e=o[t];return void 0===e?r[t].encode?(this.uint32((n<<3|2)>>0).fork(),r[t].encode(i,this).ldelim()):c.$.call(this,"int32",i,n):c[t].call(this.uint32(n<<3|e),i)}},l=0;l<h.length;l++)a[h[l]]=e.Reader.prototype[h[l]],c[h[l]]=e.Writer.prototype[h[l]];!function t(i,n,s,h){for(var l=0,f=Object.keys(i);l<f.length;l++){var _=f[l];if(i[_].$m&&Object.keys(i[_].$m).every((function(t){return Number(t)}))){if(s[_])throw Error(`nested type ${s}.${_} has already exist`);s[_]=function(i,s){function h(t){for(var n in i){var e=i[n];"{"===e[1].charAt(0)?this[e[0]]={}:"["!==e[1].charAt(0)&&"<"!==e[1].charAt(0)||(this[e[0]]=[])}if(t)for(var s=Object.keys(t),r=0;r<s.length;++r)null!=t[s[r]]&&(this[s[r]]=t[s[r]])}var l={};for(var f in i){var _=i[f],d=_[1];"{"===d.charAt(0)?(h.prototype[_[0]]=e.util.emptyObject,l[d]={$m:d.substring(1).split(",").map((function(t,i){return[`$${i+1}`,t,null]})).reduce((function(t,i,n){return t[n+1]=i,t}),{})}):h.prototype[_[0]]="["===d.charAt(0)||"<"===d.charAt(0)?e.util.emptyArray:"bytes"===d?e.util.newBuffer([]):_[2]&&_[2].hasOwnProperty("low")&&_[2].hasOwnProperty("high")?e.util.Long.fromBits(_[2].low,_[2].high,_[2].unsigned):_[2]}return h.create=function(t){return new h(t)},h.decode=function(t,n){t instanceof e.Reader||(t=e.Reader.create(t));for(var s=void 0===n?t.len:t.pos+n,o=new h;t.pos<s;){var c=t.uint32(),l=c>>>3;if(l>0&&i[l]){var f=i[l][0],_=i[l][1];if("{"===_.charAt(0)){o[f]===e.util.emptyObject&&(o[f]={});var d=h.$namespace[_].decode(t,t.uint32());o[f][d.$1]=d.$2}else if("["===_.charAt(0)||"<"===_.charAt(0)){_=_.substring(1),o[f]&&o[f].length||(o[f]=[]);if(void 0!==u[_=!a[_]&&!r[_].decode?"int32":_]&&2==(7&c))for(var m=t.uint32()+t.pos;t.pos<m;)o[f].push(a.$.call(t,_));else o[f].push(a.$.call(t,_))}else o[f]=a.$.call(t,_)}else t.skipType(7&c)}return o},h.encode=function(t,n){for(var s in n||(n=e.Writer.create()),i){var a=i[s][0],l=i[s][1];if("{"===l.charAt(0)){if(null!=t[a]&&t.hasOwnProperty(a))for(var f=0,_=Object.keys(t[a]);f<_.length;++f)n.uint32((s<<3|2)>>0).fork(),h.$namespace[l].encode({$1:_[f],$2:t[a][_[f]]},n).ldelim()}else if("["===l.charAt(0)||"<"===l.charAt(0)){var d="<"===l.charAt(0);l=l.substring(1);var m=t[a];if(null!=m&&m.length){if(l=void 0===o[l]&&!r[l].encode?"int32":l,d&&void 0!==u[l]){n.uint32((s<<3|2)>>0).fork();for(f=0;f<m.length;f++)c[l].call(n,m[f]);n.ldelim()}else for(f=0;f<m.length;f++)c.$.call(n,l,m[f],s)}}else null!=t[a]&&t.hasOwnProperty(a)&&c.$.call(n,l,t[a],s)}return n},Object.keys(l).length&&(h.$namespace=t(l,n+"."+s,h.$namespace||{},!0)),h}(i[_].$m,_)}else i[_].$s?s[_]=function(t,i){function s(t,i,n){e.rpc.Service.call(this,t,i,n)}return(s.prototype=Object.create(e.rpc.Service.prototype)).constructor=s,s.create=function(t,i,n){return new s(t,i,n)},Object.keys(t).forEach((function(e){var o=t[e];function u(t,i){return this.rpcCall(u,r[o[0]],r[o[1]],t,i)}Object.defineProperty(u,"name",{value:e}),Object.defineProperty(u,"path",{value:`${n}.${i}`}),s.prototype[e]=u})),s}(i[_].$s,_):i[_].$e&&Object.values(i[_].$e).every((function(t){return Number(t)===t}))&&(s[_]=function(t,i){for(var n=Object.keys(t),e={},s=0;s<n.length;s++)e[e[n[s]]=t[n[s]]]=n[s];return e}(i[_].$e));s[_]&&!h&&(r[`${n}.${_}`]=s[_]),delete i[_].$m,delete i[_].$s,delete i[_].$e,s[_]=t(i[_],n?`${n}.${_}`:_,s[_]||{})}return s}({mixstream:{proto_mixstream:{AutoRoomMixOutputStream:{$m:{1:["stream_out_common","mixstream.proto_mixstream.MixOutputStreamCommon",null],2:["audio_channel_cnt","int32",0]}},AutoRoomMixStreamStartRequest:{$m:{1:["request_seq","uint32",0],2:["mix_stream_common","mixstream.proto_mixstream.MixStreamCommon",null],3:["mix_source","string",""],4:["room_id","string",""],5:["task_id","string",""],6:["water_mark","mixstream.proto_mixstream.MixWaterMark",null],7:["output_stream","<mixstream.proto_mixstream.AutoRoomMixOutputStream",null],8:["extra_params","<mixstream.proto_mixstream.MixAdvanceConfig",null],9:["has_recv_buffer_level","bool",!1],10:["recv_buffer_level","sint32",0]}},AutoRoomMixStreamStartResponse:{$m:{1:["request_seq","uint32",0],2:["common_response","mixstream.proto_mixstream.MixstreamServerCommonResponse",null]}},AutoRoomMixStreamStopRequest:{$m:{1:["request_seq","uint32",0],2:["task_id","string",""],3:["room_id","string",""]}},AutoRoomMixStreamStopResponse:{$m:{1:["request_seq","uint32",0],2:["common_response","mixstream.proto_mixstream.MixstreamServerCommonResponse",null]}},GetMixStreamStatusRequest:{$m:{1:["request_seq","uint32",0],2:["task_id","string",""]}},GetMixStreamStatusResponse:{$m:{1:["request_seq","uint32",0],2:["common_response","mixstream.proto_mixstream.MixstreamServerCommonResponse",null],3:["push_url","<mixstream.proto_mixstream.PushUrl",null],4:["version","int32",0],5:["task_id","string",""]}},MixAdvanceConfig:{$m:{1:["key","string",""],2:["value","string",""]}},MixImage:{$m:{1:["url","string",""],2:["display_mode","int32",0]}},MixInputStream:{$m:{1:["stream_input_common","mixstream.proto_mixstream.MixInputStreamCommon",null],2:["volume","int32",0],3:["audio_focus","int32",0],4:["audio_h_angle","int32",0],5:["render_mode","int32",0],6:["corner_radius","uint32",0],7:["label","mixstream.proto_mixstream.MixLabel",null],8:["image","mixstream.proto_mixstream.MixImage",null]}},MixInputStreamCommon:{$m:{1:["stream_id","string",""],2:["sound_level_id","uint32",0],3:["content_control","int32",0],4:["layer_rect","mixstream.proto_mixstream.MixRect",null],5:["stream_url","string",""]}},MixLabel:{$m:{1:["text","string",""],2:["text_left","int32",0],3:["text_top","int32",0],4:["font","mixstream.proto_mixstream.MixLableFont",null]}},MixLableFont:{$m:{1:["font_type","int32",0],2:["font_size","int32",0],3:["font_color","int32",0],4:["font_transparency","int32",0],5:["font_border_color","sint32",0]}},MixOutputStream:{$m:{1:["output_stream_common","mixstream.proto_mixstream.MixOutputStreamCommon",null],2:["video_enc_id","int32",0],3:["video_encode_latency","int32",0],4:["video_encode_profile","int32",0],5:["low_bitrate_hd","int32",0]}},MixOutputStreamCommon:{$m:{1:["is_url","int32",0],2:["target","string",""],3:["video_fps","int32",0],4:["rate_control_mode","int32",0],5:["video_bitrate","int32",0],6:["video_width","int32",0],7:["video_height","int32",0],8:["output_quality","int32",0],9:["audio_bitrate","int32",0],10:["audio_enc_id","int32",0]}},MixRect:{$m:{1:["top","int32",0],2:["left","int32",0],3:["bottom","int32",0],4:["right","int32",0],5:["layer","int32",0]}},MixStartReplyData:{$m:{1:["request_id","string",""],2:["play_infos","<mixstream.proto_mixstream.PlayInfo",null]}},MixStreamCommon:{$m:{1:["user_data","string",""],2:["output_bg_color","int32",0],3:["output_bg_image","string",""],4:["with_sound_level","int32",0],5:["single_stream_pass_through","int32",0],6:["alignment_type","int32",0]}},MixstreamServerCommonResponse:{$m:{1:["code","uint32",0],2:["message","string",""]}},MixStreamStartRequest:{$m:{1:["request_seq","uint32",0],2:["mix_protocol_version","int32",0],3:["task_id","string",""],4:["room_id","string",""],5:["mix_stream_common","mixstream.proto_mixstream.MixStreamCommon",null],6:["audio_channel_cnt","int32",0],7:["audio_mix_mode","int32",0],8:["recv_buffer_level","sint32",0],9:["input_stream","<mixstream.proto_mixstream.MixInputStream",null],10:["water_mark","mixstream.proto_mixstream.MixWaterMark",null],11:["advance_config","<mixstream.proto_mixstream.MixAdvanceConfig",null],12:["output_stream","<mixstream.proto_mixstream.MixOutputStream",null],13:["white_board","mixstream.proto_mixstream.MixWhiteBoard",null],14:["timestamp","int64",{low:0,high:0,unsigned:!1}],15:["check_image_mode","int32",0]}},MixStreamStartResponse:{$m:{1:["request_seq","uint32",0],2:["common_response","mixstream.proto_mixstream.MixstreamServerCommonResponse",null],3:["data","mixstream.proto_mixstream.MixStartReplyData",null],4:["error_streamid_list","<string",null]}},MixStreamStopRequest:{$m:{1:["request_seq","uint32",0],2:["task_id","string",""],3:["room_id","string",""],4:["is_url","int32",0],5:["target","string",""],6:["timestamp","int64",{low:0,high:0,unsigned:!1}]}},MixStreamStopResponse:{$m:{1:["request_seq","uint32",0],2:["common_response","mixstream.proto_mixstream.MixstreamServerCommonResponse",null]}},MixStreamTaskHbRequest:{$m:{1:["request_seq","uint32",0],2:["task_id","string",""]}},MixStreamTaskHbResponse:{$m:{1:["request_seq","uint32",0],2:["common_response","mixstream.proto_mixstream.MixstreamServerCommonResponse",null],3:["status","uint32",0],4:["hb_interval","uint32",0]}},MixWaterMark:{$m:{1:["image","string",""],2:["layout_rect","mixstream.proto_mixstream.MixRect",null]}},MixWhiteBoard:{$m:{1:["whiteboard_id","uint64",{low:0,high:0,unsigned:!0}],2:["horizontal_ratio","int32",0],3:["vertical_ratio","int32",0],4:["is_ppt_animation","int32",0],5:["layout_rect","mixstream.proto_mixstream.MixRect",null],6:["background_color","int32",0]}},PlayInfo:{$m:{1:["stream_alias","string",""],2:["rtmp_url","string",""],3:["hls_url","string",""],4:["hdl_url","string",""]}},PushUrl:{$m:{1:["status","int32",0],2:["url","string",""],3:["mod_time","int64",{low:0,high:0,unsigned:!1}],4:["reason","int32",0]}}}}},"",r,!1);const f=r.mixstream},951:(t,i,n)=>{"use strict";var e,s=n(100),r=s.Reader,o=s.Writer,u=s.util,h=s.roots.default||(s.roots.default={});h.proto_media=((e={}).MediaServerCommonResponse=function(){function t(t){if(t)for(var i=Object.keys(t),n=0;n<i.length;++n)null!=t[i[n]]&&(this[i[n]]=t[i[n]])}return t.prototype.code=0,t.prototype.message="",t.create=function(i){return new t(i)},t.encode=function(t,i){return i||(i=o.create()),null!=t.code&&Object.hasOwnProperty.call(t,"code")&&i.uint32(8).uint32(t.code),null!=t.message&&Object.hasOwnProperty.call(t,"message")&&i.uint32(18).string(t.message),i},t.decode=function(t,i){t instanceof r||(t=r.create(t));for(var n=void 0===i?t.len:t.pos+i,e=new h.proto_media.MediaServerCommonResponse;t.pos<n;){var s=t.uint32();switch(s>>>3){case 1:e.code=t.uint32();break;case 2:e.message=t.string();break;default:t.skipType(7&s)}}return e},t}(),e.RelayPublishCdnRequest=function(){function t(t){if(t)for(var i=Object.keys(t),n=0;n<i.length;++n)null!=t[i[n]]&&(this[i[n]]=t[i[n]])}return t.prototype.request_seq=0,t.prototype.request_cmd=0,t.prototype.streamid="",t.prototype.cdn_server="",t.prototype.publish_timeout=0,t.prototype.request_seq_v2=u.Long?u.Long.fromBits(0,0,!0):0,t.create=function(i){return new t(i)},t.encode=function(t,i){return i||(i=o.create()),null!=t.request_seq&&Object.hasOwnProperty.call(t,"request_seq")&&i.uint32(8).uint32(t.request_seq),null!=t.request_cmd&&Object.hasOwnProperty.call(t,"request_cmd")&&i.uint32(16).int32(t.request_cmd),null!=t.streamid&&Object.hasOwnProperty.call(t,"streamid")&&i.uint32(26).string(t.streamid),null!=t.cdn_server&&Object.hasOwnProperty.call(t,"cdn_server")&&i.uint32(34).string(t.cdn_server),null!=t.publish_timeout&&Object.hasOwnProperty.call(t,"publish_timeout")&&i.uint32(40).uint32(t.publish_timeout),null!=t.request_seq_v2&&Object.hasOwnProperty.call(t,"request_seq_v2")&&i.uint32(48).uint64(t.request_seq_v2),i},t.decode=function(t,i){t instanceof r||(t=r.create(t));for(var n=void 0===i?t.len:t.pos+i,e=new h.proto_media.RelayPublishCdnRequest;t.pos<n;){var s=t.uint32();switch(s>>>3){case 1:e.request_seq=t.uint32();break;case 2:e.request_cmd=t.int32();break;case 3:e.streamid=t.string();break;case 4:e.cdn_server=t.string();break;case 5:e.publish_timeout=t.uint32();break;case 6:e.request_seq_v2=t.uint64();break;default:t.skipType(7&s)}}return e},t}(),e.RelayPublishCdnResponse=function(){function t(t){if(t)for(var i=Object.keys(t),n=0;n<i.length;++n)null!=t[i[n]]&&(this[i[n]]=t[i[n]])}return t.prototype.request_seq=0,t.prototype.response=null,t.prototype.request_seq_v2=u.Long?u.Long.fromBits(0,0,!0):0,t.create=function(i){return new t(i)},t.encode=function(t,i){return i||(i=o.create()),null!=t.request_seq&&Object.hasOwnProperty.call(t,"request_seq")&&i.uint32(8).uint32(t.request_seq),null!=t.response&&Object.hasOwnProperty.call(t,"response")&&h.proto_media.MediaServerCommonResponse.encode(t.response,i.uint32(18).fork()).ldelim(),null!=t.request_seq_v2&&Object.hasOwnProperty.call(t,"request_seq_v2")&&i.uint32(24).uint64(t.request_seq_v2),i},t.decode=function(t,i){t instanceof r||(t=r.create(t));for(var n=void 0===i?t.len:t.pos+i,e=new h.proto_media.RelayPublishCdnResponse;t.pos<n;){var s=t.uint32();switch(s>>>3){case 1:e.request_seq=t.uint32();break;case 2:e.response=h.proto_media.MediaServerCommonResponse.decode(t,t.uint32());break;case 3:e.request_seq_v2=t.uint64();break;default:t.skipType(7&s)}}return e},t}(),e),t.exports=h}},__webpack_module_cache__={};function __webpack_require__(t){var i=__webpack_module_cache__[t];if(void 0!==i)return i.exports;var n=__webpack_module_cache__[t]={exports:{}};return __webpack_modules__[t].call(n.exports,n,n.exports,__webpack_require__),n.exports}__webpack_require__.n=t=>{var i=t&&t.__esModule?()=>t.default:()=>t;return __webpack_require__.d(i,{a:i}),i},__webpack_require__.d=(t,i)=>{for(var n in i)__webpack_require__.o(i,n)&&!__webpack_require__.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:i[n]})},__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),__webpack_require__.o=(t,i)=>Object.prototype.hasOwnProperty.call(t,i),__webpack_require__.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var __webpack_exports__={};return(()=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{ZegoExpressEngine:()=>ns});var t,i,n=__webpack_require__(901);!function(t){t[t.debug=0]="debug",t[t.info=1]="info",t[t.warn=2]="warn",t[t.error=3]="error",t[t.report=99]="report",t[t.disable=100]="disable"}(t||(t={})),function(t){t[t.CN=2]="CN",t[t.NA=3]="NA",t[t.EU=4]="EU",t[t.AS=5]="AS",t[t.IN=6]="IN",t[t.NCN=7]="NCN"}(i||(i={}));var e,s;!function(t){t[t.disable=0]="disable",t[t.websocket=1]="websocket",t[t.https=2]="https"}(e||(e={})),function(t){t[t.SDKProject_Other=0]="SDKProject_Other",t[t.SDKProject_ZegoExpressVideo=1]="SDKProject_ZegoExpressVideo",t[t.SDKProject_ZegoExpressAudio=2]="SDKProject_ZegoExpressAudio",t[t.SDKProject_ZegoLiveRoom=3]="SDKProject_ZegoLiveRoom",t[t.SDKProject_ZegoAudioRoom=4]="SDKProject_ZegoAudioRoom",t[t.SDKProject_ZegoAVKit=5]="SDKProject_ZegoAVKit",t[t.SDKProject_ZegoWebRTC=6]="SDKProject_ZegoWebRTC",t[t.SDKProject_ZegoMiniProgram=7]="SDKProject_ZegoMiniProgram"}(s||(s={}));var r;!function(t){t[t.disconnected=0]="disconnected",t[t.connecting=1]="connecting",t[t.connected=2]="connected"}(r||(r={}));var o,u,h,a,c=6,l=7,f=0,_=1,d=2;!function(t){t[t.tryProbe=0]="tryProbe",t[t.probed=2]="probed"}(o||(o={})),function(t){t[t.CDN=0]="CDN",t[t.RTC=1]="RTC",t[t.L3=2]="L3",t[t.DG=3]="DG"}(u||(u={})),function(t){t[t.UDP=0]="UDP",t[t.RTMP=1]="RTMP",t[t.FLV=2]="FLV",t[t.HLS=3]="HLS",t[t.WEBRTC=4]="WEBRTC"}(h||(h={})),function(t){t[t.replaceNew=0]="replaceNew",t[t.changeResolution=1]="changeResolution"}(a||(a={}));var m,v,p,g=1,b=2,E=3,S=4,R=2001,O=2002,y=2003,T=1,w=0;!function(t){t[t.logout=0]="logout",t[t.trylogin=1]="trylogin",t[t.login=2]="login"}(m||(m={})),function(t){t[t.logout=0]="logout",t[t.trylogin=1]="trylogin",t[t.login=2]="login",t[t.reconnect=3]="reconnect"}(v||(v={})),function(t){t[t.offline=0]="offline",t[t.online=1]="online"}(p||(p={}));var I;!function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.CDN=1]="CDN",t[t.RTC=2]="RTC",t[t.L3=3]="L3"}(I||(I={}));var N,C,k=12001,z=12002,A=12003;!function(t){t[t.publish_quality=0]="publish_quality",t[t.play_quality=1]="play_quality",t[t.charge=2]="charge"}(N||(N={})),function(t){t[t.low=1]="low",t[t.stantard=2]="stantard",t[t.hight=3]="hight",t[t.custome=4]="custome"}(C||(C={}));var D,M,P,x,U,L;!function(t){t[t.captureFpsToLow=1001]="captureFpsToLow",t[t.captureVolumeToLow=1002]="captureVolumeToLow",t[t.sendVideoBitrateToLow=1003]="sendVideoBitrateToLow",t[t.sendFpsToLow=1004]="sendFpsToLow",t[t.sendAudioBitrateToLow=1005]="sendAudioBitrateToLow",t[t.receiveVolumeToLow=1006]="receiveVolumeToLow",t[t.receiveAudioDecodedFail=1007]="receiveAudioDecodedFail",t[t.receiveVideoDecodedFail=1008]="receiveVideoDecodedFail",t[t.receiveVideoFpsDecodedToLow=1009]="receiveVideoFpsDecodedToLow",t[t.renderVideoFpsToLow=1010]="renderVideoFpsToLow",t[t.captureFpsNormal=2001]="captureFpsNormal",t[t.captureVolumeNormal=2002]="captureVolumeNormal",t[t.sendVideoBitrateNormal=2003]="sendVideoBitrateNormal",t[t.sendFpsNormal=2004]="sendFpsNormal",t[t.sendAudioBitrateNormal=2005]="sendAudioBitrateNormal",t[t.receiveVolumeNormal=2006]="receiveVolumeNormal",t[t.receiveAudioDecodedNormal=2007]="receiveAudioDecodedNormal",t[t.receiveVideoDecodedNormal=2008]="receiveVideoDecodedNormal",t[t.receiveVideoFpsDecodedNormal=2009]="receiveVideoFpsDecodedNormal",t[t.renderVideoFpsNormal=2010]="renderVideoFpsNormal"}(D||(D={})),function(t){t[t.cdn=0]="cdn",t[t.ultra=1]="ultra"}(M||(M={})),function(t){t[t.stop=0]="stop",t[t.start=1]="start"}(P||(P={})),function(t){t[t.cdn=0]="cdn",t[t.ultra=1]="ultra",t[t.customUrl=2]="customUrl"}(x||(x={})),function(t){t[t.CDN=0]="CDN",t[t.BGP=1]="BGP"}(U||(U={})),function(t){t[t.ClientType_None=0]="ClientType_None",t[t.ClientType_H5=1]="ClientType_H5",t[t.ClientType_SmallPragram=2]="ClientType_SmallPragram",t[t.ClientType_Webrtc=3]="ClientType_Webrtc"}(L||(L={}));var q,j,G,H,$,V,B,J,Y,F,W,X,Z,K,Q,tt=function(){function t(t,i){void 0===t&&(t=null),void 0===i&&(i=null),this._id=null,this.next=null,this.prev=null,this._id=t,this._data=i}return Object.defineProperty(t.prototype,"id",{get:function(){return this._id?this._id:null},set:function(t){this._id=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t},enumerable:!1,configurable:!0}),t.prototype.hasNext=function(){return this.next&&this.next.id},t.prototype.hasPrev=function(){return this.prev&&this.prev.id},t}(),it=(function(){function t(){this.start=new tt,this.end=new tt,this._idCounter=0,this._numNodes=0,this.start.next=this.end,this.start.prev=null,this.end.prev=this.start,this.end.next=null}t.prototype.insertBefore=function(t,i){var n=new tt(this._idCounter,i);return n.next=t,n.prev=t.prev,t.prev&&(t.prev.next=n),t.prev=n,++this._idCounter,++this._numNodes,n},t.prototype.addLast=function(t){return this.insertBefore(this.end,t)},t.prototype.add=function(t){return this.addLast(t)},t.prototype.getFirst=function(){return 0===this._numNodes?null:this.start.next},t.prototype.getLast=function(){return 0===this._numNodes?null:this.end.prev},t.prototype.size=function(){return this._numNodes},t.prototype.getFromFirst=function(t){var i=0,n=this.start.next;if(t>=0)for(;i<t&&null!==n;)n=n.next,++i;else n=null;if(null===n)throw"Index out of bounds.";return n},t.prototype.get=function(t){return 0===t?this.getFirst():t===this._numNodes-1?this.getLast():this.getFromFirst(t)},t.prototype.remove=function(t){return t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),--this._numNodes,t},t.prototype.removeFirst=function(){var t=null;return this._numNodes>0&&this.start.next&&(t=this.remove(this.start.next)),t},t.prototype.removeLast=function(){var t=null;return this._numNodes>0&&this.end.prev&&(t=this.remove(this.end.prev)),t},t.prototype.removeAll=function(){this.start.next=this.end,this.end.prev=this.start,this._numNodes=0,this._idCounter=0},t.prototype.each=function(t){for(var i=this.start;i.hasNext();)t(i=i.next)},t.prototype.find=function(t){for(var i=this.start,n=!1,e=null;i.hasNext()&&!n;)t(i=i.next)&&(e=i,n=!0);return e},t.prototype.map=function(t){for(var i=this.start,n=[];i.hasNext();)t(i=i.next)&&n.push(i);return n},t.prototype.push=function(t){return this.addLast(t)},t.prototype.unshift=function(t){this.insertBefore(this._numNodes>0?this.start.next:this.end,t)},t.prototype.pop=function(){return this.removeLast()},t.prototype.shift=function(){return this.removeFirst()}}(),["NO_RELAY","RELAYING","RELAY_REQUESTING","NO_RELAY"]),nt={0:"NONE",8:"SERVER_ERROR",9:"HANDSHAKE_FAILED",10:"ACCESS_POINT_ERROR",11:"CREATE_STREAM_FAILED",12:"BAD_NAME",13:"CDN_SERVER_DISCONNECTED",14:"DISCONNECTED",1214:"ALL_INPUT_STREAM_CLOSED",1215:"ALL_INPUT_STREAM_NO_DATA",1230:"SERVER_INTERNAL_ERROR"},et=0,st=1,rt=2,ot=1,ut=2,ht="eventStart",at="addEventMsg",ct="eventEnd",lt="addMsgInfo";!function(t){t[t.Unknown=-1]="Unknown",t[t.Excellent=0]="Excellent",t[t.Good=1]="Good",t[t.Middle=2]="Middle",t[t.Poor=3]="Poor",t[t.Die=4]="Die"}(q||(q={})),function(t){t[t.MinQuality=0]="MinQuality",t[t.DieQuality=0]="DieQuality",t[t.PoorMinQuality=1]="PoorMinQuality",t[t.MiddleMinQuality=30]="MiddleMinQuality",t[t.GoodMinQuality=60]="GoodMinQuality",t[t.ExcellentMinQuality=85]="ExcellentMinQuality",t[t.MaxQuality=100]="MaxQuality"}(j||(j={})),function(t){t[t.ZegoDefined=0]="ZegoDefined",t[t.UserUnregister=1]="UserUnregister"}(G||(G={})),function(t){t[t.CDN=0]="CDN",t[t.L3=1]="L3"}(H||(H={})),function(t){t[t.RTC=0]="RTC",t[t.CDN=1]="CDN",t[t.L3=2]="L3",t[t.DG=3]="DG"}($||($={})),function(t){t[t.PortraitSegmentation=0]="PortraitSegmentation"}(V||(V={})),function(t){t[t.Default=3]="Default",t[t.StandardVideoCall=4]="StandardVideoCall",t[t.HighVideoCall=5]="HighVideoCall",t[t.StandardChatroom=6]="StandardChatroom",t[t.HighQualityChatroom=7]="HighQualityChatroom",t[t.Broadcast=8]="Broadcast",t[t.UNKNOWN=100]="UNKNOWN"}(B||(B={})),function(t){t[t.I=0]="I",t[t.H=10]="H",t[t.M=100]="M",t[t.L=1e3]="L"}(J||(J={})),function(t){t[t.BASE_LINE=1]="BASE_LINE",t[t.MAIN=2]="MAIN",t[t.HIGH=3]="HIGH"}(Y||(Y={})),function(t){t.ONLY_BASELINE="only_baseline",t.HARD_SOFT_ENCODEC_FIRST="hard_or_soft_encodec_first",t.HIGH_PROFILE_FIRST="high_profile_first"}(F||(F={})),function(t){t[t.useAnalyzer=0]="useAnalyzer",t[t.useWorklet=1]="useWorklet"}(W||(W={})),function(t){t[t.None=0]="None",t[t.Vocalist=1]="Vocalist",t[t.BackingSinging=2]="BackingSinging"}(X||(X={})),function(t){t[t.METHOD_UNSET=0]="METHOD_UNSET",t[t.METHOD_GET=1]="METHOD_GET",t[t.METHOD_POST=2]="METHOD_POST",t[t.METHOD_PUT=3]="METHOD_PUT",t[t.METHOD_PATCH=4]="METHOD_PATCH",t[t.METHOD_DELETE=5]="METHOD_DELETE",t[t.METHOD_HEAD=6]="METHOD_HEAD",t[t.METHOD_OPTIONS=7]="METHOD_OPTIONS"}(Z||(Z={})),function(t){t[t.SERVICE_UNSET=0]="SERVICE_UNSET",t[t.SERVICE_MEDIAGW=1]="SERVICE_MEDIAGW",t[t.SERVICE_LIVEROOM=2]="SERVICE_LIVEROOM",t[t.SERVICE_MIX=3]="SERVICE_MIX",t[t.SERVICE_ZEUS=4]="SERVICE_ZEUS",t[t.SERVICE_ZPUSH=5]="SERVICE_ZPUSH",t[t.SERVICE_L3=6]="SERVICE_L3",t[t.SERVICE_TALKLINE=7]="SERVICE_TALKLINE",t[t.SERVICE_EDUSUITE=8]="SERVICE_EDUSUITE",t[t.SERVICE_ZIM=9]="SERVICE_ZIM",t[t.SERVICE_ClOUD_SETTING=10]="SERVICE_ClOUD_SETTING",t[t.SERVICE_ZEUSHB=11]="SERVICE_ZEUSHB",t[t.SERVICE_USER_LOGIC=12]="SERVICE_USER_LOGIC",t[t.SERVICE_UNIFYDISPATCH=13]="SERVICE_UNIFYDISPATCH",t[t.SERVICE_QUALITY=14]="SERVICE_QUALITY",t[t.SERVICE_SECURITY=15]="SERVICE_SECURITY",t[t.SERVICE_KTVCPR=16]="SERVICE_KTVCPR",t[t.SERVICE_SWITCH4LIVEROOM=17]="SERVICE_SWITCH4LIVEROOM",t[t.SERVICE_WEBRTC_SIGNAL=18]="SERVICE_WEBRTC_SIGNAL",t[t.SERVICE_L3_WEBRTC_SIGNAL=19]="SERVICE_L3_WEBRTC_SIGNAL",t[t.SERVICE_VIDEOCPR=20]="SERVICE_VIDEOCPR",t[t.SERVICE_CDN=21]="SERVICE_CDN",t[t.SERVICE_CLOUDRECORD=22]="SERVICE_CLOUDRECORD",t[t.SERVICE_INNER_ECHO=23]="SERVICE_INNER_ECHO",t[t.SERVICE_OUTER_ECHO=24]="SERVICE_OUTER_ECHO",t[t.SERVICE_LOCALHOST_ECHO=25]="SERVICE_LOCALHOST_ECHO",t[t.SERVICE_ECHO=26]="SERVICE_ECHO",t[t.SERVICE_DOCSERVICE=27]="SERVICE_DOCSERVICE",t[t.SERVICE_AUTHSVR=28]="SERVICE_AUTHSVR"}(K||(K={})),function(t){t[t.Default=0]="Default",t[t.Extranet=1]="Extranet",t[t.Intranet=2]="Intranet"}(Q||(Q={}));var ft="zw.scw.sps.0",_t="zw.scw.sps.1",dt="zw.pw.ue",mt="zw.drh.a.0",vt=(__webpack_require__(720),Promise);document;function pt(t,i,n){void 0===n&&(n=""),t.info("".concat(i," call ").concat(n))}function gt(t,i,n){void 0===n&&(n=""),t.info("".concat(i," end ").concat(n))}function bt(t,i,n){void 0===n&&(n=""),t.info("".concat(i," success ").concat(n))}function Et(t,i){return new vt((function(n,e){e(function(t,i){var n=function(t){var i=t.reduce((function(i,n,e){var s="".concat(n," module");return 0==e?s:e==t.length-1?"".concat(i," and ").concat(s):"".concat(i,", ").concat(s)}),"");return"should install ".concat(i)}(t);return console.error(n),{errorCode:i||At.code,extendedData:n}}(t,i))}))}var St="input param error",Rt="network is broken",Ot="the user cancels the stream request.",yt={code:1000002,message:"not login room"},Tt={code:1000014,message:"stream ID is too long"},wt={code:1000015,message:"streamID is empty"},It={code:1000016,message:"stream ID contains illegal characters"},Nt={code:1000017,message:Rt},Ct={code:1100001,message:St},kt={code:1100002,message:"network timeout."},zt={code:1100999,message:"unknown server error"},At={code:1101003,message:"Module not imported"},Dt=1002011,Mt="room ID is empty",Pt=1002012,xt="room ID contains illegal characters",Ut=1002013,Lt="room ID is too long",qt={code:1102017,message:"dispatch error"},jt={code:1102018,message:"token expired"},Gt={code:1102022,message:"dispatch request timeout"},Ht={code:1103001,message:St},$t={code:1103049,message:"repeated pull same stream"},Vt={code:1103051,message:"publisher retry timeout"},Bt={code:1103055,message:"publish stream no found"},Jt={code:1103056,message:"publish is publishing"},Yt={code:1103089,message:Ot},Ft={code:1104001,message:"input parm error"},Wt={code:1104031,message:"player retry timeout"},Xt={code:1104032,message:"player is playing"},Zt={code:1104039,message:"play stream not found"},Kt={code:1104042,message:Ot},Qt={code:1103052,message:"publisher cdn push error"},ti={code:1000055,message:"cdn url is invalid"},ii=function(t){return t},ni=function(t){return t},ei=function(t){return t},si="/sdk/init",ri="/sdk/login",oi="listener",ui=si,hi="/sdk/start_publish",ai="/liveroom/send_stream_update_info",ci=ni,li=ni,fi=ni,_i={event:"/liveroom/get_current_stream_list",room_id:ni,room_sid_string:ni,stream_seq:ei,stream_size:ei,stream_list:ii,use_ua:ei,error:{Mt:Ht,NOT_LOGIN:yt}},di="/sdk/listener",mi={event:"/sdk/publish_target",error:{Mt:Ct,xt:Bt,Lt:yt,qt:{code:1103063,message:"publish target no response"},jt:{code:1102021,message:"biz channel error."},Gt:{code:1102024,message:"invalid channel"},Ht:zt}},vi="/mss/pushadd",pi="/mss/pushdel",gi=ni,bi={event:"/liveroom/send_stream_extra_info",error:{Mt:Ct,$t:{code:1003050,message:"extra info of publishing stream is null"},Lt:yt,xt:Bt,Vt:{code:1103062,message:"update stream info fail"}},stream_id:ni,stream_extra_info:ni,room_sid_string:ni,room_id:ni,send_seq:ei};function Ei(t){return"number"==typeof t}function Si(t){return"string"==typeof t}function Ri(t){return"boolean"==typeof t}function Oi(t){return void 0===t}function yi(t){return null!==t&&t instanceof Object}function Ti(t){return"function"==typeof t}function wi(t){return t instanceof Array}function Ii(t){return(t.startsWith("preset-id://")||t.startsWith("http")||t.startsWith("https"))&&(t.endsWith(".jpg")||t.endsWith(".jpeg")||t.endsWith(".png"))}function Ni(t){return/^([0-9a-zA-Z#!$%&()`'+-;<=.>@^_~,\\*])+$/.test(t)&&/^[^:/]*$/g.test(t)}function Ci(t){return!!(t.startsWith("rtmp://")||t.startsWith("avertp://")||t.startsWith("https://")&&t.endsWith(".flv")||t.startsWith("https://")&&t.endsWith(".m3u8"))}function ki(t,i){return i[t+"SuccessCallback"]}function zi(t,i,n,e,s){switch(n){case"eventStart":t.eventStart(i,e);break;case"eventEndWithMsgInfo":t.eventEndWithMsgInfo(i,e,s[0]);break;case"addEventMsg":t.addEventMsg(i,e,s[0],s[1]);break;case"addEvent":t.addEvent(i,e);break;case"eventEnd":t.eventEnd(i,e);break;case"addMsgInfo":t.addMsgInfo(i,s[0])}}function Ai(t,i,n,e){!function(t,i,n){i.success&&(n[t+"SuccessCallback"]=i.success),i.error&&(n[t+"ErrorCallback"]=i.error)}(t,{success:function(t,e){for(var s=[],r=2;r<arguments.length;r++)s[r-2]=arguments[r];zi(i,n,t,e,s)}},e)}function Di(t,i,n,e,s){ki(t,i)&&ki(t,i)(n,e)}function Mi(t,i,n){if(i)return{code:t,message:n||"liveroom error"};return{code:0,message:""}}function Pi(t,i){delete i[t+"SuccessCallback"],delete i[t+"ErrorCallback"]}function xi(t,i){var n={code:-1,message:"server error"};return t>1e9&&(n.code=t-1e9+52e6),i&&(n.message=i),n}function Ui(t,i){var n={1016:"MULTI_ROOM_UNABLE",1105:"ROOM_MAX_USER_COUNT",1012:"PUBLISHER_ERROR_REPETITIVE_PUBLISH_STREAM",2002:"TOKEN_ERROR",2003:"ROOM_ERROR_LOGIN_TIMEOUT",2010:"TOKEN_ERROR",5022:"ROOM_COUNT_EXCEED"};return i?t>2e5&&t<3e5?n[t-2e5]:t<2e5?{50116:"TOKEN_ERROR",50117:"TOKEN_EXPIRED",50118:"TOKEN_ERROR",50119:"TOKEN_ERROR",50120:"TOKEN_ERROR",50121:"TOKEN_ERROR",50122:"TOKEN_ERROR",50123:"TOKEN_EXPIRED",50124:"TOKEN_ERROR",50125:"TOKEN_ERROR",50126:"TOKEN_ERROR",50127:"TOKEN_ERROR",50128:"TOKEN_ERROR"}[t]||n[t]||"ROOM_INNER_ERROR":n[t]||"ROOM_INNER_ERROR":""}function Li(t,i,n,e){var s,r=[],o=[],u=[],h=[];n||(n=[]);for(var a=0;a<n.length;a++)if(n[a].anchor_id_name!=t&&n[a].id_name!=t&&n[a].user_id!=t){s=!1;for(var c=0;c<i.length;c++)if(n[a].stream_id===i[c].stream_id){n[a].extra_info!==i[c].extra_info&&u.push(n[a]),JSON.stringify(n[a].stream_attr_opts)!==JSON.stringify(i[c].stream_attr_opts)&&h.push(n[a]),s=!0;break}s||r.push(n[a])}for(var l=0;l<i.length;l++)if(i[l].anchor_id_name!=t&&i[l].id_name!=t&&i[l].user_id!=t){s=!1;for(var f=0;f<n.length;f++)if(i[l].stream_id===n[f].stream_id){s=!0;break}s||o.push(i[l])}i.splice(0);for(a=0;a<n.length;a++)i.push(n[a]);e(r,o,u,h)}function qi(t,i){return 0==i?Ei(t)&&t%1==0&&t>=0:Ei(t)&&t%1==0&&t>0}function ji(t,i,n){return i=null!=i?i:1,n=null!=n?n:1e4,Ei(t)&&t%1==0&&t>=i&&t<=n}function Gi(t){return 0==t||1==t?0==t?"PUBLISHING":"NO_PUBLISH":"PUBLISH_REQUESTING"}function Hi(t){return 0==t||1==t?0==t?"PLAYING":"NO_PLAY":"PLAY_REQUESTING"}function $i(t){return null!=t&&""!==t}function Vi(t,i){return!(t.length>=i)}function Bi(t){for(var i,n=0,e=t.length,s="";n<e;)i=t.subarray(n,Math.min(n+32768,e)),s+=String.fromCharCode.apply(null,Array.from(i)),n+=32768;return btoa(s)}function Ji(t){for(var i in t)yi(t[i])?Ji(t[i]):t.hasOwnProperty(i)||(Ei(t[i])&&(t[i]=0),Si(t[i])&&(t[i]=""))}var Yi="zc.sh.msbss",Fi="zc.sh.psl",Wi="zc.crh.a.0",Xi="zc.hrh.smt.0",Zi=function(){function t(t,i){this.Bt=t,this.Jt=i,this.debug=!1,this.testEnvironment=!1,this.pullLimited=!0,this.useNetAgent=!0,this.configOK=!1,this.relateService=[],this.role=2,this.maxMemberCount=0,this.roomCreateFlag=1,this.netMode=Q.Default,this.callbackList={},this.experimentalAPIList={onRecvRoomMuteVideoStream:0,onRecvRoomMuteAudioStream:0},this.publishStreamList={},this.waitPublishStreamList={},this.streamUrlMap={},this.cmdCallback={},this.customUrl=[],this.customPlayUrl=[],this.turnToTcp=!1,this.turnOverTcpOnly=void 0,this.audioEffectBuffer={},this.audioBitRate=48e3,this.cdnSeq=0,this.engineDestroy=!1,this.listenerList={roomStreamUpdate:[],streamExtraInfoUpdate:[],playerStateUpdate:[],publisherStateUpdate:[],screenSharingEnded:[],publishQualityUpdate:[],playQualityUpdate:[],remoteCameraStatusUpdate:[],remoteMicStatusUpdate:[],soundLevelUpdate:[],capturedSoundLevelUpdate:[],videoDeviceStateChanged:[],audioDeviceStateChanged:[],deviceError:[],_deviceError:[],_remoteCameraStatusUpdate:[],_remoteMicStatusUpdate:[],_streamUpdated:[],receiveRealTimeSequentialData:[],beautyEffectOverload:[],playerRecvSEI:[],beautyEffectError:[],_engineConfigUpdate:[],backgroundEffectError:[],exceptionUpdate:[],networkQuality:[],mixerSoundLevelUpdate:[],autoMixerSoundLevelUpdate:[],mixerRelayCDNStateUpdate:[],_engineDestroy:[],recvExperimentalAPI:[]},this.reportList={},this.reportSeqList={startPublish:{},rePublish:{},startPlay:{},rePlay:{},stopPublish:{},stopPlay:{}},this.streamTrigger={},this.audioStreamList={},this.deviceInfos=null,this.deviceChangeTimer=null,this.deviceStateOut=!1,this.customUa=!1,this.testNetPackageSize=!1,this.testSignalConnectCount=0,this.streamRetryTime=300,this.checkList=[],this.anchor_info={anchor_id:"",anchor_id_name:"",anchor_nick_name:""},this.streamConnectTime=0,this.defaultConnTime=5,this.clientIP="",this.accessClientIp="",this.isMultiOuter=!1,this.type="PUBLIC",this.roomList=[],this.tempRoomList=[],this.isMultiRoom=!1,this.browser="",this.unregisterSeiFilter="",this.isTestMode=!1,this.debugLog=!1,this.netAppConfigDelay=0,this.seiConfig={emulationPreventionByte:!1},this.playAccelerate=!0,this.connectChanged=!1,this.autoSwitchDeviceSetting={camera:!1,microphone:!1},this.unSendMessageList=[],this.scenario=B.Default,this.testStreamRetryMode=0,this.testStreamRetryCount=10,this.supportDispatchByPass=!1,this.testStreamStatusSeq=0,this.engineConfig={keepAudioTrack:!0,playClearLastFrame:!0,previewClearLastFrame:!0,mixingAudioDelay:0,baseMixingAudioDelay:0,adaptCustomUA:!1,allowReplaceEmptyTrack:!1,publishQualityInterval:0,playQualityInterval:0,keepRtcWhenSignalDisconnected:!0,autoRecaptureOnShow:!1,datachannelOption:{ordered:!0}},this.Yt=!0,this.Ft=!1,this.player265Validated=!1,this.player265ReceiverList=[],this.logReportCallback=Ai,this.unregisterCallback=Pi,this.decodeServerError=xi,this.getLiveRoomError=Ui,this.getServerError=Mi,this.mergeStreamList=Li,this.actionSuccessCallback=ki,this.checkValidNumber=ji,this.uint8arrayToBase64=Bi,this.getSeq=n.getSeq,this.getReportSeq=n.getReportSeq,this.cdnSeqV2=(new Date).getTime()}return Object.defineProperty(t.prototype,"networkState",{get:function(){var t;return null===(t=this.rtm)||void 0===t?void 0:t.stateCenter.networkState},set:function(t){var i;(null===(i=this.rtm)||void 0===i?void 0:i.stateCenter)&&!Oi(t)&&(this.rtm.stateCenter.networkState=t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isMiniSdp",{get:function(){if(!this.Yt&&!this.Ft)return!1;if(!window.WebAssembly||!window.Worker)return!1;var t=this.settingConfig.getSetting("open_mini_sdp");return!!Ri(t)&&(this.Bt.info("zc.c.ims setting: "+t),t)},enumerable:!1,configurable:!0}),t.prototype.setIsMiniSdp=function(t){this.settingConfig.setUserValue("open_mini_sdp",t)},Object.defineProperty(t.prototype,"streamCenter",{get:function(){return this.Wt},set:function(t){this.Wt=t},enumerable:!1,configurable:!0}),t.prototype.getRequestId=function(){return this.idName+"-"+(0,n.getSeq)()},t.prototype.actionListener=function(t){for(var i=this,n=[],e=1;e<arguments.length;e++)n[e-1]=arguments[e];var s=["playQualityUpdate","publishQualityUpdate","soundLevelUpdate","capturedSoundLevelUpdate","playerRecvSEI","_remoteCameraStatusUpdate","_remoteMicStatusUpdate","_streamUpdated","_deviceError","networkQuality","exceptionUpdate","mixerSoundLevelUpdate","autoMixerSoundLevelUpdate","mixerRelayCDNStateUpdate"].includes(t);if(!s&&this.listenerList[t]){var r=this.reporter.createSpan(J.H,{key:oi},{key:""},di);r.setAttributes({listener:t,listener_params:JSON.stringify(n)}),["deviceError","streamExtraInfoUpdate","publisherStateUpdate","playerStateUpdate","roomStreamUpdate"].includes(t)&&this.Bt.info("zc.al ".concat(t," ").concat(JSON.stringify(n))),r.end()}this.listenerList[t]&&this.listenerList[t].forEach((function(e){try{setTimeout((function(){e.apply(void 0,n)}),0)}catch(n){i.Bt.error("zc.sc.al "+t+" "+n)}}))},t.prototype.getRoomByRoomID=function(t){return this.roomList.find((function(i){return i.roomID==t}))},t.prototype.getPlayRoom=function(t){return this.roomList.find((function(i){return!!i.streamList.find((function(i){return i.stream_id==t}))}))},t.prototype.callExperimentalAPI=function(t){return new Promise((function(t,i){t(void 0)}))},t.prototype.onExperimentalAPICallback=function(t,i){this.experimentalAPIList[t]&&this.actionListener("recvExperimentalAPI",i)},t.prototype.destroy=function(){this.Wt=null},t}(),Ki=_i,Qi="zb.sh.usi",tn=function(){function t(t,i,n,e,s){this.Bt=t,this.Xt=i,this.rtm=n,this.Wt=e,this.Zt=s,this.Kt=0,this.Qt=0,this.ti=0,this.ii=!1,this.ni=null,this.ei=2e3,this.si=5e3,this.roomID=s,this.logger=t,this.stateCenter=i}return Object.defineProperty(t.prototype,"ri",{get:function(){return this.Xt.reporter},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"reporter",{get:function(){return this.ri},enumerable:!1,configurable:!0}),t.prototype._setCDNInfo=function(t,i){var n=i.urls_flv,e=i.urls_m3u8,s=i.urls_flv_plus,r=i.urls_m3u8_plus,o=i.urls_https_flv,u=i.urls_https_m3u8,h=i.urls_rtmp;t.urlFlv=wi(n)?n[0]||"":Si(n)?n:"",t.urlHls=wi(e)?e[0]||"":Si(e)?e:"",t.urlFlvPlus=wi(s)?s[0]||"":Si(s)?s:"",t.urlHlsPlus=wi(r)?r[0]||"":Si(r)?r:"",t.urlHttpsFlv=wi(o)?o[0]||"":Si(o)?o:"",t.urlHttpsHls=wi(u)?u[0]||"":Si(u)?u:"",t.urlRtmp=wi(h)?h[0]||"":Si(h)?h:""},t.prototype.onStreamUpdated=function(t,i,n){},t.prototype.onStreamExtraInfoUpdated=function(t,i){},t.prototype.onStreamAttrUpdated=function(t,i){},t.prototype.handleStreamStart=function(t,i){var n="zb.sh.hss";pt(this.Bt,n,"stream update"),this.room=i,t.body?(this.ei=t.body.stream_list_hb_wait_merge_time||2e3,this.si=t.body.stream_list_push_merge_timeout||5e3,this.ii=!1,this.handleFullUpdateStream(t.body.stream_seq,t.body.stream_info||[]),this._handleReconnectStream(t.body.stream_info),gt(this.Bt,n)):this.Bt.error(n+" server response wrong")},t.prototype.onPublishStateUpdate=function(t,i,n){},t.prototype._updateStreamInfo=function(t,i,n,e,s){var r,o,u=this;void 0===n&&(n=""),pt(this.Bt,Qi);var h=n,a=null===(r=this.room)||void 0===r?void 0:r.streamList.find((function(i){return i.stream_id===t}));a||this.Bt.info("zb.sh.usi stream not in room cmd "+i);var c={stream_id:t,extra_info:h};if(2002!==i&&2003!==i||(c.stream_sid=(null==a?void 0:a.stream_sid)||""),2001===i){var l=this.Wt.publisherList[t].publishOption;c.inspect_flag=(null==l?void 0:l.inspectFlag)||0}var f=JSON.stringify(c),_={sub_cmd:i,stream_msg:f,third_token:null===(o=this.room)||void 0===o?void 0:o.token},d=this.room;if(this.Xt.useNetAgent){var m=this.rtm.liveRoomHandler.sendStreamUpdate(_,(function(n,s){u.handleStreamUpdateRsp(n,t,i),e&&e(n,s)}),(function(r,o){var h=u.room,a=u.rtm.stateCenter.roomModulesList.find((function(t){return t.roomID===(null==h?void 0:h.roomID)})),c=function(){return(null==a?void 0:a.isTryLogin())||"CONNECTING"===(null==a?void 0:a.roomState)},l=function(){u.Bt.warn("zb.sh.usi resend stream update "+i),u._updateStreamInfo(t,i,n,e,s)};if(h&&((null==a?void 0:a.isLogin())||c())&&r.code&&r.code==kt.code&&h.streamInfoList[t].seq==o)setTimeout((function(){if(2001==i&&u.Xt.publishStreamList[t]&&u.Xt.publishStreamList[t].state==E||2002==i)if(c()){var n=function(t,i){var e=function(){u.rtm.stateCenter.offListener("_roomStateUpdate",n)};t===(null==h?void 0:h.roomID)&&"CONNECTED"===i?(l(),e()):t===(null==h?void 0:h.roomID)&&"DISCONNECTED"===i&&e()};u.rtm.stateCenter.onListener("_roomStateUpdate",n)}else l();else s&&s(kt)}),0);else if(r.body&&r.body.err_code){var f=u.Xt.getServerError(r.body.err_code,u.Xt.useNetAgent,r.body.err_message);[1011,1000002002].includes(f.code)&&(f=jt),s&&s(f,o),i===R&&u.onPublishStateUpdate(st,t,f)}}),{sessionID:null==d?void 0:d.sessionID,roomID:null==d?void 0:d.roomID,roomSessionID:null==d?void 0:d.roomSessionID});[2001,2002].includes(i)&&(this.room.streamInfoList[t]={seq:m})}bt(this.Bt,Qi,"cmd: "+i+", roomid: ".concat(null==d?void 0:d.roomID,", stream: ").concat(t))},t.prototype.updateStreamInfo=function(t,i,n,e,s){var r=this;if(void 0===n&&(n=""),this.room){var o;if(2001===i||2002===i)(o=this.ri.createSpan(J.H,{key:ri,par:this.Zt},{key:""},ai)).setAttributes({stream_update_type:ci(2001===i?"stream added":2002===i?"stream deleted":""),stream_extra_info:li(n),stream_id:fi(t)});this._updateStreamInfo(t,i,n,(function(t,n){[2001,2002].includes(i)&&(o.setAttributes({send_seq:n}),o&&o.end()),e&&e(t,n)}),(function(t,n){[2001,2002].includes(i)&&(o.setAttributes({send_seq:n}),r.ri.setError(o,t)),s&&s(t,n)}))}else this.Bt.warn("zb.sh.usi room not exist")},t.prototype.handleStreamUpdateRsp=function(t,i,n){var e,s,r,o;if(this.rtm.isDisConnect())this.Bt.warn("zb.sh.hsur not login");else if(0==t.body.err_code){this.Bt.info("zb.sh.hsur stream seq "+this.Qt+" server seq "+t.body.stream_seq);var u=this.room;if(u){if(null===(e=null==t?void 0:t.body)||void 0===e?void 0:e.token_remain_time)this.Xt.getRoomByRoomID(null===(s=null==t?void 0:t.header)||void 0===s?void 0:s.room_id)?this.rtm.resetRoomTokenTimer(t.header.room_id,t.body.token_remain_time):this.Bt.error("zb.sh.hsur room no found ignore "+JSON.stringify(null===(r=t.header)||void 0===r?void 0:r.room_id));if(this.Xt.useNetAgent){this.handleStreamSync(t,i,n);var h=u.streamInfoList[i],a=null===(o=t.header)||void 0===o?void 0:o.seq;h&&h.seq===a?delete u.streamInfoList[i]:this.Bt.info("zb.sh.hsur ".concat(JSON.stringify(i)," udp stream info; rsp seq: ").concat(a,", cur seq: ").concat(null==h?void 0:h.seq," "))}}else this.Bt.info("hsur.0 room no found")}else this.Bt.error("zb.sh.hsur stream update error "+t.body.err_code)},t.prototype.handleStreamSync=function(t,i,n){if(this.handleStreamRsp(this.room,i,{stream_id:i,stream_sid:t.body.stream_sid,stream_ver:t.body.stream_ver,stream_nid:t.body.stream_nid,id_name:this.Xt.idName,nick_name:this.Xt.nickName},n),t.body.stream_seq>this.Qt+1)return this.Bt.info("zb.sh.hss.1 seq diff server: "+t.body.stream_seq+" client "+this.Qt),void this.fetchStreamList();this.Qt=t.body.stream_seq;var e=this.room.streamList.find((function(t){return t.stream_id==i}));e&&t.body.stream_ver>e.stream_ver&&this.fetchStreamList(i)},t.prototype.handleStreamRsp=function(t,i,n,e){var s=this.Xt.publishStreamList[i],r=t.streamList.find((function(t){return t.stream_id==i}));if(this.Bt.info("hsur.0 cmd "+e+" "+!!r),r&&2002===e){var o=t.streamList.findIndex((function(t){return t.stream_id==i}));this.Bt.info("hsur.0 stream index "+o),o>-1&&t.streamList.splice(o,1)}s?(s.state==E&&(s.state=S,2001!==e||r||t.streamList.push(n),this.onPublishStateUpdate(et,i,{code:0,message:""})),r&&r.stream_sid!==n.stream_sid&&(this.Bt.info("hsur.0 update sid. "+i+" origin:"+r.stream_sid+", new:"+n.stream_sid),r.stream_sid=n.stream_sid)):this.Bt.info("hsur.0 stream is not exist")},t.prototype.handleFetchStreamListRsp=function(t,i){var n,e,s,r,o,u,h="zb.sh.hfslr";if(pt(this.Bt,h,i),this.ii=!1,this.ri.spanEnd({key:Ki.event,par:this.Zt},{stream_seq:Ki.stream_seq(null===(n=t.body)||void 0===n?void 0:n.stream_seq),stream_size:Ki.stream_size(null===(s=null===(e=t.body)||void 0===e?void 0:e.stream_info)||void 0===s?void 0:s.length),stream_list:Ki.stream_list(null===(r=t.body)||void 0===r?void 0:r.stream_info),error:(null===(o=null==t?void 0:t.body)||void 0===o?void 0:o.err_code)||(null==t?void 0:t.code),message:(null===(u=null==t?void 0:t.body)||void 0===u?void 0:u.err_message)||(null==t?void 0:t.msg)}),0===t.body.err_code)if(this.Qt!==t.body.stream_seq){if(this.Qt>t.body.stream_seq)return this.Bt.error(h+" less seq"),void this.fetchStreamList(i);if(this.ti>t.body.stream_seq)this.Bt.info(h+" less than max fetch stream seq ");else{var a=t.body.stream_info;this.Xt.useNetAgent&&i&&(a=t.body.stream_info.filter((function(t){return t.stream_id===i}))),this.handleFullUpdateStream(t.body.stream_seq,a),bt(this.Bt,h)}}else this.Bt.info(h+" same seq");else this.Bt.info(h+" server error=",t.body.err_code)},t.prototype.syncPublishStreamList=function(){var t="zb.sh.spsl";pt(this.Bt,t);var i=function(t){var i=n.Xt.publishStreamList[t];if(i.state===S){var e=n.room.streamList.findIndex((function(i){return i.stream_id===t}));if(i.roomID===n.room.roomID&&-1===e)i.state=E,n.updateStreamInfo(t,R,i.extra_info,(function(t){}))}},n=this;for(var e in this.Xt.publishStreamList)i(e);bt(this.Bt,t)},t.prototype.handleFullUpdateStream=function(t,i){var n=this,e="zb.sh.hfus";pt(this.Bt,e),this.Qt=t,this.ti<t&&(this.ti=t),this.Bt.debug(e+" server seq "+this.Qt),i=i.filter((function(t){return 1!==t.stream_type})),this.Xt.mergeStreamList(this.Xt.idName,this.room.streamList,i,(function(t,i,s,r){0!==t.length&&(n.Bt.debug(e+" callback addstream"),n.onStreamUpdated(n.Zt,T,n.makeCallbackStreamList(t))),0!==i.length&&(n.Bt.debug(e+" callback delstream"),n.onStreamUpdated(n.Zt,w,n.makeCallbackStreamList(i))),0!==s.length&&(n.Bt.debug(e+" callback updatestream"),n.onStreamExtraInfoUpdated(n.Zt,n.makeCallbackStreamList(s))),0!==r.length&&(n.Bt.warn(e+" callback updateAttrstream"),n.onStreamAttrUpdated(n.Zt,n.makeCallbackStreamList(r)))})),this.syncPublishStreamList(),bt(this.Bt,e)},t.prototype.handlePushStreamUpdateMsg=function(t){var i="zb.sh.hpsum";pt(this.Bt,i,JSON.stringify(t));var n=t.body.stream_info;if(n&&0!==n.length){if(n=n.filter((function(t){return 1!==t.stream_type})),this.Qt+1!==t.body.stream_seq)return pt(this.Bt,i,"updatestream 1"),void this.fetchStreamList();if(t.body.stream_seq<this.ti)return pt(this.Bt,i,"updatestream 2"),void this.fetchStreamList();switch(this.Qt=t.body.stream_seq,t.body.stream_cmd){case k:this.oi(n);break;case z:this.ui(n);break;case A:this._handleUpdatedStreamList(n)}bt(this.Bt,i)}else this.Bt.info(i+", emtpy list")},t.prototype.oi=function(t){var i="zb.sh.hasl";pt(this.Bt,i);for(var n,e=[],s=0;s<t.length;s++)if(t[s].anchor_id_name!=this.Xt.idName&&t[s].id_name!=this.Xt.idName&&t[s].user_id!==this.Xt.idName){n=!1;for(var r=0;r<this.room.streamList.length;r++)if(t[s].stream_id===this.room.streamList[r].stream_id){n=!0;break}n||e.push(t[s])}else this.Bt.debug("hdsl.0 have self stream added");if(0!==e.length){this.Bt.debug(i+" callback addstream");for(var o=0;o<e.length;o++){this.room.streamList.push(e[o]);var u=this.Wt.playerList[e[o].stream_id];null==u||u.player.setStreamAdd()}this.onStreamUpdated(this.Zt,T,this.makeCallbackStreamList(e))}bt(this.Bt,i)},t.prototype.ui=function(t){var i="zb.sh.hdsl";pt(this.Bt,i);for(var n=[],e=0;e<t.length;e++)if(t[e].anchor_id_name!=this.Xt.idName&&t[e].id_name!=this.Xt.idName&&t[e].user_id!==this.Xt.idName){for(var s=this.room.streamList.length-1;s>=0;s--)if(t[e].stream_id===this.room.streamList[s].stream_id){!this.Xt.connectChanged&&this.room.streamList.splice(s--,1),n.push(t[e]);break}}else this.Bt.debug(i+" have self stream deleted");0!==n.length&&(this.Bt.debug(i+" callback delstream"),this.onStreamUpdated(this.Zt,w,this.makeCallbackStreamList(n))),gt(this.Bt,i)},t.prototype._handleUpdatedStreamList=function(t){var i="zb.sh.husl";pt(this.Bt,i);for(var n=[],e=[],s=0;s<t.length;s++)if(t[s].anchor_id_name!=this.Xt.idName&&t[s].id_name!=this.Xt.idName&&t[s].user_id!==this.Xt.idName){for(var r=0;r<this.room.streamList.length;r++)if(t[s].stream_id===this.room.streamList[r].stream_id){t[s].extra_info!==this.room.streamList[r].extra_info&&(this.room.streamList[r]=t[s],n.push(t[s])),t[s].stream_attr_opts&&JSON.stringify(t[s].stream_attr_opts)!==JSON.stringify(this.room.streamList[r].stream_attr_opts)&&(this.room.streamList[r]=t[s],e.push(t[s]));break}}else this.Bt.debug("hsul.0 have self stream updated");0!==n.length&&(this.Bt.debug(i+" callback updatestream"),this.onStreamExtraInfoUpdated(this.Zt,this.makeCallbackStreamList(n))),0!==e.length&&(this.Bt.warn(i+" callback updateAttrStream"),this.onStreamAttrUpdated(this.Zt,this.makeCallbackStreamList(e))),bt(this.Bt,i)},t.prototype.fetchStreamList=function(t){var i,n,e,s=this,r="zb.sh.fsl";pt(this.Bt,r);var o=this.ri.createSpan(J.H,{key:ri,par:this.Zt},{key:Ki.event,par:this.Zt},Ki.event,!0);return this.rtm.isDisConnect()?(this.Bt.info(r+" state error"),void this.ri.setError(o,Ki.error.NOT_LOGIN)):this.ii?(this.Bt.info(r+" already doing"),void this.ri.setError(o,Ki.error.Mt," already doing")):(this.ii=!0,this.Bt.info(r+" send fetch request"),this.Xt.useNetAgent&&this.rtm.liveRoomHandler.getStreamList({},(function(i){s.handleFetchStreamListRsp(i,t)}),(function(t){}),{roomID:null===(i=this.room)||void 0===i?void 0:i.roomID,sessionID:null===(n=this.room)||void 0===n?void 0:n.sessionID,roomSessionID:null===(e=this.room)||void 0===e?void 0:e.roomSessionID}),void bt(this.Bt,r))},t.prototype._handleReconnectStream=function(t){var i,n,e,s,r,o,u,h="zb.sh.hrs";pt(this.Bt,h);var a=this.Wt.publisherList,f=this.Wt.playerList;this.Bt.info(h+" publish "+Object.keys(this.Wt.publisherList));var m=function(h){if((null===(n=null===(i=a[h])||void 0===i?void 0:i.room)||void 0===n?void 0:n.roomID)!==v.Zt)return"continue";var f=t.find((function(t){return t.stream_id==h})),m=f&&!(f.anchor_id_name===v.Xt.idName||f.id_name===v.Xt.idName||f.user_id===v.Xt.idName);if(v.Bt.info("zb.sh.hrs stream ".concat(h," ").concat(!!f," ").concat(m," ").concat(null===(e=a[h].publisher)||void 0===e?void 0:e.state)),(null===(s=a[h].publisher)||void 0===s?void 0:s.state)!=c&&a[h].state!==_||f&&!m){if(((null===(r=a[h].publisher)||void 0===r?void 0:r.state)==l||a[h].state===d)&&!(null===(u=null===(o=a[h])||void 0===o?void 0:o.retryStreamHandler)||void 0===u?void 0:u.maxTimer)&&t.find((function(t){return t.stream_id==h}))){v.updateStreamInfo(h,O);for(var p=0;p<v.room.streamList.length;p++)if(v.room.streamList[p].stream_id==h){v.room.streamList.splice(p--,1);break}}}else v.updateStreamInfo(h,R,v.Xt.publishStreamList[h].extra_info)},v=this;for(var p in a)m(p);for(var p in a){if(a[p].room.roomID===this.Zt)if(a[p].isReDispatch)this.Bt.info(h+" "+p+"retry dispatch"),(g=a[p].retryDispatchHandler).stopMaxTime(),g.invalid(),g.initStream(p,a[p].publishOption,!0),g.active(0),a[p].isReDispatch=!1}for(var p in f){var g;if(f[p].room.roomID===this.Zt)if(f[p].isReDispatch)this.Bt.info(h+" "+p+"retry dispatch"),(g=f[p].retryDispatchHandler).stopMaxTime(),g.invalid(),g.initStream(p,f[p].playOption,!1),g.active(0),f[p].isReDispatch=!1}var b=this.Wt.stopedPlayerList;for(var p in b)if(b[p].roomID===this.Zt){var E=this.Wt,S=b[p],y=S.playOption;E.setPlayStateStart(p,y,S.isDataChannel);var T=E.playerList[p].retryDispatchHandler;E.playSuccessCallBackList[p]=b[p].sucCallBack?b[p].sucCallBack:function(t){},b[p].errCallBack&&(E.playErrorCallBackList[p]=b[p].errCallBack),E.onPlayStateUpdate(ut,p,{code:0,message:""}),T.stopMaxTime(),T.invalid(),T.initStream(p,y,!1),T.startMaxTime(),T.active(0),delete b[p]}gt(this.Bt,h)},t.prototype.makeCallbackStreamList=function(t){var i,n=[];this.Xt.useNetAgent&&this.Xt.appConfig&&(i=this.Xt.appConfig.media_config.play_config.resource_info.filter((function(t){return[u.CDN,u.DG].includes(t.resource_type)})));if(t&&t.length>0)for(var e=0;e<t.length;e++){var s=t[e].stream_id;if(i&&i.length)for(var r=0;r<i.length;r++){for(var o=i[r].resource_type==u.DG?"_plus":"",a=[],c=[],l=[],f=0;f<i[r].service_info.length;f++){var _=i[r].service_info[f],d=_.protocol,m=_.url_template.replace("{STREAM_NAME}",s);switch(d){case h.FLV:a.push(m);break;case h.HLS:c.push(m);break;case h.RTMP:l.push(m)}}t[e]["urls_flv"+o]=a,t[e]["urls_m3u8"+o]=c,t[e]["urls_rtmp"+o]=l}var v={user:{userID:t[e].anchor_id_name||t[e].id_name,userName:t[e].anchor_nick_name||t[e].nick_name},extraInfo:t[e].extra_info,streamID:t[e].stream_id,roomID:"",urlFlv:"",urlFlvPlus:"",urlRtmp:"",urlHls:"",urlHlsPlus:"",urlHttpsFlv:"",urlHttpsHls:"",streamGID:t[e].stream_gid,closeType:t[e].close_type,stream_attr_opts:t[e].stream_attr_opts};this._setCDNInfo(v,t[e]),n.push(v)}return n},t.prototype.sendHttpPBRequest=function(t,i,n,e,s){var r,o;null===(r=this.rtm.netAgent)||void 0===r||r.startHttpRequest2({interfaceID:t.interfaceID,resID:t.resID||"",body:i,ack:!1,idName:this.Xt.idName,method:2,token:null===(o=this.room)||void 0===o?void 0:o.token,mode:this.Xt.testEnvironment?2:1,reduceRspHeaders:!0},(function(t,i){n&&n(t,i)}),(function(t){e&&e(t)}),null,{timeout:(null==s?void 0:s.timeout)||4e3,extras:{protoCmd:t.protoCmd}})},t.prototype.sendMixRequest=function(t,i,n,e,s){var r=this;void 0===s&&(s=2);var o=function(o,u){var h=o.status_code,a=o.body,c=o.code,l=o.message;return Oi(c)||0===c?h&&200!==h?(s--,void(502===h&&s>0?r.sendMixRequest(t,i,n,e,s):e&&e(h,a))):void(n&&n(a,u)):c===kt.code&&s>0?(s--,void r.sendMixRequest(t,i,n,e,s)):void(e&&e(-1,{},{code:c,message:l}))};this.sendHttpPBRequest(t,i,(function(t,i){o(t,i)}),(function(t){o(t)}))},t.prototype.sendRTMPRequest=function(t,i,n){var e=this.rtm.netAgent,s=this.Xt.appid,r=t.streamID,o="/v1/jsrtmp/dispatch/".concat(s,"/").concat(r,"/").concat(t.actionType,"/").concat(e.clientIP),u=this.room;e.startHttpRequest({service:1,headers:[{name:"Token-Appid",val:s+""},{name:"Token-Str",val:(null==u?void 0:u.token)||""},{name:"Token-Userid",val:this.Xt.idName},{name:"Token-Biztype",val:"2"},{name:"Net-Mode",val:this.Xt.netMode+""}],body:{},idName:this.Xt.idName,method_no:1,ack:!1,location:o},(function(t){i(t)}),(function(t,i,e){n(t)}))},t.prototype._publishTarget=function(t,i,n){},t.prototype.updateStreamExtraInfo=function(t,i,n,e){pt(this.Bt,"zb.sh.usei");var s=y;this.Xt.publishStreamList[t]&&this.Xt.publishStreamList[t].state>=E?(this.Xt.publishStreamList[t].extra_info=i,this.updateStreamInfo(t,s,i,n,e)):this.Xt.publishStreamList[t]&&this.Xt.publishStreamList[t].state===b?(this.Xt.publishStreamList[t].extra_info=i,n({errorCode:0})):e(bi.error.Vt)},t.prototype.getMixStreamStatus=function(t){},t.prototype.setStreamExtraInfo=function(t,i,n,e){this.updateStreamExtraInfo(t,i,n,e)},t.prototype._publishTargetWeb=function(t,i,n){},t.prototype.patchStreamList=function(t){var i=this;if(Ei(t.body.stream_refresh)&&0!==t.body.stream_refresh)return this.Bt.info("zc.sh.psl stream refresh "),void this.fetchStreamList();this.Bt.info("zc.sh.psl stream seq "+this.Qt+" "+JSON.stringify(this.ni)),t.body.stream_seq>this.Qt&&!this.ni&&(this.ni={},pt(this.Bt,Fi,"update stream "+this.Qt+" server "+t.body.stream_seq),this.ai&&clearTimeout(this.ai),this.ai=setTimeout((function(){i.handleMergeTimeout()}),this.ei)),this.Kt=t.body.stream_seq},t.prototype.getStreamSeq=function(){return this.Qt},t.prototype.mergeStreamByStreamSeq=function(t,i,n){var e=this;this.ni||(this.Bt.warn("zc.sh.msbss new merge stream list "+this.Qt+" server "+i),this.ni={},this.ai&&clearTimeout(this.ai),this.ai=setTimeout((function(){e.handleMergeTimeout()}),this.si)),this.Bt.info(Yi+" ".concat(this.ni," ").concat(t," ").concat(i," ").concat(n)),this.ni[i]={cmd:t,streamList:n}},t.prototype.handleMergeTimeout=function(){if(this.ni){var t=Object.keys(this.ni).map((function(t){return+t})).sort((function(t,i){return t-i}));t[t.length-1]-t[0]+1===t.length||t[t.length-1]>=this.Kt?this.mergeStream(t):(this.ni=null,this.fetchStreamList())}},t.prototype.mergeStream=function(t){var i=this;this.Bt.info("zc.sh.ms merge streamList "+this.Qt+" streamSeqList "+t.join(","));var n=t[t.length-1],e=[];t.forEach((function(t){if(i.ni&&i.ni[t])switch(i.ni[t].cmd){case k:i.ni[t].streamList.forEach((function(t){var i=e.findIndex((function(i){return i.stream_id==t.stream_id}));-1!==i&&e.splice(i),e.push(t)}));break;case z:i.ni[t].streamList.forEach((function(t){var i=e.findIndex((function(i){return i.stream_id==t.stream_id}));-1!==i&&e.splice(i)}));break;case A:i.ni[t].streamList.forEach((function(t){var i=e.findIndex((function(i){return i.stream_id==t.stream_id}));-1!==i&&e.splice(i),e.push(t)}))}})),this.ni=null,this.Bt.info("zc.sh.ms "+e),this.handleFullUpdateStream(n,e)},t.prototype.reset=function(){this.Kt=0,this.ni=null,this.ai&&(clearTimeout(this.ai),this.ai=void 0),this.ei=2e3,this.si=5e3},t}(),nn="/sdk/init",en="/sdk/check_system",sn={kCheckSystemGetSettingFailError:{code:1101001,message:"wx get setting fail"}},rn=ii,on={event:"/sdk/api/publish_request",error:{kPublishStreamIDNullError:wt,ci:Ht,kPublishStreamIDTooLongError:Tt,kPublishStreamIDInvalidCharacterError:It,li:kt,fi:Gt,_i:qt,di:Nt,mi:yt,vi:Vt,pi:Jt},publishOption:ii,stream:ii,message:ii},un={event:"/sdk/api/play_request",error:{kPlayStreamIDNullError:wt,gi:Ft,kPlayStreamIDTooLongError:Tt,bi:It,Ei:yt,Si:$t,Ri:Zt,Oi:kt,yi:Gt,Ti:qt,wi:Nt,Ii:Wt,Ni:Xt},playOption:ii,message:ii,session_id:ii,stream:ii,audio_activate:ii,video_activate:ii},hn="/sdk/stop_publish",an="/sdk/stop_play",cn="/liveroom/get_stream_update_info",ln=ii,fn=ii,_n="/liveroom/get_stream_extra_info",dn=ii,mn=function(){return mn=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t},mn.apply(this,arguments)},vn=function(){function t(t,i,n,e,s){this.Bt=t,this.dataReport=i,this.Xt=n,this.Wt=e,this.rtm=s,this.preferPublishSourceType=x.ultra,this.ultraPlaySourceType="rtmp_v2"}return t.prototype.startPublishingStream=function(t,i){var e=this;return new Promise((function(s,r){var o;e.Bt.info("zw.pu.sps.0 call");var u=(0,n.getReportSeq)();e.Xt.reportSeqList.startPublish[t]=u,e.dataReport.newReport(u,on.event);var h=function(i,n){e.Bt.error("zw.pu.sps.0 "+(n||i.message)),e.dataReport.uploadReport(u,void 0,i,n),delete e.Xt.reportSeqList.startPublish[t],r(mn(mn({},i),{errorCode:i.code,extendedData:i.message+(n?" "+n:"")}))};if($i(t))if(Si(t)){if(!Vi(t,256))return h(on.error.kPublishStreamIDTooLongError),!1;if(!Ni(t))return h(on.error.kPublishStreamIDInvalidCharacterError),!1;if(e.Xt.isMultiRoom&&(!i||!Si(i.roomID)||""==i.roomID))return h(on.error.ci,"  roomID is need if set multi room"),!1;if(i&&!Oi(i.inspectFlag)){if(!Ei(i.inspectFlag))return h(on.error.ci,"  inspectFlag must be number"),!1;if(![0,1].includes(i.inspectFlag))return h(on.error.ci,"  inspectFlag is not in range"),!1}var a=(null==i?void 0:i.roomID)?i.roomID:null===(o=e.Xt.roomList[0])||void 0===o?void 0:o.roomID,c=e.Xt.getRoomByRoomID(a);if(e.dataReport.addMsgInfo(u,{stream:on.stream(t),publish_room_id:a}),c){if(e.Xt.customUrl&&0!=e.Xt.customUrl.length){e.Xt.publishStreamList[t]={state:g,extra_info:i&&i.extraInfo?i.extraInfo:null,roomID:a};var l=e.Wt.updatePublishingState(c,t,i||void 0,!0);if(!0!==l){var f=JSON.parse(JSON.stringify(l));return void h(f,"cannot start publish")}return e.Wt.publishSuccessCallBackList[t]=function(t,i){s({streamID:t,url:i})},e.Wt.startPublishingStream(t,e.Xt.customUrl,1)}if(e.rtm.isDisConnect())h(on.error.mi);else{var _=e.Wt.updatePublishingState(c,t,i||void 0,!0);if(!0===_)Ai("kZegoTaskPublishStart"+t,e.dataReport,u,e.Xt.reportList),c.streamHandler.onPublishStateUpdate(rt,t,{code:0,message:""}),e.dataReport.addMsgInfo(u,{publishOption:on.publishOption(i),mini_sys_infos:e.Wt.systemInfo}),!i||"CDN"!=i.sourceType&&"BGP"!=i.sourceType||e.setPreferPublishSourceType(U[i.sourceType]),e.Xt.publishStreamList[t]={state:g,extra_info:i&&i.extraInfo?i.extraInfo:null,roomID:null==c?void 0:c.roomID},e.Bt.info("zw.pu.sps.0 fetch stream url"),Di("kZegoTaskPublishStart"+t,e.Xt.reportList,ht,"get_publish_url"),e.Wt.publishSuccessCallBackList[t]=function(t,i){Di("kZegoTaskPublishStart"+t,e.Xt.reportList,ct,"get_publish_url"),s({streamID:t,url:i})},e.Wt.publishErrorCallBackList[t]=function(t){h(t)},e.fetchPublishStreamUrl(t,c);else{f=JSON.parse(JSON.stringify(_));h(f,"cannot start publish")}}}else h(on.error.ci,"room no found")}else h(on.error.ci);else h(on.error.kPublishStreamIDNullError)}))},t.prototype.setPreferPublishSourceType=function(t,i){return this.Bt.info("zw.pu.sppst.0 call"),t!==x.cdn&&t!==x.ultra&&t!==x.customUrl?(this.Bt.error("zw.pu.sppst.0 sourceType only can be number 0 1 2"),!1):t!==x.customUrl||Si(i)&&""!=i?(this.preferPublishSourceType=t,this.customCdnUrl=i,this.Bt.info("zw.pu.sppst.0 call success"),!0):(this.Bt.error("zw.pu.sppst.0 customUrl must be string and not empty"),!1)},t.prototype.fetchPublishStreamUrl=function(t,i){var n=this;if(this.Bt.info("zw.pu.fpsu.0 call"),this.Bt.info("zw.pu.fpsu.0 send fetch publish request"),this.preferPublishSourceType==x.cdn){var e=this.Wt.getCDNUrl(t,1).rtmps;e&&e.length?this.doPublishStream(t,e,i):this.handleStreamPublishFail(t,i,"the cdn url is empty from app config")}else{this.Wt.eventSeq+=1;var s=this.Wt.eventSeq,r=this.Wt.publisherList[t],o=r.dispatchRetryHandler;o.initRequestInfo({actionType:"push",streamID:t},i),o.initCallback((function(e){e.seq=s,n.handleFetchStreamPublishUrlRsp(e,t,i.roomID)}),(function(e){n.handleStreamPublishFail(t,i)})),r.dispatchRetryHandler.startMaxTime(),r.dispatchRetryHandler.active(!0),this.Xt.streamUrlMap[s]=t}this.Bt.info("zw.pu.fpsu.0 call success")},t.prototype.handleFetchStreamPublishUrlRsp=function(t,i,n){this.Bt.info("zw.pu.hfspur.0 call");var e=this.Xt.getRoomByRoomID(n);if(e){var s;if(this.Xt.streamUrlMap[null==t?void 0:t.seq]&&delete this.Xt.streamUrlMap[null==t?void 0:t.seq],0!==(s=t.code))return this.Bt.info("zw.pu.hfspur.0 server error= "+s),void(this.Xt.publishStreamList[i]&&(this.Bt.error("zw.pu.hfspur.0 liveRoom cmd error"),this.handleStreamPublishFail(i,e,"server error="+s)));t.hosts&&this.doPublishStream(i,t.hosts||[],e)}else this.Bt.error("zw.pu.hfspur.0 room no found")},t.prototype.handleStreamPublishFail=function(t,i,n){var e=on.error._i;this.Bt.error("zw.pu.hspf.0 "+(n=n||e.message)),this.Wt.publishErrorCallBackList[t](e),this.Wt.stopPublishingStream(t,{code:e.code,message:n})},t.prototype.doPublishStream=function(t,i,n){return this.Bt.info("zw.pu.dps.0 call "+t+"streamUrl: "+JSON.stringify(i)),this.Xt.publishStreamList[t]?(this.Xt.publishStreamList[t].state=b,!i||i.length<=0?(this.handleStreamPublishFail(t,n),!1):(this.Wt.startPublishingStream(t,i,this.preferPublishSourceType),this.Bt.info("zw.pu.dps.0 call success"),!0)):(this.Bt.error("zw.pu.dps.0 cannot find stream"),!1)},t.prototype.stopPublishingStream=function(t,i){var e,s,r=this;this.Bt.info("zw.pu.sps.0.0 call "+t);var o=(0,n.getReportSeq)();this.dataReport.newReport(o,hn),this.dataReport.addMsgInfo(o,{stream_id:t,room_id:null===(s=null===(e=this.Wt.publisherList[t])||void 0===e?void 0:e.room)||void 0===s?void 0:s.roomID});var u=function(i,n){r.Bt.error("zw.pu.sps.0.0 "+(n||i.message)),r.dataReport.uploadReport(o,void 0,i,n),delete r.Xt.reportSeqList.startPublish[t]};if(!$i(t))return u(on.error.kPublishStreamIDNullError),!1;if(!Si(t))return this.Bt.error("zw.pu.sps.0.0 param error"),u(on.error.ci),!1;var h=this.Wt.publisherList[t];return(null==h?void 0:h.room)?(this.Wt.stopPublishingStream(t,void 0,i),this.dataReport.uploadReport(o),this.Bt.info("zw.pu.sps.0.0 call success"),!0):(u(on.error.ci," room no found"),!1)},t}(),pn=function(){return pn=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t},pn.apply(this,arguments)},gn=function(){function t(t,i,n,e,s){this.Bt=t,this.dataReport=i,this.Xt=n,this.Wt=e,this.rtm=s,this.mixStreamList={},this.streamUrlRspList={},this.preferPlaySourceType=M.ultra,this.ultraPlaySourceType="rtmp_v2"}return Object.defineProperty(t.prototype,"isDisConnect",{get:function(){return this.rtm.isDisConnect()},enumerable:!1,configurable:!0}),t.prototype.startPlayingStream=function(t,i){var e=this;return new Promise((function(s,r){e.Bt.info("zw.pl.sps.1 call "+t);var o=(0,n.getReportSeq)();e.Xt.reportSeqList.startPlay[t]=o,e.dataReport.newReport(o,un.event);var u=function(i,n){e.Bt.error("zw.pl.sps.1 "+(n||i.message)),e.dataReport.uploadReport(o,void 0,i,n),delete e.Xt.reportSeqList.startPlay[t],r(pn(pn({},i),{errorCode:i.code,extendedData:i.message+(n?" "+n:"")}))};if($i(t))if(Si(t))if(Vi(t,256))if(Ni(t)){if(e.Xt.customPlayUrl&&0!=e.Xt.customPlayUrl.length){var h=e.Wt.updatePlayingState(t,i?i.streamParams:void 0,!0);if(!0!==h){var a=JSON.parse(JSON.stringify(h));return void u(a,"cannot start play")}return e.Wt.playErrorCallBackList[t]=function(t){u(t)},e.Wt.startPlayingStream(t,e.Xt.customPlayUrl,1)}if(e.isDisConnect)u(un.error.Ei);else{var c=e.Wt.updatePlayingState(t,i?i.streamParams:void 0,!0);if(!0===c){if(e.Wt.onPlayStateUpdate(ut,t,{code:0,message:""}),Ai("kZegoTaskPlayStart"+t,e.dataReport,o,e.Xt.reportList),e.dataReport.addMsgInfo(o,{stream:un.stream(t),playOption:un.playOption(i),mini_sys_infos:e.Wt.systemInfo}),e.Wt.playSuccessCallBackList[t]=function(t,i){Di("kZegoTaskPlayStart"+t,e.Xt.reportList,ct,"get_play_url"),s({streamID:t,url:i})},e.Wt.playErrorCallBackList[t]=function(i){Di("kZegoTaskPlayStart"+t,e.Xt.reportList,ct,"get_play_url"),u(i)},i&&i.isMix){e.mixStreamList[t]={ultra_url_rtmp:null};var l="BGP"==i.sourceType,f=l?"rtmp_v2":"rtmp_cdn",_=l?x.ultra:x.cdn;return e.Bt.info("zw.pl.sps.1 play mix: "+"".concat(f,", ").concat(_)),void e.fetchPlayStreamUrl(t,f,_)}Di("kZegoTaskPlayStart"+t,e.Xt.reportList,ht,"get_play_url"),i&&"CDN"==i.sourceType||e.preferPlaySourceType===M.cdn?e.startPlayingStreamFromCDN(t):e.startPlayingStreamFromBGP(t)}else{a=JSON.parse(JSON.stringify(c));u(a)}}}else u(un.error.bi);else u(un.error.kPlayStreamIDTooLongError);else u(un.error.gi);else u(un.error.kPlayStreamIDNullError)}))},t.prototype.stopPlayingStream=function(t,i){var e;this.Bt.info("zw.pl.sps.1.0 call "+t);var s=(0,n.getReportSeq)();if(this.dataReport.newReport(s,an),this.dataReport.addMsgInfo(s,{stream_id:t,room_id:null===(e=this.Wt.playerList[t])||void 0===e?void 0:e.room.roomID}),!Si(t)||""==t)return this.Bt.error("zw.pl.sps.1.0 stream ID must be string and not empty"),this.dataReport.addMsgInfo(s,un.error.gi),void this.dataReport.uploadReport(s);var r=this.Wt.playerList[t],o=r&&r.state!==d;for(var u in this.Wt.stopPlayingStream(t,void 0,i),o&&this.Wt.onPlayStateUpdate(ot,t,{code:0,message:""}),this.Xt.streamUrlMap)if(this.Xt.streamUrlMap[u]===t){delete this.Xt.streamUrlMap[u];break}this.mixStreamList[t]&&delete this.mixStreamList[t],this.dataReport.uploadReport(s),this.Bt.info("zw.pl.sps.1.0 call success")},t.prototype.startPlayingStreamFromCDN=function(t){this.Bt.info("zw.pl.spsfc call "+t);var i=this.Xt.getPlayRoom(t)||this.Xt.roomList[0];if(!i)return this.Bt.error("zw.pl.spsfc room no found"),!1;for(var n=null,e=0;e<i.streamList.length;e++)if(i.streamList[e].stream_id===t){n=i.streamList[e].urls_rtmp||[];break}if(!n||n.length<=0){var s;if(!(s=this.Wt.getCDNUrl(t,0).rtmps)||!s.length)return this.Bt.error("zw.pl.spsfc cannot find stream url,Please check if CDN is configured "),this.Wt.onPlayStateUpdate(ot,t,un.error.Ti),!1;this.Bt.info("zw.pl.spsfcfrom app config"),n=s}return this.Bt.info("zw.pl.spsfc play stream"),this.doPlayStream(t,n,x.cdn)},t.prototype.startPlayingStreamFromBGP=function(t){return this.Bt.info("zw.pl.spsfb fetch stream url"),this.fetchPlayStreamUrl(t,this.ultraPlaySourceType,x.ultra),!0},t.prototype.doPlayStream=function(t,i,n){return this.Bt.info("zw.pl.dps call"),this.Wt.startPlayingStream(t,i,n),!0},t.prototype.fetchPlayStreamUrl=function(t,i,n){var e=this;if(this.Bt.info("zw.pl.fpsu call "+t),this.isDisConnect)this.Bt.info("zw.pl.fpsu state error");else{this.Bt.info("zw.pl.fpsu send fetch request");var s=this.Xt.roomList[0].roomID,r=this.Xt.getRoomByRoomID(s);if(this.Wt.eventSeq+=1,r){if(n==x.cdn){var o=this.Wt.getCDNUrl(t,0).rtmps;o&&o.length?this.doPlayStream(t,o,n):this.handleStreamUrlFail(t,un.error.Ti.code)}else{var u=this.Wt.eventSeq,h=this.Wt.playerList[t],a=h.dispatchRetryHandler;a.initRequestInfo({actionType:"pull",streamID:t},r),a.initCallback((function(i){i.seq=u,e.handleFetchStreamUrlRsp(i,n,t,s)}),(function(i){e.handleStreamUrlFail(t,i.code)})),h.dispatchRetryHandler.startMaxTime(),h.dispatchRetryHandler.active(!0),this.Xt.streamUrlMap[u]=t,this.Wt.playerList[t]&&(this.Wt.playerList[t].seq=u)}this.Bt.info("zw.pl.fpsu call success")}else this.Bt.error("zw.pl.fpsu room no found")}},t.prototype.handleFetchStreamUrlRsp=function(t,i,n,e){var s,r;this.Bt.info("zw.pl.hfsur call ");var o;if(r=t.code,this.Xt.streamUrlMap[o=t.seq]&&delete this.Xt.streamUrlMap[o],0!==r)return this.Bt.error("zw.pl.hfsur server error= "+r),void this.handleStreamUrlFail(n,r);var u=[];t.hosts&&t.hosts.length>0&&(u=t.hosts);var h=!1,a=this.Xt.getRoomByRoomID(e);if(a)if(o===(null===(s=this.Wt.playerList[n])||void 0===s?void 0:s.seq)){for(var c=0;c<a.streamList.length;c++)if(a.streamList[c].stream_id==n){a.streamList[c].urltra_url_rtmp=u,h=!0;break}!h&&this.mixStreamList[n]&&(this.mixStreamList[n].urltra_url_rtmp=u,i=x.cdn,h=!0),h||(this.Bt.info("zw.pl.hfsurcannot find streamInfo in existing stream list"),this.streamUrlRspList[n]=u),this.doPlayStream(n,u,i),this.Bt.info("zw.pl.hfsur call success")}else this.Bt.info("zw.pl.hfsur seq is not match, ignore "+n);else this.Bt.error("zw.pl.hfsur room no found")},t.prototype.handleStreamUrlFail=function(t,i){this.Wt.onPlayStateUpdate(ot,t,1900001004===i?un.error.Ri:un.error.Ti)},t.prototype.setPreferPlaySourceType=function(t){return this.Bt.info("zw.w.sppst.1 call"),t!==M.cdn&&t!==M.ultra?(this.Bt.error("zw.w.sppst.1 sourceType can be number 0 or 1, which can be represented auto or ultra"),!1):(this.preferPlaySourceType=t,this.Bt.info("zw.w.sppst.1 call success"),!0)},t}(),bn=function(t,i){var n,e={10001:"当前微信版本过低，无法使用相关组件",10002:"需要摄像头和录音功能的授权"};n=wx.getSystemInfoSync().SDKVersion;var s={code:0,msg:""};(function(t,i){t=t.split("."),i=i.split(".");for(var n=Math.max(t.length,i.length);t.length<n;)t.push("0");for(;i.length<n;)i.push("0");for(var e=0;e<n;e++){var s=parseInt(t[e]),r=parseInt(i[e]);if(s>r)return 1;if(s<r)return-1}return 0})(n,"1.7.0")<0&&(s={code:10001,msg:e[10001]},t&&t(s)),wx.getSetting({success:function(i){var n=i.authSetting;n["scope.camera"]&&n["scope.record"]||(s={code:10002,msg:e[10002]}),t&&t(s)},fail:function(t){console.error("get setting error",t),i&&i(t)}})};var En,Sn,Rn,On,yn=function(){function t(t,i,n,e){this.Wt=t,this.Xt=i,this.Bt=n,this.rtm=e}return Object.defineProperty(t.prototype,"ri",{get:function(){return this.Xt.reporter},enumerable:!1,configurable:!0}),t.prototype.setStreamExtraInfo=function(t,i){var n=this;return new vt((function(e,s){var r=n.Wt.getRoomByStreamID(t),o=bi,u=n.ri.createSpan(J.H,r?{key:ri,par:null==r?void 0:r.roomID}:{key:ui},{key:""},o.event);u.setAttributes({stream_id:o.stream_id(t),stream_extra_info:o.stream_extra_info(i)});var h=function(t,i){void 0===i&&(i=""),n.Bt.error("zb.ssei "+i),n.ri.setError(u,t,i),s({errorCode:t.code,extendedData:t.message+" "+i})};Si(t)&&""!=t?Si(i)&&""!=i?n.rtm.isDisConnect()?h(o.error.Lt,"not login"):n.Xt.publishStreamList[t]?r?r.streamHandler.setStreamExtraInfo(t,i,(function(t,i){var r,h,a,c;if(0===(null===(r=null==t?void 0:t.body)||void 0===r?void 0:r.err_code)||0===(null==t?void 0:t.errorCode))u.setAttributes({send_seq:o.send_seq(i)}),u.end(),e({errorCode:0===(null===(h=null==t?void 0:t.body)||void 0===h?void 0:h.err_code)?null===(a=null==t?void 0:t.body)||void 0===a?void 0:a.err_code:null==t?void 0:t.errorCode,extendedData:""});else{var l={errorCode:(null===(c=null==t?void 0:t.body)||void 0===c?void 0:c.err_code)||(null==t?void 0:t.code)};n.ri.setError(u,l),s(l)}}),h):h(o.error.Lt,"not login"):h(o.error.xt):h(o.error.Mt,"extraInfo must be string and no empty"):h(o.error.Mt,"streamID must be string and not empty")}))},t}(),Tn=function(){function t(t,i,n,e,s,r){this.Bt=t,this.dataReport=i,this.reporter=n,this.Xt=e,this.rtm=r,this.currentPlaySourceType=x.cdn,this.mixStreamList={},this.ultraPlaySourceType="rtmp_v2",this.Wt=s,this.publishModule=new vn(this.Bt,this.dataReport,this.Xt,this.Wt,this.rtm),this.playModule=new gn(this.Bt,this.dataReport,this.Xt,this.Wt,this.rtm),this.streamCommon=new yn(s,e,t,r),this.init(),this.initStreamCDN()}return Object.defineProperty(t.prototype,"logger",{get:function(){return this.Bt},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stateCenter",{get:function(){return this.Xt},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"streamCenter",{get:function(){return this.Wt},enumerable:!1,configurable:!0}),t.prototype.init=function(){this.bindRTMListener(),this.bindStreamCenterHandler()},t.prototype.initStreamCDN=function(){},t.prototype.bindRTMListener=function(){var t=this;this.rtm._on("roomLoginResponse",(function(i){t.Bt.info("zc.rlr call "+JSON.stringify(i));var n=i.header.room_id;t.Xt.appid=t.rtm.getAppID(),t.Xt.idName=t.rtm.getUserID(),t.Xt.testEnvironment=t.rtm.isTestEnvironment(),t.Xt.isMultiRoom=t.rtm.getMultiRoom();var e=t.rtm.getToken(n),s=t.rtm.getSessionId(n),r=t.rtm.getRoomSessionID(n),o=t.Xt.getRoomByRoomID(n);if(!o){var u=new tn(t.Bt,t.Xt,t.rtm,t.Wt,n);t.bindStreamHandler(u),t.Xt.roomList.push(o={roomID:n,streamHandler:u,sessionID:s,roomSessionID:r,token:e,isResetRoom:!1,streamList:[],streamInfoList:[],dataChannelManager:null})}if(o.sessionID=s,o.roomSessionID=r,o.token=o.token,o.streamHandler.handleStreamStart(i,o),t.Bt.info("zc.rlr unsendmsg "+JSON.stringify(t.Xt.unSendMessageList)),t.Xt.unSendMessageList.length>0)for(var h=function(i){var e=t.Xt.unSendMessageList[i],s=e.streamid,r=e.cmd,u=e.stream_extra_info;if(n===e.roomID){var h=o.streamList.findIndex((function(t){return t.stream_id===s}));t.Bt.warn("zc.rlr stream index "+h),2002===r&&h>=0&&(t.Bt.warn("zc.rlr resend "+r+" "+s),o.streamHandler.updateStreamInfo(s,r,u),o.streamList.splice(h,1)),t.Xt.unSendMessageList.splice(i,1)}},a=t.Xt.unSendMessageList.length-1;a>=0;a--)h(a);t.Bt.info("zc.rlr end "+n)})),this.rtm._on("_roomLogin",(function(i,n){t.Xt.useNetAgent=t.rtm.isUseNetAgent})),this.rtm._on("_appConfigRsp",(function(){t.Bt.info("zw.acr call "),t.Xt.appConfig=t.rtm.getAppConfig()})),this.rtm._on("_userTransUpdate",(function(i,n,e){var s=t.Xt.getRoomByRoomID(i);s?"pushstatus"===n||"mixpushstatus"===n&&s.streamHandler.getMixStreamStatus(e):t.Bt.error("zw.opur room no found")})),this.rtm._on("HBResponse",(function(i){var n,e=null===(n=null==i?void 0:i.header)||void 0===n?void 0:n.room_id,s=t.Xt.getRoomByRoomID(e);null==s||s.streamHandler.patchStreamList(i)})),this.rtm._on("_roomStateUpdate",(function(i,n,e,s){if("DISCONNECTED"==n){t.Bt.info("zw.w.brl _roomStateUpdate "+i+" disconnected "+(e?e+" ":"")+(s||""));var r=t.Xt.getRoomByRoomID(i);if(r){var o=t.Xt.roomList.findIndex((function(t){return t.roomID==i}));r.isResetRoom=!0,r.streamHandler.reset(),t.Wt.reset(i,e,0===e),t.Xt.roomList.splice(o,1)}}else t.Bt.info("zc.rsu "+i+" state: "+n)})),this.rtm.liveRoomHandler.handlePushStreamMsg=function(i){var n,e=(null===(n=null==i?void 0:i.header)||void 0===n?void 0:n.room_id)||"",s=t.Xt.getRoomByRoomID(e);i.body.stream_cmd=i.header.sub_cmd,i.body.stream_info=i.body.stream_info_list,delete i.body.stream_info_list,null==s||s.streamHandler.handlePushStreamUpdateMsg(i)}},t.prototype.bindStreamHandler=function(t){var i=this;t.onStreamUpdated=function(t,e,s){var r=s.map((function(n){var s=i.playModule.streamUrlRspList[n.streamID];if(s&&1===e){var r=i.Xt.getRoomByRoomID(t),o=r.streamList.findIndex((function(t){return t.stream_id==n.streamID}));-1!==o&&r.streamList[o]&&(r.streamList[o].urltra_url_rtmp=s)}else 1!==e&&delete i.playModule.streamUrlRspList[n.streamID];return{streamID:n.streamID,user:n.user,extraInfo:n.extraInfo}})),o=(0,n.getReportSeq)();if(i.dataReport.newReport(o,cn),i.dataReport.addMsgInfo(o,{stream_update_type:ln(1===e?"added":"deleted"),update_stream:fn(s)}),i.dataReport.uploadReport(o),i.Xt.actionListener("roomStreamUpdate",t,function(t){return 0==t?"DELETE":"ADD"}(e),r),1===e){var u=[];r.forEach((function(t){t.extraInfo&&u.push({streamID:t.streamID,user:t.user,extraInfo:t.extraInfo})})),u.length>0&&i.Xt.actionListener("streamExtraInfoUpdate",t,u)}},t.onPublishStateUpdate=function(t,n,e){i.Bt.info("zw.w.opsu "+n);var s=i.Xt.reportSeqList.startPublish[n];i.Wt.publishingList[n]&&(0==t||1==t)&&s&&(i.dataReport.eventEndWithMsgInfo(s,"PublishState",{type:t}),1==t&&i.dataReport.addMsgInfo(s,e),i.dataReport.uploadReport(s),1012===e.code&&i.Wt.stopPublishingStream(n),delete i.Xt.reportSeqList.startPublish[n]),i.Xt.actionListener("publisherStateUpdate",{state:Gi(t),streamID:n,errorCode:e.code,extendedData:e.message})},t.onStreamExtraInfoUpdated=function(t,e){var s=e.map((function(t){return{streamID:t.streamID,user:t.user,extraInfo:t.extraInfo}})),r=(0,n.getReportSeq)();i.dataReport.newReport(r,_n),i.dataReport.addMsgInfo(r,{update_stream:dn(s)}),i.dataReport.uploadReport(r),i.Xt.actionListener("streamExtraInfoUpdate",t,s)}},t.prototype.bindStreamCenterHandler=function(){var t=this;this.Wt.onPlayStateUpdate=function(i,n,e){var s=t.Xt.reportSeqList.startPlay[n];t.Wt.playingList.find((function(t){return t.streamID===n}))&&(0==i||1==i)&&s&&(t.dataReport.eventEndWithMsgInfo(s,"PlayState",{type:i}),t.dataReport.uploadReport(s,void 0,1==i&&e?e:void 0),delete t.Xt.reportSeqList.startPlay[n]),t.Xt.actionListener("playerStateUpdate",{state:Hi(i),streamID:n,errorCode:e&&e.code,extendedData:e&&e.message}),1===i&&t.Wt.playErrorCallBackList[n]&&(t.Wt.playErrorCallBackList[n](e),delete t.Wt.playErrorCallBackList[n])},this.Wt.onPublishStateUpdate=function(i,n,e){t.onPublishStateUpdateHandle(i,n,e)},this.Wt.onPublishQualityUpdate=function(i,n){t.Xt.actionListener("publishQualityUpdate",i,n)},this.Wt.onPlayQualityUpdate=function(i,n){t.Xt.actionListener("playQualityUpdate",i,n)}},t.prototype.onPublishStateUpdateHandle=function(t,i,n){var e=this;this.Bt.info("zw.w.opsuh call");var s=this.Wt.publisherList[i].room;if(s)if(0==t){if(this.Xt.publishStreamList[i]){var r=!s.streamList.find((function(t){return t.stream_id==i&&(t.anchor_id_name==e.Xt.idName||t.id_name==e.Xt.idName||t.user_id===e.Xt.idName)})),o=this.Xt.publishStreamList[i].state;if(this.Bt.info("zc.opsuh.0  state: ".concat(o,", in room: ").concat(r)),o==b&&r)this.Xt.publishStreamList[i].state=E,s.streamHandler.updateStreamInfo(i,R,this.Xt.publishStreamList[i].extra_info,(function(t){})),this.dataReport.uploadReport(this.Xt.reportSeqList.startPublish[i]),delete this.Xt.reportSeqList.startPublish[i],Pi("kZegoTaskPublishStart"+i,this.Xt.reportList);else this.Xt.publishStreamList[i].state=S,s.streamHandler.onPublishStateUpdate(t,i,n),this.dataReport.uploadReport(this.Xt.reportSeqList.startPublish[i]),delete this.Xt.reportSeqList.startPublish[i],Pi("kZegoTaskPublishStart"+i,this.Xt.reportList)}}else s.streamHandler.onPublishStateUpdate(t,i,n),1==t&&(this.Bt.info("zw.w.opsuh stop publish called by sdk"),this.publishModule.stopPublishingStream(i));else this.Bt.error("zc.opsuh.0 room not exist")},t.prototype.bindListener=function(t,i){return this.Bt.info("zw.w.bl call"),this.Xt.listenerList[t]?Ti(i)?(-1==this.Xt.listenerList[t].indexOf(i)&&this.Xt.listenerList[t].push(i),!0):(this.Bt.error("zw.w.bl listener callBack must be function"),!1):(this.Bt.error("zw.w.bl event "+t+" no found"),!1)},t.prototype.deleteListener=function(t,i){if(this.Bt.info("zw.w.dl call"),!this.Xt.listenerList[t])return this.Bt.error("zw.w.dl listener no found"),!1;var n=this.Xt.listenerList[t];return i?n.splice(n.indexOf(i),1):this.Xt.listenerList[t]=[],!0},t.prototype.checkSystemRequirements=function(){var t=this;return new vt((function(i,n){var e=t.Xt.reporter.createSpan(J.H,{key:nn},{key:""},en);bn((function(t){e.setAttributes({capability:rn(t)}),e.end(),i(t)}),(function(i){t.Xt.reporter.setError(e,sn.kCheckSystemGetSettingFailError),n(i)}))}))},t.prototype.updatePlayerState=function(t,i){this.Bt.info("zw.w.ups call "+t),this.Wt.updatePlayerState(t,i)},t.prototype.updatePlayerNetStatus=function(t,i){this.Bt.info("zw.w.upns call "+t),this.Wt.updatePlayerNetStatus(t,i)},t.prototype.updateAudioVolumeNotify=function(t,i){this.Wt.updateAudioVolumeNotify(t,i)},t.prototype.getNextUrl=function(t){return Si(t)&&""!=t?this.Wt.getNextUrl(t):(this.Bt.error("zw.w.gnu stream ID must be string and not empty"),"")},t.prototype.setCustomSignalUrl=function(t,i){if(void 0===i&&(i=!0),this.Bt.info("zw.w.scsu call: "+JSON.stringify(t)),!t||0==t.length)return this.Bt.error("zw.w.scsu param error"),!1;var n=!0;t.forEach((function(t){return 0!=t.indexOf("rtmp://")&&(n=!1)})),n?i?this.Xt.customUrl=t:this.Xt.customPlayUrl=t:this.Bt.error("zw.w.scsu url is not correct")},t}(),wn=function(t,i,n,e){return new(n||(n=Promise))((function(s,r){function o(t){try{h(e.next(t))}catch(t){r(t)}}function u(t){try{h(e.throw(t))}catch(t){r(t)}}function h(t){var i;t.done?s(t.value):(i=t.value,i instanceof n?i:new n((function(t){t(i)}))).then(o,u)}h((e=e.apply(t,i||[])).next())}))},In=function(t,i){var n,e,s,r,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return r={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function u(u){return function(h){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,u[0]&&(o=0)),o;)try{if(n=1,e&&(s=2&u[0]?e.return:u[0]?e.throw||((s=e.return)&&s.call(e),0):e.next)&&!(s=s.call(e,u[1])).done)return s;switch(e=0,s&&(u=[2&u[0],s.value]),u[0]){case 0:case 1:s=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,e=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(s=o.trys,(s=s.length>0&&s[s.length-1])||6!==u[0]&&2!==u[0])){o=0;continue}if(3===u[0]&&(!s||u[1]>s[0]&&u[1]<s[3])){o.label=u[1];break}if(6===u[0]&&o.label<s[1]){o.label=s[1],s=u;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(u);break}s[2]&&o.ops.pop(),o.trys.pop();continue}u=i.call(t,o)}catch(t){u=[6,t],e=0}finally{n=s=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,h])}}},Nn=function(){function t(t,i,n,e){this.wxContext=t,this.dataAtr=i,this.zegoWechatMini=n,this.defaultAttributes={enableCamera:!0,enableMic:!0},this.attributes={},this.isPublishing=!1,this.Bt=this.zegoWechatMini.Bt,this.context=wx.createLivePusherContext(),Object.assign(this.attributes,this.defaultAttributes),Object.assign(this.attributes,e)}return t.prototype.setWXData=function(t){if(this.wxContext&&this.dataAtr)if(void 0===t||Ti(t)){var i={};i[this.dataAtr]=this.attributes,this.wxContext.setData(i,t)}else this.Bt.info("zw.p.0.swd callBack is not function");else this.Bt.error("zw.p.0.swd context wrong")},t.prototype.iswxContext=function(){return!!this.wxContext},t.prototype.setPusherAttributes=function(t,i){this.Bt.info("zw.p.0.spa call "+JSON.stringify(t)),Object.assign(this.attributes,t),this.setWXData(i),this.Bt.info("zw.p.0.spa call success "+JSON.stringify(this.attributes))},t.prototype.startPreview=function(t){this.Bt.info("zw.p.0.sp.0 call");try{this.context.startPreview(t)}catch(t){this.Bt.error("zw.p.0.sp.0 error "+(t?JSON.stringify(t):""))}this.Bt.info("zw.p.0.sp.0 call success")},t.prototype.stopPreview=function(t){this.Bt.info("zw.p.0.sp.1 call");try{this.context.stopPreview(t)}catch(t){this.Bt.error("zw.p.0.sp.1 error "+(t?JSON.stringify(t):""))}this.Bt.info("zw.p.0.sp.1 call success")},t.prototype.start=function(t,i){var n=this;return new Promise((function(e,s){return wn(n,void 0,void 0,(function(){var n,r,o=this;return In(this,(function(u){switch(u.label){case 0:if(!Si(t))return this.Bt.error("zw.p.0.s.0 streamID type error"),[2];this.Bt.info("zw.p.0.s.0 call "+t),this.attributes.id=t,u.label=1;case 1:return u.trys.push([1,3,,4]),[4,this.zegoWechatMini.startPublishingStream(t,i)];case 2:return n=u.sent(),this.attributes.url=n.url,this.isPublishing=!0,this.setWXData((function(){o.Bt.info("zw.p.0.s.0 set url")})),this.context.start({success:function(){o.Bt.info("zw.p.0.s.0 publish success"),e()},fail:function(t){o.Bt.error(JSON.stringify(t)),s(t)}}),[3,4];case 3:return r=u.sent(),this.Bt.error("zw.p.0.s.0 "+JSON.stringify(r)),s(r),[3,4];case 4:return[2]}}))}))}))},t.prototype.pause=function(t){this.Bt.info("zw.p.0.p call");try{this.context.pause(t)}catch(t){this.Bt.error("zw.p.0.p error "+(t?JSON.stringify(t):""))}this.Bt.info("zw.p.0.p call success")},t.prototype.resume=function(t){this.Bt.info("zw.p.0.r call");try{this.context.resume(t)}catch(t){this.Bt.error("zw.p.0.r error "+(t?JSON.stringify(t):""))}this.Bt.info("zw.p.0.r call success")},t.prototype.stop=function(){this.Bt.info("zw.p.0.s.1 call"),this.attributes.id||this.Bt.error("zw.p.0.s.1 publish id no found");try{this.context&&this.context.stop(),this.attributes.id&&this.zegoWechatMini.stopPublishingStream(this.attributes.id),this.attributes={},Object.assign(this.attributes,this.defaultAttributes),this.isPublishing=!1,this.setWXData()}catch(t){return void this.Bt.error("zw.p.0.s.1 "+(t?JSON.stringify(t):""))}this.Bt.info("zw.p.0.s.1 call success")},t.prototype.snapshot=function(t){this.Bt.info("zw.p.0.ss call");try{this.context.snapshot(t)}catch(t){this.Bt.error("zw.p.0.ss error "+(t?JSON.stringify(t):""))}this.Bt.info("zw.p.0.ss call success")},t.prototype.playBGM=function(t){this.Bt.info("zw.p.0.pb.0 call");try{this.context.playBGM(t)}catch(t){this.Bt.error("zw.p.0.pb.0 error "+(t?JSON.stringify(t):""))}this.Bt.info("zw.p.0.pb.0 call success")},t.prototype.pauseBGM=function(t){this.Bt.info("zw.p.0.pb.1 call");try{this.context.pauseBGM(t)}catch(t){this.Bt.error("zw.p.0.pb.1 error "+(t?JSON.stringify(t):""))}this.Bt.info("zw.p.0.pb.1 call success")},t.prototype.resumeBGM=function(t){this.Bt.info("zw.p.0.rb call");try{this.context.resumeBGM(t)}catch(t){this.Bt.error("zw.p.0.rb error "+(t?JSON.stringify(t):""))}this.Bt.info("zw.p.0.rb call success")},t.prototype.stopBGM=function(t){this.Bt.info("zw.p.0.sb call");try{this.context.stopBGM(t)}catch(t){this.Bt.error("zw.p.0.sb error "+(t?JSON.stringify(t):""))}this.Bt.info("zw.p.0.sb call success")},t.prototype.setBGMVolume=function(t){this.Bt.info("zw.p.0.sbv call");try{this.context.setBGMVolume(t)}catch(t){this.Bt.error("zw.p.0.sbv error "+(t?JSON.stringify(t):""))}this.Bt.info("zw.p.0.sbv call success")},t.prototype.setMICVolume=function(t){this.Bt.info("zw.p.0.smv call");try{this.context.setMICVolume(t)}catch(t){this.Bt.error("zw.p.0.smv error "+(t?JSON.stringify(t):""))}this.Bt.info("zw.p.0.smv call success")},t.prototype.switchCamera=function(t){this.Bt.info("zw.p.0.sc call");try{this.context.switchCamera(t)}catch(t){this.Bt.error("zw.p.0.sc error "+(t?JSON.stringify(t):""))}this.Bt.info("zw.p.0.sc call success")},t.prototype.toggleTorch=function(t){this.Bt.info("zw.p.0.tt call");try{this.context.toggleTorch(t)}catch(t){this.Bt.error("zw.p.0.tt error "+(t?JSON.stringify(t):""))}this.Bt.info("zw.p.0.tt call success")},t}(),Cn=function(t,i,n,e){return new(n||(n=Promise))((function(s,r){function o(t){try{h(e.next(t))}catch(t){r(t)}}function u(t){try{h(e.throw(t))}catch(t){r(t)}}function h(t){var i;t.done?s(t.value):(i=t.value,i instanceof n?i:new n((function(t){t(i)}))).then(o,u)}h((e=e.apply(t,i||[])).next())}))},kn=function(t,i){var n,e,s,r,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return r={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function u(u){return function(h){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,u[0]&&(o=0)),o;)try{if(n=1,e&&(s=2&u[0]?e.return:u[0]?e.throw||((s=e.return)&&s.call(e),0):e.next)&&!(s=s.call(e,u[1])).done)return s;switch(e=0,s&&(u=[2&u[0],s.value]),u[0]){case 0:case 1:s=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,e=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(s=o.trys,(s=s.length>0&&s[s.length-1])||6!==u[0]&&2!==u[0])){o=0;continue}if(3===u[0]&&(!s||u[1]>s[0]&&u[1]<s[3])){o.label=u[1];break}if(6===u[0]&&o.label<s[1]){o.label=s[1],s=u;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(u);break}s[2]&&o.ops.pop(),o.trys.pop();continue}u=i.call(t,o)}catch(t){u=[6,t],e=0}finally{n=s=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,h])}}},zn=function(){function t(t,i,n,e){this.wxContext=t,this.streamID=i,this.zegoWechatMini=n,this.attributes={},this.isPlaying=!1,this.Bt=this.zegoWechatMini.Bt,this.attributes.id=i,this.context=wx.createLivePlayerContext(this.attributes.id,e||this.wxContext)}return t.prototype.setPlayerAttributes=function(t,i){this.Bt.info("zw.p.1.spa call "+this.streamID+" "+JSON.stringify(t)),Object.assign(this.attributes,t),this.zegoWechatMini.setPlayData(i),this.Bt.info("zw.p.1.spa call success "+this.streamID+" "+JSON.stringify(this.attributes))},t.prototype.play=function(t){var i=this;return new Promise((function(n,e){return Cn(i,void 0,void 0,(function(){var i,s,r=this;return kn(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),this.Bt.info("zw.p.1.p.0 call "+this.streamID),[4,this.zegoWechatMini.startPlayingStream(this.streamID,t)];case 1:return i=o.sent().url,this.attributes.url=i,this.isPlaying=!0,this.zegoWechatMini.setPlayData((function(){r.Bt.info("zw.p.1.p.0 start play url")})),this.context.play({success:function(){r.Bt.info("zw.p.1.p.0 start play success"),n(!0)},fail:function(){r.Bt.error("zw.p.1.p.0 start play fail"),e()},complete:function(){r.Bt.info("zw.p.1.p.0 start play complete")}}),n(!0),[3,3];case 2:return s=o.sent(),this.Bt.error("zw.p.1.p.0 start play catch fail "+JSON.stringify(s)),e(s),[3,3];case 3:return[2]}}))}))}))},t.prototype.stop=function(){var t=this;this.Bt.info("zw.p.1.s call stop "+this.streamID),this.isPlaying||this.Bt.info("zw.p.1.s stream is not playing"),this.context&&this.context.stop(),this.streamID&&(this.zegoWechatMini.stopPlayingStream(this.streamID),this.zegoWechatMini.wechatMiniModules.Wt.livePlayerList=this.zegoWechatMini.wechatMiniModules.Wt.livePlayerList.filter((function(i){return i.streamID!==t.streamID}))),this.isPlaying=!1,this.zegoWechatMini.setPlayData(),this.Bt.info("zw.p.1.s call success")},t.prototype.pause=function(t){this.Bt.info("zw.p.1.p.1 pull pause call "+this.streamID);try{this.context.pause(t)}catch(t){this.Bt.error("zw.p.1.p.1 pull pause error "+(t?JSON.stringify(t):""))}this.Bt.info("zw.p.1.p.1 pull pause success")},t.prototype.resume=function(t){this.Bt.info("zw.p.1.r call "+this.streamID);try{this.context.resume(t)}catch(t){this.Bt.error("zw.p.1.r error "+(t?JSON.stringify(t):""))}this.Bt.info("zw.p.1.r call success")},t.prototype.mute=function(t){this.Bt.info("zw.p.1.m mute call "+this.streamID);try{this.context.mute(t)}catch(t){this.Bt.error("zw.p.1.m pull mute error "+(t?JSON.stringify(t):""))}this.Bt.info("zw.p.1.m mute success")},t.prototype.requestFullScreen=function(t){this.Bt.info("zw.p.1.rfs call "+this.streamID);try{this.context.requestFullScreen(t)}catch(t){this.Bt.error("zw.p.1.rfs error "+(t?JSON.stringify(t):""))}this.Bt.info("zw.p.1.rfs call success")},t.prototype.exitFullScreen=function(t){this.Bt.info("zw.p.1.efs call "+this.streamID);try{this.context.exitFullScreen(t)}catch(t){this.Bt.error("zw.p.1.efs error "+(t?JSON.stringify(t):""))}this.Bt.info("zw.p.1.efs call success")},t.prototype.requestPictureInPicture=function(t){this.Bt.info("zw.p.1.rpip call "+this.streamID);try{this.context.requestPictureInPicture(t)}catch(t){this.Bt.error("zw.p.1.rpip error "+(t?JSON.stringify(t):""))}this.Bt.info("zw.p.1.rpip call success")},t.prototype.exitPictureInPicture=function(t){this.Bt.info("zw.p.1.epip call "+this.streamID);try{this.context.exitPictureInPicture(t)}catch(t){this.Bt.error("zw.p.1.epip error "+(t?JSON.stringify(t):""))}this.Bt.info("zw.p.1.epip call success")},t.prototype.snapshot=function(t){this.Bt.info("zw.p.1.ss call "+this.streamID);try{this.context.snapshot(t)}catch(t){this.Bt.error("zw.p.1.ss error "+(t?JSON.stringify(t):""))}this.Bt.info("zw.p.1.ss call success")},t}(),An=function(){this.publisherList={},this.playerList={},this.stopedPlayerList={}},Dn=function(){function t(t,i){this.Bt=t,this.Xt=i,this.attempt=0,this.baseInterval=.3,this.capInterval=4.8,this.retryRule=0,this.retryTimer=null,this.maxTimer=null,this.isOverTime=!1,this.RETRY_MAX_TIME=60}return t.prototype.setRetryRule=function(t){switch(this.retryRule=t,t){case 1:this.baseInterval=.3,this.capInterval=32;break;case 0:this.baseInterval=.3,this.capInterval=4.8}},t.prototype.getRetryDelayByCount=function(t){var i;i=1===this.retryRule?t+2:t<2?0:t;var n,e,s=Math.min(this.capInterval,this.baseInterval*Math.pow(2,i)),r=(n=0,e=1e3*s,Math.floor(Math.random()*(e-n+1))+n);return this.Bt.info("".concat("zc.hrh.grdbc"," ").concat(this.attempt," ").concat(s," ").concat(r)),r},t.prototype.initCallback=function(t,i){this.sucCallBack=t,this.failCallBack=i},t.prototype.startMaxTime=function(){var t,i=this;this.Bt.info("".concat(Xi," ").concat(null===(t=this.requestInfo)||void 0===t?void 0:t.streamID," call")),this.maxTimer?this.Bt.warn("".concat(Xi," max timer")):(this.maxTimer=setTimeout((function(){var t;i.Bt.warn("".concat(Xi," ").concat(null===(t=i.requestInfo)||void 0===t?void 0:t.streamID," over max time ").concat(i.RETRY_MAX_TIME,"s, stop retry")),i.isOverTime=!0,i.requestFail(i._err)}),1e3*this.RETRY_MAX_TIME),this.Bt.info("".concat(Xi," maxTimer=").concat(this.maxTimer)))},t.prototype.invalid=function(){this.clearRetryTimer(),this.attempt=0},t.prototype.clearRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},t.prototype.requestFail=function(t){this.invalid(),this.stopMaxTime(),this.failCallBack&&(this.failCallBack(t),this.resetCallback())},t.prototype.stopMaxTime=function(){this.Bt.info("".concat("zc.hrh.smt.1"," stop max timer")),this.maxTimer&&clearTimeout(this.maxTimer),this.maxTimer=null},t.prototype.resetCallback=function(){this.sucCallBack=void 0,this.failCallBack=void 0},t}(),Mn=(En=function(t,i){return En=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])},En(t,i)},function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=t}En(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}),Pn=function(t){function i(i,n){var e=t.call(this,i,n)||this;return e.Bt=i,e.Xt=n,e.RETRY_MAX_TIME=300,e}return Mn(i,t),i.prototype.initRequestInfo=function(t,i){this.requestInfo=t,this.room=i},i.prototype.active=function(t){var i=this;if(void 0===t&&(t=!1),this.retryTimer)this.Bt.warn("".concat(mt," was actived, ignore"));else if(this.isOverTime)this.Bt.warn("".concat(mt," retry over time, stop retry"));else{var n=function(){i.clearRetryTimer(),i.room.streamHandler.sendRTMPRequest(i.requestInfo,(function(t){if(200===t.status_code){var n=JSON.parse(t.body);n.hosts=n.hosts&&n.hosts.map((function(t){return"rtmp://".concat(t,"/").concat(i.Xt.appid,"/").concat(i.requestInfo.streamID)})),i.invalid(),i.stopMaxTime(),i.sucCallBack&&(i.sucCallBack(n),i.resetCallback())}else i.handleRequestFail(t)}),(function(t){i.handleRequestFail(t)})),t||i.attempt++};if(t)n();else{var e=this.getRetryDelayByCount(this.attempt);this.retryTimer=setTimeout(n,e)}}},i.prototype.handleRequestFail=function(t){if(this._err=t,this.isOverTime)this.requestFail(t);else{var i=t.status_code;(429===i||i>=500&&i<600)&&this.setRetryRule(1),this.active()}},i}(Dn),xn=function(){return xn=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t},xn.apply(this,arguments)},Un=function(){function t(t,i,n,e,s,r,o){this.Bt=t,this.streamId=i,this.Wt=n,this.dataReport=e,this.Xt=s,this.room=r,this.publishOption=o,this.urls=[],this.tryUrls=[],this.playUrlIndex=0,this.playUrlTryCount=0,this.currentUrl=null,this.retryIndex=0,this.reconnectCount=0,this.state=d,this.reconnectLimit=0,this.sourceType=0,this.playerType=0,this.playerSeq=0,this.playerReportSeq=0,this.publishQualitySeq=0,this.publishQualityCount=0,this.publishQulaityMaxCount=30,this.playQualitySeq=0,this.playQualityCount=0,this.playQulaityMaxCount=30,this.everSuccess=!1,this.pushBegin=!1,this.playBegin=!1,this.playerLogUploadTime=Date.now(),this.seq=-1,this.netStatusUpdateTime=0,this.cacheQualityInfo={},this.isDoubledQuality=!1,this.dispatchRetryHandler=new Pn(this.Bt,this.Xt)}return t.prototype.resetPlayer=function(){this.state=d},t.prototype.newPlayer=function(){this.resetPlayer();var t=this.getCurrentPlayerUrl(),i=t;0!=this.params.length&&(i=t+"?"+this.params);var n=Date.now();return i=i.indexOf("?")>-1?i+"&zgseq="+n+"&zgdid="+this.room.sessionID:i+"?zgseq="+n+"&zgdid="+this.room.sessionID,t!==this.currentUrl?(this.currentUrl=t,this.Wt.onStreamUrlUpdate(this.streamId,i,this.playerType)):this.Wt.onPlayerRetry(this.streamId,this.playerType),0==this.everSuccess?0==this.playerType?(this.dataReport.eventStart(this.playerReportSeq,"PlayBegin"),this.dataReport.addEventInfo(this.playerReportSeq,"PlayBegin","url",i),this.tryUrls.push(i)):(this.dataReport.eventStart(this.playerReportSeq,"PublishBegin"),this.dataReport.addEventInfo(this.playerReportSeq,"PublishBegin","url",i),this.tryUrls.push(i)):this.dataReport.addEventInfo(this.playerSeq,0==this.playerType?"PlayRetry":"PublishRetry","url",i),this.state=f,!0},t.prototype.stopPlayer=function(){this.isDoubledQuality=!1,0==this.playerType?this.dataReport.eventEndWithMsg(this.playerReportSeq,"PlayStat",{quality:this.playerInfo}):(this.dataReport.addEventInfo(this.playerReportSeq,"PublishStat","quality",this.playerInfo),this.dataReport.eventEndWithMsg(this.playerReportSeq,"PublishStat",{quality:this.playerInfo}))},t.prototype.tryStartPlayer=function(t){for(this.Bt.info("zw.pw.tsp.0 call");this.playUrlTryCount<this.urls.length;)if(++this.reconnectCount>this.reconnectLimit)this.playUrlTryCount++,this.playUrlIndex=(this.playUrlIndex+1)%this.urls.length,this.reconnectCount=0;else if(this.Bt.info("zw.pw.tsp.0 index: "+this.playUrlIndex+", url: "+this.getCurrentPlayerUrl()),this.newPlayer())break;if(this.playUrlTryCount>=this.urls.length){this.Bt.info("zw.pw.tsp.0 stream: "+this.streamId),this.resetPlayer();var i="";0==this.playerType?i="PlayEnd":1==this.playerType&&(i="PublishEnd",this.reportQualityStatics()),this.dataReport.addEvent(this.playerSeq,i,{error:t,reason:"no url to retry"}),this.Wt.onPlayerStop(this.streamId,this.playerType,t)}},t.prototype.getPlayerUrl=function(){this.Bt.info("zw.pw.gpu call "+this.streamId);var t=this.urls[++this.retryIndex%this.urls.length],i=t;0!=this.params.length&&(i=t+"?"+this.params);var n=Date.now();return i=i.indexOf("?")>-1?i+"&zgseq="+n+"&zgdid="+this.room.sessionID:i+"?zgseq="+n+"&zgdid="+this.room.sessionID,this.tryUrls.push(i),this.Bt.info("zw.pw.gpu call streamId: "+this.streamId+" url: "+i),i},t.prototype.shouldRetryPlay=function(t){return 3001==t||3002==t||3003==t||3005==t},t.prototype.isPlayFailed=function(t){return[-2301,2101,2102].includes(t)},t.prototype.isPlaySuccess=function(t){return 2004===t},t.prototype.shouldRetryPublish=function(t){return 3001==t||3002==t||3003==t||3004==t||3005==t},t.prototype.isPublishFailed=function(t){return t<=-1301&&t>=-1311},t.prototype.isPublishSuccess=function(t){return 1002==t},t.prototype.updateEvent=function(t){var i=t.detail.code;if(this.Bt.info(dt+" ".concat(this.streamId," state code: ").concat(JSON.stringify(i))),0==this.playerType){if(this.playBegin||(this.playBegin=!0,ki("kZegoTaskPlayStart"+this.streamId,this.Xt.reportList)&&ki("kZegoTaskPlayStart"+this.streamId,this.Xt.reportList)(ht,"play_begin")),this.isPlaySuccess(i))this.everSuccess?this.dataReport.eventEnd(this.playerReportSeq,"PlayRetry"):(this.everSuccess=!0,this.dataReport.eventStart(this.playerReportSeq,"PlayStat"),ki("kZegoTaskPlayStart"+this.streamId,this.Xt.reportList)&&(ki("kZegoTaskPlayStart"+this.streamId,this.Xt.reportList)(at,"play_begin","try_urls",this.tryUrls),ki("kZegoTaskPlayStart"+this.streamId,this.Xt.reportList)(ct,"play_begin"),ki("kZegoTaskPlayStart"+this.streamId,this.Xt.reportList)(ht,"play_state"))),this.Bt.info("zw.pw.ue play suc: "+this.streamId),this.state=_,this.Wt.onPlayerStart(this.streamId,this.playerType);else if(this.shouldRetryPlay(i));else if(this.isPlayFailed(i)){this.Bt.info("zw.pw.ue play error: "+this.streamId),this.resetPlayer();ki("kZegoTaskPlayStart"+this.streamId,this.Xt.reportList)&&(ki("kZegoTaskPlayStart"+this.streamId,this.Xt.reportList)(at,"play_begin","error_code",i),ki("kZegoTaskPlayStart"+this.streamId,this.Xt.reportList)(at,"play_begin","try_urls",this.tryUrls),ki("kZegoTaskPlayStart"+this.streamId,this.Xt.reportList)(ct,"play_begin"),ki("kZegoTaskPlayStart"+this.streamId,this.Xt.reportList)(lt,void 0,{})),this.playBegin=!1,this.Wt.onPlayerStop(this.streamId,this.playerType,{code:i,msg:"play fail"})}this.everSuccess||this.dataReport.eventEnd(this.playerReportSeq,"PlayBegin")}else 1==this.playerType&&(this.pushBegin||(this.pushBegin=!0,ki("kZegoTaskPublishStart"+this.streamId,this.Xt.reportList)&&ki("kZegoTaskPublishStart"+this.streamId,this.Xt.reportList)(ht,"push_begin")),this.isPublishSuccess(i)?this.handlePublisherSuccess():this.shouldRetryPublish(i)||this.isPublishFailed(i)&&(this.Bt.info("zw.pw.ue publish error: "+this.streamId),this.resetPlayer(),ki("kZegoTaskPublishStart"+this.streamId,this.Xt.reportList)&&(ki("kZegoTaskPublishStart"+this.streamId,this.Xt.reportList)(at,"push_begin","error_code",i),ki("kZegoTaskPublishStart"+this.streamId,this.Xt.reportList)(at,"push_begin","try_urls",this.tryUrls),ki("kZegoTaskPublishStart"+this.streamId,this.Xt.reportList)(ct,"push_begin"),ki("kZegoTaskPublishStart"+this.streamId,this.Xt.reportList)(lt,void 0,{})),this.pushBegin=!1,this.Wt.onPlayerStop(this.streamId,this.playerType,{code:i,msg:"publish fail"})),this.everSuccess||this.dataReport.eventEnd(this.playerReportSeq,"PublishBegin"))},t.prototype.updatePlayerNetStatus=function(t){var i,e,s,r=this,o=xn({},t.detail.info),u=null===(i=this.Wt.systemInfo)||void 0===i?void 0:i.platform,h=Date.now(),a=h-this.netStatusUpdateTime;if(this.netStatusUpdateTime=h,!this.isDoubledQuality&&"ios"===u&&this.netStatusUpdateTime&&a<200)this.isDoubledQuality=!0;else{if(this.isDoubledQuality){if(a>200)return void(this.cacheQualityInfo=xn({},o));Object.keys(this.cacheQualityInfo).forEach((function(t){void 0===o[t]&&void 0!==r.cacheQualityInfo[t]&&(o[t]=r.cacheQualityInfo[t])}))}var c={videoBitrate:o.videoBitrate,audioBitrate:o.audioBitrate,videoFPS:o.videoFPS,videoHeight:o.videoHeight,videoWidth:o.videoWidth,videoGOP:o.videoGOP,netSpeed:o.netSpeed,netJitter:o.netJitter};if(this.playerInfo=c,1==this.playerType){if(!this.everSuccess)"8.0.16"==wx.getSystemInfoSync().version&&this.handlePublisherSuccess();var l=xn({},o||{}),f=null===(s=null===(e=this.Wt.pusherInstance)||void 0===e?void 0:e.attributes)||void 0===s?void 0:s.enableCamera;if("ios"!==u||!1!==f||0===l.videoWidth&&0===l.videoHeight||(l.videoWidth=0,l.videoHeight=0,this.playerInfo.videoWidth=0,this.playerInfo.videoHeight=0),0==this.publishQualitySeq&&(this.publishQualitySeq=(0,n.getReportSeq)(),this.dataReport.newReport(this.publishQualitySeq),this.dataReport.addMsgInfo(this.publishQualitySeq,{stream_id:this.streamId})),this.dataReport.addEvent(this.publishQualitySeq,"PublishQuality",l),this.publishQualityCount+=1,this.publishQualityCount>=this.publishQulaityMaxCount)Date.now()-this.playerLogUploadTime>45e3&&this.reportQualityStatics()}else if(0==this.playerType){l=xn({},o||{});if(0==this.playQualitySeq&&(this.playQualitySeq=(0,n.getReportSeq)(),this.dataReport.newReport(this.playQualitySeq),this.dataReport.addMsgInfo(this.playQualitySeq,{stream_id:this.streamId})),this.dataReport.addEvent(this.playQualitySeq,"PlayQuality",l),this.playQualityCount+=1,this.playQualityCount>=this.playQulaityMaxCount)Date.now()-this.playerLogUploadTime>45e3&&this.reportPlayQualityStatics()}this.Wt.onPlayerQuality(this.streamId,c,this.playerType)}},t.prototype.getCurrentPlayerUrl=function(){return this.urls[this.playUrlIndex%this.urls.length]},t.prototype.reportQualityStatics=function(){this.dataReport.addMsgInfo(this.publishQualitySeq,{itemtype:"WXPublishStateUpdate"}),this.dataReport.uploadReport(this.publishQualitySeq,"/sdk/publish_stat_report"),this.publishQualityCount=0,this.publishQualitySeq=0,this.playerLogUploadTime=Date.now()},t.prototype.reportPlayQualityStatics=function(){this.dataReport.addMsgInfo(this.playQualitySeq,{itemtype:"WXPlayStateUpdate"}),this.dataReport.uploadReport(this.playQualitySeq,"/sdk/play_stat_report"),this.playQualityCount=0,this.playQualitySeq=0,this.playerLogUploadTime=Date.now()},t.prototype.handlePublisherSuccess=function(){this.everSuccess?this.dataReport.eventEnd(this.playerReportSeq,"PublishRetry"):(this.everSuccess=!0,this.dataReport.eventStart(this.playerReportSeq,"PublishStat"),ki("kZegoTaskPublishStart"+this.streamId,this.Xt.reportList)&&(ki("kZegoTaskPublishStart"+this.streamId,this.Xt.reportList)(at,"push_begin","try_urls",this.tryUrls),ki("kZegoTaskPublishStart"+this.streamId,this.Xt.reportList)(ct,"push_begin"),this.Xt.publishStreamList[this.streamId]&&this.Xt.publishStreamList[this.streamId].state==b&&ki("kZegoTaskPublishStart"+this.streamId,this.Xt.reportList)(ht,"publish_state"))),this.Bt.info("zw.pw.ue play suc: "+this.streamId),this.state=_,this.Wt.onPlayerStart(this.streamId,this.playerType)},t}(),Ln=function(){var t=function(i,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])},t(i,n)};return function(i,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function e(){this.constructor=i}t(i,n),i.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}}(),qn=0,jn=1,Gn=2,Hn=0,$n=1,Vn=function(t){function i(i,n,e){var s,r=t.call(this)||this;return r.playerList={},r.publisherList={},r.playerCount=0,r.playingList=[],r.publishingList=[],r.eventSeq=0,r.streamEventMap={},r.streamReportMap={},r.livePlayerList=[],r.playerContextMap={},r.publishSuccessCallBackList={},r.publishErrorCallBackList={},r.playSuccessCallBackList={},r.playErrorCallBackList={},r.Bt=i,r.dataReport=e,r.Xt=n,s=wx.getSystemInfoSync(),r.systemInfo={brand:s.brand,model:s.model,system:s.system,platform:s.platform,version:s.version,SDKVersion:s.SDKVersion},r}return Ln(i,t),i.prototype.updatePlayingState=function(t,i,n,e){if(this.Bt.info("zw.scw.ups.1.0 "+t),null==t)return un.error.kPlayStreamIDNullError;if(n){var s=this.playerList[t],r=this.Xt.reportSeqList.startPlay[t];if(this.dataReport.eventStart(r,"updatePlayingState"),s)return this.Bt.error("zw.scw.ups.1.0 player already exist"),this.dataReport.eventEndWithMsgInfo(r,"updatePlayingState",{message:"player already exist"}),this.dataReport.uploadReport(r,void 0),delete this.Xt.reportSeqList.startPlay[t],un.error.Si;var o=this.Xt.getPlayRoom(t)||this.Xt.roomList[0];if(!o)return this.Bt.error("zw.scw.ups.1.0 room no found"),un.error.Ei;this.playerList[t]=new Un(this.Bt,t,this,this.dataReport,this.Xt,o)}return this.updateStreamState(t,n,i,this.playingList),n?(this.streamEventMap[t]=this.Xt.reportSeqList.startPlay[t],this.eventSeq+=1,this.streamReportMap[t]=this.eventSeq,this.dataReport.newReport(this.eventSeq),this.dataReport.eventStart(this.eventSeq,"GotPlayInfo")):this.reportPlayEvent(t,e),!0},i.prototype.updatePublishingState=function(t,i,n,e,s){if(void 0===n&&(n={}),void 0===e&&(e=!1),this.Bt.info("zw.scw.ups.0.0 "+i),null==i)return on.error.kPublishStreamIDNullError;if(e){var r=this.publisherList[i],o=this.Xt.reportSeqList.startPublish[i];if(this.dataReport.eventStart(o,"updatePublishingState"),this.dataReport.addMsgInfo(o,{error:(null==s?void 0:s.code)||0}),r)return this.Bt.error("zw.scw.ups.0.0 publisher already exist"),this.dataReport.eventEndWithMsgInfo(o,"updatePublishingState",{message:"publisher already exist"}),this.dataReport.uploadReport(o,void 0),delete this.Xt.reportSeqList.startPublish[i],on.error.pi;this.publisherList[i]=new Un(this.Bt,i,this,this.dataReport,this.Xt,t,n)}return this.updateStreamState(i,e,(null==n?void 0:n.streamParams)||"",this.publishingList),e?(this.streamEventMap[i]=this.Xt.reportSeqList.startPublish[i],this.eventSeq+=1,this.streamReportMap[i]=this.eventSeq,this.dataReport.newReport(this.eventSeq),this.dataReport.eventStart(this.eventSeq,"GotPublishInfo")):this.reportPublishEvent(i,s),!0},i.prototype.updateAudioVolumeNotify=function(t,i){var n;this.Bt.info("zw.w.upvn "+t+" volume: "+(null===(n=null==i?void 0:i.detail)||void 0===n?void 0:n.volume))},i.prototype.updateStreamState=function(t,i,n,e){if(t)if(n&&Si(n)||(n=""),1==i)e.push({streamID:t,params:n});else for(var s=0;s<e.length;s++)if(e[s].streamID==t){e.splice(s--,1);break}},i.prototype.isPlaying=function(){return 0!=this.playingList.length},i.prototype.isPublishing=function(){return 0!=this.publishingList.length},i.prototype.startPlayingStream=function(t,i,n){if(this.Bt.info("zw.scw.sps.1 call "+t),this.streamEventMap[t]){0==n?"cdn":1==n&&"ultra_src",Di("kZegoTaskPlayStart"+t,this.Xt.reportList,at,"get_play_url"),Di("kZegoTaskPlayStart"+t,this.Xt.reportList,at,"get_play_url")}var e=this.streamReportMap[t];return e&&this.dataReport.eventEndWithMsg(e,"GotPlayInfo",{type:0==n?"cdn":"ultra_src",urls:i}),this.Bt.info("".concat(_t," call ").concat(t,", urls:").concat(JSON.stringify(i),", type:").concat(n)),this.startPlayer(t,i,n,Hn)},i.prototype.startPlayer=function(t,i,n,e){var s=this.playerList[t];if(e==$n&&(s=this.publisherList[t]),!s)return this.Bt.error("zw.scw.sp.0 player don't exist"),!1;var r=[];e==Hn?r=this.playingList:e==$n&&(r=this.publishingList);for(var o=!1,u="",h=0;h<r.length;h++)if(r[h].streamID==t){o=!0,u=r[h].params;break}if(!o)return this.Bt.warn("zw.scw.sp.0 should not start"),!1;if(s.urls=i,s.params=u,s.reconnectLimit=this.getReconnectLimit(n),s.dispatchType=n,s.playerType=e,s.playerSeq=this.streamEventMap[t],s.playerReportSeq=this.streamReportMap[t],!s)return this.Bt.info("zw.scw.sp.0 new player failed"),!1;++this.playerCount;var a=s.tryStartPlayer(0);return this.Bt.info("zw.scw.sp.0 call result: "+a),!0},i.prototype.getNextUrl=function(t){this.Bt.info("zw.scw.gnu call "+t);var i,e=this.publisherList[t]||this.playerList[t];if(!e)return this.Bt.error("zw.scw.gnu player don't exist"),"";this.publishingList.find((function(i){return i.streamID===t}))?(i=!0,this.onPublishStateUpdate(rt,t,{code:0,message:""})):(i=!1,this.onPlayStateUpdate(Gn,t,{code:0,message:""}));var s=e.getPlayerUrl();if(i){if(!this.Xt.reportSeqList.startPublish[t]){var r=(0,n.getReportSeq)();this.Xt.reportSeqList.startPublish[t]=r,this.dataReport.newReport(r,"/sdk/republish"),e.pushBegin=!1,Ai("kZegoTaskPublishStart"+t,this.dataReport,r,this.Xt.reportList)}}else if(!this.Xt.reportSeqList.startPlay[t]){r=(0,n.getReportSeq)();this.Xt.reportSeqList.startPlay[t]=r,this.dataReport.newReport(r,"/sdk/replay"),e.playBegin=!1,Ai("kZegoTaskPlayStart"+t,this.dataReport,r,this.Xt.reportList)}return s},i.prototype.stopPlayingStream=function(t,i,n){var e;if(this.Bt.info("zw.scw.sps.1.0 call "+t),null!=t){var s=null===(e=this.playerList[t])||void 0===e?void 0:e.dispatchRetryHandler;s&&(s.invalid(),s.stopMaxTime());var r=this.playerList[t];if(n&&(null==r?void 0:r.state)==f){var o=this.Xt.reportSeqList.startPlay[t];this.dataReport.addMsgInfo(o,{error:Kt.code,message:Kt.message}),this.dataReport.uploadReport(o)}this.stopPlayer(t),delete this.streamEventMap[t],this.updatePlayingState(t,void 0,void 0,i),delete this.streamReportMap[t],delete this.playSuccessCallBackList[t],delete this.playErrorCallBackList[t]}},i.prototype.stopPlayer=function(t){this.Bt.info("zw.scw.sp.1 call "+t);var i=this.playerList[t],n=this.publisherList[t];i||n?(i&&(i.stopPlayer(),i.reportPlayQualityStatics(),delete this.playerList[t]),n&&(n.stopPlayer(),n.reportQualityStatics(),delete this.publisherList[t]),--this.playerCount):this.Bt.info("zw.scw.sp.1 play not exist "+t),this.Bt.info("zw.scw.sp.1 call success")},i.prototype.startPublishingStream=function(t,i,n){if(this.Bt.info("zw.scw.sps.0 call "+t),this.streamEventMap[t]){0==n?"cdn":1==n&&"ultra_src",Di("kZegoTaskPublishStart"+t,this.Xt.reportList,at,"type"),Di("kZegoTaskPublishStart"+t,this.Xt.reportList,at,"urls")}var e=this.streamReportMap[t];return e&&this.dataReport.eventEndWithMsg(e,"GotPublishInfo",{type:0==n?"cdn":"ultra_src",urls:i}),this.Bt.info("".concat(ft," call ").concat(t,", urls:").concat(JSON.stringify(i),", type:").concat(n)),this.startPlayer(t,i,n,$n)},i.prototype.stopPublishingStream=function(t,i,n){if(void 0===i&&(i={code:0,message:""}),this.Bt.info("zw.scw.sps.0.0 call "+t),null!=t){var e=this.publisherList[t].room,s=this.publisherList[t],r=null==s?void 0:s.dispatchRetryHandler;if(r&&(r.invalid(),r.stopMaxTime()),n&&(null==s?void 0:s.state)==f){var o=this.Xt.reportSeqList.startPublish[t];this.dataReport.addMsgInfo(o,{error:Yt.code,message:Yt.message}),this.dataReport.uploadReport(o)}if(s&&s.state!==d&&e.streamHandler.onPublishStateUpdate(st,t,i),this.stopPlayer(t),delete this.streamEventMap[t],this.updatePublishingState(e,t,void 0,!1,i),delete this.streamReportMap[t],this.Xt.publishStreamList[t]){if(this.Xt.publishStreamList[t].state>=E){e.streamHandler.updateStreamInfo(t,O);for(var u=0;u<e.streamList.length;u++)if(e.streamList[u].stream_id==t){e.streamList.splice(u--,1);break}}delete this.Xt.publishStreamList[t]}this.Xt.streamUrlMap[t]&&delete this.Xt.streamUrlMap[t]}},i.prototype.updatePlayerState=function(t,i){var n=this.playerList[t],e=this.publisherList[t];n||e?(n&&n.updateEvent(i),e&&e.updateEvent(i)):this.Bt.error("zw.scw.ups.0 no player "+t),this.Bt.info("zw.scw.ups.0 updatePlayerEvent success")},i.prototype.updatePlayerNetStatus=function(t,i){var n=this.playerList[t],e=this.publisherList[t];n||e?(n&&n.updatePlayerNetStatus(i),e&&e.updatePlayerNetStatus(i)):this.Bt.error("zw.scw.upns no player "+t),this.Bt.info("zw.scw.upns updatePlayerNetStatus success"+t)},i.prototype.reset=function(t,i,n){var e,s;for(var r in this.Bt.info("zw.scw.r.0 call"),this.publisherList){this.publisherList[r].room.roomID!=t&&t||(this.stopPublishingStream(r,{code:i||0,message:""},n),this.pusherInstance&&this.pusherInstance.stop())}this.pusherInstance=void 0;var o=function(r){var o=u.playerList[r].room;if(o.roomID!=t||!o.streamList.find((function(t){return t.stream_id==r}))&&1!=u.Xt.roomList.length){if(o.roomID==t&&u.Xt.roomList.length>1){var h=u.Xt.roomList.find((function(i){return i.roomID!==t}));h?u.playerList[r].room=h:(u.stopPlayingStream(r,{code:i||0,message:""},n),null===(s=u.livePlayerList.find((function(t){return t.attributes.id==r})))||void 0===s||s.stop())}}else u.stopPlayingStream(r,{code:i||0,message:""},n),null===(e=u.livePlayerList.find((function(t){return t.attributes.id==r})))||void 0===e||e.stop()},u=this;for(var h in this.playerList)o(h);this.livePlayerList=[],this.playerContextMap={},this.Bt.info("zw.scw.r.0 call success")},i.prototype.reportPublishEvent=function(t,i){if(this.streamReportMap[t]){var n=this.streamReportMap[t];this.dataReport.addMsgExt(n,{stream:t}),i&&i.code&&this.dataReport.addMsgInfo(n,{error:i.code}),this.dataReport.addMsgInfo(n,{itemtype:"WXPublishStream"}),this.dataReport.uploadReport(n,"WXPublishStream"),delete this.streamReportMap[t]}},i.prototype.reportPlayEvent=function(t,i){if(this.streamReportMap[t]){var n=this.streamReportMap[t];this.dataReport.addMsgExt(n,{stream:t}),i&&i.code&&this.dataReport.addMsgInfo(n,{error:i.code}),this.dataReport.addMsgInfo(n,{itemtype:"WXPlayStream"}),this.dataReport.uploadReport(n,"WXPlayStream"),delete this.streamReportMap[t]}},i.prototype.onPlayStateUpdate=function(t,i,n){},i.prototype.onPlayQualityUpdate=function(t,i){},i.prototype.onPublishStateUpdate=function(t,i,n){},i.prototype.onPublishQualityUpdate=function(t,i){},i.prototype.onPublisherStreamUrlUpdate=function(t,i){},i.prototype.onPublisherStreamUrlFail=function(t,i){},i.prototype.onPlayerStreamUrlUpdate=function(t,i){},i.prototype.getReconnectLimit=function(t){return 1},i.prototype.onPlayerStart=function(t,i){this.Bt.info("zw.scw.ops.0 call "+t),i==Hn?this.onPlayStateUpdate(qn,t,{code:0,message:""}):i==$n&&this.onPublishStateUpdate(qn,t,{code:0,message:""})},i.prototype.onPlayerStop=function(t,i,n){this.Bt.info("zw.scw.ops.1 call "+t),i==Hn?(this.reportPlayEvent(t,n),this.Bt.warn("zw.scw.ops.1 play error"),this.onPlayStateUpdate(jn,t,n)):i==$n&&(this.reportPublishEvent(t,n),this.Bt.warn("zw.scw.ops.1 publish error"),this.onPublishStateUpdate(jn,t,n))},i.prototype.onPlayerRetry=function(t,i){this.Bt.info("zw.scw.opr call "+t),i==Hn?this.onPlayStateUpdate(Gn,t,{code:0,message:""}):i==$n&&this.onPublishStateUpdate(Gn,t,{code:0,message:""})},i.prototype.onPlayerQuality=function(t,i,n){var e={video:{videoBitrate:i.videoBitrate,videoFPS:i.videoFPS,videoWidth:i.videoWidth,videoHeight:i.videoHeight},audio:{audioBitrate:i.audioBitrate}};n==Hn?this.onPlayQualityUpdate(t,e):n==$n&&this.onPublishQualityUpdate(t,e)},i.prototype.onStreamUrlUpdate=function(t,i,n){this.Bt.info("zw.scw.opuu.0 call "+t),0==n?this.playSuccessCallBackList[t](t,i):this.publishSuccessCallBackList[t](t,i)},i.prototype.getTotalStreamId=function(t){return t},i.prototype.getRealStreamId=function(t){return t},i.prototype.getRoomByStreamID=function(t){return this.publisherList[t]?this.publisherList[t].room:this.playerList[t]?this.playerList[t].room:void 0},i.prototype.startDispatch=function(){},i.prototype.getCDNUrl=function(t,i){this.Bt.info("zw.scw.gcu call");var n=[],e=this.Xt.appConfig.media_config.play_config.resource_info;if(1==i&&(e=this.Xt.appConfig.media_config.publish_config.resource_info),e.length){var s=e.find((function(t){return 0==t.resource_type}));if(s)for(var r=0;r<s.service_info.length;r++){var o=s.service_info[r],u=o.protocol,a=o.url_template.replace("{STREAM_NAME}",t);if(u===h.RTMP)n.push(a)}}return this.Bt.info("zw.scw.gcu rtmps:"+JSON.stringify(n)),{rtmps:n}},i}(An),Bn=function(){function t(t,i,e,s,r){var o;if(void 0===r&&(r=1),this.reporter=e,this.logCount=0,this.Bt=t,this.dataReport=i,this.RTM=s,this.stateCenter=new Zi(this.Bt,this.dataReport),this.stateCenter.clientType="wxMini",!0===(null===(o=n.ZegoExpressWebRTM.engineOptions)||void 0===o?void 0:o.pri)){var u=n.ZegoExpressWebRTM.engineOptions.netMode;u!==Q.Extranet&&u!==Q.Intranet||(this.stateCenter.netMode=n.ZegoExpressWebRTM.engineOptions.netMode)}this.streamCenter=new Vn(this.Bt,this.stateCenter,this.dataReport),this.wechatMiniModules=new Tn(this.Bt,this.dataReport,e,this.stateCenter,this.streamCenter,this.RTM),this.initTracer(e)}return Object.defineProperty(t.prototype,"logger",{get:function(){return this.Bt},enumerable:!1,configurable:!0}),t.prototype.checkSystemRequirements=function(){return this.wechatMiniModules.checkSystemRequirements()},t.prototype.getVersion=function(){return"3.2.0"},t.prototype.on=function(t,i){return this.wechatMiniModules.bindListener(t,i)},t.prototype.off=function(t,i){return this.wechatMiniModules.deleteListener(t,i)},t.prototype.startPublishingStream=function(t,i){return this.wechatMiniModules.publishModule.startPublishingStream(t,i)},t.prototype.stopPublishingStream=function(t){return this.wechatMiniModules.publishModule.stopPublishingStream(t,!0)},t.prototype.getNextUrl=function(t){return this.wechatMiniModules.getNextUrl(t)},t.prototype.setCustomSignalUrl=function(t,i){if(void 0===i&&(i=!0),this.Bt.info("zw.w.scsu call: "+JSON.stringify(t)),!t||0==t.length)return this.Bt.error("zw.w.scsu param error"),!1;var n=!0;return t.forEach((function(t){return 0!=t.indexOf("rtmp://")&&(n=!1)})),n?(i?this.stateCenter.customUrl=t:this.stateCenter.customPlayUrl=t,!0):(this.Bt.error("zw.w.scsu url is not correct"),!1)},t.prototype.addPublishCdnUrl=function(t,i){return this.Bt.info("zw.apcu call "+t+" "+i),this.wechatMiniModules.streamCDNModule?this.wechatMiniModules.streamCDNModule.publishTarget({type:"addpush",streamID:t,pushUrl:i}):new vt((function(t,i){console.error("should install advanced module"),t({errorCode:-1,extendedData:"should install advanced module"})}))},t.prototype.removePublishCdnUrl=function(t,i){return this.Bt.info("zw.rpcu call "+t+" "+i),this.wechatMiniModules.streamCDNModule?this.wechatMiniModules.streamCDNModule.publishTarget({type:"delpush",streamID:t,pushUrl:i}):new vt((function(t,i){console.error("should install advanced module"),t({errorCode:-1,extendedData:"should install advanced module"})}))},t.prototype.startMixerTask=function(t){return new vt((function(t,i){console.error("未引入混流模块"),i()}))},t.prototype.setMixerTaskConfig=function(t){return new vt((function(t,i){console.error("未引入混流模块"),i()}))},t.prototype.stopMixerTask=function(t){return new vt((function(t,i){console.error("未引入混流模块"),i()}))},t.prototype.startAutoMixerTask=function(t){return Et(["mix stream"])},t.prototype.stopAutoMixerTask=function(t){return Et(["mix stream"])},t.prototype.setStreamExtraInfo=function(t,i){return this.wechatMiniModules.streamCommon.setStreamExtraInfo(t,i)},t.prototype.startPlayingStream=function(t,i){return this.wechatMiniModules.playModule.startPlayingStream(t,i)},t.prototype.stopPlayingStream=function(t){this.wechatMiniModules.playModule.stopPlayingStream(t,!0)},t.prototype.updatePlayerState=function(t,i){this.wechatMiniModules.updatePlayerState(t,i)},t.prototype.updatePlayerNetStatus=function(t,i){this.wechatMiniModules.updatePlayerNetStatus(t,i)},t.use=function(i){switch(i.type){case"MixStream":i.install(t,tn,Tn);break;case"StreamCDN":i.install(t,Tn,tn)}},t.prototype.updateAudioVolumeNotify=function(t,i){this.wechatMiniModules.updateAudioVolumeNotify(t,i)},t.prototype.initContext=function(t){t.wxContext&&(this.wxContext=t.wxContext),t.pushAtr&&(this.pushAtr=t.pushAtr),t.playAtr&&(this.playAtr=t.playAtr)},t.prototype.createPusher=function(t){return this.Bt.info("zw.cp call"),this.wxContext&&this.wxContext.setData&&this.pushAtr?(this.wechatMiniModules.Wt.pusherInstance||(this.wechatMiniModules.Wt.pusherInstance=new Nn(this.wxContext,this.pushAtr,this,t)),this.Bt.info("zw.cp call success"),this.wechatMiniModules.Wt.pusherInstance):(this.Bt.error("zw.cp init context wrong"),null)},t.prototype.setPusherAttributes=function(t,i){var n;this.Bt.info("zw.spa.0 call"),this.wechatMiniModules.Wt.pusherInstance?(null===(n=this.wechatMiniModules.Wt.pusherInstance)||void 0===n||n.setPusherAttributes(t,i),this.Bt.info("zw.spa.0 call success")):this.Bt.error("zw.spa.0 publisher no found")},t.prototype.setPlayerAttributes=function(t,i,n){if(this.Bt.info("zw.spa.1 call"),Si(t)&&Si(this.playAtr)){var e=this.wechatMiniModules.Wt.livePlayerList.find((function(i){return i.attributes.id==t}));e?(e.setPlayerAttributes(i,n),this.Bt.info("zw.spa.1 call success")):this.Bt.error("zw.spa.1 player no found")}else this.Bt.error("zw.spa.1 stream no found")},t.prototype.getPusherInstance=function(){return this.wechatMiniModules.Wt.pusherInstance?this.wechatMiniModules.Wt.pusherInstance:null},t.prototype.getPlayerInstance=function(t,i){if(this.Bt.info("zw.gpi call"),!Si(t)||!Si(this.playAtr))return this.Bt.error("zw.gpi param error"),null;var n=this.wechatMiniModules.Wt.livePlayerList.find((function(i){return i.attributes.id==t}));return i&&(this.wechatMiniModules.Wt.playerContextMap[t]=i),n||(n=new zn(this.wxContext,t,this,this.wechatMiniModules.Wt.playerContextMap[t]),this.wechatMiniModules.Wt.livePlayerList.push(n)),this.setPlayData(),this.Bt.info("zw.gpi call success"),n},t.prototype.getPlayerList=function(t){if(this.Bt.info("zw.gpl call"),!Oi(t)&&!Si(t)||!Si(this.playAtr))return this.Bt.error("zw.gpl param error"),[];if(t){var i=this.wechatMiniModules.Wt.livePlayerList.find((function(i){return i.attributes.id==t}));return i?[i.attributes]:[]}return this.Bt.info("zw.gpl call success"),this.wechatMiniModules.Wt.livePlayerList.map((function(t){return t.attributes}))},t.prototype.mutePublishStreamVideo=function(t){this.setPusherAttributes({enableCamera:!t})},t.prototype.mutePublishStreamAudio=function(t){this.setPusherAttributes({enableMic:!t})},t.prototype.mutePlayStreamVideo=function(t,i){this.setPlayerAttributes(t,{muteVideo:i})},t.prototype.mutePlayStreamAudio=function(t,i){this.setPlayerAttributes(t,{muteAudio:i})},t.prototype.setPlayData=function(t){if(this.Bt.info("zw.spd call"),this.wxContext&&this.playAtr){void 0===t||Ti(t)||this.Bt.error("zw.spd callBack is not function");var i={};i[this.playAtr]=this.wechatMiniModules.Wt.livePlayerList.map((function(t){return t.attributes})),this.wxContext.setData(i,t),this.Bt.info("zw.spd call success")}else this.Bt.error("zw.spd init context wrong")},t.prototype.initTracer=function(t){this.stateCenter.reporter=t},t}(),Jn=function(){var t=function(i,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])},t(i,n)};return function(i,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function e(){this.constructor=i}t(i,n),i.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}}(),Yn=function(t){function i(i,e){var s=this;return n.ZegoExpressWebRTMEngine.version="3.2.0",(s=t.call(this,i,e,1)||this).zegoWechatMini=new Bn(s.logger,s.dataReport,s.reporter,s.zegoWebRTM),s}return Jn(i,t),i.prototype.getNextUrl=function(t){return this.zegoWechatMini.getNextUrl(t)},i.prototype.startPlayingStream=function(t,i){return this.zegoWechatMini.startPlayingStream(t,i)},i.prototype.stopPlayingStream=function(t){return this.zegoWechatMini.stopPlayingStream(t)},i.prototype.updatePlayerNetStatus=function(t,i){return this.zegoWechatMini.updatePlayerNetStatus(t,i)},i.prototype.updatePlayerState=function(t,i){return this.zegoWechatMini.updatePlayerState(t,i)},i.prototype.updateAudioVolumeNotify=function(t,i){return this.zegoWechatMini.updateAudioVolumeNotify(t,i)},i.prototype.checkSystemRequirements=function(){return this.zegoWechatMini.checkSystemRequirements()},i.prototype.setMixerTaskConfig=function(t){return this.zegoWechatMini.setMixerTaskConfig(t)},i.prototype.startMixerTask=function(t){return this.zegoWechatMini.startMixerTask(t)},i.prototype.startAutoMixerTask=function(t){return this.zegoWechatMini.startAutoMixerTask(t)},i.prototype.stopAutoMixerTask=function(t){return this.zegoWechatMini.stopAutoMixerTask(t)},i.prototype.off=function(t,i){return this.zegoWebRTM.stateCenter.listenerList[t]?this.zegoWebRTM.off(t,i):!!this.zegoWechatMini.stateCenter.listenerList[t]&&this.zegoWechatMini.off(t,i)},i.prototype.stopMixerTask=function(t){return this.zegoWechatMini.stopMixerTask(t)},i.prototype.on=function(t,i){return this.zegoWebRTM.stateCenter.listenerList[t]?this.zegoWebRTM.on(t,i):!!this.zegoWechatMini.stateCenter.listenerList[t]&&this.zegoWechatMini.on(t,i)},i.prototype.startPublishingStream=function(t,i){return this.zegoWechatMini.startPublishingStream(t,i)},i.prototype.stopPublishingStream=function(t){return this.zegoWechatMini.stopPublishingStream(t)},i.prototype.addPublishCdnUrl=function(t,i){return 3===arguments.length?this.zegoWechatMini.addPublishCdnUrl(arguments[0],arguments[2]):this.zegoWechatMini.addPublishCdnUrl(t,i)},i.prototype.removePublishCdnUrl=function(t,i){return 3===arguments.length?this.zegoWechatMini.removePublishCdnUrl(arguments[0],arguments[2]):this.zegoWechatMini.removePublishCdnUrl(t,i)},i.prototype.setStreamExtraInfo=function(t,i){return this.zegoWechatMini.setStreamExtraInfo(t,i)},i.use=function(t){n.ZegoExpressWebRTMEngine.use(t),Bn.use(t)},i.prototype.initContext=function(t){this.zegoWechatMini.initContext(t)},i.prototype.createPusher=function(t){return this.zegoWechatMini.createPusher(t)},i.prototype.getPusherInstance=function(){return this.zegoWechatMini.getPusherInstance()},i.prototype.getPlayerInstance=function(t,i){return this.zegoWechatMini.getPlayerInstance(t,i)},i.prototype.mutePublishStreamVideo=function(t){this.zegoWechatMini.mutePublishStreamVideo(t)},i.prototype.mutePublishStreamAudio=function(t){this.zegoWechatMini.mutePublishStreamAudio(t)},i.prototype.mutePlayStreamVideo=function(t,i){this.zegoWechatMini.mutePlayStreamVideo(t,i)},i.prototype.mutePlayStreamAudio=function(t,i){this.zegoWechatMini.mutePlayStreamAudio(t,i)},i.prototype.setPusherAttributes=function(t){this.zegoWechatMini.setPusherAttributes(t)},i.prototype.setPlayerAttributes=function(t,i){this.zegoWechatMini.setPlayerAttributes(t,i)},i.prototype.getPlayerList=function(t){return this.zegoWechatMini.getPlayerList(t)},i}(n.ZegoExpressWebRTMEngine),Fn=__webpack_require__(533),Wn=__webpack_require__.n(Fn),Xn=function(){var t=function(i,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])},t(i,n)};return function(i,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function e(){this.constructor=i}t(i,n),i.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}}(),Zn=function(t){function i(i,n,e){var s=t.call(this,i,n)||this;return s.Bt=i,s.Xt=n,s.Ci=e,s.RETRY_MAX_TIME=8,s}return Xn(i,t),i.prototype.initReqParams=function(t,i){this.streamId=t,this.cdnPushConfig=i},i.prototype.active=function(t){var i=this;if(void 0===t&&(t=!1),this.retryTimer)this.Bt.warn("".concat(Wi," was actived, ignore"));else if(this.isOverTime)this.Bt.warn("".concat(Wi," retry over time, stop retry"));else{var n=function(){i.clearRetryTimer(),i.Ci.sendCDNRequest(i.streamId,i.cdnPushConfig,(function(t,n){var e=t.body;i.invalid(),i.stopMaxTime(),i.sucCallBack&&(i.sucCallBack&&i.sucCallBack(e,n),i.resetCallback())}),(function(t){i._err=t;var n=t.status_code;i.isOverTime?i.requestFail(t):((429===n||n>=500&&n<600)&&i.setRetryRule(1),i.active())})),t||i.attempt++};if(t)n();else{var e=this.getRetryDelayByCount(this.attempt);this.retryTimer=setTimeout(n,e)}}},i}(Dn);Sn=__webpack_require__(951).proto_media,Rn=__webpack_require__(100),On=__webpack_require__(720),Rn.util.Long=On,Rn.configure();var Kn,Qn=function(){function t(){}return t.prototype.encodeRelayPublishCdnReq=function(t){var i=Sn.RelayPublishCdnRequest.create(t);return Sn.RelayPublishCdnRequest.encode(i).finish()},t.prototype.decodeRelayPublishCdnRsp=function(t){var i=Sn.RelayPublishCdnResponse.decode(t);return i.request_seq_v2&&On.isLong(i.request_seq_v2)&&(i.request_seq_v2=i.request_seq_v2.toNumber()),i},t}();!function(t){t[t.I=0]="I",t[t.H=10]="H",t[t.M=100]="M",t[t.L=1e3]="L"}(Kn||(Kn={}));var te,ie,ne,ee,se,re,oe,ue,he,ae,ce,le,fe,_e,de,me,ve,pe,ge,be,Ee,Se,Re,Oe,ye,Te,we={},Ie={_sendCDNPublishByAccessHub:function(t,i,n,e){var s=this;this.mediaProtoBuf||(this.mediaProtoBuf=new Qn);var r=new Zn(this.logger,this.stateCenter,this);r.initReqParams(t,i);var o=function(t,i){try{var n=s.mediaProtoBuf.decodeRelayPublishCdnRsp(t);s.logger.info("zb.sh.pt rsp decode ".concat(JSON.stringify(n)));var e=(null==n?void 0:n.response)||{};return{code:e.code,msg:e.message}}catch(t){return{code:-1}}};r.initCallback((function(t,r){var u=o(t),h=u.code,a=u.msg;h&&0!=h?(s.logger.error("zb.sh.pt "+i.type+" error code: "+h+" "+a),e(5004===h?ti:zt," cmd: ".concat(i.type," ").concat(h," ").concat(a))):(s.logger.info("zb.sh.pt "+i.type+" success"),n&&n({errorCode:0,extendedData:""}))}),(function(t){var n=t.status_code,r=t.body,u=t.code,h=t.msg,a=JSON.parse(JSON.stringify(mi.error.Ht)),c="";if(u)a={code:u,msg:h},c=h;else if(200===n)s.logger.info("zb.sh.pt error: "),a=mi.error.Ht,c="cmd: ".concat(i.type);else{var l="";if(Si(r))l=r;else{var f=o(r);l=f.code+" "+f.msg}c="request media server fail, error: "+n+" "+l}s.logger.error("zb.sh.pt "+c),e&&e(a,c)})),r.startMaxTime(),r.active(!0)},sendCDNRequest:function(t,i,n,e){var s=this,r="addpush"===i.type?1:2,o={request_seq:this.stateCenter.cdnSeq++,request_cmd:r,streamid:t,cdn_server:i.pushUrl,request_seq_v2:this.stateCenter.cdnSeqV2++};this.logger.info("zb.sh.scpba "+JSON.stringify(o));var u=this.mediaProtoBuf.encodeRelayPublishCdnReq(o);this.sendHttpPBRequest({interfaceID:6,resID:this.stateCenter.appid+"/"+t},u,(function(t,i){s.logger.info("zb.sh.pt receive message "+(null==t?void 0:t.status_code)),n&&n(t,i)}),(function(t){e&&e(t)}),{timeout:4e3})},_publishTarget:function(t,i,n){this.logger.info("zb.sh.pt call");var e=t.streamID;this.stateCenter.testEnvironment&&(e="zegotest-"+this.stateCenter.appid+"-"+t.streamID),this.stateCenter.useNetAgent&&this._sendCDNPublishByAccessHub(e,t,i,n)}},Ne=function(){function t(t,i,n,e){this.Bt=t,this.dataReport=i,this.Wt=n,this.Xt=e,this.screenShotReady=!1}return Object.defineProperty(t.prototype,"ri",{get:function(){return this.Xt.reporter},enumerable:!1,configurable:!0}),t.prototype.publishTarget=function(t){var i=this,n="";switch(t.type){case"addpush":n=vi;break;case"delpush":case"clearpush":n=pi}var e=this.ri.createSpan(Kn.H,{key:hi,par:t.streamID},{key:""},n);return e.setAttributes({url:gi(t.pushUrl)}),new vt((function(n,s){var r=function(t,n){i.Bt.error("zb.pt "+(n||t.message)),i.ri.setError(e,t,n),s({errorCode:t.code,extendedData:t.message+(n?" "+n:"")})};if(-1==["addpush","delpush","clearpush"].indexOf(t.type))return i.Bt.error("zb.sh.pt cdn push type error"),void r(Qt,"type error");if(t.streamID&&Si(t.streamID))if(t.pushUrl&&Si(t.pushUrl))if(i.Xt.publishStreamList[t.streamID]){var o=i.Wt.getRoomByStreamID(t.streamID);if(o){o.streamHandler._publishTarget(t,(function(t){e.end(),n(t)}),r)}else r(mi.error.Lt)}else r(mi.error.xt);else r(mi.error.Mt,"push url error");else r(mi.error.Mt,"stream id type error")}))},t}(),Ce={type:"StreamCDN",install:function(t,i,n){for(var e in Object.defineProperty(i.prototype,"initStreamCDN",{value:function(){this.streamCDNModule=new Ne(this.logger,this.dataReport,this.streamCenter,this.stateCenter)},writable:!1}),we)Object.defineProperty(t.prototype,e,{value:we[e],writable:!1});for(var e in Ie)Object.defineProperty(n.prototype,e,{value:Ie[e],writable:!1})}},ke={NOT_LOGIN:yt,INPUT_PARAM:Ct,TIMEOUT:kt,MIXER_NO_SERVICES:{code:1005e3,message:"no mix stream service"},MIXER_TASK_ID_NULL:{code:1005001,message:"mixer task is null"},MIXER_TASK_ID_TOO_LONG:{code:1005002,message:"task ID is too long"},MIXER_TASK_ID_INVALID_CHARACTER:{code:1005003,message:"task ID contains illegal characters"},MIXER_NO_OUTPUT_TARGET:{code:1005005,message:"task configuration does not specify output"},MIXER_OUTPUT_TARGET_INVALID:{code:1005006,message:"stream output target is incorrect"},MIXER_START_REQUEST_ERROR:{code:1005010,message:"start mixer task fail, possibly due to network reasons"},MIXER_STOP_REQUEST_ERROR:{code:1005011,message:"stop mixer task fail, possibly due to network reasons"},MIXER_NOT_OWNER_STOP_MIXER:{code:1005012,message:" maxed task must be stopped by the start user of the task"},MIXER_INPUTLIST_NULL:{code:1005020,message:"Mixed stream task input list is null"},MIXER_OUTPUTLIST_NULL:{code:1005021,message:"Mixed stream task output list is null"},MIXER_VIDEO_CONFIG_INVALID:{code:1005023,message:"invalid mixed stream task video configuration"},MIXER_EXCEED_MAX_INPUT_COUNT:{code:1005025,message:"more than the maximum number of input streams"},MIXER_INPUT_STREAM_NOT_EXISTS:{code:1005026,message:"Input stream does not exist"},MIXER_INPUT_PARAMETERS_ERROR:{code:1005027,message:"mix stream input parameters are wrong"},MIXER_INPUT_LABEL_TOO_LONG:{code:1005028,message:"Input stream label text is too long"},MIXER_OUTPUT_TARGET_TOO_LONG:{code:1005029,message:"Output stream target is too long"},MIXER_EXCEED_MAX_OUTPUT_COUNT:{code:1005030,message:"more than the maximum number of output streams"},MIXER_INPUT_IMAGE_URL_TOO_LONG:{code:1005034,message:"Input stream image url too long"},MIXER_INPUT_IMAGE_FORMAT_WRONG:{code:1005035,message:"Input stream image format wrong"},MIXER_INPUT_IMAGE_GET_FAIL:{code:1005036,message:"Input stream image get fail"},MIXER_AUTHENTICATION_FAILED:{code:1005050,message:"mixed stream authentication failed"},MIXER_WATERMARK_NULL:{code:1005061,mag:"input watermark is null"},MIXER_WATERMARK_PARAMETERS_ERROR:{code:1005062,message:"input watermark parameter is wrong"},MIXER_WATERMARK_URL_INVALID:{code:1005063,message:"illegal input watermark URL"},MIXER_BACKGROUND_IMAGE_URL_INVALID:{code:1005067,message:"illegal input background image URL"},MIXER_REPEAT_INPUT:{code:1005099,message:"mix stream input repeat"},MIXER_INNER_ERROR:{code:1005099,message:"mixer internal error"}};!function(t){t[t.Off=0]="Off",t[t.TurningOn=1]="TurningOn",t[t.On=2]="On"}(te||(te={})),function(t){t[t.World=0]="World",t[t.Team=1]="Team",t[t.SecretTeam=2]="SecretTeam"}(ie||(ie={})),function(t){t[t.All=0]="All",t[t.World=1]="World",t[t.Team=2]="Team"}(ne||(ne={})),function(t){t[t.All=0]="All",t[t.World=1]="World",t[t.Team=2]="Team"}(ee||(ee={})),function(t){t[t.Song=0]="Song",t[t.Accompaniment=1]="Accompaniment",t[t.AccompanimentClip=2]="AccompanimentClip",t[t.AccompanimentSegment=3]="AccompanimentSegment"}(se||(se={})),function(t){t[t.Count=0]="Count",t[t.User=1]="User",t[t.Room=2]="Room",t[t.Master=3]="Master"}(re||(re={})),function(t){t[t.VendorDefault=0]="VendorDefault",t[t.Vendor1=1]="Vendor1",t[t.Vendor2=2]="Vendor2",t[t.Vendor3=4]="Vendor3"}(oe||(oe={})),function(t){t[t.PortraitSegmentation=0]="PortraitSegmentation"}(ue||(ue={})),function(t){t[t.NONE=0]="NONE",t[t.MEN_TO_CHILD=1]="MEN_TO_CHILD",t[t.MEN_TO_WOMEN=2]="MEN_TO_WOMEN",t[t.WOMEN_TO_CHILD=3]="WOMEN_TO_CHILD",t[t.WOMEN_TO_MEN=4]="WOMEN_TO_MEN",t[t.FOREIGNER=5]="FOREIGNER",t[t.OPTIMUS_PRIME=6]="OPTIMUS_PRIME",t[t.ANDROID=7]="ANDROID",t[t.ETHEREAL=8]="ETHEREAL",t[t.MALE_MAGNETIC=9]="MALE_MAGNETIC",t[t.FEMALE_FRESH=10]="FEMALE_FRESH",t[t.MAJOR_C=11]="MAJOR_C",t[t.MINOR_A=12]="MINOR_A",t[t.HARMONIC_MINOR=13]="HARMONIC_MINOR",t[t.FEMALE_ENERGETIC=14]="FEMALE_ENERGETIC",t[t.RICHNESS=15]="RICHNESS",t[t.MUFFLED=16]="MUFFLED",t[t.ROUNDNESS=17]="ROUNDNESS",t[t.FALSETTO=18]="FALSETTO",t[t.FULLNESS=19]="FULLNESS",t[t.CLEAR=20]="CLEAR",t[t.HIGHLY_RESONANT=21]="HIGHLY_RESONANT",t[t.LOUD_CLEAR=22]="LOUD_CLEAR"}(he||(he={})),function(t){t[t.None=0]="None",t[t.SoftRoom=1]="SoftRoom",t[t.LargeRoom=2]="LargeRoom",t[t.ConcertHall=3]="ConcertHall",t[t.Valley=4]="Valley",t[t.RecordingStudio=5]="RecordingStudio",t[t.Basement=6]="Basement",t[t.KTV=7]="KTV",t[t.Popular=8]="Popular",t[t.Rock=9]="Rock",t[t.VocalConcert=10]="VocalConcert",t[t.GramoPhone=11]="GramoPhone",t[t.EnhancedKTV=12]="EnhancedKTV"}(ae||(ae={})),function(t){t[t.None=0]="None",t[t.Local=1]="Local",t[t.Publish=2]="Publish",t[t.All=3]="All"}(ce||(ce={})),function(t){t[t.AI=0]="AI",t[t.AIBalanced=1]="AIBalanced"}(le||(le={})),function(t){t[t.Off=0]="Off",t[t.On=1]="On"}(fe||(fe={})),function(t){t[t.PortraitSegmentation=0]="PortraitSegmentation"}(_e||(_e={})),function(t){t[t.ZegoGeoFenceTypeNone=0]="ZegoGeoFenceTypeNone",t[t.ZegoGeoFenceTypeInclude=1]="ZegoGeoFenceTypeInclude",t[t.ZegoGeoFenceTypeExclude=2]="ZegoGeoFenceTypeExclude"}(de||(de={})),function(t){t[t.AspectFill=0]="AspectFill",t[t.AspectFit=1]="AspectFit"}(me||(me={})),function(t){t[t.ZegoFontTypeSourceHanSans=0]="ZegoFontTypeSourceHanSans",t[t.ZegoFontTypeAlibabaSans=1]="ZegoFontTypeAlibabaSans",t[t.ZegoFontTypePangMenZhengDaoTitle=2]="ZegoFontTypePangMenZhengDaoTitle",t[t.ZegoFontTypeHappyZcool=3]="ZegoFontTypeHappyZcool"}(ve||(ve={})),function(t){t[t.ZegoDefined=0]="ZegoDefined",t[t.UserUnregister=1]="UserUnregister"}(pe||(pe={})),function(t){t[t.ZegoAudioCodecIDNormal=1]="ZegoAudioCodecIDNormal",t[t.ZegoAudioCodecIDNormal2=2]="ZegoAudioCodecIDNormal2",t[t.ZegoAudioCodecIDLow3=6]="ZegoAudioCodecIDLow3"}(ge||(ge={})),function(t){t[t.ZegoAudioMixModeRaw=0]="ZegoAudioMixModeRaw",t[t.ZegoAudioMixModeFocused=1]="ZegoAudioMixModeFocused"}(be||(be={})),function(t){t[t.ZegoEncodeProfileDefault=0]="ZegoEncodeProfileDefault",t[t.ZegoEncodeProfileBaseline=1]="ZegoEncodeProfileBaseline",t[t.ZegoEncodeProfileMain=2]="ZegoEncodeProfileMain",t[t.ZegoEncodeProfileHigh=3]="ZegoEncodeProfileHigh"}(Ee||(Ee={})),function(t){t[t.Allow=0]="Allow",t[t.NotAllow=1]="NotAllow"}(Se||(Se={})),function(t){t[t.video=0]="video",t[t.audio=1]="audio",t[t.videoAndAudio=2]="videoAndAudio"}(Re||(Re={})),Oe=__webpack_require__(413).Z.proto_mixstream,ye=__webpack_require__(100),Te=__webpack_require__(720),ye.util.Long=Te,ye.configure();var ze,Ae,De=function(){function t(){}return t.prototype.encodeMixStreamStartReq=function(t){var i=Oe.MixStreamStartRequest.create(t);return Oe.MixStreamStartRequest.encode(i).finish()},t.prototype.decodeMixStreamStartRsp=function(t){return Oe.MixStreamStartResponse.decode(t)},t.prototype.encodeMixStreamStopReq=function(t){var i=Oe.MixStreamStopRequest.create(t);return Oe.MixStreamStopRequest.encode(i).finish()},t.prototype.decodeMixStreamStopRsp=function(t){return Oe.MixStreamStopResponse.decode(t)},t.prototype.encodeGetMixStreamStatusReq=function(t){var i=Oe.GetMixStreamStatusRequest.create(t);return Oe.GetMixStreamStatusRequest.encode(i).finish()},t.prototype.decodeGetMixStreamStatusRsp=function(t){return Oe.GetMixStreamStatusResponse.decode(t)},t.prototype.encodeAutoRoomMixStreamStartReq=function(t){var i=Oe.AutoRoomMixStreamStartRequest.create(t);return Oe.AutoRoomMixStreamStartRequest.encode(i).finish()},t.prototype.decodeAutoRoomMixStreamStartRsp=function(t){return Oe.AutoRoomMixStreamStartResponse.decode(t)},t.prototype.encodeAutoRoomMixStreamStopReq=function(t){var i=Oe.AutoRoomMixStreamStopRequest.create(t);return Oe.AutoRoomMixStreamStopRequest.encode(i).finish()},t.prototype.decodeAutoRoomMixStreamStopRsp=function(t){return Oe.AutoRoomMixStreamStopResponse.decode(t)},t.prototype.encodeMixStreamTaskHbReq=function(t){var i=Oe.MixStreamTaskHbRequest.create(t);return Oe.MixStreamTaskHbRequest.encode(i).finish()},t.prototype.decodeMixStreamTaskHbRsp=function(t){return Oe.MixStreamTaskHbResponse.decode(t)},t}(),Me={event:"/mix/start_mix",error:{Mt:ke.INPUT_PARAM,ki:ke.MIXER_TASK_ID_NULL,zi:ke.MIXER_TASK_ID_TOO_LONG,Ai:ke.MIXER_TASK_ID_INVALID_CHARACTER,Di:ke.MIXER_INPUTLIST_NULL,Mi:ke.MIXER_OUTPUTLIST_NULL,Pi:ke.MIXER_OUTPUT_TARGET_INVALID,xi:ke.MIXER_NO_OUTPUT_TARGET,Ui:ke.MIXER_OUTPUT_TARGET_TOO_LONG,Li:ke.MIXER_START_REQUEST_ERROR,qi:ke.MIXER_INNER_ERROR,ji:ke.MIXER_INPUT_LABEL_TOO_LONG,Gi:ke.MIXER_INPUT_IMAGE_URL_TOO_LONG,Hi:ke.MIXER_INPUT_IMAGE_FORMAT_WRONG,$i:ke.MIXER_WATERMARK_URL_INVALID,Lt:ke.NOT_LOGIN},mix_stream_conf:ii,stop_reason:ni},Pe={event:"/mix/stop_mix",error:{Mt:ke.INPUT_PARAM,ki:ke.MIXER_TASK_ID_NULL,Li:ke.MIXER_STOP_REQUEST_ERROR,qi:ke.MIXER_INNER_ERROR,Lt:ke.NOT_LOGIN}},xe={event:"/mix/config_mix",error:{Mt:ke.INPUT_PARAM,Vi:ke.MIXER_VIDEO_CONFIG_INVALID,Bi:ke.MIXER_BACKGROUND_IMAGE_URL_INVALID,Lt:ke.NOT_LOGIN},mix_params:ii},Ue="/automix/start",Le="/automix/stop",qe=function(){return qe=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t},qe.apply(this,arguments)},je=256,Ge=1024,He=1e4;function $e(t,i){var n,e,s,r,o="",u=ke;return i.errorCode<2e9&&i.errorCode>1e9?(s={1:"MIXER_START_REQUEST_ERROR",2:"MIXER_START_REQUEST_ERROR",3:"MIXER_AUTHENTICATION_FAILED",141:"MIXER_INPUT_IMAGE_FORMAT_WRONG",142:"MIXER_INPUT_IMAGE_GET_FAIL",150:"MIXER_INPUT_STREAM_NOT_EXISTS",151:"MIXER_START_REQUEST_ERROR",152:"MIXER_STOP_REQUEST_ERROR",153:"MIXER_INPUT_PARAMETERS_ERROR",154:"MIXER_EXCEED_MAX_OUTPUT_COUNT",155:"MIXER_INPUT_PARAMETERS_ERROR",156:"MIXER_VIDEO_CONFIG_INVALID",157:"MIXER_NO_SERVICES",158:"MIXER_EXCEED_MAX_INPUT_COUNT",159:"MIXER_START_REQUEST_ERROR",160:"MIXER_NOT_OWNER_STOPMIXER",170:"MIXER_WATERMARK_PARAMETERS_ERROR",171:"MIXER_WATERMARK_NULL",175:"MIXER_REPEAT_INPUT",179:"MIXER_INPUT_LABEL_TOO_LONG",190:"MIXER_START_REQUEST_ERROR"},r="MIXER_INNER_ERROR",(e=i.errorCode-He)>1e9&&s[e-1e9]&&(r=s[e-1e9]),n=u[o=r]):i.errorCode<1e6&&(n=t.decodeServerError(i.errorCode,i.extendedData),o=t.getLiveRoomError(i.errorCode,t.useNetAgent)),{reportErr:n,actualError:u[o]}}ze=__webpack_require__(720),function(t){t[t.I=0]="I",t[t.H=10]="H",t[t.M=100]="M",t[t.L=1e3]="L"}(Ae||(Ae={}));var Ve,Be={VIDEO:0,AUDIO:1,VIDEO_ONLY:2},Je={"H.264":0,"H.265":3};function Ye(t){var i=Ve.AUDIO_ENC_HE_AAC;switch(t){case ge.ZegoAudioCodecIDNormal2:i=Ve.AUDIO_ENC_AAC_LC;break;case ge.ZegoAudioCodecIDLow3:i=Ve.AUDIO_ENC_OPUS;break;default:i=Ve.AUDIO_ENC_HE_AAC}return i}!function(t){t[t.AUDIO_ENC_HE_AAC=0]="AUDIO_ENC_HE_AAC",t[t.AUDIO_ENC_AAC_LC=1]="AUDIO_ENC_AAC_LC",t[t.AUDIO_ENC_MP3=2]="AUDIO_ENC_MP3",t[t.AUDIO_ENC_OPUS=3]="AUDIO_ENC_OPUS",t[t.AUDIO_ENC_SILK=4]="AUDIO_ENC_SILK",t[t.AUDIO_ENC_EVS=5]="AUDIO_ENC_EVS"}(Ve||(Ve={}));var Fe={},We={},Xe=[],Ze={},Ke={startMixerTask:function(t){var i=this;return new vt((function(n,e){var s,r,o,u,h,a,c,l,f,_,d,m,v=i.reporter.createSpan(Ae.H,{key:ui},{key:Me.event,par:t.taskID},Me.event,!0),p={errorCode:ke.MIXER_INPUT_PARAMETERS_ERROR.code,extendedData:ke.MIXER_INPUT_PARAMETERS_ERROR.message};if(!!(null==t?void 0:t.inputList.find((function(t){return null==t.streamID&&(p.extendedData=p.extendedData+". streamID should be of string type",!0)}))))return i.reporter.setError(v,ke.MIXER_INPUT_PARAMETERS_ERROR),void e(p);var g=t.outputConfig;g&&g.outputFps&&(g.outputFPS=g.outputFps);var b=function(n){var s=$e(i.stateCenter,n),r=s.reportErr,o=s.actualError;1000010150===n.errorCode&&v.setAttributes({stop_reason:"UnmatchStreamId"}),i.reporter.setError(v,r||n),i.reporter.spanEnd({key:Me.event,par:t.taskID}),o&&(n.errorCode=null==o?void 0:o.code,n.extendedData=(null==o?void 0:o.message)||""),e(n)},E=i.stateCenter.roomList[0];if(E){var S=[];if(!t.noTaskID&&!t.taskID)return i.logger.error("zb.sh.ums no taskId found"),void b({errorCode:Me.error.ki.code,extendedData:Me.error.ki.message});if(!t.noTaskID&&!Si(t.taskID))return i.logger.error("zb.rh.lg taskId must be string"),void b({errorCode:Me.error.Mt.code,extendedData:Me.error.Mt.message});if(!t.noTaskID&&t.taskID.length>je)return i.logger.error("zb.sh.ums taskId is too long"),void b({errorCode:Me.error.zi.code,extendedData:Me.error.zi.message});if(!t.noTaskID&&!Ni(t.taskID))return i.logger.error("zb.sh.ums task ID contains illegal characters"),void b({errorCode:Me.error.Ai.code,extendedData:Me.error.Ai.message});if(!t.inputList||0==t.inputList.length)return i.logger.error("zb.sh.ums input list wrong"),void b({errorCode:Me.error.Di.code,extendedData:Me.error.Di.message});if(t.inputList.some((function(t){return yi(t)&&!t.streamID})))return i.logger.error("zb.sh.ums input stream is null"),void b({errorCode:Me.error.Di.code,extendedData:Me.error.Di.message});for(var R=0;R<t.inputList.length;R++){var O=t.inputList[R],y={errorCode:Me.error.Mt.code,extendedData:Me.error.Mt.message};if(!yi(O.layout))return i.logger.error("zb.sh.ums input layout must be object"),void b(y);var T=O.layout,w=T.bottom,I=T.left,N=T.right;if(!(qi(T.top,!1)&&qi(w,!1)&&qi(I,!1)&&qi(N,!1)))return i.logger.error("zb.sh.ums top、left、bottom、right must be integer number"),void b(y);if(void 0!==O.renderMode&&![0,1].includes(O.renderMode))return i.logger.error("zb.sh.ums render_mode is wrong"),void b(y);if(void 0!==O.imageInfo){if(!Si(O.imageInfo.url))return i.logger.error("zb.sh.ums image url is require string"),void b(y);if(O.imageInfo.url.length>1024)return i.logger.error("zb.sh.ums input image url length too long"),void b({errorCode:Me.error.Gi.code,extendedData:Me.error.Gi.message})}if(!Oi(O.label)){if(!Si(null===(s=O.label)||void 0===s?void 0:s.text))return i.logger.error("zb.sh.ums input label text is not string"),void b({errorCode:Me.error.Mt.code,extendedData:Me.error.Mt.message+" label text is not string"});if((null===(o=null===(r=O.label)||void 0===r?void 0:r.text)||void 0===o?void 0:o.length)>=300)return i.logger.error("zb.sh.ums input label text is  too long"),void b({errorCode:Me.error.ji.code,extendedData:Me.error.ji.message});var C=O.label,k=C.left,z=C.top;if(void 0!==k&&!qi(k,!1)||void 0!==z&&!qi(z,!1))return i.logger.error("zb.sh.ums input label left and top should be integer"),void b(y)}if(void 0!==O.cornerRadius&&!Ei(O.cornerRadius))return i.logger.error("zb.sh.ums cornerRadius is wrong"),void b(y);if(void 0!==O.soundLevelID&&!qi(O.soundLevelID,!1))return i.logger.error("zb.sh.ums soundLevelID is wrong"),void b(y);if(void 0!==O.volume&&!qi(O.volume,!1))return i.logger.error("zb.sh.ums volume is wrong"),void b(y)}if(!t.outputList||0==t.outputList.length)return i.logger.error("zb.sh.ums no output list found"),void b({errorCode:Me.error.Mi.code,extendedData:Me.error.Mi.message});if(t.outputList.some((function(t){return Si(t)&&!Ci(t)&&""===t||yi(t)&&!t.target})))return i.logger.error("zb.sh.ums stream output target is nul"),void b({errorCode:Me.error.Mi.code,extendedData:Me.error.Mi.message});if(t.outputList.some((function(t){return Si(t)&&!Ci(t)&&t.length>Ge||yi(t)&&Si(t.target)&&t.target.length>Ge})))return i.logger.error("zb.sh.ums stream output target is too long"),void b({errorCode:Me.error.Ui.code,extendedData:Me.error.Ui.message});if(t.outputList.some((function(t){return Si(t)&&!Ci(t)&&!Ni(t)||yi(t)&&t.target&&!Ci(t.target)&&!Ni(t.target)})))return i.logger.error("zb.sh.ums stream output target is incorrect"),void b({errorCode:Me.error.Pi.code,extendedData:Me.error.Pi.message});if(!g||!yi(g))return i.logger.error("zb.sh.ums no output config found"),void b({errorCode:Me.error.xi.code,extendedData:Me.error.xi.message});if(!g.outputBitrate||!qi(g.outputBitrate))return i.logger.error("zb.sh.ums bitrate param is required and must be integer number"),void b({errorCode:Me.error.Mt.code,extendedData:Me.error.Mt.message});if(!g.outputFPS||!qi(g.outputFPS))return i.logger.error("zb.sh.ums fps param is required and must be integer number"),void b({errorCode:Me.error.Mt.code,extendedData:Me.error.Mt.message});if(!g.outputWidth||!qi(g.outputWidth))return i.logger.error("zb.sh.ums width param is required and must be integer number"),void b({errorCode:Me.error.Mt.code,extendedData:Me.error.Mt.message});if(!g.outputHeight||!qi(g.outputHeight))return i.logger.error("zb.sh.ums height param is required and must be integer number"),void b({errorCode:Me.error.Mt.code,extendedData:Me.error.Mt.message});if(void 0!==g.outputAudioCodecID&&!qi(g.outputAudioCodecID,!1))return i.logger.error("zb.sh.ums AudioCodecID param must be integer number"),void b({errorCode:Me.error.Mt.code,extendedData:Me.error.Mt.message});if(void 0!==g.outputAudioBitrate&&!qi(g.outputAudioBitrate))return i.logger.error("zb.sh.ums AudioBitrate param must be integer number"),void b({errorCode:Me.error.Mt.code,extendedData:Me.error.Mt.message});if(void 0!==g.outputAudioChannels&&!qi(g.outputAudioChannels,!1))return i.logger.error("zb.sh.ums AudioChannels param must be integer number"),void b({errorCode:Me.error.Mt.code,extendedData:Me.error.Mt.message});if(!Oi(t.watermark)){if(!Si(null===(u=t.watermark)||void 0===u?void 0:u.imageURL))return i.logger.error("zb.sh.ums watermark image type error"),void b({errorCode:Me.error.Mt.code,extendedData:Me.error.Mt.message});if(!Ii(null===(h=t.watermark)||void 0===h?void 0:h.imageURL))return i.logger.error("zb.sh.ums watermark image url invalid"),void b({errorCode:Me.error.$i.code,extendedData:Me.error.$i.message})}if(!Oi(t.whiteboard)){if(!Si(null===(a=t.whiteboard)||void 0===a?void 0:a.whiteboardID))return i.logger.error("zb.sh.ums whiteboard is required and must be string"),void b({errorCode:Me.error.Mt.code,extendedData:Me.error.Mt.message});if(!yi(null===(c=t.whiteboard)||void 0===c?void 0:c.layout))return i.logger.error("zb.sh.ums whiteboard layout must be object"),void b({errorCode:Me.error.Mt.code,extendedData:Me.error.Mt.message});var A=null===(l=t.whiteboard)||void 0===l?void 0:l.layout;w=A.bottom,I=A.left,N=A.right;if(!(qi(A.top,!1)&&qi(w,!1)&&qi(I,!1)&&qi(N,!1)))return i.logger.error("zb.sh.ums whiteboard top、left、bottom、right must be integer number"),void b({errorCode:Me.error.Mt.code,extendedData:Me.error.Mt.message});var D=t.whiteboard,M=D.horizontalRatio,P=D.verticalRatio,x=D.isPPTAnimation,U=D.zOrder,L=D.backgroundColor;if(!Oi(M)&&!qi(M))return i.logger.error("zb.sh.ums horizontalRatio must be integer number"),void b({errorCode:Me.error.Mt.code,extendedData:Me.error.Mt.message});if(!Oi(P)&&!qi(P))return i.logger.error("zb.sh.ums verticalRatio must be integer number"),void b({errorCode:Me.error.Mt.code,extendedData:Me.error.Mt.message});if(!Oi(x)&&!Ri(x))return i.logger.error("zb.sh.ums isPPTAnimation must be boolean"),void b({errorCode:Me.error.Mt.code,extendedData:Me.error.Mt.message});if(!Oi(U)&&!qi(U,!1))return i.logger.error("zb.sh.ums zOrder must be integer number"),void b({errorCode:Me.error.Mt.code,extendedData:Me.error.Mt.message});if(!Oi(L)&&!qi(L,!1))return i.logger.error("zb.sh.ums backgroundColor must be integer number"),void b({errorCode:Me.error.Mt.code,extendedData:Me.error.Mt.message})}if(!Oi(t.enableSoundLevel)&&!Ri(t.enableSoundLevel))return i.logger.error("zb.sh.ums enableSoundLevel is not bool"),void b({errorCode:Me.error.Mt.code,extendedData:Me.error.Mt.message});for(R=0;R<t.inputList.length;R++){var q=t.inputList[R],j=q.streamID;i.stateCenter.testEnvironment&&(j="zegotest-"+i.stateCenter.appid+"-"+q.streamID),S.push({stream_id:j,content_control:Be[q.contentType||"VIDEO"]||0,top:null===(f=q.layout)||void 0===f?void 0:f.top,left:null===(_=q.layout)||void 0===_?void 0:_.left,bottom:null===(d=q.layout)||void 0===d?void 0:d.bottom,right:null===(m=q.layout)||void 0===m?void 0:m.right,render_mode:q.renderMode,image:q.imageInfo,label:q.label})}var G=[];t.outputList.forEach((function(t){var i="";Si(t)?i=t:yi(t)&&t.target&&(i=t.target);var n=0;(i.startsWith("rtmp://")||i.startsWith("https://")&&i.endsWith(".flv")||i.startsWith("https://")&&i.endsWith(".m3u8"))&&(n=1),G.push({target:i,is_url:n?"true":"false"})}));i.reporter.spanSetAttributes({key:Me.event,par:t.taskID},{mix_stream_conf:Me.mix_stream_conf({fps:g.outputFPS,bitrate:g.outputBitrate,w:g.outputWidth,h:g.outputHeight,stream_cnt:S.length,mix_task_id:t.taskID,input_stream_list:S,output_target_list:G})}),E.streamHandler.updateMixStream(t,Fe,(function(e){i.reporter.spanEnd({key:Me.event,par:t.taskID}),n(e)}),b)}else b({errorCode:Me.error.Lt.code,extendedData:Me.error.Lt.message})}))},setMixerTaskConfig:function(t){var i=this;return new vt((function(n,e){var s,r=i.reporter.createSpan(Ae.H,{key:ui},{key:""},xe.event),o={},u=function(t){i.reporter.setError(r,t),e(t)};if(t&&t.videoCodec){var h=t.videoCodec.toLowerCase();if(-1==["vp8","h264"].indexOf(h))return i.logger.error("zb.sh.ums param videoCode error"),u({errorCode:xe.error.Vi.code,extendedData:xe.error.Vi.message}),!1;o.videoCodec=h}if(t.backgroundColor){if(!qi(t.backgroundColor))return i.logger.error("zb.sh.ums param backgroundColor must be integer number"),u({errorCode:xe.error.Mt.code,extendedData:xe.error.Mt.message}),!1;o.backgroundColor=t.backgroundColor}var a=t.backgroundImage;if(a){if(!Si(a))return i.logger.error("zb.sh.ums param outputBgImage error"),u({errorCode:xe.error.Mt.code,extendedData:xe.error.Mt.message}),!1;if(!Ii(a))return i.logger.error("zb.sh.ums illegal input background image URL"),u({errorCode:xe.error.Bi.code,extendedData:xe.error.Bi.message}),!1;o.backgroundImage=a}var c=t&&t.userData;if(c){if(!(c instanceof Uint8Array))return i.logger.error("zb.sh.ums param userData required Uint8Array"),u({errorCode:xe.error.Mt.code,extendedData:xe.error.Mt.message}),!1;if(c.byteLength>1e3)return i.logger.error("zb.sh.ums param userData should shorter than 1000"),u({errorCode:xe.error.Mt.code,extendedData:xe.error.Mt.message}),!1;o.userData=c}t.extraParams&&(o.extraParams||(o.extraParams=[]),(s=o.extraParams).push.apply(s,t.extraParams)),Fe=o,r.setAttributes({mix_params:xe.mix_params(t)}),i.stateCenter.roomList[0]?(r.end(),n({errorCode:0,extendedData:""})):u({errorCode:xe.error.Lt.code,extendedData:xe.error.Lt.message})}))},stopMixerTask:function(t){var i=this;return new vt((function(n,e){var s=i.reporter.createSpan(Ae.H,{key:ui},{key:""},Pe.event);if(!t||!Si(t)||t.length>je||!Ni(t))return i.logger.error("zb.rh.lg taskID must be string less 256"),i.reporter.setError(s,Pe.error.Mt," param taskID error"),void e({errorCode:Pe.error.Mt.code,extendedData:Pe.error.Mt.message+" param taskID error"});s.setAttributes({mix_task_id:t});var r=function(t){var n=$e(i.stateCenter,t),r=n.actualError;i.reporter.setError(s,n.reportErr||t),r&&(t.errorCode=null==r?void 0:r.code,t.extendedData=(null==r?void 0:r.message)||""),e(t)},o=i.stateCenter.roomList[0];o?o.streamHandler.stopMixStream(t,(function(t){s.end(),n(t)}),r):r({errorCode:Pe.error.Lt.code,extendedData:Pe.error.Lt.message})}))},startAutoMixerTask:function(t){var i=this;return new vt((function(n,e){var s,r,o=i.reporter.createSpan(Ae.H,{key:ui},{key:Ue,par:t.taskID},Ue,!0),u=function(n){var s=$e(i.stateCenter,n),r=s.reportErr;1000010150===n.errorCode&&o.setAttributes({stop_reason:"UnmatchStreamId"}),i.reporter.setError(o,r||n),i.reporter.spanEnd({key:Ue,par:t.taskID}),e(n)},h=i.stateCenter.roomList[0];if(h){if(!t.taskID)return i.logger.error("zb.sh.ums no taskId found"),void u({errorCode:Me.error.ki.code,extendedData:Me.error.ki.message});if(!Si(t.taskID))return i.logger.error("zb.rh.lg taskId must be string"),void u({errorCode:Me.error.Mt.code,extendedData:Me.error.Mt.message});if(t.taskID.length>je)return i.logger.error("zb.sh.ums taskId is too long"),void u({errorCode:Me.error.zi.code,extendedData:Me.error.zi.message});if(!Ni(t.taskID))return i.logger.error("zb.sh.ums task ID contains illegal characters"),void u({errorCode:Me.error.Ai.code,extendedData:Me.error.Ai.message});if(!t.roomID)return i.logger.error("zb.sh.ums no roomID found"),void u({errorCode:Dt,extendedData:Mt});if(!Si(t.roomID))return i.logger.error("zb.rh.lg roomID must be string"),void u({errorCode:Me.error.Mt.code,extendedData:Me.error.Mt.message});if(t.roomID.length>128)return i.logger.error("zb.sh.ums roomID is too long"),void u({errorCode:Ut,extendedData:Lt});if(!Ni(t.roomID))return i.logger.error("zb.sh.ums room ID contains illegal characters"),void u({errorCode:Pt,extendedData:xt});if(!t.outputList||0==t.outputList.length)return i.logger.error("zb.sh.ums no output list found"),void u({errorCode:Me.error.Mi.code,extendedData:Me.error.Mi.message});if(t.outputList.some((function(t){return yi(t)&&!t.target})))return i.logger.error("zb.sh.ums stream output target is nul"),void u({errorCode:Me.error.Mi.code,extendedData:Me.error.Mi.message});if(t.outputList.some((function(t){return yi(t)&&Si(t.target)&&t.target.length>Ge})))return i.logger.error("zb.sh.ums stream output target is too long"),void u({errorCode:Me.error.Ui.code,extendedData:Me.error.Ui.message});if(t.outputList.some((function(t){return yi(t)&&t.target&&!Ci(t.target)&&!Ni(t.target)})))return i.logger.error("zb.sh.ums stream output target is incorrect"),void u({errorCode:Me.error.Pi.code,extendedData:Me.error.Pi.message});if(t.audioConfig){if(void 0!==(null===(s=t.audioConfig)||void 0===s?void 0:s.bitrate)&&!qi(null===(r=t.audioConfig)||void 0===r?void 0:r.bitrate))return i.logger.error("zb.sh.ums audio bitrate param is required and must be integer number"),void u({errorCode:Me.error.Mt.code,extendedData:Me.error.Mt.message});if(void 0!==t.audioConfig.codecID&&!qi(t.audioConfig.codecID,!1))return i.logger.error("zb.sh.ums AudioCodecID param must be integer number"),void u({errorCode:Me.error.Mt.code,extendedData:Me.error.Mt.message});if(void 0!==t.audioConfig.channel&&![1,2].includes(t.audioConfig.channel))return i.logger.error("zb.sh.ums AudioChannels param must be 1 or 2"),void u({errorCode:Me.error.Mt.code,extendedData:Me.error.Mt.message})}if(!Oi(t.enableSoundLevel)&&!Ri(t.enableSoundLevel))return i.logger.error("zb.sh.ums enableSoundLevel is not bool"),void u({errorCode:Me.error.Mt.code,extendedData:Me.error.Mt.message});t.outputList.forEach((function(t){var i="";Si(t)?i=t:yi(t)&&t.target&&(i=t.target);i.startsWith("rtmp://")||i.startsWith("https://")&&i.endsWith(".flv")||i.startsWith("https://")&&i.endsWith(".m3u8")})),i.reporter.spanSetAttributes({key:Ue,par:t.taskID},{task_id:t.taskID,room_id:t.roomID,with_sound_level:t.enableSoundLevel?1:0,alignment_type:t.streamAlignmentMode||0,recv_buffer_level:t.minPlayStreamBufferLength||0,output_target_list:[]}),h.streamHandler.updateAutoMixStream(t,(function(e){i.reporter.spanEnd({key:Ue,par:t.taskID}),n(e)}),u)}else u({errorCode:Me.error.Lt.code,extendedData:Me.error.Lt.message})}))},stopAutoMixerTask:function(t){var i=this;return new vt((function(n,e){var s=i.reporter.createSpan(Ae.H,{key:ui},{key:""},Le);if(!t.taskID||!Si(t.taskID)||t.taskID.length>je||!Ni(t.taskID))return i.logger.error("zb.rh.lg taskID must be string less 256"),i.reporter.setError(s,Pe.error.Mt," param taskID error"),void e({errorCode:Pe.error.Mt.code,extendedData:Pe.error.Mt.message+" param taskID error"});s.setAttributes({task_id:t.taskID,room_id:t.roomID});var r=function(t){var n=$e(i.stateCenter,t);i.reporter.setError(s,n.reportErr||t),e(t)},o=i.stateCenter.roomList[0];o?o.streamHandler.stopAutoMixStream(t,(function(t){s.end(),n(t)}),r):r({errorCode:Pe.error.Lt.code,extendedData:Pe.error.Lt.message})}))}},Qe={_sendMixStopReqByAccessHub:function(t,i,n){var e=this;this.mixStreamProtoBuf||(this.mixStreamProtoBuf=new De),t.timestamp=ze.fromInt(Math.ceil((new Date).getTime()/1e3)),this.logger.info("zb.sh.smseba.1 req "+JSON.stringify(t));var s=this.mixStreamProtoBuf.encodeMixStreamStopReq(t),r=function(i,n){try{var s=e.mixStreamProtoBuf.decodeMixStreamStopRsp(i);Ji(s),e.logger.info("zb.sh.smseba.1 rsp "+JSON.stringify(t));var r=(null==s?void 0:s.common_response)||{};return{code:r.code,msg:r.message}}catch(t){return{code:-1}}};this.sendMixRequest({interfaceID:16},s,(function(t,e){var s=r(t),o=s.code,u=s.msg;0!=o&&null!=o||!Ti(i)?n&&n({errorCode:o,extendedData:u||""}):i({errorCode:o,extendedData:u})}),(function(t,i,s){var o="";if(s)return s.code==ke.TIMEOUT.code&&(s=Me.error.qi),s.code&&20010===s.code&&(s=JSON.parse(JSON.stringify(ke.MIXER_NO_SERVICES))),void(n&&n(s,o));s=Me.error.qi;var u="";if(Si(i))u=i;else{var h=r(i);u=h.code+" "+h.msg}e.logger.error("zb.sh.pt "+(o="request media server fail, error: "+t+" "+u)),n&&n(s,o)}))},stopMixStream:function(t,i,n,e,s){this.logger.info("zb.sh.sms call");var r=this.getStopMixStreamParams(t,e,s);this.stateCenter.useNetAgent&&this._sendMixStopReqByAccessHub(r.mixStopReq,(function(n){Ze[t]&&(Ze[t].timer&&clearTimeout(Ze[t].timer),delete Ze[t]),i(n)}),n)},_sendMixStartReqByAccessHub:function(t,i,n,e){var s=this;this.mixStreamProtoBuf||(this.mixStreamProtoBuf=new De),t.timestamp=ze.fromInt(Math.ceil((new Date).getTime()/1e3)),this.logger.info("zb.sh.smseba.0 req "+JSON.stringify(t));var r=this.mixStreamProtoBuf.encodeMixStreamStartReq(t),o=function(t,i){try{var n=s.mixStreamProtoBuf.decodeMixStreamStartRsp(t);Ji(n),s.logger.info("zb.sh.smseba.0 rsp "+JSON.stringify(n));var e=n.common_response;return{code:e.code,msg:e.message,data:n.data,errStreamList:n.error_streamid_list}}catch(t){return{code:-1}}};this.sendMixRequest({interfaceID:15},r,(function(r,u){var h=o(r),a=h.code,c=h.data,l=h.errStreamList;if(void 0===a||0==a){var f=c.play_infos.map((function(t){var n={rtmpURL:"",hlsURL:"",flvURL:""},e=t.stream_alias||"";return s.stateCenter.testEnvironment&&e&&e.startsWith(i)&&(e=e.slice(i.length)),n.streamID=e,t.rtmp_url&&t.rtmp_url.length>0&&(n.rtmpURL=t.rtmp_url),t.hls_url&&t.hls_url.length>0&&(n.hlsURL=t.hls_url),t.hdl_url&&t.hdl_url.length>0&&(n.flvURL=t.hdl_url),n}));if(c.request_id){We[t.task_id]||(We[t.task_id]={mixStatusVer:0,requestId:c.request_id}),We[t.task_id].requestId=c.request_id;var _=Xe.findIndex((function(t){return t==c.request_id}));_>-1&&(s.fetchMixStreamStatus(s.stateCenter.appid+":"+t.task_id),Xe.splice(_,1))}if(n)n({errorCode:0,extendedData:JSON.stringify({mixerOutputList:f})})}else{var d="",m=a+1e9;if(1000000150==m&&l){var v=l.map((function(t){return s.stateCenter.testEnvironment&&t.startsWith(i)?t.slice(i.length):t}))||[];v.length>0&&(s.logger.debug("zb.sh.ums not exist streams: "+v),d=v.join(","))}e&&e({errorCode:s.stateCenter.getServerError(He+m,s.stateCenter.useNetAgent).code,extendedData:d})}}),(function(t,i,n){var r="";if(n)return n.code==ke.TIMEOUT.code&&(n=Me.error.Li),n.code&&20010===n.code&&(n=JSON.parse(JSON.stringify(ke.MIXER_NO_SERVICES))),void(e&&e(n,r));n=Me.error.qi;var u="";if(Si(i))u=i;else{var h=o(i);u=h.code+" "+h.msg}s.logger.error("zb.sh.pt "+(r="request media server fail, error: "+t+" "+u)),e&&e(n,r)}))},getStartMixStreamParams:function(t,i){var n,e,s=this,r={request_seq:this.stateCenter.getSeq(),mix_protocol_version:1,task_id:t.taskID,room_id:this.roomID,mix_stream_common:{},input_stream:[],advance_config:[],output_stream:[]},o=t.outputConfig||{};o.singleStreamPassThrough&&Ri(o.singleStreamPassThrough)&&(r.mix_stream_common.single_stream_pass_through=o.singleStreamPassThrough?1:0);var u=i;if(u&&(u.videoCodec&&(null===(n=r.advance_config)||void 0===n||n.push({key:"video_encode",value:u.videoCodec})),u.backgroundColor&&(r.mix_stream_common.output_bg_color=u.backgroundColor),u.backgroundImage&&(r.mix_stream_common.output_bg_image=u.backgroundImage),u.userData&&(r.mix_stream_common.user_data=this.stateCenter.uint8arrayToBase64(u.userData)),u.extraParams&&(null===(e=r.advance_config)||void 0===e||e.push.apply(e,u.extraParams))),void 0!==t.enableSoundLevel&&(r.mix_stream_common.with_sound_level=t.enableSoundLevel?1:0),t.inputList.forEach((function(t,i){var n,e,o,u,h,a,c,l,f,_,d,m,v,p,g,b,E,S,R,O,y,T,w=t.streamID;s.stateCenter.testEnvironment&&(w="zegotest-"+s.stateCenter.appid+"-"+t.streamID);var I={stream_input_common:{stream_id:w,content_control:Be[t.contentType||"VIDEO"]||0,layer_rect:{layer:null===(n=t.layout)||void 0===n?void 0:n.layer,top:null===(e=t.layout)||void 0===e?void 0:e.top,left:null===(o=t.layout)||void 0===o?void 0:o.left,bottom:null===(u=t.layout)||void 0===u?void 0:u.bottom,right:null===(h=t.layout)||void 0===h?void 0:h.right}},volume:null!==(a=t.volume)&&void 0!==a?a:100,audio_focus:t.isAudioFocus?1:0,audio_h_angle:-1,render_mode:t.renderMode,corner_radius:t.cornerRadius};if(null===(c=t.label)||void 0===c?void 0:c.text){var N={font_type:(null===(f=null===(l=t.label)||void 0===l?void 0:l.font)||void 0===f?void 0:f.type)||0,font_size:(null===(d=null===(_=t.label)||void 0===_?void 0:_.font)||void 0===d?void 0:d.size)||24,font_color:(null===(v=null===(m=t.label)||void 0===m?void 0:m.font)||void 0===v?void 0:v.color)||16777215,font_transparency:(null===(g=null===(p=t.label)||void 0===p?void 0:p.font)||void 0===g?void 0:g.transparency)||0};N.font_border_color=(null===(E=null===(b=t.label)||void 0===b?void 0:b.font)||void 0===E?void 0:E.border)?null===(R=null===(S=t.label)||void 0===S?void 0:S.font)||void 0===R?void 0:R.borderColor:-1;var C={text:null===(O=t.label)||void 0===O?void 0:O.text,text_left:(null===(y=t.label)||void 0===y?void 0:y.left)||0,text_top:(null===(T=t.label)||void 0===T?void 0:T.top)||0,font:N};I.label=C}t.imageInfo&&(I.image={url:t.imageInfo.url}),t.soundLevelID&&(I.stream_input_common.sound_level_id=t.soundLevelID),r.input_stream.push(I)})),t.outputList.forEach((function(t){var i,n,e,h,a,c,l,f,_,d,m,v,p,g="";if(Si(t)?g=t:yi(t)&&t.target?g=t.target:s.logger.error("zb.sh.ums output target required"),Ci(g))v=1,p=g;else{v=0,p=s.stateCenter.testEnvironment?"zegotest-"+s.stateCenter.appid+"-"+g:g}var b=o.outputBitrate;"string"!=typeof t&&(null===(i=t.videoConfig)||void 0===i?void 0:i.bitrate)&&(b=null===(n=t.videoConfig)||void 0===n?void 0:n.bitrate);var E={is_url:v,target:p,video_bitrate:1e3*b,video_fps:o.outputFPS,video_width:o.outputWidth,video_height:o.outputHeight,output_quality:23};o.outputAudioCodecID&&(E.audio_enc_id=o.outputAudioCodecID),"vp8"===u.videoCodec?E.audio_enc_id=3:"h264"===u.videoCodec&&(E.audio_enc_id=0),o.outputAudioBitrate&&(E.audio_bitrate=1e3*o.outputAudioBitrate);var S={output_stream_common:E};"string"!=typeof t&&((null===(e=t.videoConfig)||void 0===e?void 0:e.videoCodecID)&&(S.video_enc_id=Je[null===(h=t.videoConfig)||void 0===h?void 0:h.videoCodecID]||0),(null===(a=t.videoConfig)||void 0===a?void 0:a.encodeProfile)&&[0,1,2,3].includes(null===(c=t.videoConfig)||void 0===c?void 0:c.encodeProfile)&&(S.video_encode_profile=function(t){var i=1;switch(t){case Ee.ZegoEncodeProfileDefault:case Ee.ZegoEncodeProfileMain:i=1;break;case Ee.ZegoEncodeProfileBaseline:i=0;break;case Ee.ZegoEncodeProfileHigh:i=2}return i}(null===(l=t.videoConfig)||void 0===l?void 0:l.encodeProfile)),Ei(null===(f=t.videoConfig)||void 0===f?void 0:f.encodeLatency)&&(S.video_encode_latency=null===(_=t.videoConfig)||void 0===_?void 0:_.encodeLatency),Ri(null===(d=t.videoConfig)||void 0===d?void 0:d.enableLowBitrateHD)&&(S.low_bitrate_hd=(null===(m=t.videoConfig)||void 0===m?void 0:m.enableLowBitrateHD)?1:0)),r.output_stream.push(S)})),t.watermark&&(r.water_mark={image:t.watermark.imageURL,layout_rect:t.watermark.layout}),t.whiteboard){var h=t.whiteboard,a=h.horizontalRatio,c=h.verticalRatio,l=h.layout,f=h.zOrder,_=h.isPPTAnimation,d=h.backgroundColor;r.white_board={whiteboard_id:ze.fromString(h.whiteboardID),horizontal_ratio:a||16,vertical_ratio:c||9,is_ppt_animation:!0===_?1:0,layout_rect:qe(qe({},l),{layer:f||0}),background_color:d||4059296768}}return isNaN(t.streamAlignmentMode)||(r.mix_stream_common.alignment_type=t.streamAlignmentMode),r.audio_channel_cnt=o.outputAudioChannels?o.outputAudioChannels:1,o.audioMixMode&&(r.audio_mix_mode=o.audioMixMode),{mixStartReq:r}},updateMixStream:function(t,i,n,e){var s=this;this.logger.info("zb.sh.ums call"),this.logger.info("zb.sh.ums send command");var r=this.getStartMixStreamParams(t,i).mixStartReq;return this.stateCenter.useNetAgent&&this._sendMixStartReqByAccessHub(r,"zegotest-"+this.stateCenter.appid+"-",(function(i){s.startMixHb(t.taskID),n(i)}),e),!0},updateAutoMixStream:function(t,i,n){var e=this;this.logger.info("zb.sh.uams.0 call");var s=t.taskID,r=t.roomID,o=t.audioConfig,u=t.outputList,h=t.enableSoundLevel,a=t.streamAlignmentMode,c=t.minPlayStreamBufferLength;if(this.stateCenter.useNetAgent){this.mixStreamProtoBuf||(this.mixStreamProtoBuf=new De);var l=[];u.forEach((function(t){var i=t.target,n=0;(i.startsWith("rtmp://")||i.startsWith("avertp://")||i.startsWith("https://")&&i.endsWith(".flv")||i.startsWith("https://")&&i.endsWith(".m3u8"))&&(n=1),l.push({stream_out_common:{target:i,is_url:n,audio_bitrate:(null==o?void 0:o.bitrate)?1e3*(null==o?void 0:o.bitrate):48e3,audio_enc_id:Oi(null==o?void 0:o.codecID)?0:Ye(null==o?void 0:o.codecID),video_fps:1,video_bitrate:1,video_width:1,video_height:1},audio_channel_cnt:(null==o?void 0:o.channel)||1})}));var f={request_seq:this.stateCenter.getSeq(),mix_stream_common:{with_sound_level:h?1:0,alignment_type:a},room_id:r,task_id:s,output_stream:l};Ei(c)&&c>=0&&(f.has_recv_buffer_level=!0,f.recv_buffer_level=c),this.logger.info("zb.sh.uams.0 params "+JSON.stringify(f));var _=this.mixStreamProtoBuf.encodeAutoRoomMixStreamStartReq(f),d=function(t,i){try{var n=e.mixStreamProtoBuf.decodeAutoRoomMixStreamStartRsp(t);Ji(n),e.logger.info("zb.sh.uams.0 rsp "+JSON.stringify(n));var s=n.common_response;return{code:s.code,msg:s.message}}catch(t){return{code:-1}}};this.sendMixRequest({interfaceID:10},_,(function(t,s){e.mixSucFun(t,i,n,d,"zb.sh.uams.0")}),(function(t,i,s){e.mixFailFun(t,i,s,n,d,"zb.sh.uams.0")}),6)}return!0},stopAutoMixStream:function(t,i,n){var e=this,s=t.taskID,r=t.roomID,o={request_seq:this.stateCenter.getSeq(),room_id:r,task_id:s};this.logger.info("zb.sh.uams.1 params "+JSON.stringify(o));var u=this.mixStreamProtoBuf.encodeAutoRoomMixStreamStopReq(o),h=function(t,i){try{var n=e.mixStreamProtoBuf.decodeAutoRoomMixStreamStopRsp(t);Ji(n),e.logger.info("zb.sh.smseba.0 rsp "+JSON.stringify(n));var s=n.common_response;return{code:s.code,msg:s.message}}catch(t){return{code:-1}}};this.sendMixRequest({interfaceID:11},u,(function(t,s){e.mixSucFun(t,i,n,h,"zb.sh.uams.1")}),(function(t,i,s){e.mixFailFun(t,i,s,n,h,"zb.sh.uams.1")}),6)},mixSucFun:function(t,i,n,e,s,r){var o=e(t,r),u=o.code,h=o.msg;void 0===u||0===u?(this.logger.info(s+" suc"),i&&i({errorCode:0,extendedData:""})):(this.logger.info(s+" fail "+u+" "+h),n&&n({errorCode:this.stateCenter.getServerError(He+(u+1e9),this.stateCenter.useNetAgent).code,extendedData:h}))},mixFailFun:function(t,i,n,e,s,r){var o="";if(n)return n.code==ke.TIMEOUT.code&&(n=Me.error.qi),n.code&&20010===n.code&&(n=JSON.parse(JSON.stringify(ke.MIXER_NO_SERVICES))),void(e&&e(n,o));n=Me.error.qi;var u="";if(Si(i))u=i;else{var h=s(i);u=h.code+" "+h.msg}o="request media server fail, error: "+t+" "+u,this.logger.error("".concat(r," http fail ").concat(o)),e&&e(n,o)},getStopMixStreamParams:function(t,i,n){var e={id_name:this.stateCenter.idName,live_channel:this.roomID,appid:this.stateCenter.appid,version:"3.2.0"},s={request_seq:this.stateCenter.getSeq(),room_id:this.roomID};if(Si(t)&&(e.task_id=t,s.task_id=t),null!=i){var r=void 0;e.stream_id=r=this.stateCenter.testEnvironment?"zegotest-"+this.stateCenter.appid+"-"+i:i,s.is_url=0,s.target=r}else null!=n&&(e.mixurl=n,s.is_url=1,s.target=n);return{req_body:e,mixStopReq:s}},getMixStreamStatus:function(t){this.logger.info("zb.sh.fmss call");for(var i=0;i<t.length;i++){var n=t[i],e=n.trans_type.replace("mixpushstatus:",""),s=e.replace(this.stateCenter.appid+":",""),r=We[s],o=JSON.parse(n.trans_data),u=o.request_id;if(r&&r.requestId===u){var h=parseInt(o.version);h<=r.mixStatusVer&&1!=h?this.logger.info("zb.sh.fmss data ver is not new"):this.fetchMixStreamStatus(e)}else this.logger.info("zb.sh.fmss taskId don't exist"),Xe.push(u)}},fetchMixStreamStatus:function(t){var i=this;this.mixStreamProtoBuf||(this.mixStreamProtoBuf=new De);var n={request_seq:this.stateCenter.getSeq(),task_id:t},e=this.mixStreamProtoBuf.encodeGetMixStreamStatusReq(n),s=t.replace(this.stateCenter.appid+":","");this.sendMixRequest({interfaceID:13},e,(function(t,n){var e=function(t,n){try{var e=i.mixStreamProtoBuf.decodeGetMixStreamStatusRsp(t);Ji(e),i.logger.info("zb.sh.fmss rsp "+JSON.stringify(e));var s=e.common_response;return{code:s.code,msg:s.message,push_url:e.push_url,request_seq:e.request_seq,task_id:e.task_id,version:e.version}}catch(t){return{code:-1}}}(t),r=e.code,o=e.msg,u=e.push_url,h=e.task_id,a=e.version;if(void 0!==r&&0!==r||!Ei(a))i.logger.warn("zb.sh.fmss fail "+r+" "+o);else{var c=We[s];if(!c)return void i.logger.info("zb.sh.fmss taskId don't exist");if(a<=c.mixStatusVer&&1!=a)return void i.logger.warn("zb.sh.fmss data ver is not new");c.mixStatusVer=a;var l=[];u.forEach((function(t){l.push({url:t.url,state:it[t.status],updateReason:nt[t.reason],stateTime:t.mod_time.toNumber()})})),i.stateCenter.actionListener("mixerRelayCDNStateUpdate",h,l)}}),(function(t,n,e){i.logger.warn("zb.sh.fmss http fail "+t+" "+JSON.stringify(e))}))},startMixHb:function(t){var i=this;this.logger.info("zb.sh.smh.0 call");var n={request_seq:this.stateCenter.getSeq(),task_id:"".concat(t)},e=this.mixStreamProtoBuf.encodeMixStreamTaskHbReq(n);this.sendMixRequest({interfaceID:12},e,(function(n,e){var s=function(t,n){try{var e=i.mixStreamProtoBuf.decodeMixStreamTaskHbRsp(t);Ji(e),i.logger.info("zb.sh.smh.0 rsp "+JSON.stringify(e));var s=e.common_response;return{code:s.code,msg:s.message,status:e.status,hb_interval:e.hb_interval}}catch(t){return{code:-1}}}(n),r=s.code,o=s.msg,u=s.status,h=s.hb_interval;void 0===r||0===r?(i.logger.info("zb.sh.smh.0 suc ".concat(u," ").concat(h)),Ei(h)&&0===u&&(!Ze[t]&&(Ze[t]={}),Ze[t].timer=setTimeout((function(){i.startMixHb(t)}),1e3*h))):i.logger.info("zb.sh.smh.0 fail ".concat(r," ").concat(o))}),(function(t,n,e){i.logger.info("zb.sh.smh.0 send err ".concat(t," ").concat(e))}))}},ts={type:"MixStream",install:function(t,i){for(var n in Ke)Object.defineProperty(t.prototype,n,{value:Ke[n],writable:!1});for(var n in Qe)Object.defineProperty(i.prototype,n,{value:Qe[n],writable:!1})}},is=function(){var t=function(i,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])},t(i,n)};return function(i,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function e(){this.constructor=i}t(i,n),i.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}}();Yn.use(Wn()),Yn.use(Ce),Yn.use(ts);var ns=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return is(i,t),i}(Yn)})(),__webpack_exports__})()}));